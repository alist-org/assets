import{a9 as Er,r as vt,a8 as fa,ak as qo,al as zu,R as oe,am as ye,l as Tp,j as ca,aj as Ku,n as bi,C as Si,H as fs,t as da,an as Mn,o as Op,p as Ap,V as el,q as Vu,D as jr,v as tl,u as wp,ao as Lp,a3 as Dp,ap as Pp,aa as Gu,K as Rp,$ as Cp,a0 as Ip,A as Mp,a1 as kp,a2 as Np,L as Bp,aq as Fp,ag as Ti}from"./vendor.e93814c3.js";import{a as Up,g as cs}from"./clsx.m.3209b210.js";import{I as Sn,P as jp,i as Wp,Q as zp}from"./index.af9b405a.js";import{d as kn,u as Kp,_ as Vp}from"./index.901a944a.js";import{u as Gp}from"./useTitle.b2d04281.js";import"./index.esm.0e795abe.js";import"./index.09abe110.js";import"./copy-clip.08e8f9de.js";var Oi={exports:{}};/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/(function(i){(function(){var e={}.hasOwnProperty;function r(){for(var n=[],t=0;t<arguments.length;t++){var a=arguments[t];if(!!a){var s=typeof a;if(s==="string"||s==="number")n.push(a);else if(Array.isArray(a)){if(a.length){var o=r.apply(null,a);o&&n.push(o)}}else if(s==="object")if(a.toString===Object.prototype.toString)for(var p in a)e.call(a,p)&&a[p]&&n.push(p);else n.push(a.toString())}}return n.join(" ")}i.exports?(r.default=r,i.exports=r):window.classNames=r})()})(Oi);var ar=Oi.exports,Hu={exports:{}};(function(i,e){(function(r,n){i.exports=n()})(Er,function(){return function r(n,t,a){var s=window,o="application/octet-stream",p=a||o,x=n,g=!t&&!a&&x,d=document.createElement("a"),h=function(E){return String(E)},y=s.Blob||s.MozBlob||s.WebKitBlob||h,b=t||"download",T,_;if(y=y.call?y.bind(s):Blob,String(this)==="true"&&(x=[x,p],p=x[0],x=x[1]),g&&g.length<2048&&(b=g.split("/").pop().split("?")[0],d.href=g,d.href.indexOf(g)!==-1)){var c=new XMLHttpRequest;return c.open("GET",g,!0),c.responseType="blob",c.onload=function(E){r(E.target.response,b,o)},setTimeout(function(){c.send()},0),c}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(x))if(x.length>1024*1024*1.999&&y!==h)x=l(x),p=x.type||o;else return navigator.msSaveBlob?navigator.msSaveBlob(l(x),b):m(x);else if(/([\x80-\xff])/.test(x)){var u=0,f=new Uint8Array(x.length),v=f.length;for(u;u<v;++u)f[u]=x.charCodeAt(u);x=new y([f],{type:p})}T=x instanceof y?x:new y([x],{type:p});function l(E){var S=E.split(/[:;,]/),O=S[1],D=S[2]=="base64"?atob:decodeURIComponent,P=D(S.pop()),A=P.length,w=0,L=new Uint8Array(A);for(w;w<A;++w)L[w]=P.charCodeAt(w);return new y([L],{type:O})}function m(E,S){if("download"in d)return d.href=E,d.setAttribute("download",b),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout(function(){d.click(),document.body.removeChild(d),S===!0&&setTimeout(function(){s.URL.revokeObjectURL(d.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(E)&&(E="data:"+E.replace(/^data:([\w\/\-\+]+)/,o)),window.open(E)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=E),!0;var O=document.createElement("iframe");document.body.appendChild(O),!S&&/^data:/.test(E)&&(E="data:"+E.replace(/^data:([\w\/\-\+]+)/,o)),O.src=E,setTimeout(function(){document.body.removeChild(O)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(T,b);if(s.URL)m(s.URL.createObjectURL(T),!0);else{if(typeof T=="string"||T.constructor===h)try{return m("data:"+p+";base64,"+s.btoa(T))}catch(E){return m("data:"+p+","+encodeURIComponent(T))}_=new FileReader,_.onload=function(E){m(this.result)},_.readAsDataURL(T)}return!0}})})(Hu);var $u=Hu.exports,ds={exports:{}};ds.exports=rl;ds.exports.isMobile=rl;ds.exports.default=rl;var Hp=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,$p=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i;function rl(i){i||(i={});var e=i.ua;if(!e&&typeof navigator!="undefined"&&(e=navigator.userAgent),e&&e.headers&&typeof e.headers["user-agent"]=="string"&&(e=e.headers["user-agent"]),typeof e!="string")return!1;var r=i.tablet?$p.test(e):Hp.test(e);return!r&&i.tablet&&i.featureDetect&&navigator&&navigator.maxTouchPoints>1&&e.indexOf("Macintosh")!==-1&&e.indexOf("Safari")!==-1&&(r=!0),r}var Yp=ds.exports,nl={},il={exports:{}},hs={exports:{}};(function(i){function e(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?(i.exports=e=function(t){return typeof t},i.exports.default=i.exports,i.exports.__esModule=!0):(i.exports=e=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i.exports.default=i.exports,i.exports.__esModule=!0),e(r)}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(hs);(function(i){var e=hs.exports.default;function r(t){if(typeof WeakMap!="function")return null;var a=new WeakMap,s=new WeakMap;return(r=function(p){return p?s:a})(t)}function n(t,a){if(!a&&t&&t.__esModule)return t;if(t===null||e(t)!=="object"&&typeof t!="function")return{default:t};var s=r(a);if(s&&s.has(t))return s.get(t);var o={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in t)if(x!=="default"&&Object.prototype.hasOwnProperty.call(t,x)){var g=p?Object.getOwnPropertyDescriptor(t,x):null;g&&(g.get||g.set)?Object.defineProperty(o,x,g):o[x]=t[x]}return o.default=t,s&&s.set(t,o),o}i.exports=n,i.exports.default=i.exports,i.exports.__esModule=!0})(il);var Nn={exports:{}};(function(i){function e(r){return r&&r.__esModule?r:{default:r}}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(Nn);var qn={exports:{}},ei={exports:{}};(function(i){function e(r,n,t){return n in r?Object.defineProperty(r,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[n]=t,r}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(ei);(function(i){var e=ei.exports;function r(t,a){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);a&&(o=o.filter(function(p){return Object.getOwnPropertyDescriptor(t,p).enumerable})),s.push.apply(s,o)}return s}function n(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?r(Object(s),!0).forEach(function(o){e(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}i.exports=n,i.exports.default=i.exports,i.exports.__esModule=!0})(qn);var ps={exports:{}};(function(i){function e(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(ps);var vs={exports:{}};(function(i){function e(n,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function r(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}i.exports=r,i.exports.default=i.exports,i.exports.__esModule=!0})(vs);var gs={exports:{}},Yu={exports:{}};(function(i){function e(r,n){return i.exports=e=Object.setPrototypeOf||function(a,s){return a.__proto__=s,a},i.exports.default=i.exports,i.exports.__esModule=!0,e(r,n)}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(Yu);(function(i){var e=Yu.exports;function r(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t&&e(n,t)}i.exports=r,i.exports.default=i.exports,i.exports.__esModule=!0})(gs);var ms={exports:{}},ys={exports:{}};(function(i){function e(r){return i.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i.exports.default=i.exports,i.exports.__esModule=!0,e(r)}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(ys);var Xu={exports:{}};(function(i){function e(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(r){return!1}}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(Xu);var Zu={exports:{}},Qu={exports:{}};(function(i){function e(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(Qu);(function(i){var e=hs.exports.default,r=Qu.exports;function n(t,a){if(a&&(e(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return r(t)}i.exports=n,i.exports.default=i.exports,i.exports.__esModule=!0})(Zu);(function(i){var e=ys.exports,r=Xu.exports,n=Zu.exports;function t(a){var s=r();return function(){var p=e(a),x;if(s){var g=e(this).constructor;x=Reflect.construct(p,arguments,g)}else x=p.apply(this,arguments);return n(this,x)}}i.exports=t,i.exports.default=i.exports,i.exports.__esModule=!0})(ms);var Wr={};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.warning=Ju;Wr.note=qu;Wr.resetWarned=Xp;Wr.call=sl;Wr.warningOnce=ef;Wr.noteOnce=Zp;Wr.default=void 0;var al={};function Ju(i,e){}function qu(i,e){}function Xp(){al={}}function sl(i,e,r){!e&&!al[r]&&(i(!1,r),al[r]=!0)}function ef(i,e){sl(Ju,i,e)}function Zp(i,e){sl(qu,i,e)}var Qp=ef;Wr.default=Qp;var Es={},ol=Nn.exports;Object.defineProperty(Es,"__esModule",{value:!0});Es.default=void 0;var tf=ol(qn.exports),Ai=ol(ei.exports),Jp=ol(vt.exports),qp=function(e){var r,n,t=e.className,a=e.included,s=e.vertical,o=e.style,p=e.length,x=e.offset,g=e.reverse;p<0&&(g=!g,p=Math.abs(p),x=100-x);var d=s?(r={},(0,Ai.default)(r,g?"top":"bottom","".concat(x,"%")),(0,Ai.default)(r,g?"bottom":"top","auto"),(0,Ai.default)(r,"height","".concat(p,"%")),r):(n={},(0,Ai.default)(n,g?"right":"left","".concat(x,"%")),(0,Ai.default)(n,g?"left":"right","auto"),(0,Ai.default)(n,"width","".concat(p,"%")),n),h=(0,tf.default)((0,tf.default)({},o),d);return a?Jp.default.createElement("div",{className:t,style:h}):null},ev=qp;Es.default=ev;var ll={},ul={exports:{}};(function(i){function e(){return i.exports=e=Object.assign||function(r){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},i.exports.default=i.exports,i.exports.__esModule=!0,e.apply(this,arguments)}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(ul);var fl={exports:{}},rf={exports:{}};(function(i){function e(r,n){if(r==null)return{};var t={},a=Object.keys(r),s,o;for(o=0;o<a.length;o++)s=a[o],!(n.indexOf(s)>=0)&&(t[s]=r[s]);return t}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(rf);(function(i){var e=rf.exports;function r(n,t){if(n==null)return{};var a=e(n,t),s,o;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(o=0;o<p.length;o++)s=p[o],!(t.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}i.exports=r,i.exports.default=i.exports,i.exports.__esModule=!0})(fl);var cl={exports:{}},nf={exports:{}},dl={exports:{}};(function(i){function e(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=r[t];return a}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(dl);(function(i){var e=dl.exports;function r(n){if(Array.isArray(n))return e(n)}i.exports=r,i.exports.default=i.exports,i.exports.__esModule=!0})(nf);var af={exports:{}};(function(i){function e(r){if(typeof Symbol!="undefined"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(af);var sf={exports:{}};(function(i){var e=dl.exports;function r(n,t){if(!!n){if(typeof n=="string")return e(n,t);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return e(n,t)}}i.exports=r,i.exports.default=i.exports,i.exports.__esModule=!0})(sf);var of={exports:{}};(function(i){function e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(of);(function(i){var e=nf.exports,r=af.exports,n=sf.exports,t=of.exports;function a(s){return e(s)||r(s)||n(s)||t()}i.exports=a,i.exports.default=i.exports,i.exports.__esModule=!0})(cl);var lf={exports:{}},uf={exports:{}};(function(i){var e=ys.exports;function r(n,t){for(;!Object.prototype.hasOwnProperty.call(n,t)&&(n=e(n),n!==null););return n}i.exports=r,i.exports.default=i.exports,i.exports.__esModule=!0})(uf);(function(i){var e=uf.exports;function r(n,t,a){return typeof Reflect!="undefined"&&Reflect.get?(i.exports=r=Reflect.get,i.exports.default=i.exports,i.exports.__esModule=!0):(i.exports=r=function(o,p,x){var g=e(o,p);if(!!g){var d=Object.getOwnPropertyDescriptor(g,p);return d.get?d.get.call(x):d.value}},i.exports.default=i.exports,i.exports.__esModule=!0),r(n,t,a||n)}i.exports=r,i.exports.default=i.exports,i.exports.__esModule=!0})(lf);var _s={},ff={exports:{}};(function(i){function e(r){return r&&r.__esModule?r:{default:r}}i.exports=e,i.exports.default=i.exports,i.exports.__esModule=!0})(ff);var tv=ff.exports;Object.defineProperty(_s,"__esModule",{value:!0});_s.default=rv;var cf=tv(fa.exports);function rv(i,e,r,n){var t=cf.default.unstable_batchedUpdates?function(s){cf.default.unstable_batchedUpdates(r,s)}:r;return i.addEventListener&&i.addEventListener(e,t,n),{remove:function(){i.removeEventListener&&i.removeEventListener(e,t)}}}var xs={},ha=Nn.exports;Object.defineProperty(xs,"__esModule",{value:!0});xs.default=void 0;var pa=ha(ei.exports),wi=ha(qn.exports),df=ha(vt.exports),nv=ha(Oi.exports),iv=ha(Wr),av=function(e,r,n,t,a,s){(0,iv.default)(n?t>0:!0,"`Slider[step]` should be a positive number in order to make Slider[dots] work.");var o=Object.keys(r).map(parseFloat).sort(function(x,g){return x-g});if(n&&t)for(var p=a;p<=s;p+=t)o.indexOf(p)===-1&&o.push(p);return o},sv=function(e){var r=e.prefixCls,n=e.vertical,t=e.reverse,a=e.marks,s=e.dots,o=e.step,p=e.included,x=e.lowerBound,g=e.upperBound,d=e.max,h=e.min,y=e.dotStyle,b=e.activeDotStyle,T=d-h,_=av(n,a,s,o,h,d).map(function(c){var u,f="".concat(Math.abs(c-h)/T*100,"%"),v=!p&&c===g||p&&c<=g&&c>=x,l=n?(0,wi.default)((0,wi.default)({},y),{},(0,pa.default)({},t?"top":"bottom",f)):(0,wi.default)((0,wi.default)({},y),{},(0,pa.default)({},t?"right":"left",f));v&&(l=(0,wi.default)((0,wi.default)({},l),b));var m=(0,nv.default)((u={},(0,pa.default)(u,"".concat(r,"-dot"),!0),(0,pa.default)(u,"".concat(r,"-dot-active"),v),(0,pa.default)(u,"".concat(r,"-dot-reverse"),t),u));return df.default.createElement("span",{className:m,style:l,key:c})});return df.default.createElement("div",{className:"".concat(r,"-step")},_)},ov=sv;xs.default=ov;var bs={},va=Nn.exports;Object.defineProperty(bs,"__esModule",{value:!0});bs.default=void 0;var hf=va(qn.exports),Ss=va(ei.exports),lv=va(hs.exports),hl=va(vt.exports),uv=va(Oi.exports),fv=function(e){var r=e.className,n=e.vertical,t=e.reverse,a=e.marks,s=e.included,o=e.upperBound,p=e.lowerBound,x=e.max,g=e.min,d=e.onClickLabel,h=Object.keys(a),y=x-g,b=h.map(parseFloat).sort(function(T,_){return T-_}).map(function(T){var _,c=a[T],u=(0,lv.default)(c)==="object"&&!hl.default.isValidElement(c),f=u?c.label:c;if(!f&&f!==0)return null;var v=!s&&T===o||s&&T<=o&&T>=p,l=(0,uv.default)((_={},(0,Ss.default)(_,"".concat(r,"-text"),!0),(0,Ss.default)(_,"".concat(r,"-text-active"),v),_)),m=(0,Ss.default)({marginBottom:"-50%"},t?"top":"bottom","".concat((T-g)/y*100,"%")),E=(0,Ss.default)({transform:"translateX(".concat(t?"50%":"-50%",")"),msTransform:"translateX(".concat(t?"50%":"-50%",")")},t?"right":"left","".concat((T-g)/y*100,"%")),S=n?m:E,O=u?(0,hf.default)((0,hf.default)({},S),c.style):S;return hl.default.createElement("span",{className:l,style:O,key:T,onMouseDown:function(P){return d(P,T)},onTouchStart:function(P){return d(P,T)}},f)});return hl.default.createElement("div",{className:r},b)},cv=fv;bs.default=cv;var Ts={},Jr=Nn.exports;Object.defineProperty(Ts,"__esModule",{value:!0});Ts.default=void 0;var dv=Jr(ul.exports),pf=Jr(qn.exports),ti=Jr(ei.exports),hv=Jr(fl.exports),pv=Jr(ps.exports),vv=Jr(vs.exports),gv=Jr(gs.exports),mv=Jr(ms.exports),vf=Jr(vt.exports),yv=Jr(Oi.exports),Ev=Jr(_s),_v=["prefixCls","vertical","reverse","offset","style","disabled","min","max","value","tabIndex","ariaLabel","ariaLabelledBy","ariaValueTextFormatter"],xv=function(i){(0,gv.default)(r,i);var e=(0,mv.default)(r);function r(){var n;(0,pv.default)(this,r);for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return n=e.call.apply(e,[this].concat(a)),n.state={clickFocused:!1},n.onMouseUpListener=void 0,n.handle=void 0,n.setHandleRef=function(o){n.handle=o},n.handleMouseUp=function(){document.activeElement===n.handle&&n.setClickFocus(!0)},n.handleMouseDown=function(o){o.preventDefault(),n.focus()},n.handleBlur=function(){n.setClickFocus(!1)},n.handleKeyDown=function(){n.setClickFocus(!1)},n}return(0,vv.default)(r,[{key:"componentDidMount",value:function(){this.onMouseUpListener=(0,Ev.default)(document,"mouseup",this.handleMouseUp)}},{key:"componentWillUnmount",value:function(){this.onMouseUpListener&&this.onMouseUpListener.remove()}},{key:"setClickFocus",value:function(t){this.setState({clickFocused:t})}},{key:"clickFocus",value:function(){this.setClickFocus(!0),this.focus()}},{key:"focus",value:function(){this.handle.focus()}},{key:"blur",value:function(){this.handle.blur()}},{key:"render",value:function(){var t,a,s=this.props,o=s.prefixCls,p=s.vertical,x=s.reverse,g=s.offset,d=s.style,h=s.disabled,y=s.min,b=s.max,T=s.value,_=s.tabIndex,c=s.ariaLabel,u=s.ariaLabelledBy,f=s.ariaValueTextFormatter,v=(0,hv.default)(s,_v),l=(0,yv.default)(this.props.className,(0,ti.default)({},"".concat(o,"-handle-click-focused"),this.state.clickFocused)),m=p?(t={},(0,ti.default)(t,x?"top":"bottom","".concat(g,"%")),(0,ti.default)(t,x?"bottom":"top","auto"),(0,ti.default)(t,"transform",x?null:"translateY(+50%)"),t):(a={},(0,ti.default)(a,x?"right":"left","".concat(g,"%")),(0,ti.default)(a,x?"left":"right","auto"),(0,ti.default)(a,"transform","translateX(".concat(x?"+":"-","50%)")),a),E=(0,pf.default)((0,pf.default)({},d),m),S=_||0;(h||_===null)&&(S=null);var O;return f&&(O=f(T)),vf.default.createElement("div",(0,dv.default)({ref:this.setHandleRef,tabIndex:S},v,{className:l,style:E,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onMouseDown:this.handleMouseDown,role:"slider","aria-valuemin":y,"aria-valuemax":b,"aria-valuenow":T,"aria-disabled":!!h,"aria-label":c,"aria-labelledby":u,"aria-valuetext":O}))}}]),r}(vf.default.Component);Ts.default=xv;var fr={},Os={};Object.defineProperty(Os,"__esModule",{value:!0});Os.default=void 0;var yt={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(e){var r=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||r>=yt.F1&&r<=yt.F12)return!1;switch(r){case yt.ALT:case yt.CAPS_LOCK:case yt.CONTEXT_MENU:case yt.CTRL:case yt.DOWN:case yt.END:case yt.ESC:case yt.HOME:case yt.INSERT:case yt.LEFT:case yt.MAC_FF_META:case yt.META:case yt.NUMLOCK:case yt.NUM_CENTER:case yt.PAGE_DOWN:case yt.PAGE_UP:case yt.PAUSE:case yt.PRINT_SCREEN:case yt.RIGHT:case yt.SHIFT:case yt.UP:case yt.WIN_KEY:case yt.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(e){if(e>=yt.ZERO&&e<=yt.NINE||e>=yt.NUM_ZERO&&e<=yt.NUM_MULTIPLY||e>=yt.A&&e<=yt.Z||window.navigator.userAgent.indexOf("WebKit")!==-1&&e===0)return!0;switch(e){case yt.SPACE:case yt.QUESTION_MARK:case yt.NUM_PLUS:case yt.NUM_MINUS:case yt.NUM_PERIOD:case yt.NUM_DIVISION:case yt.SEMICOLON:case yt.DASH:case yt.EQUALS:case yt.COMMA:case yt.PERIOD:case yt.SLASH:case yt.APOSTROPHE:case yt.SINGLE_QUOTE:case yt.OPEN_SQUARE_BRACKET:case yt.BACKSLASH:case yt.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}},bv=yt;Os.default=bv;var gf=Nn.exports;Object.defineProperty(fr,"__esModule",{value:!0});fr.calculateNextValue=mf;fr.ensureValueInRange=Rv;fr.ensureValuePrecision=Cv;fr.getClosestPoint=pl;fr.getHandleCenterPosition=Pv;fr.getKeyboardValueMutator=Mv;fr.getMousePosition=Lv;fr.getPrecision=vl;fr.getTouchPosition=Dv;fr.isEventFromHandle=Ov;fr.isNotTouchEvent=wv;fr.isValueOutOfRange=Av;fr.pauseEvent=Iv;var Sv=gf(cl.exports),Tv=fa.exports,Bn=gf(Os);function Ov(i,e){try{return Object.keys(e).some(function(r){return i.target===(0,Tv.findDOMNode)(e[r])})}catch(r){return!1}}function Av(i,e){var r=e.min,n=e.max;return i<r||i>n}function wv(i){return i.touches.length>1||i.type.toLowerCase()==="touchend"&&i.touches.length>0}function pl(i,e){var r=e.marks,n=e.step,t=e.min,a=e.max,s=Object.keys(r).map(parseFloat);if(n!==null){var o=Math.pow(10,vl(n)),p=Math.floor((a*o-t*o)/(n*o)),x=Math.min((i-t)/n,p),g=Math.round(x)*n+t;s.push(g)}var d=s.map(function(h){return Math.abs(i-h)});return s[d.indexOf(Math.min.apply(Math,(0,Sv.default)(d)))]}function vl(i){var e=i.toString(),r=0;return e.indexOf(".")>=0&&(r=e.length-e.indexOf(".")-1),r}function Lv(i,e){return i?e.clientY:e.pageX}function Dv(i,e){return i?e.touches[0].clientY:e.touches[0].pageX}function Pv(i,e){var r=e.getBoundingClientRect();return i?r.top+r.height*.5:window.pageXOffset+r.left+r.width*.5}function Rv(i,e){var r=e.max,n=e.min;return i<=n?n:i>=r?r:i}function Cv(i,e){var r=e.step,n=isFinite(pl(i,e))?pl(i,e):0;return r===null?n:parseFloat(n.toFixed(vl(r)))}function Iv(i){i.stopPropagation(),i.preventDefault()}function mf(i,e,r){var n={increase:function(o,p){return o+p},decrease:function(o,p){return o-p}},t=n[i](Object.keys(r.marks).indexOf(JSON.stringify(e)),1),a=Object.keys(r.marks)[t];return r.step?n[i](e,r.step):!!Object.keys(r.marks).length&&!!r.marks[a]?r.marks[a]:e}function Mv(i,e,r){var n="increase",t="decrease",a=n;switch(i.keyCode){case Bn.default.UP:a=e&&r?t:n;break;case Bn.default.RIGHT:a=!e&&r?t:n;break;case Bn.default.DOWN:a=e&&r?n:t;break;case Bn.default.LEFT:a=!e&&r?n:t;break;case Bn.default.END:return function(s,o){return o.max};case Bn.default.HOME:return function(s,o){return o.min};case Bn.default.PAGE_UP:return function(s,o){return s+o.step*2};case Bn.default.PAGE_DOWN:return function(s,o){return s-o.step*2};default:return}return function(s,o){return mf(a,s,o)}}var tr=Nn.exports,kv=il.exports;Object.defineProperty(ll,"__esModule",{value:!0});ll.default=Xv;var Nv=tr(ul.exports),Bv=tr(fl.exports),As=tr(qn.exports),ws=tr(ei.exports),Fv=tr(cl.exports),Uv=tr(ps.exports),jv=tr(vs.exports),gl=tr(lf.exports),ml=tr(ys.exports),Wv=tr(gs.exports),zv=tr(ms.exports),ga=tr(vt.exports),Ls=tr(_s),Kv=tr(Oi.exports),Vv=tr(Wr),Gv=tr(xs),Hv=tr(bs),$v=tr(Ts),Dr=kv(fr),Yv=["index"];function un(){}function Xv(i){var e,r;return r=e=function(n){(0,Wv.default)(a,n);var t=(0,zv.default)(a);function a(s){var o;(0,Uv.default)(this,a),o=t.call(this,s),o.handlesRefs=void 0,o.sliderRef=void 0,o.document=void 0,o.dragOffset=void 0,o.prevMovedHandleIndex=void 0,o.onTouchMoveListener=void 0,o.onTouchUpListener=void 0,o.onMouseMoveListener=void 0,o.onMouseUpListener=void 0,o.dragTrack=void 0,o.startBounds=void 0,o.onDown=function(h,y){var b=y,T=o.props,_=T.draggableTrack,c=T.vertical,u=o.state.bounds,f=_&&o.positionGetValue?o.positionGetValue(b)||[]:[],v=Dr.isEventFromHandle(h,o.handlesRefs);if(o.dragTrack=_&&u.length>=2&&!v&&!f.map(function(m,E){var S=E?!0:m>=u[E];return E===f.length-1?m<=u[E]:S}).some(function(m){return!m}),o.dragTrack)o.dragOffset=b,o.startBounds=(0,Fv.default)(u);else{if(!v)o.dragOffset=0;else{var l=Dr.getHandleCenterPosition(c,h.target);o.dragOffset=b-l,b=l}o.onStart(b)}},o.onMouseDown=function(h){if(h.button===0){o.removeDocumentEvents();var y=o.props.vertical,b=Dr.getMousePosition(y,h);o.onDown(h,b),o.addDocumentMouseEvents()}},o.onTouchStart=function(h){if(!Dr.isNotTouchEvent(h)){var y=o.props.vertical,b=Dr.getTouchPosition(y,h);o.onDown(h,b),o.addDocumentTouchEvents(),Dr.pauseEvent(h)}},o.onFocus=function(h){var y=o.props,b=y.onFocus,T=y.vertical;if(Dr.isEventFromHandle(h,o.handlesRefs)&&!o.dragTrack){var _=Dr.getHandleCenterPosition(T,h.target);o.dragOffset=0,o.onStart(_),Dr.pauseEvent(h),b&&b(h)}},o.onBlur=function(h){var y=o.props.onBlur;o.dragTrack||o.onEnd(),y&&y(h)},o.onMouseUp=function(){o.handlesRefs[o.prevMovedHandleIndex]&&o.handlesRefs[o.prevMovedHandleIndex].clickFocus()},o.onMouseMove=function(h){if(!o.sliderRef){o.onEnd();return}var y=Dr.getMousePosition(o.props.vertical,h);o.onMove(h,y-o.dragOffset,o.dragTrack,o.startBounds)},o.onTouchMove=function(h){if(Dr.isNotTouchEvent(h)||!o.sliderRef){o.onEnd();return}var y=Dr.getTouchPosition(o.props.vertical,h);o.onMove(h,y-o.dragOffset,o.dragTrack,o.startBounds)},o.onKeyDown=function(h){o.sliderRef&&Dr.isEventFromHandle(h,o.handlesRefs)&&o.onKeyboard(h)},o.onClickMarkLabel=function(h,y){h.stopPropagation(),o.onChange({value:y}),o.setState({value:y},function(){return o.onEnd(!0)})},o.saveSlider=function(h){o.sliderRef=h};var p=s.step,x=s.max,g=s.min,d=isFinite(x-g)?(x-g)%p==0:!0;return(0,Vv.default)(p&&Math.floor(p)===p?d:!0,"Slider[max] - Slider[min] (".concat(x-g,") should be a multiple of Slider[step] (").concat(p,")")),o.handlesRefs={},o}return(0,jv.default)(a,[{key:"componentDidMount",value:function(){this.document=this.sliderRef&&this.sliderRef.ownerDocument;var o=this.props,p=o.autoFocus,x=o.disabled;p&&!x&&this.focus()}},{key:"componentWillUnmount",value:function(){(0,gl.default)((0,ml.default)(a.prototype),"componentWillUnmount",this)&&(0,gl.default)((0,ml.default)(a.prototype),"componentWillUnmount",this).call(this),this.removeDocumentEvents()}},{key:"getSliderStart",value:function(){var o=this.sliderRef,p=this.props,x=p.vertical,g=p.reverse,d=o.getBoundingClientRect();return x?g?d.bottom:d.top:window.pageXOffset+(g?d.right:d.left)}},{key:"getSliderLength",value:function(){var o=this.sliderRef;if(!o)return 0;var p=o.getBoundingClientRect();return this.props.vertical?p.height:p.width}},{key:"addDocumentTouchEvents",value:function(){this.onTouchMoveListener=(0,Ls.default)(this.document,"touchmove",this.onTouchMove),this.onTouchUpListener=(0,Ls.default)(this.document,"touchend",this.onEnd)}},{key:"addDocumentMouseEvents",value:function(){this.onMouseMoveListener=(0,Ls.default)(this.document,"mousemove",this.onMouseMove),this.onMouseUpListener=(0,Ls.default)(this.document,"mouseup",this.onEnd)}},{key:"removeDocumentEvents",value:function(){this.onTouchMoveListener&&this.onTouchMoveListener.remove(),this.onTouchUpListener&&this.onTouchUpListener.remove(),this.onMouseMoveListener&&this.onMouseMoveListener.remove(),this.onMouseUpListener&&this.onMouseUpListener.remove()}},{key:"focus",value:function(){var o;this.props.disabled||(o=this.handlesRefs[0])===null||o===void 0||o.focus()}},{key:"blur",value:function(){var o=this;this.props.disabled||Object.keys(this.handlesRefs).forEach(function(p){var x,g;(x=o.handlesRefs[p])===null||x===void 0||(g=x.blur)===null||g===void 0||g.call(x)})}},{key:"calcValue",value:function(o){var p=this.props,x=p.vertical,g=p.min,d=p.max,h=Math.abs(Math.max(o,0)/this.getSliderLength()),y=x?(1-h)*(d-g)+g:h*(d-g)+g;return y}},{key:"calcValueByPos",value:function(o){var p=this.props.reverse?-1:1,x=p*(o-this.getSliderStart()),g=this.trimAlignValue(this.calcValue(x));return g}},{key:"calcOffset",value:function(o){var p=this.props,x=p.min,g=p.max,d=(o-x)/(g-x);return Math.max(0,d*100)}},{key:"saveHandle",value:function(o,p){this.handlesRefs[o]=p}},{key:"render",value:function(){var o,p=this.props,x=p.prefixCls,g=p.className,d=p.marks,h=p.dots,y=p.step,b=p.included,T=p.disabled,_=p.vertical,c=p.reverse,u=p.min,f=p.max,v=p.children,l=p.maximumTrackStyle,m=p.style,E=p.railStyle,S=p.dotStyle,O=p.activeDotStyle,D=(0,gl.default)((0,ml.default)(a.prototype),"render",this).call(this),P=D.tracks,A=D.handles,w=(0,Kv.default)(x,(o={},(0,ws.default)(o,"".concat(x,"-with-marks"),Object.keys(d).length),(0,ws.default)(o,"".concat(x,"-disabled"),T),(0,ws.default)(o,"".concat(x,"-vertical"),_),(0,ws.default)(o,g,g),o));return ga.default.createElement("div",{ref:this.saveSlider,className:w,onTouchStart:T?un:this.onTouchStart,onMouseDown:T?un:this.onMouseDown,onMouseUp:T?un:this.onMouseUp,onKeyDown:T?un:this.onKeyDown,onFocus:T?un:this.onFocus,onBlur:T?un:this.onBlur,style:m},ga.default.createElement("div",{className:"".concat(x,"-rail"),style:(0,As.default)((0,As.default)({},l),E)}),P,ga.default.createElement(Gv.default,{prefixCls:x,vertical:_,reverse:c,marks:d,dots:h,step:y,included:b,lowerBound:this.getLowerBound(),upperBound:this.getUpperBound(),max:f,min:u,dotStyle:S,activeDotStyle:O}),A,ga.default.createElement(Hv.default,{className:"".concat(x,"-mark"),onClickLabel:T?un:this.onClickMarkLabel,vertical:_,marks:d,included:b,lowerBound:this.getLowerBound(),upperBound:this.getUpperBound(),max:f,min:u,reverse:c}),v)}}]),a}(i),e.displayName="ComponentEnhancer(".concat(i.displayName,")"),e.defaultProps=(0,As.default)((0,As.default)({},i.defaultProps),{},{prefixCls:"rc-slider",className:"",min:0,max:100,step:1,marks:{},handle:function(t){var a=t.index,s=(0,Bv.default)(t,Yv);return delete s.dragging,s.value===null?null:ga.default.createElement($v.default,(0,Nv.default)({},s,{key:a}))},onBeforeChange:un,onChange:un,onAfterChange:un,included:!0,disabled:!1,dots:!1,vertical:!1,reverse:!1,trackStyle:[{}],handleStyle:[{}],railStyle:{},dotStyle:{},activeDotStyle:{}}),r}var Zv=il.exports,Tn=Nn.exports;Object.defineProperty(nl,"__esModule",{value:!0});var yl=nl.default=void 0,Li=Tn(qn.exports),Qv=Tn(ps.exports),Jv=Tn(vs.exports),qv=Tn(gs.exports),eg=Tn(ms.exports),yf=Tn(vt.exports),Ef=Tn(Wr),tg=Tn(Es),rg=Tn(ll),Di=Zv(fr),ng=function(i){(0,qv.default)(r,i);var e=(0,eg.default)(r);function r(n){var t;(0,Qv.default)(this,r),t=e.call(this,n),t.positionGetValue=function(o){return[]},t.startValue=void 0,t.startPosition=void 0,t.prevMovedHandleIndex=void 0,t.onEnd=function(o){var p=t.state.dragging;t.removeDocumentEvents(),(p||o)&&t.props.onAfterChange(t.getValue()),t.setState({dragging:!1})};var a=n.defaultValue!==void 0?n.defaultValue:n.min,s=n.value!==void 0?n.value:a;return t.state={value:t.trimAlignValue(s),dragging:!1},(0,Ef.default)(!("minimumTrackStyle"in n),"minimumTrackStyle will be deprecated, please use trackStyle instead."),(0,Ef.default)(!("maximumTrackStyle"in n),"maximumTrackStyle will be deprecated, please use railStyle instead."),t}return(0,Jv.default)(r,[{key:"calcValueByPos",value:function(t){return 0}},{key:"calcOffset",value:function(t){return 0}},{key:"saveHandle",value:function(t,a){}},{key:"removeDocumentEvents",value:function(){}},{key:"componentDidUpdate",value:function(t,a){var s=this.props,o=s.min,p=s.max,x=s.value,g=s.onChange;if("min"in this.props||"max"in this.props){var d=x!==void 0?x:a.value,h=this.trimAlignValue(d,this.props);h!==a.value&&(this.setState({value:h}),!(o===t.min&&p===t.max)&&Di.isValueOutOfRange(d,this.props)&&g(h))}}},{key:"onChange",value:function(t){var a=this.props,s=!("value"in a),o=t.value>this.props.max?(0,Li.default)((0,Li.default)({},t),{},{value:this.props.max}):t;s&&this.setState(o);var p=o.value;a.onChange(p)}},{key:"onStart",value:function(t){this.setState({dragging:!0});var a=this.props,s=this.getValue();a.onBeforeChange(s);var o=this.calcValueByPos(t);this.startValue=o,this.startPosition=t,o!==s&&(this.prevMovedHandleIndex=0,this.onChange({value:o}))}},{key:"onMove",value:function(t,a){Di.pauseEvent(t);var s=this.state.value,o=this.calcValueByPos(a);o!==s&&this.onChange({value:o})}},{key:"onKeyboard",value:function(t){var a=this.props,s=a.reverse,o=a.vertical,p=Di.getKeyboardValueMutator(t,o,s);if(p){Di.pauseEvent(t);var x=this.state,g=x.value,d=p(g,this.props),h=this.trimAlignValue(d);if(h===g)return;this.onChange({value:h}),this.props.onAfterChange(h),this.onEnd()}}},{key:"getValue",value:function(){return this.state.value}},{key:"getLowerBound",value:function(){var t=this.props.startPoint||this.props.min;return this.state.value>t?t:this.state.value}},{key:"getUpperBound",value:function(){return this.state.value<this.props.startPoint?this.props.startPoint:this.state.value}},{key:"trimAlignValue",value:function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t===null)return null;var s=(0,Li.default)((0,Li.default)({},this.props),a),o=Di.ensureValueInRange(t,s);return Di.ensureValuePrecision(o,s)}},{key:"render",value:function(){var t=this,a=this.props,s=a.prefixCls,o=a.vertical,p=a.included,x=a.disabled,g=a.minimumTrackStyle,d=a.trackStyle,h=a.handleStyle,y=a.tabIndex,b=a.ariaLabelForHandle,T=a.ariaLabelledByForHandle,_=a.ariaValueTextFormatterForHandle,c=a.min,u=a.max,f=a.startPoint,v=a.reverse,l=a.handle,m=this.state,E=m.value,S=m.dragging,O=this.calcOffset(E),D=l({className:"".concat(s,"-handle"),prefixCls:s,vertical:o,offset:O,value:E,dragging:S,disabled:x,min:c,max:u,reverse:v,index:0,tabIndex:y,ariaLabel:b,ariaLabelledBy:T,ariaValueTextFormatter:_,style:h[0]||h,ref:function(R){return t.saveHandle(0,R)}}),P=f!==void 0?this.calcOffset(f):0,A=d[0]||d,w=yf.default.createElement(tg.default,{className:"".concat(s,"-track"),vertical:o,included:p,offset:P,reverse:v,length:O-P,style:(0,Li.default)((0,Li.default)({},g),A)});return{tracks:w,handles:D}}}]),r}(yf.default.Component),ig=(0,rg.default)(ng);yl=nl.default=ig;function _f(i,e,r){return e in i?Object.defineProperty(i,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[e]=r,i}function ag(i){if(Array.isArray(i))return i}function sg(i,e){var r=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(r!=null){var n=[],t=!0,a=!1,s,o;try{for(r=r.call(i);!(t=(s=r.next()).done)&&(n.push(s.value),!(e&&n.length===e));t=!0);}catch(p){a=!0,o=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(a)throw o}}return n}}function xf(i,e){(e==null||e>i.length)&&(e=i.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=i[r];return n}function og(i,e){if(!!i){if(typeof i=="string")return xf(i,e);var r=Object.prototype.toString.call(i).slice(8,-1);if(r==="Object"&&i.constructor&&(r=i.constructor.name),r==="Map"||r==="Set")return Array.from(i);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xf(i,e)}}function lg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ug(i,e){return ag(i)||sg(i,e)||og(i,e)||lg()}function fg(i,e){if(i==null)return{};var r={},n=Object.keys(i),t,a;for(a=0;a<n.length;a++)t=n[a],!(e.indexOf(t)>=0)&&(r[t]=i[t]);return r}function cg(i,e){if(i==null)return{};var r=fg(i,e),n,t;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);for(t=0;t<a.length;t++)n=a[t],!(e.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,n)||(r[n]=i[n]))}return r}function dg(i){if(Array.isArray(i))return i}function hg(i,e){var r=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(r!=null){var n=[],t=!0,a=!1,s,o;try{for(r=r.call(i);!(t=(s=r.next()).done)&&(n.push(s.value),!(e&&n.length===e));t=!0);}catch(p){a=!0,o=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(a)throw o}}return n}}function bf(i,e){(e==null||e>i.length)&&(e=i.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=i[r];return n}function pg(i,e){if(!!i){if(typeof i=="string")return bf(i,e);var r=Object.prototype.toString.call(i).slice(8,-1);if(r==="Object"&&i.constructor&&(r=i.constructor.name),r==="Map"||r==="Set")return Array.from(i);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bf(i,e)}}function vg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gg(i,e){return dg(i)||hg(i,e)||pg(i,e)||vg()}function mg(i,e){var r=e||{},n=r.defaultValue,t=r.value,a=r.onChange,s=r.postState,o=vt.exports.useState(function(){return t!==void 0?t:n!==void 0?typeof n=="function"?n():n:typeof i=="function"?i():i}),p=gg(o,2),x=p[0],g=p[1],d=t!==void 0?t:x;s&&(d=s(d));function h(b){g(b),d!==b&&a&&a(b,d)}var y=vt.exports.useRef(!0);return vt.exports.useEffect(function(){if(y.current){y.current=!1;return}t===void 0&&g(t)},[t]),[d,h]}var gt={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(e){var r=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||r>=gt.F1&&r<=gt.F12)return!1;switch(r){case gt.ALT:case gt.CAPS_LOCK:case gt.CONTEXT_MENU:case gt.CTRL:case gt.DOWN:case gt.END:case gt.ESC:case gt.HOME:case gt.INSERT:case gt.LEFT:case gt.MAC_FF_META:case gt.META:case gt.NUMLOCK:case gt.NUM_CENTER:case gt.PAGE_DOWN:case gt.PAGE_UP:case gt.PAUSE:case gt.PRINT_SCREEN:case gt.RIGHT:case gt.SHIFT:case gt.UP:case gt.WIN_KEY:case gt.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(e){if(e>=gt.ZERO&&e<=gt.NINE||e>=gt.NUM_ZERO&&e<=gt.NUM_MULTIPLY||e>=gt.A&&e<=gt.Z||window.navigator.userAgent.indexOf("WebKit")!==-1&&e===0)return!0;switch(e){case gt.SPACE:case gt.QUESTION_MARK:case gt.NUM_PLUS:case gt.NUM_MINUS:case gt.NUM_PERIOD:case gt.NUM_DIVISION:case gt.SEMICOLON:case gt.DASH:case gt.EQUALS:case gt.COMMA:case gt.PERIOD:case gt.SLASH:case gt.APOSTROPHE:case gt.SINGLE_QUOTE:case gt.OPEN_SQUARE_BRACKET:case gt.BACKSLASH:case gt.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}},Sf=vt.exports.forwardRef(function(i,e){var r,n=i.prefixCls,t=n===void 0?"rc-switch":n,a=i.className,s=i.checked,o=i.defaultChecked,p=i.disabled,x=i.loadingIcon,g=i.checkedChildren,d=i.unCheckedChildren,h=i.onClick,y=i.onChange,b=i.onKeyDown,T=cg(i,["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"]),_=mg(!1,{value:s,defaultValue:o}),c=ug(_,2),u=c[0],f=c[1];function v(S,O){var D=u;return p||(D=S,f(D),y==null||y(D,O)),D}function l(S){S.which===gt.LEFT?v(!1,S):S.which===gt.RIGHT&&v(!0,S),b==null||b(S)}function m(S){var O=v(!u,S);h==null||h(O,S)}var E=ar(t,a,(r={},_f(r,"".concat(t,"-checked"),u),_f(r,"".concat(t,"-disabled"),p),r));return vt.exports.createElement("button",Object.assign({},T,{type:"button",role:"switch","aria-checked":u,disabled:p,className:E,ref:e,onKeyDown:l,onClick:m}),x,vt.exports.createElement("span",{className:"".concat(t,"-inner")},u?g:d))});Sf.displayName="Switch";var Ds={exports:{}},Tf={},yg=qo(Up),$t={},fn={};Object.defineProperty(fn,"__esModule",{value:!0});fn.findInArray=Eg;fn.isFunction=_g;fn.isNum=xg;fn.int=bg;fn.dontSetMe=Sg;function Eg(i,e){for(var r=0,n=i.length;r<n;r++)if(e.apply(e,[i[r],r,i]))return i[r]}function _g(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Function]"}function xg(i){return typeof i=="number"&&!isNaN(i)}function bg(i){return parseInt(i,10)}function Sg(i,e,r){if(i[e])return new Error("Invalid prop ".concat(e," passed to ").concat(r," - do not set this, set it on the child."))}var ri={};Object.defineProperty(ri,"__esModule",{value:!0});ri.getPrefix=Of;ri.browserPrefixToKey=Af;ri.browserPrefixToStyle=Tg;ri.default=void 0;var El=["Moz","Webkit","O","ms"];function Of(){var i,e,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window=="undefined")return"";var n=(i=window.document)===null||i===void 0||(e=i.documentElement)===null||e===void 0?void 0:e.style;if(!n||r in n)return"";for(var t=0;t<El.length;t++)if(Af(r,El[t])in n)return El[t];return""}function Af(i,e){return e?"".concat(e).concat(Og(i)):i}function Tg(i,e){return e?"-".concat(e.toLowerCase(),"-").concat(i):i}function Og(i){for(var e="",r=!0,n=0;n<i.length;n++)r?(e+=i[n].toUpperCase(),r=!1):i[n]==="-"?r=!0:e+=i[n];return e}var Ag=Of();ri.default=Ag;function Ps(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ps=function(r){return typeof r}:Ps=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Ps(i)}Object.defineProperty($t,"__esModule",{value:!0});$t.matchesSelector=Cf;$t.matchesSelectorAndParentsTo=Lg;$t.addEvent=Dg;$t.removeEvent=Pg;$t.outerHeight=Rg;$t.outerWidth=Cg;$t.innerHeight=Ig;$t.innerWidth=Mg;$t.offsetXYFromParent=kg;$t.createCSSTransform=Ng;$t.createSVGTransform=Bg;$t.getTranslation=_l;$t.getTouch=Fg;$t.getTouchIdentifier=Ug;$t.addUserSelectStyles=jg;$t.removeUserSelectStyles=Wg;$t.addClassName=If;$t.removeClassName=Mf;var Pr=fn,wf=wg(ri);function Lf(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Lf=function(t){return t?r:e})(i)}function wg(i,e){if(!e&&i&&i.__esModule)return i;if(i===null||Ps(i)!=="object"&&typeof i!="function")return{default:i};var r=Lf(e);if(r&&r.has(i))return r.get(i);var n={},t=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in i)if(a!=="default"&&Object.prototype.hasOwnProperty.call(i,a)){var s=t?Object.getOwnPropertyDescriptor(i,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=i[a]}return n.default=i,r&&r.set(i,n),n}function Df(i,e){var r=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})),r.push.apply(r,n)}return r}function Pf(i){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Df(Object(r),!0).forEach(function(n){Rf(i,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):Df(Object(r)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(r,n))})}return i}function Rf(i,e,r){return e in i?Object.defineProperty(i,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[e]=r,i}var Rs="";function Cf(i,e){return Rs||(Rs=(0,Pr.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(r){return(0,Pr.isFunction)(i[r])})),(0,Pr.isFunction)(i[Rs])?i[Rs](e):!1}function Lg(i,e,r){var n=i;do{if(Cf(n,e))return!0;if(n===r)return!1;n=n.parentNode}while(n);return!1}function Dg(i,e,r,n){if(!!i){var t=Pf({capture:!0},n);i.addEventListener?i.addEventListener(e,r,t):i.attachEvent?i.attachEvent("on"+e,r):i["on"+e]=r}}function Pg(i,e,r,n){if(!!i){var t=Pf({capture:!0},n);i.removeEventListener?i.removeEventListener(e,r,t):i.detachEvent?i.detachEvent("on"+e,r):i["on"+e]=null}}function Rg(i){var e=i.clientHeight,r=i.ownerDocument.defaultView.getComputedStyle(i);return e+=(0,Pr.int)(r.borderTopWidth),e+=(0,Pr.int)(r.borderBottomWidth),e}function Cg(i){var e=i.clientWidth,r=i.ownerDocument.defaultView.getComputedStyle(i);return e+=(0,Pr.int)(r.borderLeftWidth),e+=(0,Pr.int)(r.borderRightWidth),e}function Ig(i){var e=i.clientHeight,r=i.ownerDocument.defaultView.getComputedStyle(i);return e-=(0,Pr.int)(r.paddingTop),e-=(0,Pr.int)(r.paddingBottom),e}function Mg(i){var e=i.clientWidth,r=i.ownerDocument.defaultView.getComputedStyle(i);return e-=(0,Pr.int)(r.paddingLeft),e-=(0,Pr.int)(r.paddingRight),e}function kg(i,e,r){var n=e===e.ownerDocument.body,t=n?{left:0,top:0}:e.getBoundingClientRect(),a=(i.clientX+e.scrollLeft-t.left)/r,s=(i.clientY+e.scrollTop-t.top)/r;return{x:a,y:s}}function Ng(i,e){var r=_l(i,e,"px");return Rf({},(0,wf.browserPrefixToKey)("transform",wf.default),r)}function Bg(i,e){var r=_l(i,e,"");return r}function _l(i,e,r){var n=i.x,t=i.y,a="translate(".concat(n).concat(r,",").concat(t).concat(r,")");if(e){var s="".concat(typeof e.x=="string"?e.x:e.x+r),o="".concat(typeof e.y=="string"?e.y:e.y+r);a="translate(".concat(s,", ").concat(o,")")+a}return a}function Fg(i,e){return i.targetTouches&&(0,Pr.findInArray)(i.targetTouches,function(r){return e===r.identifier})||i.changedTouches&&(0,Pr.findInArray)(i.changedTouches,function(r){return e===r.identifier})}function Ug(i){if(i.targetTouches&&i.targetTouches[0])return i.targetTouches[0].identifier;if(i.changedTouches&&i.changedTouches[0])return i.changedTouches[0].identifier}function jg(i){if(!!i){var e=i.getElementById("react-draggable-style-el");e||(e=i.createElement("style"),e.type="text/css",e.id="react-draggable-style-el",e.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,e.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,i.getElementsByTagName("head")[0].appendChild(e)),i.body&&If(i.body,"react-draggable-transparent-selection")}}function Wg(i){if(!!i)try{if(i.body&&Mf(i.body,"react-draggable-transparent-selection"),i.selection)i.selection.empty();else{var e=(i.defaultView||window).getSelection();e&&e.type!=="Caret"&&e.removeAllRanges()}}catch(r){}}function If(i,e){i.classList?i.classList.add(e):i.className.match(new RegExp("(?:^|\\s)".concat(e,"(?!\\S)")))||(i.className+=" ".concat(e))}function Mf(i,e){i.classList?i.classList.remove(e):i.className=i.className.replace(new RegExp("(?:^|\\s)".concat(e,"(?!\\S)"),"g"),"")}var cn={};Object.defineProperty(cn,"__esModule",{value:!0});cn.getBoundPosition=zg;cn.snapToGrid=Kg;cn.canDragX=Vg;cn.canDragY=Gg;cn.getControlPosition=Hg;cn.createCoreData=$g;cn.createDraggableData=Yg;var Rr=fn,Pi=$t;function zg(i,e,r){if(!i.props.bounds)return[e,r];var n=i.props.bounds;n=typeof n=="string"?n:Xg(n);var t=xl(i);if(typeof n=="string"){var a=t.ownerDocument,s=a.defaultView,o;if(n==="parent"?o=t.parentNode:o=a.querySelector(n),!(o instanceof s.HTMLElement))throw new Error('Bounds selector "'+n+'" could not find an element.');var p=o,x=s.getComputedStyle(t),g=s.getComputedStyle(p);n={left:-t.offsetLeft+(0,Rr.int)(g.paddingLeft)+(0,Rr.int)(x.marginLeft),top:-t.offsetTop+(0,Rr.int)(g.paddingTop)+(0,Rr.int)(x.marginTop),right:(0,Pi.innerWidth)(p)-(0,Pi.outerWidth)(t)-t.offsetLeft+(0,Rr.int)(g.paddingRight)-(0,Rr.int)(x.marginRight),bottom:(0,Pi.innerHeight)(p)-(0,Pi.outerHeight)(t)-t.offsetTop+(0,Rr.int)(g.paddingBottom)-(0,Rr.int)(x.marginBottom)}}return(0,Rr.isNum)(n.right)&&(e=Math.min(e,n.right)),(0,Rr.isNum)(n.bottom)&&(r=Math.min(r,n.bottom)),(0,Rr.isNum)(n.left)&&(e=Math.max(e,n.left)),(0,Rr.isNum)(n.top)&&(r=Math.max(r,n.top)),[e,r]}function Kg(i,e,r){var n=Math.round(e/i[0])*i[0],t=Math.round(r/i[1])*i[1];return[n,t]}function Vg(i){return i.props.axis==="both"||i.props.axis==="x"}function Gg(i){return i.props.axis==="both"||i.props.axis==="y"}function Hg(i,e,r){var n=typeof e=="number"?(0,Pi.getTouch)(i,e):null;if(typeof e=="number"&&!n)return null;var t=xl(r),a=r.props.offsetParent||t.offsetParent||t.ownerDocument.body;return(0,Pi.offsetXYFromParent)(n||i,a,r.props.scale)}function $g(i,e,r){var n=i.state,t=!(0,Rr.isNum)(n.lastX),a=xl(i);return t?{node:a,deltaX:0,deltaY:0,lastX:e,lastY:r,x:e,y:r}:{node:a,deltaX:e-n.lastX,deltaY:r-n.lastY,lastX:n.lastX,lastY:n.lastY,x:e,y:r}}function Yg(i,e){var r=i.props.scale;return{node:e.node,x:i.state.x+e.deltaX/r,y:i.state.y+e.deltaY/r,deltaX:e.deltaX/r,deltaY:e.deltaY/r,lastX:i.state.x,lastY:i.state.y}}function Xg(i){return{left:i.left,top:i.top,right:i.right,bottom:i.bottom}}function xl(i){var e=i.findDOMNode();if(!e)throw new Error("<DraggableCore>: Unmounted during event!");return e}var Cs={},Is={};Object.defineProperty(Is,"__esModule",{value:!0});Is.default=Zg;function Zg(){}function ma(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ma=function(r){return typeof r}:ma=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ma(i)}Object.defineProperty(Cs,"__esModule",{value:!0});Cs.default=void 0;var bl=Jg(vt.exports),Cr=Tl(zu.exports),Qg=Tl(fa.exports),cr=$t,ni=cn,Sl=fn,ya=Tl(Is);function Tl(i){return i&&i.__esModule?i:{default:i}}function kf(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(kf=function(t){return t?r:e})(i)}function Jg(i,e){if(!e&&i&&i.__esModule)return i;if(i===null||ma(i)!=="object"&&typeof i!="function")return{default:i};var r=kf(e);if(r&&r.has(i))return r.get(i);var n={},t=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in i)if(a!=="default"&&Object.prototype.hasOwnProperty.call(i,a)){var s=t?Object.getOwnPropertyDescriptor(i,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=i[a]}return n.default=i,r&&r.set(i,n),n}function qg(i,e){return nm(i)||rm(i,e)||tm(i,e)||em()}function em(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tm(i,e){if(!!i){if(typeof i=="string")return Nf(i,e);var r=Object.prototype.toString.call(i).slice(8,-1);if(r==="Object"&&i.constructor&&(r=i.constructor.name),r==="Map"||r==="Set")return Array.from(i);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nf(i,e)}}function Nf(i,e){(e==null||e>i.length)&&(e=i.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=i[r];return n}function rm(i,e){var r=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(r!=null){var n=[],t=!0,a=!1,s,o;try{for(r=r.call(i);!(t=(s=r.next()).done)&&(n.push(s.value),!(e&&n.length===e));t=!0);}catch(p){a=!0,o=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(a)throw o}}return n}}function nm(i){if(Array.isArray(i))return i}function im(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Bf(i,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function am(i,e,r){return e&&Bf(i.prototype,e),r&&Bf(i,r),i}function sm(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&Ol(i,e)}function Ol(i,e){return Ol=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},Ol(i,e)}function om(i){var e=um();return function(){var n=Ms(i),t;if(e){var a=Ms(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return lm(this,t)}}function lm(i,e){if(e&&(ma(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dr(i)}function dr(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function um(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Ms(i){return Ms=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Ms(i)}function zr(i,e,r){return e in i?Object.defineProperty(i,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[e]=r,i}var qr={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}},Fn=qr.mouse,ks=function(i){sm(r,i);var e=om(r);function r(){var n;im(this,r);for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return n=e.call.apply(e,[this].concat(a)),zr(dr(n),"state",{dragging:!1,lastX:NaN,lastY:NaN,touchIdentifier:null}),zr(dr(n),"mounted",!1),zr(dr(n),"handleDragStart",function(o){if(n.props.onMouseDown(o),!n.props.allowAnyClick&&typeof o.button=="number"&&o.button!==0)return!1;var p=n.findDOMNode();if(!p||!p.ownerDocument||!p.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");var x=p.ownerDocument;if(!(n.props.disabled||!(o.target instanceof x.defaultView.Node)||n.props.handle&&!(0,cr.matchesSelectorAndParentsTo)(o.target,n.props.handle,p)||n.props.cancel&&(0,cr.matchesSelectorAndParentsTo)(o.target,n.props.cancel,p))){o.type==="touchstart"&&o.preventDefault();var g=(0,cr.getTouchIdentifier)(o);n.setState({touchIdentifier:g});var d=(0,ni.getControlPosition)(o,g,dr(n));if(d!=null){var h=d.x,y=d.y,b=(0,ni.createCoreData)(dr(n),h,y);(0,ya.default)("DraggableCore: handleDragStart: %j",b),(0,ya.default)("calling",n.props.onStart);var T=n.props.onStart(o,b);T===!1||n.mounted===!1||(n.props.enableUserSelectHack&&(0,cr.addUserSelectStyles)(x),n.setState({dragging:!0,lastX:h,lastY:y}),(0,cr.addEvent)(x,Fn.move,n.handleDrag),(0,cr.addEvent)(x,Fn.stop,n.handleDragStop))}}}),zr(dr(n),"handleDrag",function(o){var p=(0,ni.getControlPosition)(o,n.state.touchIdentifier,dr(n));if(p!=null){var x=p.x,g=p.y;if(Array.isArray(n.props.grid)){var d=x-n.state.lastX,h=g-n.state.lastY,y=(0,ni.snapToGrid)(n.props.grid,d,h),b=qg(y,2);if(d=b[0],h=b[1],!d&&!h)return;x=n.state.lastX+d,g=n.state.lastY+h}var T=(0,ni.createCoreData)(dr(n),x,g);(0,ya.default)("DraggableCore: handleDrag: %j",T);var _=n.props.onDrag(o,T);if(_===!1||n.mounted===!1){try{n.handleDragStop(new MouseEvent("mouseup"))}catch(u){var c=document.createEvent("MouseEvents");c.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.handleDragStop(c)}return}n.setState({lastX:x,lastY:g})}}),zr(dr(n),"handleDragStop",function(o){if(!!n.state.dragging){var p=(0,ni.getControlPosition)(o,n.state.touchIdentifier,dr(n));if(p!=null){var x=p.x,g=p.y,d=(0,ni.createCoreData)(dr(n),x,g),h=n.props.onStop(o,d);if(h===!1||n.mounted===!1)return!1;var y=n.findDOMNode();y&&n.props.enableUserSelectHack&&(0,cr.removeUserSelectStyles)(y.ownerDocument),(0,ya.default)("DraggableCore: handleDragStop: %j",d),n.setState({dragging:!1,lastX:NaN,lastY:NaN}),y&&((0,ya.default)("DraggableCore: Removing handlers"),(0,cr.removeEvent)(y.ownerDocument,Fn.move,n.handleDrag),(0,cr.removeEvent)(y.ownerDocument,Fn.stop,n.handleDragStop))}}}),zr(dr(n),"onMouseDown",function(o){return Fn=qr.mouse,n.handleDragStart(o)}),zr(dr(n),"onMouseUp",function(o){return Fn=qr.mouse,n.handleDragStop(o)}),zr(dr(n),"onTouchStart",function(o){return Fn=qr.touch,n.handleDragStart(o)}),zr(dr(n),"onTouchEnd",function(o){return Fn=qr.touch,n.handleDragStop(o)}),n}return am(r,[{key:"componentDidMount",value:function(){this.mounted=!0;var t=this.findDOMNode();t&&(0,cr.addEvent)(t,qr.touch.start,this.onTouchStart,{passive:!1})}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var t=this.findDOMNode();if(t){var a=t.ownerDocument;(0,cr.removeEvent)(a,qr.mouse.move,this.handleDrag),(0,cr.removeEvent)(a,qr.touch.move,this.handleDrag),(0,cr.removeEvent)(a,qr.mouse.stop,this.handleDragStop),(0,cr.removeEvent)(a,qr.touch.stop,this.handleDragStop),(0,cr.removeEvent)(t,qr.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,cr.removeUserSelectStyles)(a)}}},{key:"findDOMNode",value:function(){var t,a,s;return(t=(a=this.props)===null||a===void 0||(s=a.nodeRef)===null||s===void 0?void 0:s.current)!==null&&t!==void 0?t:Qg.default.findDOMNode(this)}},{key:"render",value:function(){return bl.cloneElement(bl.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}}]),r}(bl.Component);Cs.default=ks;zr(ks,"displayName","DraggableCore");zr(ks,"propTypes",{allowAnyClick:Cr.default.bool,disabled:Cr.default.bool,enableUserSelectHack:Cr.default.bool,offsetParent:function(e,r){if(e[r]&&e[r].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:Cr.default.arrayOf(Cr.default.number),handle:Cr.default.string,cancel:Cr.default.string,nodeRef:Cr.default.object,onStart:Cr.default.func,onDrag:Cr.default.func,onStop:Cr.default.func,onMouseDown:Cr.default.func,scale:Cr.default.number,className:Sl.dontSetMe,style:Sl.dontSetMe,transform:Sl.dontSetMe});zr(ks,"defaultProps",{allowAnyClick:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1});(function(i){function e(W){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(Y){return typeof Y}:e=function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y},e(W)}Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"DraggableCore",{enumerable:!0,get:function(){return x.default}}),i.default=void 0;var r=b(vt.exports),n=h(zu.exports),t=h(fa.exports),a=h(yg),s=$t,o=cn,p=fn,x=h(Cs),g=h(Is),d=["axis","bounds","children","defaultPosition","defaultClassName","defaultClassNameDragging","defaultClassNameDragged","position","positionOffset","scale"];function h(W){return W&&W.__esModule?W:{default:W}}function y(W){if(typeof WeakMap!="function")return null;var G=new WeakMap,Y=new WeakMap;return(y=function(ee){return ee?Y:G})(W)}function b(W,G){if(!G&&W&&W.__esModule)return W;if(W===null||e(W)!=="object"&&typeof W!="function")return{default:W};var Y=y(G);if(Y&&Y.has(W))return Y.get(W);var q={},ee=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var re in W)if(re!=="default"&&Object.prototype.hasOwnProperty.call(W,re)){var pe=ee?Object.getOwnPropertyDescriptor(W,re):null;pe&&(pe.get||pe.set)?Object.defineProperty(q,re,pe):q[re]=W[re]}return q.default=W,Y&&Y.set(W,q),q}function T(){return T=Object.assign||function(W){for(var G=1;G<arguments.length;G++){var Y=arguments[G];for(var q in Y)Object.prototype.hasOwnProperty.call(Y,q)&&(W[q]=Y[q])}return W},T.apply(this,arguments)}function _(W,G){if(W==null)return{};var Y=c(W,G),q,ee;if(Object.getOwnPropertySymbols){var re=Object.getOwnPropertySymbols(W);for(ee=0;ee<re.length;ee++)q=re[ee],!(G.indexOf(q)>=0)&&(!Object.prototype.propertyIsEnumerable.call(W,q)||(Y[q]=W[q]))}return Y}function c(W,G){if(W==null)return{};var Y={},q=Object.keys(W),ee,re;for(re=0;re<q.length;re++)ee=q[re],!(G.indexOf(ee)>=0)&&(Y[ee]=W[ee]);return Y}function u(W,G){var Y=Object.keys(W);if(Object.getOwnPropertySymbols){var q=Object.getOwnPropertySymbols(W);G&&(q=q.filter(function(ee){return Object.getOwnPropertyDescriptor(W,ee).enumerable})),Y.push.apply(Y,q)}return Y}function f(W){for(var G=1;G<arguments.length;G++){var Y=arguments[G]!=null?arguments[G]:{};G%2?u(Object(Y),!0).forEach(function(q){K(W,q,Y[q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(W,Object.getOwnPropertyDescriptors(Y)):u(Object(Y)).forEach(function(q){Object.defineProperty(W,q,Object.getOwnPropertyDescriptor(Y,q))})}return W}function v(W,G){return O(W)||S(W,G)||m(W,G)||l()}function l(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function m(W,G){if(!!W){if(typeof W=="string")return E(W,G);var Y=Object.prototype.toString.call(W).slice(8,-1);if(Y==="Object"&&W.constructor&&(Y=W.constructor.name),Y==="Map"||Y==="Set")return Array.from(W);if(Y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Y))return E(W,G)}}function E(W,G){(G==null||G>W.length)&&(G=W.length);for(var Y=0,q=new Array(G);Y<G;Y++)q[Y]=W[Y];return q}function S(W,G){var Y=W==null?null:typeof Symbol!="undefined"&&W[Symbol.iterator]||W["@@iterator"];if(Y!=null){var q=[],ee=!0,re=!1,pe,Le;try{for(Y=Y.call(W);!(ee=(pe=Y.next()).done)&&(q.push(pe.value),!(G&&q.length===G));ee=!0);}catch(Te){re=!0,Le=Te}finally{try{!ee&&Y.return!=null&&Y.return()}finally{if(re)throw Le}}return q}}function O(W){if(Array.isArray(W))return W}function D(W,G){if(!(W instanceof G))throw new TypeError("Cannot call a class as a function")}function P(W,G){for(var Y=0;Y<G.length;Y++){var q=G[Y];q.enumerable=q.enumerable||!1,q.configurable=!0,"value"in q&&(q.writable=!0),Object.defineProperty(W,q.key,q)}}function A(W,G,Y){return G&&P(W.prototype,G),Y&&P(W,Y),W}function w(W,G){if(typeof G!="function"&&G!==null)throw new TypeError("Super expression must either be null or a function");W.prototype=Object.create(G&&G.prototype,{constructor:{value:W,writable:!0,configurable:!0}}),G&&L(W,G)}function L(W,G){return L=Object.setPrototypeOf||function(q,ee){return q.__proto__=ee,q},L(W,G)}function R(W){var G=N();return function(){var q=U(W),ee;if(G){var re=U(this).constructor;ee=Reflect.construct(q,arguments,re)}else ee=q.apply(this,arguments);return C(this,ee)}}function C(W,G){if(G&&(e(G)==="object"||typeof G=="function"))return G;if(G!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return M(W)}function M(W){if(W===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return W}function N(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(W){return!1}}function U(W){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(Y){return Y.__proto__||Object.getPrototypeOf(Y)},U(W)}function K(W,G,Y){return G in W?Object.defineProperty(W,G,{value:Y,enumerable:!0,configurable:!0,writable:!0}):W[G]=Y,W}var V=function(W){w(Y,W);var G=R(Y);function Y(q){var ee;return D(this,Y),ee=G.call(this,q),K(M(ee),"onDragStart",function(re,pe){(0,g.default)("Draggable: onDragStart: %j",pe);var Le=ee.props.onStart(re,(0,o.createDraggableData)(M(ee),pe));if(Le===!1)return!1;ee.setState({dragging:!0,dragged:!0})}),K(M(ee),"onDrag",function(re,pe){if(!ee.state.dragging)return!1;(0,g.default)("Draggable: onDrag: %j",pe);var Le=(0,o.createDraggableData)(M(ee),pe),Te={x:Le.x,y:Le.y};if(ee.props.bounds){var be=Te.x,Re=Te.y;Te.x+=ee.state.slackX,Te.y+=ee.state.slackY;var Se=(0,o.getBoundPosition)(M(ee),Te.x,Te.y),Ge=v(Se,2),$e=Ge[0],st=Ge[1];Te.x=$e,Te.y=st,Te.slackX=ee.state.slackX+(be-Te.x),Te.slackY=ee.state.slackY+(Re-Te.y),Le.x=Te.x,Le.y=Te.y,Le.deltaX=Te.x-ee.state.x,Le.deltaY=Te.y-ee.state.y}var Ze=ee.props.onDrag(re,Le);if(Ze===!1)return!1;ee.setState(Te)}),K(M(ee),"onDragStop",function(re,pe){if(!ee.state.dragging)return!1;var Le=ee.props.onStop(re,(0,o.createDraggableData)(M(ee),pe));if(Le===!1)return!1;(0,g.default)("Draggable: onDragStop: %j",pe);var Te={dragging:!1,slackX:0,slackY:0},be=Boolean(ee.props.position);if(be){var Re=ee.props.position,Se=Re.x,Ge=Re.y;Te.x=Se,Te.y=Ge}ee.setState(Te)}),ee.state={dragging:!1,dragged:!1,x:q.position?q.position.x:q.defaultPosition.x,y:q.position?q.position.y:q.defaultPosition.y,prevPropsPosition:f({},q.position),slackX:0,slackY:0,isElementSVG:!1},q.position&&!(q.onDrag||q.onStop)&&console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element."),ee}return A(Y,[{key:"componentDidMount",value:function(){typeof window.SVGElement!="undefined"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}},{key:"componentWillUnmount",value:function(){this.setState({dragging:!1})}},{key:"findDOMNode",value:function(){var ee,re,pe;return(ee=(re=this.props)===null||re===void 0||(pe=re.nodeRef)===null||pe===void 0?void 0:pe.current)!==null&&ee!==void 0?ee:t.default.findDOMNode(this)}},{key:"render",value:function(){var ee,re=this.props;re.axis,re.bounds;var pe=re.children,Le=re.defaultPosition,Te=re.defaultClassName,be=re.defaultClassNameDragging,Re=re.defaultClassNameDragged,Se=re.position,Ge=re.positionOffset;re.scale;var $e=_(re,d),st={},Ze=null,et=Boolean(Se),ft=!et||this.state.dragging,dt=Se||Le,ht={x:(0,o.canDragX)(this)&&ft?this.state.x:dt.x,y:(0,o.canDragY)(this)&&ft?this.state.y:dt.y};this.state.isElementSVG?Ze=(0,s.createSVGTransform)(ht,Ge):st=(0,s.createCSSTransform)(ht,Ge);var He=(0,a.default)(pe.props.className||"",Te,(ee={},K(ee,be,this.state.dragging),K(ee,Re,this.state.dragged),ee));return r.createElement(x.default,T({},$e,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),r.cloneElement(r.Children.only(pe),{className:He,style:f(f({},pe.props.style),st),transform:Ze}))}}],[{key:"getDerivedStateFromProps",value:function(ee,re){var pe=ee.position,Le=re.prevPropsPosition;return pe&&(!Le||pe.x!==Le.x||pe.y!==Le.y)?((0,g.default)("Draggable: getDerivedStateFromProps %j",{position:pe,prevPropsPosition:Le}),{x:pe.x,y:pe.y,prevPropsPosition:f({},pe)}):null}}]),Y}(r.Component);i.default=V,K(V,"displayName","Draggable"),K(V,"propTypes",f(f({},x.default.propTypes),{},{axis:n.default.oneOf(["both","x","y","none"]),bounds:n.default.oneOfType([n.default.shape({left:n.default.number,right:n.default.number,top:n.default.number,bottom:n.default.number}),n.default.string,n.default.oneOf([!1])]),defaultClassName:n.default.string,defaultClassNameDragging:n.default.string,defaultClassNameDragged:n.default.string,defaultPosition:n.default.shape({x:n.default.number,y:n.default.number}),positionOffset:n.default.shape({x:n.default.oneOfType([n.default.number,n.default.string]),y:n.default.oneOfType([n.default.number,n.default.string])}),position:n.default.shape({x:n.default.number,y:n.default.number}),className:p.dontSetMe,style:p.dontSetMe,transform:p.dontSetMe})),K(V,"defaultProps",f(f({},x.default.defaultProps),{},{axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1}))})(Tf);var Ff=Tf,Uf=Ff.default,fm=Ff.DraggableCore;Ds.exports=Uf;Ds.exports.default=Uf;Ds.exports.DraggableCore=fm;var jf=Ds.exports;/**!
 * Sortable 1.14.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Wf(i,e){var r=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})),r.push.apply(r,n)}return r}function dn(i){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Wf(Object(r),!0).forEach(function(n){cm(i,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):Wf(Object(r)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(r,n))})}return i}function Ns(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ns=function(e){return typeof e}:Ns=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ns(i)}function cm(i,e,r){return e in i?Object.defineProperty(i,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[e]=r,i}function hn(){return hn=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])}return i},hn.apply(this,arguments)}function dm(i,e){if(i==null)return{};var r={},n=Object.keys(i),t,a;for(a=0;a<n.length;a++)t=n[a],!(e.indexOf(t)>=0)&&(r[t]=i[t]);return r}function hm(i,e){if(i==null)return{};var r=dm(i,e),n,t;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);for(t=0;t<a.length;t++)n=a[t],!(e.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,n)||(r[n]=i[n]))}return r}var pm="1.14.0";function On(i){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(i)}var An=On(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Ea=On(/Edge/i),zf=On(/firefox/i),_a=On(/safari/i)&&!On(/chrome/i)&&!On(/android/i),Kf=On(/iP(ad|od|hone)/i),vm=On(/chrome/i)&&On(/android/i),Vf={capture:!1,passive:!1};function It(i,e,r){i.addEventListener(e,r,!An&&Vf)}function Rt(i,e,r){i.removeEventListener(e,r,!An&&Vf)}function Bs(i,e){if(!!e){if(e[0]===">"&&(e=e.substring(1)),i)try{if(i.matches)return i.matches(e);if(i.msMatchesSelector)return i.msMatchesSelector(e);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(e)}catch(r){return!1}return!1}}function gm(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function pn(i,e,r,n){if(i){r=r||document;do{if(e!=null&&(e[0]===">"?i.parentNode===r&&Bs(i,e):Bs(i,e))||n&&i===r)return i;if(i===r)break}while(i=gm(i))}return null}var Gf=/\s+/g;function hr(i,e,r){if(i&&e)if(i.classList)i.classList[r?"add":"remove"](e);else{var n=(" "+i.className+" ").replace(Gf," ").replace(" "+e+" "," ");i.className=(n+(r?" "+e:"")).replace(Gf," ")}}function _t(i,e,r){var n=i&&i.style;if(n){if(r===void 0)return document.defaultView&&document.defaultView.getComputedStyle?r=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(r=i.currentStyle),e===void 0?r:r[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=r+(typeof r=="string"?"":"px")}}function Ri(i,e){var r="";if(typeof i=="string")r=i;else do{var n=_t(i,"transform");n&&n!=="none"&&(r=n+" "+r)}while(!e&&(i=i.parentNode));var t=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return t&&new t(r)}function Hf(i,e,r){if(i){var n=i.getElementsByTagName(e),t=0,a=n.length;if(r)for(;t<a;t++)r(n[t],t);return n}return[]}function vn(){var i=document.scrollingElement;return i||document.documentElement}function er(i,e,r,n,t){if(!(!i.getBoundingClientRect&&i!==window)){var a,s,o,p,x,g,d;if(i!==window&&i.parentNode&&i!==vn()?(a=i.getBoundingClientRect(),s=a.top,o=a.left,p=a.bottom,x=a.right,g=a.height,d=a.width):(s=0,o=0,p=window.innerHeight,x=window.innerWidth,g=window.innerHeight,d=window.innerWidth),(e||r)&&i!==window&&(t=t||i.parentNode,!An))do if(t&&t.getBoundingClientRect&&(_t(t,"transform")!=="none"||r&&_t(t,"position")!=="static")){var h=t.getBoundingClientRect();s-=h.top+parseInt(_t(t,"border-top-width")),o-=h.left+parseInt(_t(t,"border-left-width")),p=s+a.height,x=o+a.width;break}while(t=t.parentNode);if(n&&i!==window){var y=Ri(t||i),b=y&&y.a,T=y&&y.d;y&&(s/=T,o/=b,d/=b,g/=T,p=s+g,x=o+d)}return{top:s,left:o,bottom:p,right:x,width:d,height:g}}}function $f(i,e,r){for(var n=Un(i,!0),t=er(i)[e];n;){var a=er(n)[r],s=void 0;if(r==="top"||r==="left"?s=t>=a:s=t<=a,!s)return n;if(n===vn())break;n=Un(n,!1)}return!1}function Ci(i,e,r,n){for(var t=0,a=0,s=i.children;a<s.length;){if(s[a].style.display!=="none"&&s[a]!==Et.ghost&&(n||s[a]!==Et.dragged)&&pn(s[a],r.draggable,i,!1)){if(t===e)return s[a];t++}a++}return null}function Al(i,e){for(var r=i.lastElementChild;r&&(r===Et.ghost||_t(r,"display")==="none"||e&&!Bs(r,e));)r=r.previousElementSibling;return r||null}function Or(i,e){var r=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==Et.clone&&(!e||Bs(i,e))&&r++;return r}function Yf(i){var e=0,r=0,n=vn();if(i)do{var t=Ri(i),a=t.a,s=t.d;e+=i.scrollLeft*a,r+=i.scrollTop*s}while(i!==n&&(i=i.parentNode));return[e,r]}function mm(i,e){for(var r in i)if(!!i.hasOwnProperty(r)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===i[r][n])return Number(r)}return-1}function Un(i,e){if(!i||!i.getBoundingClientRect)return vn();var r=i,n=!1;do if(r.clientWidth<r.scrollWidth||r.clientHeight<r.scrollHeight){var t=_t(r);if(r.clientWidth<r.scrollWidth&&(t.overflowX=="auto"||t.overflowX=="scroll")||r.clientHeight<r.scrollHeight&&(t.overflowY=="auto"||t.overflowY=="scroll")){if(!r.getBoundingClientRect||r===document.body)return vn();if(n||e)return r;n=!0}}while(r=r.parentNode);return vn()}function ym(i,e){if(i&&e)for(var r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);return i}function wl(i,e){return Math.round(i.top)===Math.round(e.top)&&Math.round(i.left)===Math.round(e.left)&&Math.round(i.height)===Math.round(e.height)&&Math.round(i.width)===Math.round(e.width)}var xa;function Xf(i,e){return function(){if(!xa){var r=arguments,n=this;r.length===1?i.call(n,r[0]):i.apply(n,r),xa=setTimeout(function(){xa=void 0},e)}}}function Em(){clearTimeout(xa),xa=void 0}function Zf(i,e,r){i.scrollLeft+=e,i.scrollTop+=r}function Qf(i){var e=window.Polymer,r=window.jQuery||window.Zepto;return e&&e.dom?e.dom(i).cloneNode(!0):r?r(i).clone(!0)[0]:i.cloneNode(!0)}var Ir="Sortable"+new Date().getTime();function _m(){var i=[],e;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(t){if(!(_t(t,"display")==="none"||t===Et.ghost)){i.push({target:t,rect:er(t)});var a=dn({},i[i.length-1].rect);if(t.thisAnimationDuration){var s=Ri(t,!0);s&&(a.top-=s.f,a.left-=s.e)}t.fromRect=a}})}},addAnimationState:function(n){i.push(n)},removeAnimationState:function(n){i.splice(mm(i,{target:n}),1)},animateAll:function(n){var t=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,s=0;i.forEach(function(o){var p=0,x=o.target,g=x.fromRect,d=er(x),h=x.prevFromRect,y=x.prevToRect,b=o.rect,T=Ri(x,!0);T&&(d.top-=T.f,d.left-=T.e),x.toRect=d,x.thisAnimationDuration&&wl(h,d)&&!wl(g,d)&&(b.top-d.top)/(b.left-d.left)==(g.top-d.top)/(g.left-d.left)&&(p=bm(b,h,y,t.options)),wl(d,g)||(x.prevFromRect=g,x.prevToRect=d,p||(p=t.options.animation),t.animate(x,b,d,p)),p&&(a=!0,s=Math.max(s,p),clearTimeout(x.animationResetTimer),x.animationResetTimer=setTimeout(function(){x.animationTime=0,x.prevFromRect=null,x.fromRect=null,x.prevToRect=null,x.thisAnimationDuration=null},p),x.thisAnimationDuration=p)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},s):typeof n=="function"&&n(),i=[]},animate:function(n,t,a,s){if(s){_t(n,"transition",""),_t(n,"transform","");var o=Ri(this.el),p=o&&o.a,x=o&&o.d,g=(t.left-a.left)/(p||1),d=(t.top-a.top)/(x||1);n.animatingX=!!g,n.animatingY=!!d,_t(n,"transform","translate3d("+g+"px,"+d+"px,0)"),this.forRepaintDummy=xm(n),_t(n,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),_t(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){_t(n,"transition",""),_t(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},s)}}}}function xm(i){return i.offsetWidth}function bm(i,e,r,n){return Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))/Math.sqrt(Math.pow(e.top-r.top,2)+Math.pow(e.left-r.left,2))*n.animation}var Ii=[],Ll={initializeByDefault:!0},ba={mount:function(e){for(var r in Ll)Ll.hasOwnProperty(r)&&!(r in e)&&(e[r]=Ll[r]);Ii.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Ii.push(e)},pluginEvent:function(e,r,n){var t=this;this.eventCanceled=!1,n.cancel=function(){t.eventCanceled=!0};var a=e+"Global";Ii.forEach(function(s){!r[s.pluginName]||(r[s.pluginName][a]&&r[s.pluginName][a](dn({sortable:r},n)),r.options[s.pluginName]&&r[s.pluginName][e]&&r[s.pluginName][e](dn({sortable:r},n)))})},initializePlugins:function(e,r,n,t){Ii.forEach(function(o){var p=o.pluginName;if(!(!e.options[p]&&!o.initializeByDefault)){var x=new o(e,r,e.options);x.sortable=e,x.options=e.options,e[p]=x,hn(n,x.defaults)}});for(var a in e.options)if(!!e.options.hasOwnProperty(a)){var s=this.modifyOption(e,a,e.options[a]);typeof s!="undefined"&&(e.options[a]=s)}},getEventProperties:function(e,r){var n={};return Ii.forEach(function(t){typeof t.eventProperties=="function"&&hn(n,t.eventProperties.call(r[t.pluginName],e))}),n},modifyOption:function(e,r,n){var t;return Ii.forEach(function(a){!e[a.pluginName]||a.optionListeners&&typeof a.optionListeners[r]=="function"&&(t=a.optionListeners[r].call(e[a.pluginName],n))}),t}};function Sm(i){var e=i.sortable,r=i.rootEl,n=i.name,t=i.targetEl,a=i.cloneEl,s=i.toEl,o=i.fromEl,p=i.oldIndex,x=i.newIndex,g=i.oldDraggableIndex,d=i.newDraggableIndex,h=i.originalEvent,y=i.putSortable,b=i.extraEventProperties;if(e=e||r&&r[Ir],!!e){var T,_=e.options,c="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!An&&!Ea?T=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(T=document.createEvent("Event"),T.initEvent(n,!0,!0)),T.to=s||r,T.from=o||r,T.item=t||r,T.clone=a,T.oldIndex=p,T.newIndex=x,T.oldDraggableIndex=g,T.newDraggableIndex=d,T.originalEvent=h,T.pullMode=y?y.lastPutMode:void 0;var u=dn(dn({},b),ba.getEventProperties(n,e));for(var f in u)T[f]=u[f];r&&r.dispatchEvent(T),_[c]&&_[c].call(e,T)}}var Tm=["evt"],Ar=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},t=n.evt,a=hm(n,Tm);ba.pluginEvent.bind(Et)(e,r,dn({dragEl:Ye,parentEl:Yt,ghostEl:Ot,rootEl:Ut,nextEl:ii,lastDownEl:Fs,cloneEl:Xt,cloneHidden:jn,dragStarted:Ta,putSortable:sr,activeSortable:Et.active,originalEvent:t,oldIndex:Mi,oldDraggableIndex:Sa,newIndex:Mr,newDraggableIndex:Wn,hideGhostForTarget:ic,unhideGhostForTarget:ac,cloneNowHidden:function(){jn=!0},cloneNowShown:function(){jn=!1},dispatchSortableEvent:function(o){_r({sortable:r,name:o,originalEvent:t})}},a))};function _r(i){Sm(dn({putSortable:sr,cloneEl:Xt,targetEl:Ye,rootEl:Ut,oldIndex:Mi,oldDraggableIndex:Sa,newIndex:Mr,newDraggableIndex:Wn},i))}var Ye,Yt,Ot,Ut,ii,Fs,Xt,jn,Mi,Mr,Sa,Wn,Us,sr,ki=!1,js=!1,Ws=[],ai,en,Dl,Pl,Jf,qf,Ta,Ni,Oa,Aa=!1,zs=!1,Ks,pr,Rl=[],Cl=!1,Vs=[],Gs=typeof document!="undefined",Hs=Kf,ec=Ea||An?"cssFloat":"float",Om=Gs&&!vm&&!Kf&&"draggable"in document.createElement("div"),tc=function(){if(!!Gs){if(An)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),rc=function(e,r){var n=_t(e),t=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=Ci(e,0,r),s=Ci(e,1,r),o=a&&_t(a),p=s&&_t(s),x=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+er(a).width,g=p&&parseInt(p.marginLeft)+parseInt(p.marginRight)+er(s).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&o.float&&o.float!=="none"){var d=o.float==="left"?"left":"right";return s&&(p.clear==="both"||p.clear===d)?"vertical":"horizontal"}return a&&(o.display==="block"||o.display==="flex"||o.display==="table"||o.display==="grid"||x>=t&&n[ec]==="none"||s&&n[ec]==="none"&&x+g>t)?"vertical":"horizontal"},Am=function(e,r,n){var t=n?e.left:e.top,a=n?e.right:e.bottom,s=n?e.width:e.height,o=n?r.left:r.top,p=n?r.right:r.bottom,x=n?r.width:r.height;return t===o||a===p||t+s/2===o+x/2},wm=function(e,r){var n;return Ws.some(function(t){var a=t[Ir].options.emptyInsertThreshold;if(!(!a||Al(t))){var s=er(t),o=e>=s.left-a&&e<=s.right+a,p=r>=s.top-a&&r<=s.bottom+a;if(o&&p)return n=t}}),n},nc=function(e){function r(a,s){return function(o,p,x,g){var d=o.options.group.name&&p.options.group.name&&o.options.group.name===p.options.group.name;if(a==null&&(s||d))return!0;if(a==null||a===!1)return!1;if(s&&a==="clone")return a;if(typeof a=="function")return r(a(o,p,x,g),s)(o,p,x,g);var h=(s?o:p).options.group.name;return a===!0||typeof a=="string"&&a===h||a.join&&a.indexOf(h)>-1}}var n={},t=e.group;(!t||Ns(t)!="object")&&(t={name:t}),n.name=t.name,n.checkPull=r(t.pull,!0),n.checkPut=r(t.put),n.revertClone=t.revertClone,e.group=n},ic=function(){!tc&&Ot&&_t(Ot,"display","none")},ac=function(){!tc&&Ot&&_t(Ot,"display","")};Gs&&document.addEventListener("click",function(i){if(js)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),js=!1,!1},!0);var si=function(e){if(Ye){e=e.touches?e.touches[0]:e;var r=wm(e.clientX,e.clientY);if(r){var n={};for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);n.target=n.rootEl=r,n.preventDefault=void 0,n.stopPropagation=void 0,r[Ir]._onDragOver(n)}}},Lm=function(e){Ye&&Ye.parentNode[Ir]._isOutsideThisEl(e.target)};function Et(i,e){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=e=hn({},e),i[Ir]=this;var r={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return rc(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,o){s.setData("Text",o.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:Et.supportPointer!==!1&&"PointerEvent"in window&&!_a,emptyInsertThreshold:5};ba.initializePlugins(this,i,r);for(var n in r)!(n in e)&&(e[n]=r[n]);nc(e);for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this));this.nativeDraggable=e.forceFallback?!1:Om,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?It(i,"pointerdown",this._onTapStart):(It(i,"mousedown",this._onTapStart),It(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(It(i,"dragover",this),It(i,"dragenter",this)),Ws.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),hn(this,_m())}Et.prototype={constructor:Et,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(Ni=null)},_getDirection:function(e,r){return typeof this.options.direction=="function"?this.options.direction.call(this,e,r,Ye):this.options.direction},_onTapStart:function(e){if(!!e.cancelable){var r=this,n=this.el,t=this.options,a=t.preventOnFilter,s=e.type,o=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,p=(o||e).target,x=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||p,g=t.filter;if(Nm(n),!Ye&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||t.disabled)&&!x.isContentEditable&&!(!this.nativeDraggable&&_a&&p&&p.tagName.toUpperCase()==="SELECT")&&(p=pn(p,t.draggable,n,!1),!(p&&p.animated)&&Fs!==p)){if(Mi=Or(p),Sa=Or(p,t.draggable),typeof g=="function"){if(g.call(this,e,p,this)){_r({sortable:r,rootEl:x,name:"filter",targetEl:p,toEl:n,fromEl:n}),Ar("filter",r,{evt:e}),a&&e.cancelable&&e.preventDefault();return}}else if(g&&(g=g.split(",").some(function(d){if(d=pn(x,d.trim(),n,!1),d)return _r({sortable:r,rootEl:d,name:"filter",targetEl:p,fromEl:n,toEl:n}),Ar("filter",r,{evt:e}),!0}),g)){a&&e.cancelable&&e.preventDefault();return}t.handle&&!pn(x,t.handle,n,!1)||this._prepareDragStart(e,o,p)}}},_prepareDragStart:function(e,r,n){var t=this,a=t.el,s=t.options,o=a.ownerDocument,p;if(n&&!Ye&&n.parentNode===a){var x=er(n);if(Ut=a,Ye=n,Yt=Ye.parentNode,ii=Ye.nextSibling,Fs=n,Us=s.group,Et.dragged=Ye,ai={target:Ye,clientX:(r||e).clientX,clientY:(r||e).clientY},Jf=ai.clientX-x.left,qf=ai.clientY-x.top,this._lastX=(r||e).clientX,this._lastY=(r||e).clientY,Ye.style["will-change"]="all",p=function(){if(Ar("delayEnded",t,{evt:e}),Et.eventCanceled){t._onDrop();return}t._disableDelayedDragEvents(),!zf&&t.nativeDraggable&&(Ye.draggable=!0),t._triggerDragStart(e,r),_r({sortable:t,name:"choose",originalEvent:e}),hr(Ye,s.chosenClass,!0)},s.ignore.split(",").forEach(function(g){Hf(Ye,g.trim(),Il)}),It(o,"dragover",si),It(o,"mousemove",si),It(o,"touchmove",si),It(o,"mouseup",t._onDrop),It(o,"touchend",t._onDrop),It(o,"touchcancel",t._onDrop),zf&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Ye.draggable=!0),Ar("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||r)&&(!this.nativeDraggable||!(Ea||An))){if(Et.eventCanceled){this._onDrop();return}It(o,"mouseup",t._disableDelayedDrag),It(o,"touchend",t._disableDelayedDrag),It(o,"touchcancel",t._disableDelayedDrag),It(o,"mousemove",t._delayedDragTouchMoveHandler),It(o,"touchmove",t._delayedDragTouchMoveHandler),s.supportPointer&&It(o,"pointermove",t._delayedDragTouchMoveHandler),t._dragStartTimer=setTimeout(p,s.delay)}else p()}},_delayedDragTouchMoveHandler:function(e){var r=e.touches?e.touches[0]:e;Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Ye&&Il(Ye),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;Rt(e,"mouseup",this._disableDelayedDrag),Rt(e,"touchend",this._disableDelayedDrag),Rt(e,"touchcancel",this._disableDelayedDrag),Rt(e,"mousemove",this._delayedDragTouchMoveHandler),Rt(e,"touchmove",this._delayedDragTouchMoveHandler),Rt(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,r){r=r||e.pointerType=="touch"&&e,!this.nativeDraggable||r?this.options.supportPointer?It(document,"pointermove",this._onTouchMove):r?It(document,"touchmove",this._onTouchMove):It(document,"mousemove",this._onTouchMove):(It(Ye,"dragend",this),It(Ut,"dragstart",this._onDragStart));try{document.selection?Ys(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(n){}},_dragStarted:function(e,r){if(ki=!1,Ut&&Ye){Ar("dragStarted",this,{evt:r}),this.nativeDraggable&&It(document,"dragover",Lm);var n=this.options;!e&&hr(Ye,n.dragClass,!1),hr(Ye,n.ghostClass,!0),Et.active=this,e&&this._appendGhost(),_r({sortable:this,name:"start",originalEvent:r})}else this._nulling()},_emulateDragOver:function(){if(en){this._lastX=en.clientX,this._lastY=en.clientY,ic();for(var e=document.elementFromPoint(en.clientX,en.clientY),r=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(en.clientX,en.clientY),e!==r);)r=e;if(Ye.parentNode[Ir]._isOutsideThisEl(e),r)do{if(r[Ir]){var n=void 0;if(n=r[Ir]._onDragOver({clientX:en.clientX,clientY:en.clientY,target:e,rootEl:r}),n&&!this.options.dragoverBubble)break}e=r}while(r=r.parentNode);ac()}},_onTouchMove:function(e){if(ai){var r=this.options,n=r.fallbackTolerance,t=r.fallbackOffset,a=e.touches?e.touches[0]:e,s=Ot&&Ri(Ot,!0),o=Ot&&s&&s.a,p=Ot&&s&&s.d,x=Hs&&pr&&Yf(pr),g=(a.clientX-ai.clientX+t.x)/(o||1)+(x?x[0]-Rl[0]:0)/(o||1),d=(a.clientY-ai.clientY+t.y)/(p||1)+(x?x[1]-Rl[1]:0)/(p||1);if(!Et.active&&!ki){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(Ot){s?(s.e+=g-(Dl||0),s.f+=d-(Pl||0)):s={a:1,b:0,c:0,d:1,e:g,f:d};var h="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");_t(Ot,"webkitTransform",h),_t(Ot,"mozTransform",h),_t(Ot,"msTransform",h),_t(Ot,"transform",h),Dl=g,Pl=d,en=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!Ot){var e=this.options.fallbackOnBody?document.body:Ut,r=er(Ye,!0,Hs,!0,e),n=this.options;if(Hs){for(pr=e;_t(pr,"position")==="static"&&_t(pr,"transform")==="none"&&pr!==document;)pr=pr.parentNode;pr!==document.body&&pr!==document.documentElement?(pr===document&&(pr=vn()),r.top+=pr.scrollTop,r.left+=pr.scrollLeft):pr=vn(),Rl=Yf(pr)}Ot=Ye.cloneNode(!0),hr(Ot,n.ghostClass,!1),hr(Ot,n.fallbackClass,!0),hr(Ot,n.dragClass,!0),_t(Ot,"transition",""),_t(Ot,"transform",""),_t(Ot,"box-sizing","border-box"),_t(Ot,"margin",0),_t(Ot,"top",r.top),_t(Ot,"left",r.left),_t(Ot,"width",r.width),_t(Ot,"height",r.height),_t(Ot,"opacity","0.8"),_t(Ot,"position",Hs?"absolute":"fixed"),_t(Ot,"zIndex","100000"),_t(Ot,"pointerEvents","none"),Et.ghost=Ot,e.appendChild(Ot),_t(Ot,"transform-origin",Jf/parseInt(Ot.style.width)*100+"% "+qf/parseInt(Ot.style.height)*100+"%")}},_onDragStart:function(e,r){var n=this,t=e.dataTransfer,a=n.options;if(Ar("dragStart",this,{evt:e}),Et.eventCanceled){this._onDrop();return}Ar("setupClone",this),Et.eventCanceled||(Xt=Qf(Ye),Xt.draggable=!1,Xt.style["will-change"]="",this._hideClone(),hr(Xt,this.options.chosenClass,!1),Et.clone=Xt),n.cloneId=Ys(function(){Ar("clone",n),!Et.eventCanceled&&(n.options.removeCloneOnHide||Ut.insertBefore(Xt,Ye),n._hideClone(),_r({sortable:n,name:"clone"}))}),!r&&hr(Ye,a.dragClass,!0),r?(js=!0,n._loopId=setInterval(n._emulateDragOver,50)):(Rt(document,"mouseup",n._onDrop),Rt(document,"touchend",n._onDrop),Rt(document,"touchcancel",n._onDrop),t&&(t.effectAllowed="move",a.setData&&a.setData.call(n,t,Ye)),It(document,"drop",n),_t(Ye,"transform","translateZ(0)")),ki=!0,n._dragStartId=Ys(n._dragStarted.bind(n,r,e)),It(document,"selectstart",n),Ta=!0,_a&&_t(document.body,"user-select","none")},_onDragOver:function(e){var r=this.el,n=e.target,t,a,s,o=this.options,p=o.group,x=Et.active,g=Us===p,d=o.sort,h=sr||x,y,b=this,T=!1;if(Cl)return;function _(N,U){Ar(N,b,dn({evt:e,isOwner:g,axis:y?"vertical":"horizontal",revert:s,dragRect:t,targetRect:a,canSort:d,fromSortable:h,target:n,completed:u,onMove:function(V,W){return $s(Ut,r,Ye,t,V,er(V),e,W)},changed:f},U))}function c(){_("dragOverAnimationCapture"),b.captureAnimationState(),b!==h&&h.captureAnimationState()}function u(N){return _("dragOverCompleted",{insertion:N}),N&&(g?x._hideClone():x._showClone(b),b!==h&&(hr(Ye,sr?sr.options.ghostClass:x.options.ghostClass,!1),hr(Ye,o.ghostClass,!0)),sr!==b&&b!==Et.active?sr=b:b===Et.active&&sr&&(sr=null),h===b&&(b._ignoreWhileAnimating=n),b.animateAll(function(){_("dragOverAnimationComplete"),b._ignoreWhileAnimating=null}),b!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(n===Ye&&!Ye.animated||n===r&&!n.animated)&&(Ni=null),!o.dragoverBubble&&!e.rootEl&&n!==document&&(Ye.parentNode[Ir]._isOutsideThisEl(e.target),!N&&si(e)),!o.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),T=!0}function f(){Mr=Or(Ye),Wn=Or(Ye,o.draggable),_r({sortable:b,name:"change",toEl:r,newIndex:Mr,newDraggableIndex:Wn,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=pn(n,o.draggable,r,!0),_("dragOver"),Et.eventCanceled)return T;if(Ye.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||b._ignoreWhileAnimating===n)return u(!1);if(js=!1,x&&!o.disabled&&(g?d||(s=Yt!==Ut):sr===this||(this.lastPutMode=Us.checkPull(this,x,Ye,e))&&p.checkPut(this,x,Ye,e))){if(y=this._getDirection(e,n)==="vertical",t=er(Ye),_("dragOverValid"),Et.eventCanceled)return T;if(s)return Yt=Ut,c(),this._hideClone(),_("revert"),Et.eventCanceled||(ii?Ut.insertBefore(Ye,ii):Ut.appendChild(Ye)),u(!0);var v=Al(r,o.draggable);if(!v||Cm(e,y,this)&&!v.animated){if(v===Ye)return u(!1);if(v&&r===e.target&&(n=v),n&&(a=er(n)),$s(Ut,r,Ye,t,n,a,e,!!n)!==!1)return c(),r.appendChild(Ye),Yt=r,f(),u(!0)}else if(v&&Rm(e,y,this)){var l=Ci(r,0,o,!0);if(l===Ye)return u(!1);if(n=l,a=er(n),$s(Ut,r,Ye,t,n,a,e,!1)!==!1)return c(),r.insertBefore(Ye,l),Yt=r,f(),u(!0)}else if(n.parentNode===r){a=er(n);var m=0,E,S=Ye.parentNode!==r,O=!Am(Ye.animated&&Ye.toRect||t,n.animated&&n.toRect||a,y),D=y?"top":"left",P=$f(n,"top","top")||$f(Ye,"top","top"),A=P?P.scrollTop:void 0;Ni!==n&&(E=a[D],Aa=!1,zs=!O&&o.invertSwap||S),m=Im(e,n,a,y,O?1:o.swapThreshold,o.invertedSwapThreshold==null?o.swapThreshold:o.invertedSwapThreshold,zs,Ni===n);var w;if(m!==0){var L=Or(Ye);do L-=m,w=Yt.children[L];while(w&&(_t(w,"display")==="none"||w===Ot))}if(m===0||w===n)return u(!1);Ni=n,Oa=m;var R=n.nextElementSibling,C=!1;C=m===1;var M=$s(Ut,r,Ye,t,n,a,e,C);if(M!==!1)return(M===1||M===-1)&&(C=M===1),Cl=!0,setTimeout(Pm,30),c(),C&&!R?r.appendChild(Ye):n.parentNode.insertBefore(Ye,C?R:n),P&&Zf(P,0,A-P.scrollTop),Yt=Ye.parentNode,E!==void 0&&!zs&&(Ks=Math.abs(E-er(n)[D])),f(),u(!0)}if(r.contains(Ye))return u(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){Rt(document,"mousemove",this._onTouchMove),Rt(document,"touchmove",this._onTouchMove),Rt(document,"pointermove",this._onTouchMove),Rt(document,"dragover",si),Rt(document,"mousemove",si),Rt(document,"touchmove",si)},_offUpEvents:function(){var e=this.el.ownerDocument;Rt(e,"mouseup",this._onDrop),Rt(e,"touchend",this._onDrop),Rt(e,"pointerup",this._onDrop),Rt(e,"touchcancel",this._onDrop),Rt(document,"selectstart",this)},_onDrop:function(e){var r=this.el,n=this.options;if(Mr=Or(Ye),Wn=Or(Ye,n.draggable),Ar("drop",this,{evt:e}),Yt=Ye&&Ye.parentNode,Mr=Or(Ye),Wn=Or(Ye,n.draggable),Et.eventCanceled){this._nulling();return}ki=!1,zs=!1,Aa=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ml(this.cloneId),Ml(this._dragStartId),this.nativeDraggable&&(Rt(document,"drop",this),Rt(r,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),_a&&_t(document.body,"user-select",""),_t(Ye,"transform",""),e&&(Ta&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),Ot&&Ot.parentNode&&Ot.parentNode.removeChild(Ot),(Ut===Yt||sr&&sr.lastPutMode!=="clone")&&Xt&&Xt.parentNode&&Xt.parentNode.removeChild(Xt),Ye&&(this.nativeDraggable&&Rt(Ye,"dragend",this),Il(Ye),Ye.style["will-change"]="",Ta&&!ki&&hr(Ye,sr?sr.options.ghostClass:this.options.ghostClass,!1),hr(Ye,this.options.chosenClass,!1),_r({sortable:this,name:"unchoose",toEl:Yt,newIndex:null,newDraggableIndex:null,originalEvent:e}),Ut!==Yt?(Mr>=0&&(_r({rootEl:Yt,name:"add",toEl:Yt,fromEl:Ut,originalEvent:e}),_r({sortable:this,name:"remove",toEl:Yt,originalEvent:e}),_r({rootEl:Yt,name:"sort",toEl:Yt,fromEl:Ut,originalEvent:e}),_r({sortable:this,name:"sort",toEl:Yt,originalEvent:e})),sr&&sr.save()):Mr!==Mi&&Mr>=0&&(_r({sortable:this,name:"update",toEl:Yt,originalEvent:e}),_r({sortable:this,name:"sort",toEl:Yt,originalEvent:e})),Et.active&&((Mr==null||Mr===-1)&&(Mr=Mi,Wn=Sa),_r({sortable:this,name:"end",toEl:Yt,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){Ar("nulling",this),Ut=Ye=Yt=Ot=ii=Xt=Fs=jn=ai=en=Ta=Mr=Wn=Mi=Sa=Ni=Oa=sr=Us=Et.dragged=Et.ghost=Et.clone=Et.active=null,Vs.forEach(function(e){e.checked=!0}),Vs.length=Dl=Pl=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":Ye&&(this._onDragOver(e),Dm(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],r,n=this.el.children,t=0,a=n.length,s=this.options;t<a;t++)r=n[t],pn(r,s.draggable,this.el,!1)&&e.push(r.getAttribute(s.dataIdAttr)||km(r));return e},sort:function(e,r){var n={},t=this.el;this.toArray().forEach(function(a,s){var o=t.children[s];pn(o,this.options.draggable,t,!1)&&(n[a]=o)},this),r&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(t.removeChild(n[a]),t.appendChild(n[a]))}),r&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,r){return pn(e,r||this.options.draggable,this.el,!1)},option:function(e,r){var n=this.options;if(r===void 0)return n[e];var t=ba.modifyOption(this,e,r);typeof t!="undefined"?n[e]=t:n[e]=r,e==="group"&&nc(n)},destroy:function(){Ar("destroy",this);var e=this.el;e[Ir]=null,Rt(e,"mousedown",this._onTapStart),Rt(e,"touchstart",this._onTapStart),Rt(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(Rt(e,"dragover",this),Rt(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(r){r.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Ws.splice(Ws.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!jn){if(Ar("hideClone",this),Et.eventCanceled)return;_t(Xt,"display","none"),this.options.removeCloneOnHide&&Xt.parentNode&&Xt.parentNode.removeChild(Xt),jn=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(jn){if(Ar("showClone",this),Et.eventCanceled)return;Ye.parentNode==Ut&&!this.options.group.revertClone?Ut.insertBefore(Xt,Ye):ii?Ut.insertBefore(Xt,ii):Ut.appendChild(Xt),this.options.group.revertClone&&this.animate(Ye,Xt),_t(Xt,"display",""),jn=!1}}};function Dm(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function $s(i,e,r,n,t,a,s,o){var p,x=i[Ir],g=x.options.onMove,d;return window.CustomEvent&&!An&&!Ea?p=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(p=document.createEvent("Event"),p.initEvent("move",!0,!0)),p.to=e,p.from=i,p.dragged=r,p.draggedRect=n,p.related=t||e,p.relatedRect=a||er(e),p.willInsertAfter=o,p.originalEvent=s,i.dispatchEvent(p),g&&(d=g.call(x,p,s)),d}function Il(i){i.draggable=!1}function Pm(){Cl=!1}function Rm(i,e,r){var n=er(Ci(r.el,0,r.options,!0)),t=10;return e?i.clientX<n.left-t||i.clientY<n.top&&i.clientX<n.right:i.clientY<n.top-t||i.clientY<n.bottom&&i.clientX<n.left}function Cm(i,e,r){var n=er(Al(r.el,r.options.draggable)),t=10;return e?i.clientX>n.right+t||i.clientX<=n.right&&i.clientY>n.bottom&&i.clientX>=n.left:i.clientX>n.right&&i.clientY>n.top||i.clientX<=n.right&&i.clientY>n.bottom+t}function Im(i,e,r,n,t,a,s,o){var p=n?i.clientY:i.clientX,x=n?r.height:r.width,g=n?r.top:r.left,d=n?r.bottom:r.right,h=!1;if(!s){if(o&&Ks<x*t){if(!Aa&&(Oa===1?p>g+x*a/2:p<d-x*a/2)&&(Aa=!0),Aa)h=!0;else if(Oa===1?p<g+Ks:p>d-Ks)return-Oa}else if(p>g+x*(1-t)/2&&p<d-x*(1-t)/2)return Mm(e)}return h=h||s,h&&(p<g+x*a/2||p>d-x*a/2)?p>g+x/2?1:-1:0}function Mm(i){return Or(Ye)<Or(i)?1:-1}function km(i){for(var e=i.tagName+i.className+i.src+i.href+i.textContent,r=e.length,n=0;r--;)n+=e.charCodeAt(r);return n.toString(36)}function Nm(i){Vs.length=0;for(var e=i.getElementsByTagName("input"),r=e.length;r--;){var n=e[r];n.checked&&Vs.push(n)}}function Ys(i){return setTimeout(i,0)}function Ml(i){return clearTimeout(i)}Gs&&It(document,"touchmove",function(i){(Et.active||ki)&&i.cancelable&&i.preventDefault()});Et.utils={on:It,off:Rt,css:_t,find:Hf,is:function(e,r){return!!pn(e,r,e,!1)},extend:ym,throttle:Xf,closest:pn,toggleClass:hr,clone:Qf,index:Or,nextTick:Ys,cancelNextTick:Ml,detectDirection:rc,getChild:Ci};Et.get=function(i){return i[Ir]};Et.mount=function(){for(var i=arguments.length,e=new Array(i),r=0;r<i;r++)e[r]=arguments[r];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(Et.utils=dn(dn({},Et.utils),n.utils)),ba.mount(n)})};Et.create=function(i,e){return new Et(i,e)};Et.version=pm;var Jt=[],wa,kl,Nl=!1,Bl,Fl,Xs,La;function Bm(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return i.prototype={dragStarted:function(r){var n=r.originalEvent;this.sortable.nativeDraggable?It(document,"dragover",this._handleAutoScroll):this.options.supportPointer?It(document,"pointermove",this._handleFallbackAutoScroll):n.touches?It(document,"touchmove",this._handleFallbackAutoScroll):It(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(r){var n=r.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?Rt(document,"dragover",this._handleAutoScroll):(Rt(document,"pointermove",this._handleFallbackAutoScroll),Rt(document,"touchmove",this._handleFallbackAutoScroll),Rt(document,"mousemove",this._handleFallbackAutoScroll)),sc(),Zs(),Em()},nulling:function(){Xs=kl=wa=Nl=La=Bl=Fl=null,Jt.length=0},_handleFallbackAutoScroll:function(r){this._handleAutoScroll(r,!0)},_handleAutoScroll:function(r,n){var t=this,a=(r.touches?r.touches[0]:r).clientX,s=(r.touches?r.touches[0]:r).clientY,o=document.elementFromPoint(a,s);if(Xs=r,n||this.options.forceAutoScrollFallback||Ea||An||_a){Ul(r,this.options,o,n);var p=Un(o,!0);Nl&&(!La||a!==Bl||s!==Fl)&&(La&&sc(),La=setInterval(function(){var x=Un(document.elementFromPoint(a,s),!0);x!==p&&(p=x,Zs()),Ul(r,t.options,x,n)},10),Bl=a,Fl=s)}else{if(!this.options.bubbleScroll||Un(o,!0)===vn()){Zs();return}Ul(r,this.options,Un(o,!1),!1)}}},hn(i,{pluginName:"scroll",initializeByDefault:!0})}function Zs(){Jt.forEach(function(i){clearInterval(i.pid)}),Jt=[]}function sc(){clearInterval(La)}var Ul=Xf(function(i,e,r,n){if(!!e.scroll){var t=(i.touches?i.touches[0]:i).clientX,a=(i.touches?i.touches[0]:i).clientY,s=e.scrollSensitivity,o=e.scrollSpeed,p=vn(),x=!1,g;kl!==r&&(kl=r,Zs(),wa=e.scroll,g=e.scrollFn,wa===!0&&(wa=Un(r,!0)));var d=0,h=wa;do{var y=h,b=er(y),T=b.top,_=b.bottom,c=b.left,u=b.right,f=b.width,v=b.height,l=void 0,m=void 0,E=y.scrollWidth,S=y.scrollHeight,O=_t(y),D=y.scrollLeft,P=y.scrollTop;y===p?(l=f<E&&(O.overflowX==="auto"||O.overflowX==="scroll"||O.overflowX==="visible"),m=v<S&&(O.overflowY==="auto"||O.overflowY==="scroll"||O.overflowY==="visible")):(l=f<E&&(O.overflowX==="auto"||O.overflowX==="scroll"),m=v<S&&(O.overflowY==="auto"||O.overflowY==="scroll"));var A=l&&(Math.abs(u-t)<=s&&D+f<E)-(Math.abs(c-t)<=s&&!!D),w=m&&(Math.abs(_-a)<=s&&P+v<S)-(Math.abs(T-a)<=s&&!!P);if(!Jt[d])for(var L=0;L<=d;L++)Jt[L]||(Jt[L]={});(Jt[d].vx!=A||Jt[d].vy!=w||Jt[d].el!==y)&&(Jt[d].el=y,Jt[d].vx=A,Jt[d].vy=w,clearInterval(Jt[d].pid),(A!=0||w!=0)&&(x=!0,Jt[d].pid=setInterval(function(){n&&this.layer===0&&Et.active._onTouchMove(Xs);var R=Jt[this.layer].vy?Jt[this.layer].vy*o:0,C=Jt[this.layer].vx?Jt[this.layer].vx*o:0;typeof g=="function"&&g.call(Et.dragged.parentNode[Ir],C,R,i,Xs,Jt[this.layer].el)!=="continue"||Zf(Jt[this.layer].el,C,R)}.bind({layer:d}),24))),d++}while(e.bubbleScroll&&h!==p&&(h=Un(h,!1)));Nl=x}},30),oc=function(e){var r=e.originalEvent,n=e.putSortable,t=e.dragEl,a=e.activeSortable,s=e.dispatchSortableEvent,o=e.hideGhostForTarget,p=e.unhideGhostForTarget;if(!!r){var x=n||a;o();var g=r.changedTouches&&r.changedTouches.length?r.changedTouches[0]:r,d=document.elementFromPoint(g.clientX,g.clientY);p(),x&&!x.el.contains(d)&&(s("spill"),this.onSpill({dragEl:t,putSortable:n}))}};function jl(){}jl.prototype={startIndex:null,dragStart:function(e){var r=e.oldDraggableIndex;this.startIndex=r},onSpill:function(e){var r=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var t=Ci(this.sortable.el,this.startIndex,this.options);t?this.sortable.el.insertBefore(r,t):this.sortable.el.appendChild(r),this.sortable.animateAll(),n&&n.animateAll()},drop:oc};hn(jl,{pluginName:"revertOnSpill"});function Wl(){}Wl.prototype={onSpill:function(e){var r=e.dragEl,n=e.putSortable,t=n||this.sortable;t.captureAnimationState(),r.parentNode&&r.parentNode.removeChild(r),t.animateAll()},drop:oc};hn(Wl,{pluginName:"removeOnSpill"});var Kr;function Fm(){function i(){this.defaults={swapClass:"sortable-swap-highlight"}}return i.prototype={dragStart:function(r){var n=r.dragEl;Kr=n},dragOverValid:function(r){var n=r.completed,t=r.target,a=r.onMove,s=r.activeSortable,o=r.changed,p=r.cancel;if(!!s.options.swap){var x=this.sortable.el,g=this.options;if(t&&t!==x){var d=Kr;a(t)!==!1?(hr(t,g.swapClass,!0),Kr=t):Kr=null,d&&d!==Kr&&hr(d,g.swapClass,!1)}o(),n(!0),p()}},drop:function(r){var n=r.activeSortable,t=r.putSortable,a=r.dragEl,s=t||this.sortable,o=this.options;Kr&&hr(Kr,o.swapClass,!1),Kr&&(o.swap||t&&t.options.swap)&&a!==Kr&&(s.captureAnimationState(),s!==n&&n.captureAnimationState(),Um(a,Kr),s.animateAll(),s!==n&&n.animateAll())},nulling:function(){Kr=null}},hn(i,{pluginName:"swap",eventProperties:function(){return{swapItem:Kr}}})}function Um(i,e){var r=i.parentNode,n=e.parentNode,t,a;!r||!n||r.isEqualNode(e)||n.isEqualNode(i)||(t=Or(i),a=Or(e),r.isEqualNode(n)&&t<a&&a++,r.insertBefore(e,r.children[t]),n.insertBefore(i,n.children[a]))}Et.mount(new Bm);Et.mount(Wl,jl);var Da=0,jm=1,Wm=-1,jt="__PLAYER_KEY__",zl={selector:"audio-lists-panel-content-wrap",swapClass:"audio-lists-panel-sortable-highlight-bg",swap:!0,animation:100,easing:"cubic-bezier(0.43, -0.1, 0.16, 1.1)"},zm=function(e){var r=e.audioLists,n=e.onCancel,t=e.onDelete,a=e.onPlay,s=e.playId,o=e.loading,p=e.panelToggleAnimate,x=e.glassBg,g=e.remove,d=e.removeId,h=e.isMobile,y=e.locale,b=e.icon,T=e.playing;return oe.createElement("div",{className:ar("audio-lists-panel",p,{"audio-lists-panel-mobile":h,"glass-bg":x})},oe.createElement("div",{className:"audio-lists-panel-header"},oe.createElement("h2",{className:"audio-lists-panel-header-title"},oe.createElement("span",null,y.playListsText," / "),oe.createElement("span",{className:"audio-lists-panel-header-num"},r.length),oe.createElement("span",{className:"audio-lists-panel-header-actions"},g&&oe.createElement(oe.Fragment,null,oe.createElement("span",{className:"audio-lists-panel-header-delete-btn",title:y.removeAudioListsText,onClick:t()},b.delete),oe.createElement("span",{className:"audio-lists-panel-header-line"})),oe.createElement("span",{className:"audio-lists-panel-header-close-btn",title:y.closeText,onClick:n},h?b.packUpPanelMobile:b.close)))),oe.createElement("div",{className:ar("audio-lists-panel-content",{"no-content":r.length<1})},r.length>=1?oe.createElement("ul",{className:zl.selector},r.map(function(_){var c=_.name,u=_.singer,f=_[jt],v=s===f;return oe.createElement("li",{key:f,title:T&&v?y.clickToPauseText:y.clickToPlayText,className:ar("audio-item",{playing:v},{pause:!T},{remove:d===f}),onClick:function(){return a(f)}},oe.createElement("span",{className:"group player-status"},oe.createElement("span",{className:"player-icons"},v&&o?b.loading:v?T?b.pause:b.play:void 0)),oe.createElement("span",{className:"group player-name",title:c},c),oe.createElement("span",{className:"group player-singer",title:u},u),g&&oe.createElement("span",{className:"group player-delete",title:y.clickToDeleteText(c),onClick:t(f)},b.close))})):oe.createElement(oe.Fragment,null,oe.createElement("span",null,b.empty),oe.createElement("span",{className:"no-data"},y.emptyText||y.notContentText))))},Km=vt.exports.memo(zm),Vm=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.progress,n=r===void 0?0:r,t=e.r,a=t===void 0?40:t,s=n.toFixed(2),o=Math.PI*2*a,p="".concat(Math.floor(o*s)," ").concat(Math.floor(o*(1-s)));return oe.createElement("svg",{className:"audio-circle-process-bar"},oe.createElement("circle",{cx:a,cy:a,r:a-1,fill:"none",className:"stroke",strokeDasharray:p}),oe.createElement("circle",{cx:a,cy:a,r:a-1,fill:"none",className:"bg",strokeDasharray:"0 1000"}))},Gm=vt.exports.memo(Vm),Hm=[{id:"fa",name:"Font Awesome",projectUrl:"https://fontawesome.com/",license:"CC BY 4.0 License",licenseUrl:"https://creativecommons.org/licenses/by/4.0/"},{id:"io",name:"Ionicons 4",projectUrl:"https://ionicons.com/",license:"MIT",licenseUrl:"https://github.com/ionic-team/ionicons/blob/master/LICENSE"},{id:"io5",name:"Ionicons 5",projectUrl:"https://ionicons.com/",license:"MIT",licenseUrl:"https://github.com/ionic-team/ionicons/blob/master/LICENSE"},{id:"md",name:"Material Design icons",projectUrl:"http://google.github.io/material-design-icons/",license:"Apache License Version 2.0",licenseUrl:"https://github.com/google/material-design-icons/blob/master/LICENSE"},{id:"ti",name:"Typicons",projectUrl:"http://s-ings.com/typicons/",license:"CC BY-SA 3.0",licenseUrl:"https://creativecommons.org/licenses/by-sa/3.0/"},{id:"go",name:"Github Octicons icons",projectUrl:"https://octicons.github.com/",license:"MIT",licenseUrl:"https://github.com/primer/octicons/blob/master/LICENSE"},{id:"fi",name:"Feather",projectUrl:"https://feathericons.com/",license:"MIT",licenseUrl:"https://github.com/feathericons/feather/blob/master/LICENSE"},{id:"gi",name:"Game Icons",projectUrl:"https://game-icons.net/",license:"CC BY 3.0",licenseUrl:"https://creativecommons.org/licenses/by/3.0/"},{id:"wi",name:"Weather Icons",projectUrl:"https://erikflowers.github.io/weather-icons/",license:"SIL OFL 1.1",licenseUrl:"http://scripts.sil.org/OFL"},{id:"di",name:"Devicons",projectUrl:"https://vorillaz.github.io/devicons/",license:"MIT",licenseUrl:"https://opensource.org/licenses/MIT"},{id:"ai",name:"Ant Design Icons",projectUrl:"https://github.com/ant-design/ant-design-icons",license:"MIT",licenseUrl:"https://opensource.org/licenses/MIT"},{id:"bs",name:"Bootstrap Icons",projectUrl:"https://github.com/twbs/icons",license:"MIT",licenseUrl:"https://opensource.org/licenses/MIT"},{id:"ri",name:"Remix Icon",projectUrl:"https://github.com/Remix-Design/RemixIcon",license:"Apache License Version 2.0",licenseUrl:"http://www.apache.org/licenses/"},{id:"fc",name:"Flat Color Icons",projectUrl:"https://github.com/icons8/flat-color-icons",license:"MIT",licenseUrl:"https://opensource.org/licenses/MIT"},{id:"gr",name:"Grommet-Icons",projectUrl:"https://github.com/grommet/grommet-icons",license:"Apache License Version 2.0",licenseUrl:"http://www.apache.org/licenses/"},{id:"hi",name:"Heroicons",projectUrl:"https://github.com/refactoringui/heroicons",license:"MIT",licenseUrl:"https://opensource.org/licenses/MIT"},{id:"si",name:"Simple Icons",projectUrl:"https://simpleicons.org/",license:"CC0 1.0 Universal",licenseUrl:"https://creativecommons.org/publicdomain/zero/1.0/"},{id:"im",name:"IcoMoon Free",projectUrl:"https://github.com/Keyamoon/IcoMoon-Free",license:"CC BY 4.0 License"},{id:"bi",name:"BoxIcons",projectUrl:"https://github.com/atisawd/boxicons",license:"CC BY 4.0 License"},{id:"cg",name:"css.gg",projectUrl:"https://github.com/astrit/css.gg",license:"MIT",licenseUrl:"https://opensource.org/licenses/MIT"},{id:"vsc",name:"VS Code Icons",projectUrl:"https://github.com/microsoft/vscode-codicons",license:"CC BY 4.0",licenseUrl:"https://creativecommons.org/licenses/by/4.0/"}],Kl={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Vl=oe.createContext&&oe.createContext(Kl),zn=globalThis&&globalThis.__assign||function(){return zn=Object.assign||function(i){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])}return i},zn.apply(this,arguments)},$m=globalThis&&globalThis.__rest||function(i,e){var r={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(r[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,n=Object.getOwnPropertySymbols(i);t<n.length;t++)e.indexOf(n[t])<0&&Object.prototype.propertyIsEnumerable.call(i,n[t])&&(r[n[t]]=i[n[t]]);return r};function lc(i){return i&&i.map(function(e,r){return oe.createElement(e.tag,zn({key:r},e.attr),lc(e.child))})}function Ym(i){return function(e){return oe.createElement(uc,zn({attr:zn({},i.attr)},e),lc(i.child))}}function uc(i){var e=function(r){var n=i.attr,t=i.size,a=i.title,s=$m(i,["attr","size","title"]),o=t||r.size||"1em",p;return r.className&&(p=r.className),i.className&&(p=(p?p+" ":"")+i.className),oe.createElement("svg",zn({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,n,s,{className:p,style:zn(zn({color:i.color||r.color},r.style),i.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),a&&oe.createElement("title",null,a),i.children)};return Vl!==void 0?oe.createElement(Vl.Consumer,null,function(r){return e(r)}):e(Kl)}var Xm=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",IconsManifest:Hm,GenIcon:Ym,IconBase:uc,DefaultContext:Kl,IconContext:Vl}),Qt=qo(Xm),Zm=Qt.GenIcon,Qm=function(e){return Zm({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm-16 328c0 8.8-7.2 16-16 16h-48c-8.8 0-16-7.2-16-16V176c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16v160zm112 0c0 8.8-7.2 16-16 16h-48c-8.8 0-16-7.2-16-16V176c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16v160z"}}]})(e)},Jm=Qt.GenIcon,qm=function(e){return Jm({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"}}]})(e)},e0=Qt.GenIcon,t0=function(e){return e0({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z"}}]})(e)},r0=Qt.GenIcon,fc=function(e){return r0({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C114.52 32 0 146.496 0 288v48a32 32 0 0 0 17.689 28.622l14.383 7.191C34.083 431.903 83.421 480 144 480h24c13.255 0 24-10.745 24-24V280c0-13.255-10.745-24-24-24h-24c-31.342 0-59.671 12.879-80 33.627V288c0-105.869 86.131-192 192-192s192 86.131 192 192v1.627C427.671 268.879 399.342 256 368 256h-24c-13.255 0-24 10.745-24 24v176c0 13.255 10.745 24 24 24h24c60.579 0 109.917-48.098 111.928-108.187l14.382-7.191A32 32 0 0 0 512 336v-48c0-141.479-114.496-256-256-256z"}}]})(e)},n0=Qt.GenIcon,i0=function(e){return n0({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M108 284c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h232c6.6 0 12 5.4 12 12v32c0 6.6-5.4 12-12 12H108zM448 80v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-48 346V86c0-3.3-2.7-6-6-6H54c-3.3 0-6 2.7-6 6v340c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"}}]})(e)},a0=Qt.GenIcon,s0=function(e){return a0({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"}}]})(e)},o0=Qt.GenIcon,l0=function(e){return o0({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"}}]})(e)},u0=Qt.GenIcon,f0=function(e){return u0({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"7 13 12 18 17 13"}},{tag:"polyline",attr:{points:"7 6 12 11 17 6"}}]})(e)},c0=Qt.GenIcon,d0=function(e){return c0({tag:"svg",attr:{viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M8 2.81v10.38c0 .67-.81 1-1.28.53L3 10H1c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h2l3.72-3.72C7.19 1.81 8 2.14 8 2.81zm7.53 3.22l-1.06-1.06-1.97 1.97-1.97-1.97-1.06 1.06L11.44 8 9.47 9.97l1.06 1.06 1.97-1.97 1.97 1.97 1.06-1.06L13.56 8l1.97-1.97z"}}]})(e)},h0=Qt.GenIcon,p0=function(e){return h0({tag:"svg",attr:{viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M12 8.02c0 1.09-.45 2.09-1.17 2.83l-.67-.67c.55-.56.89-1.31.89-2.16 0-.85-.34-1.61-.89-2.16l.67-.67A3.99 3.99 0 0 1 12 8.02zM7.72 2.28L4 6H2c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1h2l3.72 3.72c.47.47 1.28.14 1.28-.53V2.81c0-.67-.81-1-1.28-.53zm5.94.08l-.67.67a6.996 6.996 0 0 1 2.06 4.98c0 1.94-.78 3.7-2.06 4.98l.67.67A7.973 7.973 0 0 0 16 8c0-2.22-.89-4.22-2.34-5.66v.02zm-1.41 1.41l-.69.67a5.05 5.05 0 0 1 1.48 3.58c0 1.39-.56 2.66-1.48 3.56l.69.67A5.971 5.971 0 0 0 14 8.02c0-1.65-.67-3.16-1.75-4.25z"}}]})(e)},v0=Qt.GenIcon,cc=function(e){return v0({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(e)},g0=Qt.GenIcon,m0=function(e){return g0({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 5h-3v5.5c0 1.38-1.12 2.5-2.5 2.5S10 13.88 10 12.5s1.12-2.5 2.5-2.5c.57 0 1.08.19 1.5.51V5h4v2zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6z"}}]})(e)},y0=Qt.GenIcon,E0=function(e){return y0({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"}}]})(e)},_0=Qt.GenIcon,x0=function(e){return _0({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4zm-4-2V9h-1l-2 1v1h1.5v4H13z"}}]})(e)},b0=Qt.GenIcon,S0=function(e){return b0({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"}}]})(e)},T0=Qt.GenIcon,O0=function(e){return T0({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 15h16v-2H4v2zm0 4h16v-2H4v2zm0-8h16V9H4v2zm0-6v2h16V5H4z"}}]})(e)},A0=Qt.GenIcon,w0=function(e){return A0({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"}}]})(e)},L0=Qt.GenIcon,D0=function(e){return L0({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zm-9 3h2v6H9v-6zm4 0h2v6h-2v-6zM9 4v2h6V4H9z"}}]}]})(e)},P0=Qt.GenIcon,R0=function(e){return P0({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{fill:"none",d:"M0 0H24V24H0z"}},{tag:"path",attr:{d:"M22 18v2H2v-2h20zM2 3.5l8 5-8 5v-10zM22 11v2H12v-2h10zm0-7v2H12V4h10z"}}]}]})(e)},C0=Qt.GenIcon,I0=function(e){return C0({tag:"svg",attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 9h3.5c.736 0 1.393.391 1.851 1.001.325-.604.729-1.163 1.191-1.662-.803-.823-1.866-1.339-3.042-1.339h-3.5c-.553 0-1 .448-1 1s.447 1 1 1zM11.685 12.111c.551-1.657 2.256-3.111 3.649-3.111h1.838l-1.293 1.293c-.391.391-.391 1.023 0 1.414.195.195.451.293.707.293s.512-.098.707-.293l3.707-3.707-3.707-3.707c-.391-.391-1.023-.391-1.414 0s-.391 1.023 0 1.414l1.293 1.293h-1.838c-2.274 0-4.711 1.967-5.547 4.479l-.472 1.411c-.641 1.926-2.072 3.11-2.815 3.11h-2.5c-.553 0-1 .448-1 1s.447 1 1 1h2.5c1.837 0 3.863-1.925 4.713-4.479l.472-1.41zM15.879 13.293c-.391.391-.391 1.023 0 1.414l1.293 1.293h-2.338c-1.268 0-2.33-.891-2.691-2.108-.256.75-.627 1.499-1.09 2.185.886 1.162 2.243 1.923 3.781 1.923h2.338l-1.293 1.293c-.391.391-.391 1.023 0 1.414.195.195.451.293.707.293s.512-.098.707-.293l3.707-3.707-3.707-3.707c-.391-.391-1.023-.391-1.414 0z"}}]})(e)},M0=Qt.GenIcon,k0=function(e){return M0({tag:"svg",attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16.707 7.404c-.189-.188-.448-.283-.707-.283s-.518.095-.707.283l-2.293 2.293v-6.697c0-.552-.448-1-1-1s-1 .448-1 1v6.697l-2.293-2.293c-.189-.188-.44-.293-.707-.293s-.518.105-.707.293c-.39.39-.39 1.024 0 1.414l4.707 4.682 4.709-4.684c.388-.387.388-1.022-.002-1.412zM20.987 16c0-.105-.004-.211-.039-.316l-2-6c-.136-.409-.517-.684-.948-.684h-.219c-.094.188-.21.368-.367.525l-1.482 1.475h1.348l1.667 5h-13.893l1.667-5h1.348l-1.483-1.475c-.157-.157-.274-.337-.367-.525h-.219c-.431 0-.812.275-.948.684l-2 6c-.035.105-.039.211-.039.316-.013 0-.013 5-.013 5 0 .553.447 1 1 1h16c.553 0 1-.447 1-1 0 0 0-5-.013-5z"}}]})(e)},N0=function(){return oe.createElement(qm,{className:"react-jinke-music-player-play-icon"})},B0=function(){return oe.createElement(Qm,{className:"react-jinke-music-player-pause-icon"})},F0=function(e){var r=e.prefix,n=e.visible,t=e.title,a=e.text;return oe.createElement("div",{className:ar("".concat(r,"-play-model-tip"),{show:n})},oe.createElement("span",{className:"".concat(r,"-play-model-tip-title")},t),oe.createElement("span",{className:"".concat(r,"-play-model-tip-text")},a))},U0=vt.exports.memo(F0),kr="react-jinke-music-player-mobile",dc=function(e){var r=e.name,n=e.cover,t=e.singer,a=e.playing,s=e.duration,o=e.currentTime,p=e.loading,x=e.themeSwitch,g=e.progressBar,d=e.openAudioListsPanel,h=e.audioPrevPlay,y=e.audioNextPlay,b=e.playMode,T=e.onClose,_=e.playModeTipVisible,c=e.currentPlayModeName,u=e.extendsContent,f=e.onPlay,v=e.glassBg,l=e.onCoverClick,m=e.autoHiddenCover,E=e.icon,S=e.locale,O=e.toggleMode,D=e.renderAudioTitle,P=e.shouldShowPlayIcon,A=e.isResetCoverRotate;return oe.createElement("div",{className:ar(kr,{"default-bg":!v,"glass-bg":v})},oe.createElement(U0,{prefix:kr,visible:_,title:b,text:c}),oe.createElement("div",{className:"".concat(kr,"-header group")},oe.createElement("div",{className:"".concat(kr,"-header-title"),title:r},D()),O&&oe.createElement("div",{className:"".concat(kr,"-header-right"),onClick:T},E.close)),oe.createElement("div",{className:"".concat(kr,"-singer text-center group")},oe.createElement("span",{className:"".concat(kr,"-singer-name"),title:t},t)),oe.createElement("div",{className:"".concat(kr,"-switch text-center group")},x),(!m||m&&n)&&oe.createElement("div",{className:"".concat(kr,"-cover text-center"),onClick:function(){return l()}},oe.createElement("img",{src:n,alt:"cover",className:ar("cover",{"img-rotate-pause":!a||!n,"img-rotate-reset":A})})),oe.createElement("div",{className:"".concat(kr,"-progress group")},oe.createElement("span",{className:"current-time"},p?"--":o),oe.createElement("span",{className:"".concat(kr,"-progress-bar")},g),oe.createElement("span",{className:"duration text-right"},p?"--":s)),oe.createElement("div",{className:"".concat(kr,"-toggle text-center group")},oe.createElement("span",{className:"group prev-audio",title:S.previousTrackText,onClick:h},E.prev),p?oe.createElement("span",{className:"group loading-icon"},E.loading):oe.createElement("span",{className:"group play-btn",title:P?S.clickToPlayText:S.clickToPauseText,onClick:f},P?E.play:E.pause),oe.createElement("span",{className:"group next-audio",title:S.nextTrackText,onClick:y},E.next)),oe.createElement("div",{className:"".concat(kr,"-operation group")},oe.createElement("ul",{className:"items"},[b,E.download,E.reload,E.lyric].filter(vt.exports.isValidElement).map(function(w){return oe.createElement("li",{className:"item",key:w.props.className},w)}),u,oe.createElement("li",{className:"item",onClick:d},E.playLists))))};dc.defaultProps={icon:{},renderAudioTitle:function(){}};var j0=vt.exports.memo(dc),W0=function(e){var r=e.visible,n=e.value;return oe.createElement("div",{className:ar("play-mode-title",{"play-mode-title-visible":r})},n)},z0=vt.exports.memo(W0),K0=350,V0=32,Pa={en_US:"en_US",zh_CN:"zh_CN"},hc={MOBILE:"(max-width: 768px) and (orientation : portrait)",DARK_THEME:"screen and (prefers-color-scheme: dark)",LIGHT_THEME:"screen and (prefers-color-scheme: light)"},Vr={FULL:"full",MINI:"mini"},pc={NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3,NETWORK_READY_SUCCESS_STATE:4},G0={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},Kt={order:"order",orderLoop:"orderLoop",singleLoop:"singleLoop",shufflePlay:"shufflePlay"},Gr={LIGHT:"light",DARK:"dark",AUTO:"auto"},vc=ye.oneOf(["order","orderLoop","singleLoop","shufflePlay"]),H0={audioLists:ye.array.isRequired,locale:ye.oneOfType([ye.object,ye.oneOf(Object.values(Pa))]),theme:ye.oneOf(Object.values(Gr)),mode:ye.oneOf(Object.values(Vr)),defaultPlayMode:vc,playMode:vc,drag:ye.bool,seeked:ye.bool,autoPlay:ye.bool,clearPriorAudioLists:ye.bool,autoPlayInitLoadPlayList:ye.bool,playModeText:ye.object,panelTitle:ye.string,closeText:ye.oneOfType([ye.string,ye.object]),openText:ye.oneOfType([ye.string,ye.object]),clickToPlayText:ye.oneOfType([ye.string,ye.object]),clickToPauseText:ye.oneOfType([ye.string,ye.object]),nextTrackText:ye.oneOfType([ye.string,ye.object]),previousTrackText:ye.oneOfType([ye.string,ye.object]),reloadText:ye.oneOfType([ye.string,ye.object]),volumeText:ye.oneOfType([ye.string,ye.object]),playListsText:ye.oneOfType([ye.string,ye.object]),toggleLyricText:ye.oneOfType([ye.string,ye.object]),toggleMiniModeText:ye.oneOfType([ye.string,ye.object]),destroyText:ye.oneOfType([ye.string,ye.object]),downloadText:ye.oneOfType([ye.string,ye.object]),emptyText:ye.oneOfType([ye.string,ye.object]),controllerTitle:ye.oneOfType([ye.string,ye.object]),defaultPosition:ye.shape({top:ye.oneOfType([ye.number,ye.string]),left:ye.oneOfType([ye.number,ye.string]),right:ye.oneOfType([ye.number,ye.string]),bottom:ye.oneOfType([ye.number,ye.string])}),onAudioPlay:ye.func,onAudioPause:ye.func,onAudioEnded:ye.func,onAudioAbort:ye.func,onAudioVolumeChange:ye.func,onAudioError:ye.func,onAudioProgress:ye.func,onAudioSeeked:ye.func,onAudioDownload:ye.func,onAudioReload:ye.func,onThemeChange:ye.func,onAudioListsChange:ye.func,onPlayModeChange:ye.func,onModeChange:ye.func,onAudioListsPanelChange:ye.func,onAudioPlayTrackChange:ye.func,onAudioListsSortEnd:ye.func,onAudioLyricChange:ye.func,showDownload:ye.bool,showPlay:ye.bool,showReload:ye.bool,showPlayMode:ye.bool,showThemeSwitch:ye.bool,showMiniModeCover:ye.bool,toggleMode:ye.bool,once:ye.bool,extendsContent:ye.oneOfType([ye.array,ye.bool,ye.object,ye.node,ye.element,ye.string]),checkedText:ye.oneOfType([ye.string,ye.object]),unCheckedText:ye.oneOfType([ye.string,ye.object]),defaultVolume:ye.number,playModeShowTime:ye.number,bounds:ye.oneOfType([ye.string,ye.object]),showMiniProcessBar:ye.bool,loadAudioErrorPlayNext:ye.bool,preload:ye.oneOfType([ye.bool,ye.oneOf(["auto","metadata","none"])]),glassBg:ye.bool,remember:ye.bool,remove:ye.bool,defaultPlayIndex:ye.number,playIndex:ye.number,lyricClassName:ye.string,emptyLyricText:ye.oneOfType([ye.string,ye.object]),showLyric:ye.bool,getContainer:ye.func,getAudioInstance:ye.func,onBeforeAudioDownload:ye.func,autoHiddenCover:ye.bool,spaceBar:ye.bool,showDestroy:ye.bool,onBeforeDestroy:ye.func,onDestroyed:ye.func,customDownloader:ye.func,audioTitle:ye.oneOfType([ye.string,ye.func]),responsive:ye.bool,quietUpdate:ye.bool,renderAudioTitle:ye.func,mobileMediaQuery:ye.string,volumeFade:ye.shape({fadeIn:ye.number,fadeOut:ye.number}),sortableOptions:ye.object},$0={min:0,step:1},Y0={min:0,max:1,step:.01},tn={IN:"in",OUT:"out",NONE:"none"},X0={playModeText:{order:"Play in order",orderLoop:"List loop",singleLoop:"Single loop",shufflePlay:"Shuffle playback"},openText:"Open",closeText:"Close",emptyText:"No music",clickToPlayText:"Click to play",clickToPauseText:"Click to pause",nextTrackText:"Next track",previousTrackText:"Previous track",reloadText:"Reload",volumeText:"Volume",playListsText:"Playlists",toggleLyricText:"Toggle lyric",toggleMiniModeText:"Minimize",destroyText:"Destroy",downloadText:"Download",lightThemeText:"L",darkThemeText:"D",switchThemeText:"Dark/Light mode",removeAudioListsText:"Delete audio lists",clickToDeleteText:function(e){return"Click to delete ".concat(e)},controllerTitle:oe.createElement(fc,null),emptyLyricText:"No lyric",loadingText:"Loading"},Z0={playModeText:{order:"\u987A\u5E8F\u64AD\u653E",orderLoop:"\u5217\u8868\u5FAA\u73AF",singleLoop:"\u5355\u66F2\u5FAA\u73AF",shufflePlay:"\u968F\u673A\u64AD\u653E"},openText:"\u6253\u5F00",closeText:"\u5173\u95ED",emptyText:"\u97F3\u4E50\u64AD\u653E\u5217\u8868\u4E3A\u7A7A",clickToPlayText:"\u70B9\u51FB\u64AD\u653E",clickToPauseText:"\u70B9\u51FB\u6682\u505C",nextTrackText:"\u4E0B\u4E00\u9996",previousTrackText:"\u4E0A\u4E00\u9996",reloadText:"\u91CD\u65B0\u64AD\u653E",volumeText:"\u97F3\u91CF",playListsText:"\u64AD\u653E\u5217\u8868",toggleLyricText:"\u663E\u793A/\u9690\u85CF \u6B4C\u8BCD",toggleMiniModeText:"\u5207\u6362\u81F3\u8FF7\u4F60\u6A21\u5F0F",destroyText:"\u79FB\u9664\u64AD\u653E\u5668",downloadText:"\u4E0B\u8F7D",lightThemeText:"\u4EAE",darkThemeText:"\u6697",switchThemeText:"\u6697\u9ED1/\u660E\u4EAE \u4E3B\u9898",removeAudioListsText:"\u6E05\u7A7A\u64AD\u653E\u5217\u8868",clickToDeleteText:function(e){return"\u70B9\u51FB\u5220\u9664 ".concat(e)},controllerTitle:oe.createElement(fc,null),emptyLyricText:"\u6682\u65E0\u6B4C\u8BCD",loadingText:"\u52A0\u8F7D\u4E2D"},Qs;function gc(i,e,r){return e in i?Object.defineProperty(i,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[e]=r,i}var Q0=(Qs={},gc(Qs,Pa.en_US,X0),gc(Qs,Pa.zh_CN,Z0),Qs),mc=Q0;function J0(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function yc(i,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function q0(i,e,r){return e&&yc(i.prototype,e),r&&yc(i,r),i}var Ec=/\[(\d{2,}):(\d{2})(?:\.(\d{2,3}))?]/g,_c=0,Js=1,xc={title:"ti",artist:"ar",album:"al",offset:"offset",by:"by"},ey=function(){function i(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){};J0(this,i),this.lrc=e,this.tags={},this.lines=[],this.handler=r,this.state=_c,this.curLine=0,this._init()}return q0(i,[{key:"_init",value:function(){this._initTag(),this._initLines()}},{key:"_initTag",value:function(){for(var r in xc){var n=this.lrc.match(new RegExp("\\[".concat(xc[r],":([^\\]]*)]"),"i"));this.tags[r]=n&&n[1]||""}}},{key:"_initLines",value:function(){for(var r=this.lrc.split(`
`),n=parseInt(this.tags.offset,10)||0,t=0;t<r.length;t++){var a=r[t],s=Ec.exec(a);if(s){var o=a.replace(Ec,"").trim();o&&this.lines.push({time:s[1]*60*1e3+s[2]*1e3+(s[3]||0)*10+n,txt:o})}}this.lines.sort(function(p,x){return p.time-x.time})}},{key:"_findCurNum",value:function(r){for(var n=0;n<this.lines.length;n++)if(r<=this.lines[n].time)return n;return this.lines.length-1}},{key:"_callHandler",value:function(r){r<0||this.handler({txt:this.lines[r].txt,lineNum:r})}},{key:"_playRest",value:function(){var r=this,n=this.lines[this.curNum],t=n.time-(+new Date-this.startStamp);this.timer=setTimeout(function(){r._callHandler(r.curNum++),r.curNum<r.lines.length&&r.state===Js&&r._playRest()},t)}},{key:"play",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;!this.lines.length||(this.state=Js,this.curNum=this._findCurNum(r),this.startStamp=+new Date-r,n||this._callHandler(this.curNum-1),this.curNum<this.lines.length&&(clearTimeout(this.timer),this._playRest()))}},{key:"togglePlay",value:function(){var r=+new Date;this.state===Js?(this.stop(),this.pauseStamp=r):(this.state=Js,this.play((this.pauseStamp||r)-(this.startStamp||r),!0),this.pauseStamp=0)}},{key:"stop",value:function(){this.state=_c,clearTimeout(this.timer)}},{key:"seek",value:function(r){this.play(r)}}]),i}();function bc(i){var e=0,r=0,n=parseInt(i);n>=60&&(e=parseInt(n/60),n=parseInt(n%60),e>=60&&(r=parseInt(e/60),e=parseInt(e%60)));var t=function(s){return s>>0<10?"0".concat(s):s};return r>0?[t(r),t(e),t(n)].join(":"):[t(e),t(n)].join(":")}function ty(i,e){return parseInt(Math.random()*(e-i+1)+i,10)}var ry=function(e){return function(r){return JSON.stringify(e)===JSON.stringify(r)}},Kn=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},Sc=function(){return"".concat(Kn()+Kn(),"-").concat(Kn(),"-").concat(Kn(),"-").concat(Kn(),"-").concat(Kn()).concat(Kn()).concat(Kn())},ny=function(){return/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)};function iy(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function ay(i){return .5-Math.cos(i*Math.PI)/2}function Tc(i,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},t=n.duration,a=t===void 0?1e3:t,s=n.easing,o=s===void 0?ay:s,p=n.interval,x=p===void 0?13:p,g=arguments.length>4?arguments[4]:void 0,d=r-e;if(!d||!a||!o||!x||iy())return i.volume=r,g(),{fadeInterval:void 0,updateIntervalEndVolume:void 0};var h=Math.floor(a/x),y=1,b=function(c){r=c},T=setInterval(function(){var _=r-e;_!==d&&(d=_),i.volume=e+o(y/h)*d,++y>=h&&(i.volume=r,clearInterval(T),g())},x);return{fadeInterval:T,updateIntervalEndVolume:b}}function Bi(){return Bi=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])}return i},Bi.apply(this,arguments)}function sy(i,e){if(i==null)return{};var r=oy(i,e),n,t;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);for(t=0;t<a.length;t++)n=a[t],!(e.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,n)||(r[n]=i[n]))}return r}function oy(i,e){if(i==null)return{};var r={},n=Object.keys(i),t,a;for(a=0;a<n.length;a++)t=n[a],!(e.indexOf(t)>=0)&&(r[t]=i[t]);return r}function Oc(i,e){var r=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})),r.push.apply(r,n)}return r}function kt(i){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Oc(Object(r),!0).forEach(function(n){Pe(i,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):Oc(Object(r)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(r,n))})}return i}function Fi(i){return cy(i)||fy(i)||uy(i)||ly()}function ly(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uy(i,e){if(!!i){if(typeof i=="string")return Gl(i,e);var r=Object.prototype.toString.call(i).slice(8,-1);if(r==="Object"&&i.constructor&&(r=i.constructor.name),r==="Map"||r==="Set")return Array.from(i);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gl(i,e)}}function fy(i){if(typeof Symbol!="undefined"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function cy(i){if(Array.isArray(i))return Gl(i)}function Gl(i,e){(e==null||e>i.length)&&(e=i.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=i[r];return n}function Vn(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Vn=function(r){return typeof r}:Vn=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Vn(i)}function dy(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Ac(i,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function hy(i,e,r){return e&&Ac(i.prototype,e),r&&Ac(i,r),i}function py(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&Hl(i,e)}function Hl(i,e){return Hl=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},Hl(i,e)}function vy(i){var e=my();return function(){var n=qs(i),t;if(e){var a=qs(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return gy(this,t)}}function gy(i,e){return e&&(Vn(e)==="object"||typeof e=="function")?e:Ie(i)}function Ie(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function my(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function qs(i){return qs=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},qs(i)}function Pe(i,e,r){return e in i?Object.defineProperty(i,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[e]=r,i}Et.mount(new Fm);var $l=Yp(),wc={pause:oe.createElement(B0,null),play:oe.createElement(N0,null),destroy:oe.createElement(cc,null),close:oe.createElement(cc,null),delete:oe.createElement(D0,{size:24}),download:oe.createElement(k0,{size:26}),toggle:oe.createElement(i0,null),lyric:oe.createElement(t0,null),volume:oe.createElement(p0,{size:26}),mute:oe.createElement(d0,{size:26}),next:oe.createElement(w0,null),prev:oe.createElement(S0,null),playLists:oe.createElement(R0,null),reload:oe.createElement(l0,{size:22}),loop:oe.createElement(x0,{size:26}),order:oe.createElement(O0,{size:26}),orderLoop:oe.createElement(E0,{size:26}),shuffle:oe.createElement(I0,{size:26}),loading:oe.createElement(s0,null),packUpPanelMobile:oe.createElement(f0,{size:26}),empty:oe.createElement(m0,null)},Yl=function(i){py(r,i);var e=vy(r);function r(n){var t;return dy(this,r),t=e.call(this,n),Pe(Ie(t),"isDrag",!1),Pe(Ie(t),"initPlayId",""),Pe(Ie(t),"state",{audioLists:[],playId:t.initPlayId,name:"",cover:"",singer:"",musicSrc:"",lyric:"",currentLyric:"",isMobile:$l,toggle:t.props.mode===Vr.FULL,playing:!1,currentTime:0,soundValue:jm,moveX:0,moveY:0,loading:!1,audioListsPanelVisible:!1,playModelNameVisible:!1,theme:t.props.theme||t.darkThemeName,playMode:t.props.playMode||t.props.defaultPlayMode||"",currentAudioVolume:0,initAnimate:!1,isInitAutoPlay:t.props.autoPlay,isInitRemember:!1,loadedProgress:0,removeId:Wm,isNeedMobileHack:$l,audioLyricVisible:!1,isAutoPlayWhenUserClicked:!1,playIndex:t.props.playIndex||t.props.defaultPlayIndex||Da,canPlay:!1,currentVolumeFade:tn.NONE,currentVolumeFadeInterval:void 0,updateIntervalEndVolume:void 0,isAudioSeeking:!1,isResetCoverRotate:!1}),Pe(Ie(t),"getPlayIndex",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t.state.playIndex,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t.state.audioLists;return Math.max(Da,Math.min(s.length-1,a))}),Pe(Ie(t),"onCoverClick",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Vr.FULL,s=t.props.showMiniModeCover,o=t.state.cover;!s&&a===Vr.MINI||t.props.onCoverClick&&o&&t.props.onCoverClick(a,t.state.audioLists,t.getBaseAudioInfo())}),Pe(Ie(t),"getAudioTitle",function(){var a=t.locale||{},s=a.audioTitle,o=t.state,p=o.name,x=o.singer;return typeof s=="function"&&t.audio?s(t.getBaseAudioInfo()):s||"".concat(p).concat(x?" - ".concat(x):"")}),Pe(Ie(t),"renderAudioTitle",function(){var a=t.state,s=a.isMobile,o=a.name;return t.props.renderAudioTitle?t.props.renderAudioTitle(t.getBaseAudioInfo(),s):s?o:t.getAudioTitle()}),Pe(Ie(t),"toggleAudioLyric",function(){t.setState({audioLyricVisible:!t.state.audioLyricVisible})}),Pe(Ie(t),"togglePlayMode",function(){var a=t._PLAY_MODE_.findIndex(function(o){return o===t.state.playMode}),s=a===t._PLAY_MODE_LENGTH_-1?t._PLAY_MODE_[0]:t._PLAY_MODE_[++a];t.setState({playMode:s,playModelNameVisible:!0,playModeTipVisible:!0}),t.props.onPlayModeChange&&t.props.onPlayModeChange(s),clearTimeout(t.playModelTimer),t.playModelTimer=setTimeout(function(){t.setState({playModelNameVisible:!1,playModeTipVisible:!1})},t.props.playModeShowTime)}),Pe(Ie(t),"renderPlayModeIcon",function(a){var s={className:"react-jinke-music-player-mode-icon"},o=null;switch(a){case Kt.order:o=vt.exports.cloneElement(t.iconMap.order,s);break;case Kt.orderLoop:o=vt.exports.cloneElement(t.iconMap.orderLoop,s);break;case Kt.singleLoop:o=vt.exports.cloneElement(t.iconMap.loop,s);break;case Kt.shufflePlay:o=vt.exports.cloneElement(t.iconMap.shuffle,s);break;default:o=vt.exports.cloneElement(t.iconMap.order,s)}return o}),Pe(Ie(t),"audioListsPlay",function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:t.state,p=o.playId,x=o.playing,g=o.audioLists,d=o.loading,h=o.canPlay;if(Array.isArray(g)&&g.length===0)return console.warn("Warning: Your playlist has no songs. and cannot play !");if(!(d&&a===p)){var y=g.findIndex(function(m){return m[jt]===a}),b=g[y]||{},T=b.name,_=b.cover,c=b.musicSrc,u=b.singer,f=b.lyric,v=f===void 0?"":f,l=function(E){t.setState({name:T,cover:_,musicSrc:E,singer:u,playId:a,lyric:v,currentTime:0,playing:!1,loading:!0,canPlay:!1,loadedProgress:0,playIndex:y,isAutoPlayWhenUserClicked:!0},function(){t.lyric&&t.lyric.stop(),t.audio.load(),t.updateMediaSessionMetadata(),setTimeout(function(){t.initLyricParser()},0)})};if(a===p&&!s){if(t.setState({playing:!x}),!x){if(h){t.play();return}return l(c)}return t.audio.pause()}switch(t.props.onAudioPlayTrackChange&&t.props.onAudioPlayTrackChange(a,g,t.getBaseAudioInfo()),t.props.onPlayIndexChange&&t.props.onPlayIndexChange(y),Vn(c)){case"function":c().then(l,t.onAudioError);break;default:l(c)}}}),Pe(Ie(t),"resetAudioStatus",function(){t.audio.pause(),t.lyric&&t.lyric.stop(),t.initPlayInfo([]),t.resetAudioPlayStatus(),t.resetAudioPlayId()}),Pe(Ie(t),"resetAudioPlayId",function(){t.setState({playId:t.initPlayId})}),Pe(Ie(t),"clearAudioLists",function(){t.props.onAudioListsChange&&t.props.onAudioListsChange("",[],{}),t.resetAudioStatus()}),Pe(Ie(t),"onDeleteAudioLists",function(a){return function(s){s.stopPropagation();var o=t.state,p=o.audioLists,x=o.playId;if(!(p.length<1)){if(t.lyric&&t.lyric.stop(),!a){t.clearAudioLists();return}var g=Fi(p).filter(function(d){return d[jt]!==a});t.setState({removeId:a}),setTimeout(function(){t.setState({audioLists:g,removeId:-1},function(){if(!g.length)return t.resetAudioStatus();a===x&&t.handlePlay(Kt.orderLoop)})},K0),t.props.onAudioListsChange&&t.props.onAudioListsChange(x,g,t.getBaseAudioInfo())}}}),Pe(Ie(t),"openAudioListsPanel",function(){t.setState(function(a){var s=a.audioListsPanelVisible;return{initAnimate:!0,audioListsPanelVisible:!s}}),t.props.onAudioListsPanelChange&&t.props.onAudioListsPanelChange(!t.state.audioListsPanelVisible)}),Pe(Ie(t),"closeAudioListsPanel",function(a){a.stopPropagation(),t._closeAudioListsPanel()}),Pe(Ie(t),"_closeAudioListsPanel",function(){var a=t.state.audioListsPanelVisible;t.setState({audioListsPanelVisible:!1}),a&&t.props.onAudioListsPanelChange&&t.props.onAudioListsPanelChange(!1)}),Pe(Ie(t),"themeChange",function(a){var s=a?Gr.LIGHT:Gr.DARK;t.setState({theme:s}),t.props.onThemeChange&&t.props.onThemeChange(s)}),Pe(Ie(t),"onAudioDownload",function(){var a=t.state.musicSrc;if(t.state.musicSrc){var s=t.props.customDownloader,o=t.getBaseAudioInfo(),p=t.props.onBeforeAudioDownload(o),x={};p&&p.then?p.then(function(g){var d=g.src,h=g.filename,y=g.mimeType;x=g,s?s(g):$u(d,h,y)}):s?s({src:a}):$u(a),t.props.onAudioDownload&&t.props.onAudioDownload(o,x)}}),Pe(Ie(t),"onControllerDrag",function(a,s){var o=s.x,p=s.y,x=t.state,g=x.moveX,d=x.moveY;t.isDrag=!0,g===o&&d===p&&(t.isDrag=!1)}),Pe(Ie(t),"onControllerDragStart",function(a,s){var o=s.x,p=s.y;t.isDrag=!1,t.setState({moveX:o,moveY:p})}),Pe(Ie(t),"onControllerDragStop",function(a,s){var o=s.x,p=s.y;if(t.props.showDestroy&&t.destroyBtn&&t.destroyBtn.current&&t.destroyBtn.current.contains(a.target)){t.onDestroyPlayer();return}t.isDrag||(t.state.isNeedMobileHack&&(t.loadAndPlayAudio(),t.setState({isNeedMobileHack:!1})),t.onOpenPanel()),t.setState({moveX:o,moveY:p})}),Pe(Ie(t),"onResetVolume",function(){var a=t.state.currentAudioVolume;t.setAudioVolume(t.getVolumeBarValue(a||.1))}),Pe(Ie(t),"setAudioVolume",function(a){t.audio.volume=t.getListeningVolume(a),t.setState({currentAudioVolume:a,soundValue:a}),t.state.currentVolumeFade===tn.IN&&t.state.updateIntervalEndVolume&&t.state.updateIntervalEndVolume(a)}),Pe(Ie(t),"stopAll",function(a){a.stopPropagation(),a.preventDefault()}),Pe(Ie(t),"getBoundingClientRect",function(a){var s=a.getBoundingClientRect(),o=s.left,p=s.top;return{left:o,top:p}}),Pe(Ie(t),"getListeningVolume",function(a){return Math.pow(a,2)}),Pe(Ie(t),"getVolumeBarValue",function(a){return Math.sqrt(a)}),Pe(Ie(t),"onAudioReload",function(){t.props.audioLists.length&&(t.handlePlay(Kt.singleLoop),t.props.onAudioReload&&t.props.onAudioReload(t.getBaseAudioInfo()))}),Pe(Ie(t),"onOpenPanel",function(){var a=t.props,s=a.toggleMode,o=a.spaceBar;s&&(t.setState({toggle:!0}),t.props.onModeChange&&t.props.onModeChange(Vr.FULL),o&&t.player.current&&t.player.current.focus({preventScroll:!0})),t.onCoverClick(Vr.MINI)}),Pe(Ie(t),"onHidePanel",function(){t.setState({toggle:!1,audioListsPanelVisible:!1}),t.props.onModeChange&&t.props.onModeChange(Vr.MINI)}),Pe(Ie(t),"onDestroyPlayer",function(){if(t.props.onBeforeDestroy){var a=Promise.resolve(t.props.onBeforeDestroy(t.state.playId,t.state.audioLists,t.getBaseAudioInfo()));a&&a.then&&a.then(function(){t._onDestroyPlayer()}).catch(function(){});return}t._onDestroyPlayer()}),Pe(Ie(t),"_onDestroyPlayer",function(){t.unInstallPlayer()}),Pe(Ie(t),"_onDestroyed",function(){t.setState({isPlayDestroyed:!0}),t.props.onDestroyed&&t.props.onDestroyed(t.state.playId,t.state.audioLists,t.getBaseAudioInfo())}),Pe(Ie(t),"getCurrentPlayIndex",function(){return t.state.audioLists.findIndex(function(a){return a[jt]===t.state.playId})}),Pe(Ie(t),"resetAudioPlayStatus",function(){return new Promise(function(a){t.setState({currentTime:0,loading:!1,playing:!1,canPlay:!1,lyric:"",currentLyric:"",loadedProgress:0,playIndex:Da},a)})}),Pe(Ie(t),"onTogglePlay",function(){if(t.setState({isAudioSeeking:!1}),t.state.audioLists.length>=1){var a=t.props.volumeFade||{},s=a.fadeIn,o=a.fadeOut,p=t.state,x=p.currentVolumeFade,g=p.currentVolumeFadeInterval,d=x===tn.IN||x===tn.OUT;if(d&&(clearInterval(g),t.setState({currentVolumeFadeInterval:void 0,updateIntervalEndVolume:void 0})),!d&&t.state.playing||x===tn.IN){t.setState({currentVolumeFade:tn.OUT});var h=Tc(t.audio,t.audio.volume,0,{duration:o},function(){t.audio.pause(),t.setState({currentVolumeFade:tn.NONE,currentVolumeFadeInterval:void 0,playing:!1,updateIntervalEndVolume:void 0}),t.audio.volume=t.getListeningVolume(t.state.soundValue)}),y=h.fadeInterval,b=h.updateIntervalEndVolume;t.setState({currentVolumeFadeInterval:y,updateIntervalEndVolume:b})}else{t.setState({currentVolumeFade:tn.IN});var T=d?t.audio.volume:0,_=t.getListeningVolume(t.state.soundValue),c=Tc(t.audio,T,_,{duration:s},function(){t.setState({currentVolumeFade:tn.NONE,currentVolumeFadeInterval:void 0,updateIntervalEndVolume:void 0}),t.audio.volume=t.getListeningVolume(t.state.soundValue)}),u=c.fadeInterval,f=c.updateIntervalEndVolume;t.setState({currentVolumeFadeInterval:u,updateIntervalEndVolume:f,isAutoPlayWhenUserClicked:!0},function(){u&&(t.audio.volume=T),t.loadAndPlayAudio()})}}}),Pe(Ie(t),"playAudio",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;(t.isAudioCanPlay||a)&&(a&&t.setAudioLoaded(),t.loadAndPlayAudio(a))}),Pe(Ie(t),"setAudioLoaded",function(){t.setState({loading:!1,playing:!1})}),Pe(Ie(t),"onAudioPause",function(){t.setState({playing:!1}),t.props.onAudioPause&&t.props.onAudioPause(t.getBaseAudioInfo()),t.state.lyric&&t.lyric&&t.lyric.togglePlay()}),Pe(Ie(t),"onAudioPlay",function(){t.state.isAudioSeeking||(t.setState({playing:!0,loading:!1}),t.props.onAudioPlay&&t.props.onAudioPlay(t.getBaseAudioInfo()),t.state.lyric&&t.lyric&&t.lyric.togglePlay())}),Pe(Ie(t),"onSetAudioLoadedProgress",function(){var a=t.audio,s=a.buffered,o=a.duration;if(s.length&&s.end){var p=s.end(s.length-1)/o*100;t.setState({loadedProgress:p})}}),Pe(Ie(t),"loadAndPlayAudio",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,s=t.props.remember,o=t.state,p=o.isInitRemember,x=o.musicSrc,g=t.audio,d=g.networkState,h=g.readyState;if(!!x){if(d===pc.NETWORK_NO_SOURCE||d===pc.NETWORK_EMPTY)return t.onAudioError({reason:`
          [loadAndPlayAudio]: Failed to load because no supported source was found.
          current network status is `.concat(d,`.
        `)});if(t.setState({playing:!1,loading:!0,isAudioSeeking:!1,isResetCoverRotate:!1}),a||h>=G0.HAVE_FUTURE_DATA){var y=t.getLastPlayStatus(),b=y.playing,T=s&&!p&&!b,_=s?!T:t.isAudioCanPlay;t.setState({playing:_,loading:!1},function(){_&&t.play(),t.setState({isInitAutoPlay:!0,isInitRemember:!0,isAutoPlayWhenUserClicked:!1})})}else t.audio.load()}}),Pe(Ie(t),"onAudioError",function(a){var s=t.state,o=s.playMode,p=s.audioLists,x=s.playId,g=s.musicSrc,d=t.props.loadAudioErrorPlayNext,h=o===Kt.singleLoop,y=h?Kt.order:o;if(t.lyric&&t.lyric.stop(),g){if(d&&p.length){var b=(o===Kt.order||o===Kt.orderLoop)&&x===p[p.length-1][jt];b||t.handlePlay(y,!0)}t.props.onAudioError&&t.props.onAudioError(t.audio.error||a&&a.reason||null,x,p,t.getBaseAudioInfo())}}),Pe(Ie(t),"handlePlay",function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,o=t.state,p=o.playId,x=o.audioLists,g=x.length;if(!!g){var d=t.getCurrentPlayIndex();switch(a){case Kt.order:if(d===g-1){t.audio.pause();return}t.audioListsPlay(s?x[d+1][jt]:x[d-1][jt]);break;case Kt.orderLoop:if(s){if(d===g-1)return t.audioListsPlay(x[0][jt]);t.audioListsPlay(x[d+1][jt])}else{if(d===0)return t.audioListsPlay(x[g-1][jt]);t.audioListsPlay(x[d-1][jt])}break;case Kt.singleLoop:t.audio.currentTime=0,t.audioListsPlay(p,!0);break;case Kt.shufflePlay:{var h=ty(0,g-1);h===t.getCurrentPlayIndex()&&(h=t.getPlayIndex(h+1));var y=(x[h]||{})[jt];t.audioListsPlay(y,!0)}break}}}),Pe(Ie(t),"onAudioEnd",function(){t.props.onAudioEnded&&t.props.onAudioEnded(t.state.playId,t.state.audioLists,t.getBaseAudioInfo()),t.handlePlay(t.state.playMode)}),Pe(Ie(t),"audioPrevAndNextBasePlayHandle",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,s=t.state.playMode,o="";switch(s){case Kt.shufflePlay:o=s;break;default:o=Kt.orderLoop;break}t.handlePlay(o,a)}),Pe(Ie(t),"onPlayPrevAudio",function(){var a=t.props.restartCurrentOnPrev;if(a&&t.audio.currentTime>1){t.audio.currentTime=0;return}t.audioPrevAndNextBasePlayHandle(!1)}),Pe(Ie(t),"onPlayNextAudio",function(){t.audioPrevAndNextBasePlayHandle(!0)}),Pe(Ie(t),"audioTimeUpdate",function(){var a=t.audio.currentTime;t.setState({currentTime:a}),t.props.remember&&t.saveLastPlayStatus(),t.props.onAudioProgress&&t.props.onAudioProgress(t.getBaseAudioInfo())}),Pe(Ie(t),"onAudioSoundChange",function(a){t.setAudioVolume(a)}),Pe(Ie(t),"onAudioVolumeChange",function(){var a=t.audio.volume,s=t.state,o=s.currentVolumeFade,p=s.currentAudioVolume;if(!(o!==tn.NONE||p===a)){var x=t.getVolumeBarValue(a);if(t.setState({soundValue:x}),t.props.onAudioVolumeChange){var g=parseFloat(a.toFixed(4));t.props.onAudioVolumeChange(g)}}}),Pe(Ie(t),"onProgressChange",function(a){t.audio&&(t.audio.currentTime=a),t.setState({currentTime:a,isAudioSeeking:!0})}),Pe(Ie(t),"onAudioSeeked",function(a){t.setState({isAudioSeeking:!0}),!!t.state.audioLists.length&&(t.lyric&&t.lyric.seek(a*1e3),t.state.playing||t.lyric&&t.lyric.stop(),t.audio&&(t.audio.currentTime=a),t.props.onAudioSeeked&&t.props.onAudioSeeked(t.getBaseAudioInfo()),setTimeout(function(){t.setState({isAudioSeeking:!1})},500))}),Pe(Ie(t),"onAudioMute",function(){t.setState({soundValue:0,currentAudioVolume:t.audio.volume},function(){t.audio.volume=0})}),Pe(Ie(t),"onAudioAbort",function(a){var s=t.state,o=s.audioLists,p=s.playId,x=t.getBaseAudioInfo(),g=kt(kt({},a),x);t.props.onAudioAbort&&t.props.onAudioAbort(p,o,g)}),Pe(Ie(t),"toggleMode",function(a){a===Vr.FULL&&t.setState({toggle:!0})}),Pe(Ie(t),"toggleTheme",function(a){t.setState({theme:a})}),Pe(Ie(t),"onAudioListsSortEnd",function(a){var s=a.oldIndex,o=a.newIndex;if(s!==o){var p=t.state,x=p.playId,g=p.audioLists,d=Fi(g),h=d.splice(s,1)[0];d.splice(o,0,h);var y=s===x?o:x;t.setState({audioLists:d,playId:y}),t.props.onAudioListsSortEnd&&t.props.onAudioListsSortEnd(s,o),t.props.onAudioListsChange&&t.props.onAudioListsChange(y,d,t.getBaseAudioInfo()),t.props.onAudioListsDragEnd&&(console.warn("[Deprecated] onAudioListsDragEnd is deprecated. please use onAudioListsSortEnd(oldIndex, newIndex){}"),t.props.onAudioListsDragEnd(s,o))}}),Pe(Ie(t),"saveLastPlayStatus",function(){var a=t.state,s=a.currentTime,o=a.playId,p=a.theme,x=a.soundValue,g=a.playMode,d=a.name,h=a.cover,y=a.singer,b=a.musicSrc,T=JSON.stringify({currentTime:s,playId:o,theme:p,playMode:g,soundValue:x,name:d,cover:h,singer:y,musicSrc:b});localStorage.setItem("lastPlayStatus",T)}),Pe(Ie(t),"getLastPlayStatus",function(){var a=t.props,s=a.theme,o=a.defaultPlayMode,p=a.playMode,x=a.defaultPlayIndex,g=a.playIndex,d={currentTime:0,playMode:p||o||Kt.order,name:"",cover:"",singer:"",musicSrc:"",lyric:"",playId:t.getDefaultPlayId(),theme:s,playing:!0,playIndex:g||x||0};try{return JSON.parse(localStorage.getItem("lastPlayStatus"))||d}catch(h){return d}}),Pe(Ie(t),"checkCurrentPlayingAudioIsInUpdatedAudioLists",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t.props,s=t.state,o=s.playId,p=s.musicSrc;return!a.quietUpdate||!Array.isArray(a.audioLists)?!1:o&&a.audioLists.some(function(x){return x[jt]===o||x.musicSrc===p})}),Pe(Ie(t),"play",function(){var a=t.audio.play();a&&a.then&&a.then(function(){t.setState({loading:!1,playing:!0})}).catch(function(){t.setState({loading:!1,playing:!1})})}),Pe(Ie(t),"mockAutoPlayForMobile",function(){t.props.autoPlay&&!t.state.playing&&(t.audio.load(),t.play())}),Pe(Ie(t),"bindMobileAutoPlayEvents",function(){document.addEventListener("touchstart",function(){t.mockAutoPlayForMobile()},{once:!0}),document.addEventListener("WeixinJSBridgeReady",function(){t.mockAutoPlayForMobile()})}),Pe(Ie(t),"bindSafariAutoPlayEvents",function(){document.addEventListener("click",function(){t.mockAutoPlayForMobile()},{once:!0})}),Pe(Ie(t),"unBindEvents",function(){var a;(a=t).bindEvents.apply(a,arguments)}),Pe(Ie(t),"bindEvents",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t.audio,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{waiting:t.loadAndPlayAudio,canplay:t.onAudioCanPlay,error:t.onAudioError,ended:t.onAudioEnd,pause:t.onAudioPause,play:t.onAudioPlay,timeupdate:t.audioTimeUpdate,volumechange:t.onAudioVolumeChange,abort:t.onAudioAbort,progress:t.onSetAudioLoadedProgress},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,p=t.props.once;for(var x in s){var g=s[x];a&&(o?a.addEventListener(x,g,{once:!!(p&&x==="play")}):a.removeEventListener(x,g))}}),Pe(Ie(t),"getPlayId",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t.state.audioLists,s=t.getPlayIndex(void 0,a),o=t.state.playId||a[s]&&a[s][jt];return o}),Pe(Ie(t),"_getPlayInfo",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=t.getPlayId(a),o=a.find(function(u){return u[jt]===s})||{},p=o.name,x=p===void 0?"":p,g=o.cover,d=g===void 0?"":g,h=o.singer,y=h===void 0?"":h,b=o.musicSrc,T=b===void 0?"":b,_=o.lyric,c=_===void 0?"":_;return{name:x,cover:d,singer:y,musicSrc:T,lyric:c,audioLists:a,playId:s}}),Pe(Ie(t),"getPlayInfo",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=a.filter(function(x){return!x[jt]}),o=a.filter(function(x){return x[jt]}),p=[].concat(Fi(o),Fi(s.map(function(x){return kt(kt({},x),{},Pe({},jt,Sc()))})));return t._getPlayInfo(p)}),Pe(Ie(t),"getPlayInfoOfNewList",function(a){var s=a.audioLists,o=s===void 0?[]:s,p=o.map(function(x){var g=a.quietUpdate&&t.state.audioLists.find(function(d){var h=d.musicSrc;return h===x.musicSrc})||{};return kt(kt({},x),{},Pe({},jt,g[jt]||Sc()))});return t._getPlayInfo(p)}),Pe(Ie(t),"initPlayInfo",function(a,s){var o=t.getPlayInfo(a);switch(Vn(o.musicSrc)){case"function":o.musicSrc().then(function(p){t.setState(kt(kt({},o),{},{musicSrc:p}),s)},t.onAudioError);break;default:t.setState(o,s)}}),Pe(Ie(t),"addMatchMediaListener",function(a,s){var o=window.matchMedia(a);return s(o),"addEventListener"in o?o.addEventListener("change",s):o.addListener(s),o}),Pe(Ie(t),"removeMatchMediaListener",function(a,s){a&&("removeEventListener"in a?a.removeEventListener("change",s):a.removeListener&&a.removeListener(s))}),Pe(Ie(t),"addMobileListener",function(){t.mobileMedia=t.addMatchMediaListener(t.props.mobileMediaQuery,t.mobileMediaHandler)}),Pe(Ie(t),"removeMobileListener",function(){t.removeMatchMediaListener(t.mobileMedia,t.mobileMediaHandler)}),Pe(Ie(t),"addSystemThemeListener",function(){t.systemThemeMedia=t.addMatchMediaListener(hc.DARK_THEME,t.systemThemeMediaHandler)}),Pe(Ie(t),"removeSystemThemeListener",function(){t.removeMatchMediaListener(t.systemThemeMedia,t.systemThemeMediaHandler)}),Pe(Ie(t),"mobileMediaHandler",function(a){var s=a.matches;t.setState({isMobile:!!s})}),Pe(Ie(t),"systemThemeMediaHandler",function(a){var s=a.matches;if(t.props.theme===Gr.AUTO){var o=s?Gr.DARK:Gr.LIGHT;t.updateTheme(o)}}),Pe(Ie(t),"setDefaultAudioVolume",function(){var a=t.props,s=a.defaultVolume,o=a.remember;t.defaultVolume=Math.max(0,Math.min(s,1));var p=t.getLastPlayStatus(),x=p.soundValue,g=x===void 0?t.defaultVolume:x;t.setAudioVolume(o?g:t.defaultVolume)}),Pe(Ie(t),"getDefaultPlayId",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t.props.audioLists,s=t.getPlayIndex();return a[s]&&a[s][jt]}),Pe(Ie(t),"initLyricParser",function(){t.lyric=new ey(t.state.lyric,t.onLyricChange),t.setState({currentLyric:t.lyric.lines[0]&&t.lyric.lines[0].text})}),Pe(Ie(t),"onLyricChange",function(a){var s=a.lineNum,o=a.txt;t.setState({currentLyric:o}),t.props.onAudioLyricChange&&t.props.onAudioLyricChange(s,o)}),Pe(Ie(t),"updateTheme",function(a){a&&a!==t.props.theme&&Object.values(Gr).includes(a)&&t.setState({theme:a})}),Pe(Ie(t),"updateMode",function(a){a&&a!==t.props.mode&&Object.values(Vr).includes(a)&&(t.setState({toggle:a===Vr.FULL}),a===Vr.MINI&&t._closeAudioListsPanel())}),Pe(Ie(t),"updatePlayMode",function(a){!Object.values(Kt).includes(a)||a!==t.props.playMode&&t.setState({playMode:a})}),Pe(Ie(t),"updateAudioLists",function(a){var s=[].concat(Fi(t.state.audioLists),Fi(a.filter(function(o){return t.state.audioLists.findIndex(function(p){return p.musicSrc===o.musicSrc})===-1})));t.initPlayInfo(s),t.bindEvents(t.audio),t.props.onAudioListsChange&&t.props.onAudioListsChange(t.state.playId,a,t.getBaseAudioInfo())}),Pe(Ie(t),"loadNewAudioLists",function(a){var s=a.audioLists,o=a.remember,p=a.playMode,x=a.theme,g=a.autoPlayInitLoadPlayList,d=a.playIndex;if(!(!Array.isArray(s)||!s.length)){var h=t.getPlayInfoOfNewList(a),y=o?t.getLastPlayStatus():{playMode:p||Kt.order,playIndex:d||Da};x!==Gr.AUTO&&(y.theme=x);var b=kt(kt(kt({},h),y),{},{isInitAutoPlay:g,playing:t.isAudioCanPlay});if(t.checkCurrentPlayingAudioIsInUpdatedAudioLists(a)){t.setState({audioLists:h.audioLists});return}switch(Vn(h.musicSrc)){case"function":h.musicSrc().then(function(T){t.setState(kt(kt({},b),{},{musicSrc:T}))},t.onAudioError);break;default:t.setState(b)}}}),Pe(Ie(t),"resetPlayId",function(){return new Promise(function(a){t.setState({playId:t.initPlayId},a)})}),Pe(Ie(t),"changeAudioLists",function(a){t.checkCurrentPlayingAudioIsInUpdatedAudioLists(a)||t.resetAudioStatus(),t.resetPlayId().then(function(){t.loadNewAudioLists(a),t.props.onAudioListsChange&&t.props.onAudioListsChange(t.state.playId,a.audioLists,t.getBaseAudioInfo())})}),Pe(Ie(t),"updatePlayIndex",function(a){var s=t.getCurrentPlayIndex();a!==void 0&&s!==a&&t.resetAudioPlayStatus().then(function(){var o=t.state.audioLists[t.getPlayIndex(a)];o&&o[jt]&&t.audioListsPlay(o[jt],!0)})}),Pe(Ie(t),"playByIndex",function(a){t.updatePlayIndex(a)}),Pe(Ie(t),"getEnhanceAudio",function(){var a=Ie(t),s=a.audio;return[{name:"destroy",value:t.onDestroyPlayer},{name:"updatePlayIndex",value:t.updatePlayIndex},{name:"playByIndex",value:t.playByIndex},{name:"playNext",value:t.onPlayNextAudio},{name:"playPrev",value:t.onPlayPrevAudio},{name:"togglePlay",value:t.onTogglePlay},{name:"clear",value:t.clearAudioLists},{name:"sortable",value:t.sortable}].forEach(function(o){var p=o.name,x=o.value;Object.defineProperty(s,p,{value:x,writable:!1})}),s}),Pe(Ie(t),"onGetAudioInstance",function(){t.props.getAudioInstance&&t.props.getAudioInstance(t.getEnhanceAudio())}),Pe(Ie(t),"updateMediaSessionMetadata",function(){if("mediaSession"in navigator&&t.props.showMediaSession){var a=t.state,s=a.name,o=a.cover,p=a.singer,x={title:s,artist:p,album:s};o&&(x.artwork=["96x96","128x128","192x192","256x256","384x384","512x512"].map(function(g){return{src:o,sizes:g,type:"image/png"}})),navigator.mediaSession.metadata=new MediaMetadata(x),t.updateMediaSessionPositionState()}}),Pe(Ie(t),"updateMediaSessionPositionState",function(){if("setPositionState"in navigator.mediaSession)try{var a=Ie(t),s=a.audio;navigator.mediaSession.setPositionState({duration:t.audioDuration,playbackRate:s.playbackRate||1,position:s.currentTime||0})}catch(o){console.error("Update media session position state failed: ",o)}}),Pe(Ie(t),"onAddMediaSession",function(){if("mediaSession"in navigator&&t.props.showMediaSession){var a=10;navigator.mediaSession.setActionHandler("play",t.onTogglePlay),navigator.mediaSession.setActionHandler("pause",t.onTogglePlay),navigator.mediaSession.setActionHandler("seekbackward",function(s){var o=s.seekOffset||a;t.audio.currentTime=Math.max(t.audio.currentTime-o,0),t.props.onAudioSeeked&&t.props.onAudioSeeked(t.getBaseAudioInfo())}),navigator.mediaSession.setActionHandler("seekforward",function(s){var o=s.seekOffset||a;t.audio.currentTime=Math.min(t.audio.currentTime+o,t.audioDuration),t.props.onAudioSeeked&&t.props.onAudioSeeked(t.getBaseAudioInfo())}),navigator.mediaSession.setActionHandler("previoustrack",t.onPlayPrevAudio),navigator.mediaSession.setActionHandler("nexttrack",t.onPlayNextAudio),setTimeout(function(){t.updateMediaSessionMetadata()},0);try{navigator.mediaSession.setActionHandler("seekto",function(s){if(s.fastSeek&&"fastSeek"in t.audio){t.audio.fastSeek(s.seekTime);return}t.audio.currentTime=s.seekTime,t.updateMediaSessionPositionState()})}catch(s){console.warn('Warning! The "seekto" media session action is not supported.')}}}),Pe(Ie(t),"bindUnhandledRejection",function(){window.addEventListener("unhandledrejection",t.onAudioError)}),Pe(Ie(t),"unBindUnhandledRejection",function(){window.removeEventListener("unhandledrejection",t.onAudioError)}),Pe(Ie(t),"bindKeyDownEvents",function(){t.props.spaceBar&&t.player.current&&(t.player.current.addEventListener("keydown",t.onKeyDown,!1),t.player.current.focus({preventScroll:!0}))}),Pe(Ie(t),"unBindKeyDownEvents",function(){t.player.current&&t.player.current.removeEventListener("keydown",t.onKeyDown,!1)}),Pe(Ie(t),"onKeyDown",function(a){var s=t.props.spaceBar;s&&a.keyCode===V0&&t.onTogglePlay()}),Pe(Ie(t),"initPlayer",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t.props.audioLists,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;o&&t.setDefaultAudioVolume(),!(!Array.isArray(a)||!a.length)&&(t.bindUnhandledRejection(),t.bindEvents(t.audio),t.initLyricParser(),t.onAddMediaSession(),$l?t.bindMobileAutoPlayEvents():(s&&t.bindKeyDownEvents(),ny()&&t.bindSafariAutoPlayEvents()))}),Pe(Ie(t),"removeLyric",function(){t.lyric&&(t.lyric.stop(),t.lyric=void 0)}),Pe(Ie(t),"unInstallPlayer",function(){t.unBindEvents(t.audio,void 0,!1),t.unBindUnhandledRejection(),t.unBindKeyDownEvents(),t.removeMobileListener(),t.removeLyric(),t._onDestroyed(),t.sortable&&t.sortable.destroy()}),Pe(Ie(t),"onAudioCanPlay",function(){t.state.isAudioSeeking||t.setState({canPlay:!0},function(){t.playAudio(!0)})}),Pe(Ie(t),"initSortableAudioLists",function(){var a=t.props,s=a.audioLists,o=a.sortableOptions,p=zl.selector,x=sy(zl,["selector"]),g=document.querySelector(".".concat(p));Array.isArray(s)&&!s.length||!g||(t.sortable&&t.sortable.destroy(),t.sortable=new Et(g,kt(kt({onEnd:t.onAudioListsSortEnd},x),o)))}),t.audio=null,t.targetId="music-player-controller",t._PLAY_MODE_=Object.values(Kt),t._PLAY_MODE_LENGTH_=t._PLAY_MODE_.length,t.player=vt.exports.createRef(),t.destroyBtn=vt.exports.createRef(),t}return hy(r,[{key:"locale",get:function(){var t=this.props.locale;return typeof t=="string"?mc[this.props.locale]:t?kt(kt({},mc[Pa.en_US]),t):{}}},{key:"audioDuration",get:function(){var t=this.state,a=t.audioLists,s=t.playId;if(!a.length||!this.audio)return 0;var o=a.find(function(x){return x[jt]===s})||{},p=o.duration;return Math.max(Number(p)||this.audio.duration||0,0)}},{key:"isAudioCanPlay",get:function(){var t=this.props.autoPlay,a=this.state,s=a.isInitAutoPlay,o=a.isAutoPlayWhenUserClicked,p=a.canPlay;return p&&(s||t||o)}},{key:"iconMap",get:function(){var t=this,a=function(){return oe.createElement("span",{className:"loading group"},t.props.icon.loading)};return kt(kt(kt({},wc),this.props.icon),{},{loading:oe.createElement(a,null)})}},{key:"render",value:function(){var t=this,a=this.props,s=a.className,o=a.drag,p=a.style,x=a.showDownload,g=a.showPlay,d=a.showReload,h=a.showPlayMode,y=a.showThemeSwitch,b=a.toggleMode,T=a.showMiniModeCover,_=a.extendsContent,c=a.defaultPlayMode,u=a.seeked,f=a.showProgressLoadBar,v=a.bounds,l=a.defaultPosition,m=a.showMiniProcessBar,E=a.preload,S=a.glassBg,O=a.remove,D=a.lyricClassName,P=a.showLyric,A=a.getContainer,w=a.autoHiddenCover,L=a.showDestroy,R=a.responsive,C=this.locale,M=this.state,N=M.toggle,U=M.playing,K=M.currentTime,V=M.soundValue,W=M.moveX,G=M.moveY,Y=M.loading,q=M.audioListsPanelVisible,ee=M.theme,re=M.name,pe=M.cover,Le=M.singer,Te=M.musicSrc,be=M.playId,Re=M.isMobile,Se=M.playMode,Ge=M.playModeTipVisible,$e=M.playModelNameVisible,st=M.initAnimate,Ze=M.loadedProgress,et=M.audioLists,ft=M.removeId,dt=M.currentLyric,ht=M.audioLyricVisible,He=M.isPlayDestroyed,rt=M.isResetCoverRotate,xt=E===!1||E==="none"?{}:E===!0?{preload:"auto"}:{preload:E},pt=st?{show:q,hide:!q}:{show:q},ot=Kt[Se||c]||Kt.order,Lt=C.playModeText[ot],wt=T&&!w||w&&pe?{style:{backgroundImage:"url(".concat(pe,")")}}:{},Pt=bc(K),ve=bc(this.audioDuration),Ce=u?{onChange:this.onProgressChange,onAfterChange:this.onAudioSeeked}:{},ke=oe.createElement(oe.Fragment,null,f&&oe.createElement("div",{className:"progress-load-bar",style:{width:"".concat(Math.min(Ze,100),"%")}}),oe.createElement(yl,Bi({max:Math.ceil(this.audioDuration),defaultValue:0,value:Math.ceil(K)},Ce,$0))),Ue=x&&oe.createElement("span",{className:"group audio-download",onClick:this.onAudioDownload,title:C.downloadText},this.iconMap.download),Je=y&&oe.createElement("span",{className:"group theme-switch"},oe.createElement(Sf,{className:"theme-switch-container",onChange:this.themeChange,checkedChildren:C.lightThemeText,unCheckedChildren:C.darkThemeText,checked:ee===Gr.LIGHT,title:C.switchThemeText})),it=d&&oe.createElement("span",{className:"group reload-btn",onClick:this.onAudioReload,title:C.reloadText},this.iconMap.reload),X=P&&oe.createElement("span",{className:ar("group lyric-btn",{"lyric-btn-active":ht}),onClick:this.toggleAudioLyric,title:C.toggleLyricText},this.iconMap.lyric),Ae=h&&oe.createElement("span",{className:ar("group loop-btn"),onClick:this.togglePlayMode,title:C.playModeText[ot]},this.renderPlayModeIcon(ot)),Me=Re?30:40,Ke=L&&oe.createElement("span",{title:C.destroyText,className:"group destroy-btn",ref:this.destroyBtn,onClick:!o||N?this.onDestroyPlayer:void 0},this.iconMap.destroy),ne=oe.createElement("div",{className:ar("react-jinke-music-player"),style:l,tabIndex:"-1"},oe.createElement("div",{className:ar("music-player")},m&&oe.createElement(Gm,{progress:K/this.audioDuration,r:Me}),oe.createElement("div",Bi({id:this.targetId,className:ar("scale","music-player-controller",{"music-player-playing":U})},wt,{onClick:o?void 0:this.onOpenPanel}),Y?this.iconMap.loading:oe.createElement(oe.Fragment,null,oe.createElement("span",{className:"controller-title"},C.controllerTitle),oe.createElement("div",{className:"music-player-controller-setting"},N?C.closeText:C.openText))),Ke)),_e=A()||document.body,H=this.getAudioTitle();if(He)return null;var De=!U||this.state.currentVolumeFade===tn.OUT;return fa.exports.createPortal(oe.createElement("div",{className:ar("react-jinke-music-player-main",{"light-theme":ee===Gr.LIGHT,"dark-theme":ee===Gr.DARK},s),style:p,ref:this.player,tabIndex:"-1"},N&&Re&&R&&oe.createElement(j0,{playing:U,loading:Y,name:re,singer:Le,cover:pe,themeSwitch:Je,duration:ve,currentTime:Pt,progressBar:ke,onPlay:this.onTogglePlay,currentPlayModeName:Lt,playMode:Ae,audioNextPlay:this.onPlayNextAudio,audioPrevPlay:this.onPlayPrevAudio,icon:kt(kt({},this.iconMap),{},{reload:it,download:Ue,lyric:X}),playModeTipVisible:Ge,openAudioListsPanel:this.openAudioListsPanel,onClose:this.onHidePanel,extendsContent:_,glassBg:S,autoHiddenCover:w,onCoverClick:this.onCoverClick,locale:C,toggleMode:b,renderAudioTitle:this.renderAudioTitle,shouldShowPlayIcon:De,isResetCoverRotate:rt}),N?void 0:o?oe.createElement(jf,{bounds:v,position:{x:W,y:G},onDrag:this.onControllerDrag,onStop:this.onControllerDragStop,onStart:this.onControllerDragStart},ne):ne,N&&(!Re||!R)&&oe.createElement("div",{className:ar("music-player-panel","translate",{"glass-bg":S})},oe.createElement("section",{className:"panel-content"},(!w||w&&pe)&&oe.createElement("div",{className:ar("img-content","img-rotate",{"img-rotate-pause":!U||!pe,"img-rotate-reset":rt}),style:{backgroundImage:"url(".concat(pe,")")},onClick:function(){return t.onCoverClick()}}),oe.createElement("div",{className:"progress-bar-content"},oe.createElement("span",{className:"audio-title",title:H},this.renderAudioTitle()),oe.createElement("section",{className:"audio-main"},oe.createElement("span",{className:"current-time",title:Pt},Y?"--":Pt),oe.createElement("div",{className:"progress-bar"},ke),oe.createElement("span",{className:"duration",title:ve},Y?"--":ve))),oe.createElement("div",{className:"player-content"},g?oe.createElement("span",{className:"group"},oe.createElement("span",{className:"group prev-audio",title:C.previousTrackText,onClick:this.onPlayPrevAudio},this.iconMap.prev),Y?oe.createElement("span",{className:"group loading-icon",title:C.loadingText},this.iconMap.loading):oe.createElement("span",{className:"group play-btn",onClick:this.onTogglePlay,title:De?C.clickToPlayText:C.clickToPauseText},De?this.iconMap.play:this.iconMap.pause),oe.createElement("span",{className:"group next-audio",title:C.nextTrackText,onClick:this.onPlayNextAudio},this.iconMap.next)):Y&&this.iconMap.loading,it,Ue,Je,_||null,oe.createElement("span",{className:"group play-sounds",title:C.volumeText},V===0?oe.createElement("span",{className:"sounds-icon",onClick:this.onResetVolume},this.iconMap.mute):oe.createElement("span",{className:"sounds-icon",onClick:this.onAudioMute},this.iconMap.volume),oe.createElement(yl,Bi({value:V,onChange:this.onAudioSoundChange,className:"sound-operation"},Y0))),Ae,X,oe.createElement("span",{className:"group audio-lists-btn",title:C.playListsText,onClick:this.openAudioListsPanel},oe.createElement("span",{className:"audio-lists-icon"},this.iconMap.playLists),oe.createElement("span",{className:"audio-lists-num"},et.length)),b&&oe.createElement("span",{className:"group hide-panel",title:C.toggleMiniModeText,onClick:this.onHidePanel},this.iconMap.toggle),Ke))),oe.createElement(Km,{playing:U,playId:be,loading:Y,visible:q,audioLists:et,onPlay:this.audioListsPlay,onCancel:this.closeAudioListsPanel,icon:this.iconMap,isMobile:Re,panelToggleAnimate:pt,glassBg:S,cover:pe,remove:O,onDelete:this.onDeleteAudioLists,removeId:ft,locale:C}),!Re&&oe.createElement(z0,{visible:$e,value:Lt}),ht&&oe.createElement(jf,null,oe.createElement("div",{className:ar("music-player-lyric",D)},dt||C.emptyLyricText)),oe.createElement("audio",Bi({className:"music-player-audio",title:H},xt,{src:Te,ref:function(B){t.audio=B}}))),_e)}},{key:"getBaseAudioInfo",value:function(){var t=this.state,a=t.cover,s=t.name,o=t.musicSrc,p=t.soundValue,x=t.lyric,g=t.audioLists,d=t.currentLyric,h=this.audio||{},y=h.currentTime,b=h.muted,T=h.networkState,_=h.readyState,c=h.played,u=h.paused,f=h.ended,v=h.startDate,l=this.getCurrentPlayIndex(),m=g[l]||{};return kt(kt({},m),{},{cover:a,name:s,musicSrc:o,volume:p,currentTime:y,duration:this.audioDuration,muted:b,networkState:T,readyState:_,played:c,paused:u,ended:f,startDate:v,lyric:x,currentLyric:d,playIndex:l})}},{key:"componentDidUpdate",value:function(t,a){a.musicSrc!==this.state.musicSrc&&this.setState({isResetCoverRotate:!0})}},{key:"UNSAFE_componentWillReceiveProps",value:function(t){var a=this,s=t.audioLists,o=t.playIndex,p=t.theme,x=t.mode,g=t.playMode,d=t.clearPriorAudioLists,h=ry(s)(this.props.audioLists);h||(d?this.changeAudioLists(t):this.updateAudioLists(s),this.checkCurrentPlayingAudioIsInUpdatedAudioLists(t)||this.initPlayer(s,!1,!1),setTimeout(function(){return a.initSortableAudioLists()},200)),this.updatePlayIndex(!h&&d?Da:o),this.updateTheme(p),this.updateMode(x),this.updatePlayMode(g)}},{key:"UNSAFE_componentWillMount",value:function(){var t=this,a=this.props,s=a.audioLists,o=a.remember;if(Array.isArray(s)&&s.length>=1){var p=this.getPlayInfo(s),x=o?this.getLastPlayStatus():{};switch(Vn(p.musicSrc)){case"function":p.musicSrc().then(function(g){t.setState(kt(kt({},p),{},{musicSrc:g},x))},this.onAudioError);break;default:this.setState(kt(kt({},p),x))}}}},{key:"componentWillUnmount",value:function(){this.unInstallPlayer()}},{key:"componentDidMount",value:function(){this.addMobileListener(),this.addSystemThemeListener(),this.initPlayer(),this.initSortableAudioLists(),this.onGetAudioInstance()}}]),r}(vt.exports.PureComponent);Pe(Yl,"defaultProps",{audioLists:[],theme:Gr.DARK,mode:Vr.MINI,defaultPlayMode:Kt.order,defaultPosition:{left:0,top:0},once:!1,drag:!0,toggleMode:!0,showMiniModeCover:!0,showDownload:!0,showPlay:!0,showReload:!0,showPlayMode:!0,showThemeSwitch:!0,showLyric:!1,playModeTipVisible:!1,autoPlay:!0,defaultVolume:1,showProgressLoadBar:!0,seeked:!0,playModeShowTime:600,bounds:"body",showMiniProcessBar:!1,loadAudioErrorPlayNext:!0,preload:!1,glassBg:!1,remember:!1,remove:!0,defaultPlayIndex:0,getContainer:function(){return document.body},autoHiddenCover:!1,onBeforeAudioDownload:function(){},spaceBar:!1,showDestroy:!1,showMediaSession:!1,locale:Pa.en_US,responsive:!0,icon:wc,quietUpdate:!1,mobileMediaQuery:hc.MOBILE,volumeFade:{fadeIn:0,fadeOut:0},restartCurrentOnPrev:!1,sortableOptions:{}});Pe(Yl,"propTypes",H0);const Lc=4,yy=[],Ey=({file:i})=>{const{lastFiles:e,getSetting:r}=vt.exports.useContext(Sn),n=Tp("light","dark"),{t,i18n:a}=ca(),[s,o]=oe.useState([]),p=kn(),[x,g]=jp("volume",.5),d=Ku({base:!0,md:!1}),h=r("music cover")||"https://store.heytapimage.com/cdo-portal/feedback/202110/30/d43c41c5d257c9bc36366e310374fb19.png",y=t("unknown");return vt.exports.useEffect(()=>{const b={name:i.name,musicSrc:p(),cover:h,singer:y};i.thumbnail&&(b.cover=i.thumbnail);const T=e.filter(_=>_.type===Lc).map(_=>{let c=p(_);const u={name:_.name,musicSrc:c,cover:h,singer:y};return _.thumbnail&&(u.cover=_.thumbnail),u});T.length>0?o(T):o([b])},[]),oe.createElement(bi,{className:"audio-box",w:"full"},oe.createElement(Si,{p:"8",w:"full"},oe.createElement(fs,{display:"inline-flex",alignItems:"center"},oe.createElement(da,{color:r("icon color")||"#1890ff",as:cs(i.type,"")}),t("Enjoy the music"),"...")),oe.createElement(Yl,{audioLists:s,theme:n,locale:a.language==="zh"?"zh_CN":"en_US",mode:"full",autoPlay:r("autoplay audio")==="true",defaultPosition:{left:20,bottom:20},playIndex:s.findIndex(b=>b.name===i.name),sortableOptions:{disabled:d},defaultVolume:x,onAudioVolumeChange:b=>g(b)}))};var _y=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",type:Lc,exts:yy,default:Ey}),Xl={},eo={},Zl={exports:{}},xy="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",by=xy,Sy=by;function Dc(){}function Pc(){}Pc.resetWarningCache=Dc;var Ty=function(){function i(n,t,a,s,o,p){if(p!==Sy){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}i.isRequired=i;function e(){return i}var r={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:e,element:i,elementType:i,instanceOf:e,node:i,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Pc,resetWarningCache:Dc};return r.PropTypes=r,r};Zl.exports=Ty();var Rc={},Ra={},Hr={exports:{}},Cc={exports:{}},Oy=void 0,Ic=function(i){return i!==Oy&&i!==null},Ay=Ic,wy={object:!0,function:!0,undefined:!0},Ly=function(i){return Ay(i)?hasOwnProperty.call(wy,typeof i):!1},Dy=Ly,Py=function(i){if(!Dy(i))return!1;try{return i.constructor?i.constructor.prototype===i:!1}catch(e){return!1}},Ry=Py,Cy=function(i){if(typeof i!="function"||!hasOwnProperty.call(i,"length"))return!1;try{if(typeof i.length!="number"||typeof i.call!="function"||typeof i.apply!="function")return!1}catch(e){return!1}return!Ry(i)},Iy=Cy,My=/^\s*class[\s{/}]/,ky=Function.prototype.toString,Ny=function(i){return!(!Iy(i)||My.test(ky.call(i)))},By=function(){var i=Object.assign,e;return typeof i!="function"?!1:(e={foo:"raz"},i(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")},Fy=function(){try{return Object.keys("primitive"),!0}catch(i){return!1}},Uy=function(){},jy=Uy(),Ql=function(i){return i!==jy&&i!==null},Wy=Ql,zy=Object.keys,Ky=function(i){return zy(Wy(i)?Object(i):i)},Vy=Fy()?Object.keys:Ky,Gy=Ql,Hy=function(i){if(!Gy(i))throw new TypeError("Cannot use null or undefined");return i},$y=Vy,Yy=Hy,Xy=Math.max,Zy=function(i,e){var r,n,t=Xy(arguments.length,2),a;for(i=Object(Yy(i)),a=function(s){try{i[s]=e[s]}catch(o){r||(r=o)}},n=1;n<t;++n)e=arguments[n],$y(e).forEach(a);if(r!==void 0)throw r;return i},Qy=By()?Object.assign:Zy,Jy=Ql,qy=Array.prototype.forEach,eE=Object.create,tE=function(i,e){var r;for(r in i)e[r]=i[r]},rE=function(i){var e=eE(null);return qy.call(arguments,function(r){!Jy(r)||tE(Object(r),e)}),e},Jl="razdwatrzy",nE=function(){return typeof Jl.contains!="function"?!1:Jl.contains("dwa")===!0&&Jl.contains("foo")===!1},iE=String.prototype.indexOf,aE=function(i){return iE.call(this,i,arguments[1])>-1},sE=nE()?String.prototype.contains:aE,to=Ic,Mc=Ny,kc=Qy,Nc=rE,Ca=sE,oE=Cc.exports=function(i,e){var r,n,t,a,s;return arguments.length<2||typeof i!="string"?(a=e,e=i,i=null):a=arguments[2],to(i)?(r=Ca.call(i,"c"),n=Ca.call(i,"e"),t=Ca.call(i,"w")):(r=t=!0,n=!1),s={value:e,configurable:r,enumerable:n,writable:t},a?kc(Nc(a),s):s};oE.gs=function(i,e,r){var n,t,a,s;return typeof i!="string"?(a=r,r=e,e=i,i=null):a=arguments[3],to(e)?Mc(e)?to(r)?Mc(r)||(a=r,r=void 0):r=void 0:(a=e,e=r=void 0):e=void 0,to(i)?(n=Ca.call(i,"c"),t=Ca.call(i,"e")):(n=!0,t=!1),s={get:e,set:r,configurable:n,enumerable:t},a?kc(Nc(a),s):s};var lE=function(i){if(typeof i!="function")throw new TypeError(i+" is not a function");return i};(function(i,e){var r=Cc.exports,n=lE,t=Function.prototype.apply,a=Function.prototype.call,s=Object.create,o=Object.defineProperty,p=Object.defineProperties,x=Object.prototype.hasOwnProperty,g={configurable:!0,enumerable:!1,writable:!0},d,h,y,b,T,_,c;d=function(u,f){var v;return n(f),x.call(this,"__ee__")?v=this.__ee__:(v=g.value=s(null),o(this,"__ee__",g),g.value=null),v[u]?typeof v[u]=="object"?v[u].push(f):v[u]=[v[u],f]:v[u]=f,this},h=function(u,f){var v,l;return n(f),l=this,d.call(this,u,v=function(){y.call(l,u,v),t.call(f,this,arguments)}),v.__eeOnceListener__=f,this},y=function(u,f){var v,l,m,E;if(n(f),!x.call(this,"__ee__"))return this;if(v=this.__ee__,!v[u])return this;if(l=v[u],typeof l=="object")for(E=0;m=l[E];++E)(m===f||m.__eeOnceListener__===f)&&(l.length===2?v[u]=l[E?0:1]:l.splice(E,1));else(l===f||l.__eeOnceListener__===f)&&delete v[u];return this},b=function(u){var f,v,l,m,E;if(!!x.call(this,"__ee__")&&(m=this.__ee__[u],!!m))if(typeof m=="object"){for(v=arguments.length,E=new Array(v-1),f=1;f<v;++f)E[f-1]=arguments[f];for(m=m.slice(),f=0;l=m[f];++f)t.call(l,this,E)}else switch(arguments.length){case 1:a.call(m,this);break;case 2:a.call(m,this,arguments[1]);break;case 3:a.call(m,this,arguments[1],arguments[2]);break;default:for(v=arguments.length,E=new Array(v-1),f=1;f<v;++f)E[f-1]=arguments[f];t.call(m,this,E)}},T={on:d,once:h,off:y,emit:b},_={on:r(d),once:r(h),off:r(y),emit:r(b)},c=p({},_),i.exports=e=function(u){return u==null?s(c):p(Object(u),_)},e.methods=T})(Hr,Hr.exports);var nt={},Ia={},wn={},oi={};function ql(i,e){return e===void 0&&(e=Object),e&&typeof e.freeze=="function"?e.freeze(i):i}var Bc=ql({HTML:"text/html",isHTML:function(i){return i===Bc.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Fc=ql({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(i){return i===Fc.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});oi.freeze=ql;oi.MIME_TYPE=Bc;oi.NAMESPACE=Fc;var uE=oi,Ma=uE.NAMESPACE;function fE(i){return i!==""}function cE(i){return i?i.split(/[\t\n\f\r ]+/).filter(fE):[]}function dE(i,e){return i.hasOwnProperty(e)||(i[e]=!0),i}function Uc(i){if(!i)return[];var e=cE(i);return Object.keys(e.reduce(dE,{}))}function hE(i){return function(e){return i&&i.indexOf(e)!==-1}}function ka(i,e){for(var r in i)e[r]=i[r]}function wr(i,e){var r=i.prototype;if(!(r instanceof e)){let n=function(){};n.prototype=e.prototype,n=new n,ka(r,n),i.prototype=r=n}r.constructor!=i&&(typeof i!="function"&&console.error("unknown Class:"+i),r.constructor=i)}var Lr={},rn=Lr.ELEMENT_NODE=1,Ui=Lr.ATTRIBUTE_NODE=2,ro=Lr.TEXT_NODE=3,jc=Lr.CDATA_SECTION_NODE=4,Wc=Lr.ENTITY_REFERENCE_NODE=5,pE=Lr.ENTITY_NODE=6,zc=Lr.PROCESSING_INSTRUCTION_NODE=7,Kc=Lr.COMMENT_NODE=8,Vc=Lr.DOCUMENT_NODE=9,Gc=Lr.DOCUMENT_TYPE_NODE=10,Ln=Lr.DOCUMENT_FRAGMENT_NODE=11,vE=Lr.NOTATION_NODE=12,vr={},rr={};vr.INDEX_SIZE_ERR=(rr[1]="Index size error",1);vr.DOMSTRING_SIZE_ERR=(rr[2]="DOMString size error",2);var gE=vr.HIERARCHY_REQUEST_ERR=(rr[3]="Hierarchy request error",3);vr.WRONG_DOCUMENT_ERR=(rr[4]="Wrong document",4);vr.INVALID_CHARACTER_ERR=(rr[5]="Invalid character",5);vr.NO_DATA_ALLOWED_ERR=(rr[6]="No data allowed",6);vr.NO_MODIFICATION_ALLOWED_ERR=(rr[7]="No modification allowed",7);var mE=vr.NOT_FOUND_ERR=(rr[8]="Not found",8);vr.NOT_SUPPORTED_ERR=(rr[9]="Not supported",9);var Hc=vr.INUSE_ATTRIBUTE_ERR=(rr[10]="Attribute in use",10);vr.INVALID_STATE_ERR=(rr[11]="Invalid state",11);vr.SYNTAX_ERR=(rr[12]="Syntax error",12);vr.INVALID_MODIFICATION_ERR=(rr[13]="Invalid modification",13);vr.NAMESPACE_ERR=(rr[14]="Invalid namespace",14);vr.INVALID_ACCESS_ERR=(rr[15]="Invalid access",15);function li(i,e){if(e instanceof Error)var r=e;else r=this,Error.call(this,rr[i]),this.message=rr[i],Error.captureStackTrace&&Error.captureStackTrace(this,li);return r.code=i,e&&(this.message=this.message+": "+e),r}li.prototype=Error.prototype;ka(vr,li);function Dn(){}Dn.prototype={length:0,item:function(i){return this[i]||null},toString:function(i,e){for(var r=[],n=0;n<this.length;n++)Wi(this[n],r,i,e);return r.join("")}};function ji(i,e){this._node=i,this._refresh=e,eu(this)}function eu(i){var e=i._node._inc||i._node.ownerDocument._inc;if(i._inc!=e){var r=i._refresh(i._node);od(i,"length",r.length),ka(r,i),i._inc=e}}ji.prototype.item=function(i){return eu(this),this[i]};wr(ji,Dn);function no(){}function $c(i,e){for(var r=i.length;r--;)if(i[r]===e)return r}function Yc(i,e,r,n){if(n?e[$c(e,n)]=r:e[e.length++]=r,i){r.ownerElement=i;var t=i.ownerDocument;t&&(n&&Jc(t,i,n),yE(t,i,r))}}function Xc(i,e,r){var n=$c(e,r);if(n>=0){for(var t=e.length-1;n<t;)e[n]=e[++n];if(e.length=t,i){var a=i.ownerDocument;a&&(Jc(a,i,r),r.ownerElement=null)}}else throw li(mE,new Error(i.tagName+"@"+r))}no.prototype={length:0,item:Dn.prototype.item,getNamedItem:function(i){for(var e=this.length;e--;){var r=this[e];if(r.nodeName==i)return r}},setNamedItem:function(i){var e=i.ownerElement;if(e&&e!=this._ownerElement)throw new li(Hc);var r=this.getNamedItem(i.nodeName);return Yc(this._ownerElement,this,i,r),r},setNamedItemNS:function(i){var e=i.ownerElement,r;if(e&&e!=this._ownerElement)throw new li(Hc);return r=this.getNamedItemNS(i.namespaceURI,i.localName),Yc(this._ownerElement,this,i,r),r},removeNamedItem:function(i){var e=this.getNamedItem(i);return Xc(this._ownerElement,this,e),e},removeNamedItemNS:function(i,e){var r=this.getNamedItemNS(i,e);return Xc(this._ownerElement,this,r),r},getNamedItemNS:function(i,e){for(var r=this.length;r--;){var n=this[r];if(n.localName==e&&n.namespaceURI==i)return n}return null}};function Zc(){}Zc.prototype={hasFeature:function(i,e){return!0},createDocument:function(i,e,r){var n=new Ba;if(n.implementation=this,n.childNodes=new Dn,n.doctype=r||null,r&&n.appendChild(r),e){var t=n.createElementNS(i,e);n.appendChild(t)}return n},createDocumentType:function(i,e,r){var n=new ao;return n.name=i,n.nodeName=i,n.publicId=e||"",n.systemId=r||"",n}};function gr(){}gr.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(i,e){return ed(this,i,e)},replaceChild:function(i,e){this.insertBefore(i,e),e&&this.removeChild(e)},removeChild:function(i){return qc(this,i)},appendChild:function(i){return this.insertBefore(i,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(i){return lu(this.ownerDocument||this,this,i)},normalize:function(){for(var i=this.firstChild;i;){var e=i.nextSibling;e&&e.nodeType==ro&&i.nodeType==ro?(this.removeChild(e),i.appendData(e.data)):(i.normalize(),i=e)}},isSupported:function(i,e){return this.ownerDocument.implementation.hasFeature(i,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(i){for(var e=this;e;){var r=e._nsMap;if(r){for(var n in r)if(r[n]==i)return n}e=e.nodeType==Ui?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(i){for(var e=this;e;){var r=e._nsMap;if(r&&i in r)return r[i];e=e.nodeType==Ui?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(i){var e=this.lookupPrefix(i);return e==null}};function Qc(i){return i=="<"&&"&lt;"||i==">"&&"&gt;"||i=="&"&&"&amp;"||i=='"'&&"&quot;"||"&#"+i.charCodeAt()+";"}ka(Lr,gr);ka(Lr,gr.prototype);function Na(i,e){if(e(i))return!0;if(i=i.firstChild)do if(Na(i,e))return!0;while(i=i.nextSibling)}function Ba(){}function yE(i,e,r){i&&i._inc++;var n=r.namespaceURI;n===Ma.XMLNS&&(e._nsMap[r.prefix?r.localName:""]=r.value)}function Jc(i,e,r,n){i&&i._inc++;var t=r.namespaceURI;t===Ma.XMLNS&&delete e._nsMap[r.prefix?r.localName:""]}function tu(i,e,r){if(i&&i._inc){i._inc++;var n=e.childNodes;if(r)n[n.length++]=r;else{for(var t=e.firstChild,a=0;t;)n[a++]=t,t=t.nextSibling;n.length=a}}}function qc(i,e){var r=e.previousSibling,n=e.nextSibling;return r?r.nextSibling=n:i.firstChild=n,n?n.previousSibling=r:i.lastChild=r,tu(i.ownerDocument,i),e}function ed(i,e,r){var n=e.parentNode;if(n&&n.removeChild(e),e.nodeType===Ln){var t=e.firstChild;if(t==null)return e;var a=e.lastChild}else t=a=e;var s=r?r.previousSibling:i.lastChild;t.previousSibling=s,a.nextSibling=r,s?s.nextSibling=t:i.firstChild=t,r==null?i.lastChild=a:r.previousSibling=a;do t.parentNode=i;while(t!==a&&(t=t.nextSibling));return tu(i.ownerDocument||i,i),e.nodeType==Ln&&(e.firstChild=e.lastChild=null),e}function EE(i,e){var r=e.parentNode;if(r){var n=i.lastChild;r.removeChild(e);var n=i.lastChild}var n=i.lastChild;return e.parentNode=i,e.previousSibling=n,e.nextSibling=null,n?n.nextSibling=e:i.firstChild=e,i.lastChild=e,tu(i.ownerDocument,i,e),e}Ba.prototype={nodeName:"#document",nodeType:Vc,doctype:null,documentElement:null,_inc:1,insertBefore:function(i,e){if(i.nodeType==Ln){for(var r=i.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,e),r=n}return i}return this.documentElement==null&&i.nodeType==rn&&(this.documentElement=i),ed(this,i,e),i.ownerDocument=this,i},removeChild:function(i){return this.documentElement==i&&(this.documentElement=null),qc(this,i)},importNode:function(i,e){return sd(this,i,e)},getElementById:function(i){var e=null;return Na(this.documentElement,function(r){if(r.nodeType==rn&&r.getAttribute("id")==i)return e=r,!0}),e},getElementsByClassName:function(i){var e=Uc(i);return new ji(this,function(r){var n=[];return e.length>0&&Na(r.documentElement,function(t){if(t!==r&&t.nodeType===rn){var a=t.getAttribute("class");if(a){var s=i===a;if(!s){var o=Uc(a);s=e.every(hE(o))}s&&n.push(t)}}}),n})},createElement:function(i){var e=new ui;e.ownerDocument=this,e.nodeName=i,e.tagName=i,e.localName=i,e.childNodes=new Dn;var r=e.attributes=new no;return r._ownerElement=e,e},createDocumentFragment:function(){var i=new so;return i.ownerDocument=this,i.childNodes=new Dn,i},createTextNode:function(i){var e=new ru;return e.ownerDocument=this,e.appendData(i),e},createComment:function(i){var e=new nu;return e.ownerDocument=this,e.appendData(i),e},createCDATASection:function(i){var e=new iu;return e.ownerDocument=this,e.appendData(i),e},createProcessingInstruction:function(i,e){var r=new su;return r.ownerDocument=this,r.tagName=r.target=i,r.nodeValue=r.data=e,r},createAttribute:function(i){var e=new io;return e.ownerDocument=this,e.name=i,e.nodeName=i,e.localName=i,e.specified=!0,e},createEntityReference:function(i){var e=new au;return e.ownerDocument=this,e.nodeName=i,e},createElementNS:function(i,e){var r=new ui,n=e.split(":"),t=r.attributes=new no;return r.childNodes=new Dn,r.ownerDocument=this,r.nodeName=e,r.tagName=e,r.namespaceURI=i,n.length==2?(r.prefix=n[0],r.localName=n[1]):r.localName=e,t._ownerElement=r,r},createAttributeNS:function(i,e){var r=new io,n=e.split(":");return r.ownerDocument=this,r.nodeName=e,r.name=e,r.namespaceURI=i,r.specified=!0,n.length==2?(r.prefix=n[0],r.localName=n[1]):r.localName=e,r}};wr(Ba,gr);function ui(){this._nsMap={}}ui.prototype={nodeType:rn,hasAttribute:function(i){return this.getAttributeNode(i)!=null},getAttribute:function(i){var e=this.getAttributeNode(i);return e&&e.value||""},getAttributeNode:function(i){return this.attributes.getNamedItem(i)},setAttribute:function(i,e){var r=this.ownerDocument.createAttribute(i);r.value=r.nodeValue=""+e,this.setAttributeNode(r)},removeAttribute:function(i){var e=this.getAttributeNode(i);e&&this.removeAttributeNode(e)},appendChild:function(i){return i.nodeType===Ln?this.insertBefore(i,null):EE(this,i)},setAttributeNode:function(i){return this.attributes.setNamedItem(i)},setAttributeNodeNS:function(i){return this.attributes.setNamedItemNS(i)},removeAttributeNode:function(i){return this.attributes.removeNamedItem(i.nodeName)},removeAttributeNS:function(i,e){var r=this.getAttributeNodeNS(i,e);r&&this.removeAttributeNode(r)},hasAttributeNS:function(i,e){return this.getAttributeNodeNS(i,e)!=null},getAttributeNS:function(i,e){var r=this.getAttributeNodeNS(i,e);return r&&r.value||""},setAttributeNS:function(i,e,r){var n=this.ownerDocument.createAttributeNS(i,e);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(i,e){return this.attributes.getNamedItemNS(i,e)},getElementsByTagName:function(i){return new ji(this,function(e){var r=[];return Na(e,function(n){n!==e&&n.nodeType==rn&&(i==="*"||n.tagName==i)&&r.push(n)}),r})},getElementsByTagNameNS:function(i,e){return new ji(this,function(r){var n=[];return Na(r,function(t){t!==r&&t.nodeType===rn&&(i==="*"||t.namespaceURI===i)&&(e==="*"||t.localName==e)&&n.push(t)}),n})}};Ba.prototype.getElementsByTagName=ui.prototype.getElementsByTagName;Ba.prototype.getElementsByTagNameNS=ui.prototype.getElementsByTagNameNS;wr(ui,gr);function io(){}io.prototype.nodeType=Ui;wr(io,gr);function Fa(){}Fa.prototype={data:"",substringData:function(i,e){return this.data.substring(i,i+e)},appendData:function(i){i=this.data+i,this.nodeValue=this.data=i,this.length=i.length},insertData:function(i,e){this.replaceData(i,0,e)},appendChild:function(i){throw new Error(rr[gE])},deleteData:function(i,e){this.replaceData(i,e,"")},replaceData:function(i,e,r){var n=this.data.substring(0,i),t=this.data.substring(i+e);r=n+r+t,this.nodeValue=this.data=r,this.length=r.length}};wr(Fa,gr);function ru(){}ru.prototype={nodeName:"#text",nodeType:ro,splitText:function(i){var e=this.data,r=e.substring(i);e=e.substring(0,i),this.data=this.nodeValue=e,this.length=e.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}};wr(ru,Fa);function nu(){}nu.prototype={nodeName:"#comment",nodeType:Kc};wr(nu,Fa);function iu(){}iu.prototype={nodeName:"#cdata-section",nodeType:jc};wr(iu,Fa);function ao(){}ao.prototype.nodeType=Gc;wr(ao,gr);function td(){}td.prototype.nodeType=vE;wr(td,gr);function rd(){}rd.prototype.nodeType=pE;wr(rd,gr);function au(){}au.prototype.nodeType=Wc;wr(au,gr);function so(){}so.prototype.nodeName="#document-fragment";so.prototype.nodeType=Ln;wr(so,gr);function su(){}su.prototype.nodeType=zc;wr(su,gr);function nd(){}nd.prototype.serializeToString=function(i,e,r){return id.call(i,e,r)};gr.prototype.toString=id;function id(i,e){var r=[],n=this.nodeType==9&&this.documentElement||this,t=n.prefix,a=n.namespaceURI;if(a&&t==null){var t=n.lookupPrefix(a);if(t==null)var s=[{namespace:a,prefix:null}]}return Wi(this,r,i,e,s),r.join("")}function ad(i,e,r){var n=i.prefix||"",t=i.namespaceURI;if(!t||n==="xml"&&t===Ma.XML||t===Ma.XMLNS)return!1;for(var a=r.length;a--;){var s=r[a];if(s.prefix===n)return s.namespace!==t}return!0}function ou(i,e,r){i.push(" ",e,'="',r.replace(/[<&"]/g,Qc),'"')}function Wi(i,e,r,n,t){if(t||(t=[]),n)if(i=n(i),i){if(typeof i=="string"){e.push(i);return}}else return;switch(i.nodeType){case rn:var a=i.attributes,s=a.length,o=i.firstChild,p=i.tagName;r=Ma.isHTML(i.namespaceURI)||r;var x=p;if(!r&&!i.prefix&&i.namespaceURI){for(var g,d=0;d<a.length;d++)if(a.item(d).name==="xmlns"){g=a.item(d).value;break}if(!g)for(var h=t.length-1;h>=0;h--){var y=t[h];if(y.prefix===""&&y.namespace===i.namespaceURI){g=y.namespace;break}}if(g!==i.namespaceURI)for(var h=t.length-1;h>=0;h--){var y=t[h];if(y.namespace===i.namespaceURI){y.prefix&&(x=y.prefix+":"+p);break}}}e.push("<",x);for(var b=0;b<s;b++){var T=a.item(b);T.prefix=="xmlns"?t.push({prefix:T.localName,namespace:T.value}):T.nodeName=="xmlns"&&t.push({prefix:"",namespace:T.value})}for(var b=0;b<s;b++){var T=a.item(b);if(ad(T,r,t)){var _=T.prefix||"",c=T.namespaceURI;ou(e,_?"xmlns:"+_:"xmlns",c),t.push({prefix:_,namespace:c})}Wi(T,e,r,n,t)}if(p===x&&ad(i,r,t)){var _=i.prefix||"",c=i.namespaceURI;ou(e,_?"xmlns:"+_:"xmlns",c),t.push({prefix:_,namespace:c})}if(o||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(p)){if(e.push(">"),r&&/^script$/i.test(p))for(;o;)o.data?e.push(o.data):Wi(o,e,r,n,t.slice()),o=o.nextSibling;else for(;o;)Wi(o,e,r,n,t.slice()),o=o.nextSibling;e.push("</",x,">")}else e.push("/>");return;case Vc:case Ln:for(var o=i.firstChild;o;)Wi(o,e,r,n,t.slice()),o=o.nextSibling;return;case Ui:return ou(e,i.name,i.value);case ro:return e.push(i.data.replace(/[<&]/g,Qc).replace(/]]>/g,"]]&gt;"));case jc:return e.push("<![CDATA[",i.data,"]]>");case Kc:return e.push("<!--",i.data,"-->");case Gc:var u=i.publicId,f=i.systemId;if(e.push("<!DOCTYPE ",i.name),u)e.push(" PUBLIC ",u),f&&f!="."&&e.push(" ",f),e.push(">");else if(f&&f!=".")e.push(" SYSTEM ",f,">");else{var v=i.internalSubset;v&&e.push(" [",v,"]"),e.push(">")}return;case zc:return e.push("<?",i.target," ",i.data,"?>");case Wc:return e.push("&",i.nodeName,";");default:e.push("??",i.nodeName)}}function sd(i,e,r){var n;switch(e.nodeType){case rn:n=e.cloneNode(!1),n.ownerDocument=i;case Ln:break;case Ui:r=!0;break}if(n||(n=e.cloneNode(!1)),n.ownerDocument=i,n.parentNode=null,r)for(var t=e.firstChild;t;)n.appendChild(sd(i,t,r)),t=t.nextSibling;return n}function lu(i,e,r){var n=new e.constructor;for(var t in e){var a=e[t];typeof a!="object"&&a!=n[t]&&(n[t]=a)}switch(e.childNodes&&(n.childNodes=new Dn),n.ownerDocument=i,n.nodeType){case rn:var s=e.attributes,o=n.attributes=new no,p=s.length;o._ownerElement=n;for(var x=0;x<p;x++)n.setAttributeNode(lu(i,s.item(x),!0));break;case Ui:r=!0}if(r)for(var g=e.firstChild;g;)n.appendChild(lu(i,g,r)),g=g.nextSibling;return n}function od(i,e,r){i[e]=r}try{if(Object.defineProperty){let i=function(e){switch(e.nodeType){case rn:case Ln:var r=[];for(e=e.firstChild;e;)e.nodeType!==7&&e.nodeType!==8&&r.push(i(e)),e=e.nextSibling;return r.join("");default:return e.nodeValue}};Object.defineProperty(ji.prototype,"length",{get:function(){return eu(this),this.$$length}}),Object.defineProperty(gr.prototype,"textContent",{get:function(){return i(this)},set:function(e){switch(this.nodeType){case rn:case Ln:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),od=function(e,r,n){e["$$"+r]=n}}}catch(i){}wn.DocumentType=ao;wn.DOMException=li;wn.DOMImplementation=Zc;wn.Element=ui;wn.Node=gr;wn.NodeList=Dn;wn.XMLSerializer=nd;var Ua={},ld={};(function(i){var e=oi.freeze;i.XML_ENTITIES=e({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),i.HTML_ENTITIES=e({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"\xC0",Aacute:"\xC1",Acirc:"\xC2",Atilde:"\xC3",Auml:"\xC4",Aring:"\xC5",AElig:"\xC6",Ccedil:"\xC7",Egrave:"\xC8",Eacute:"\xC9",Ecirc:"\xCA",Euml:"\xCB",Igrave:"\xCC",Iacute:"\xCD",Icirc:"\xCE",Iuml:"\xCF",ETH:"\xD0",Ntilde:"\xD1",Ograve:"\xD2",Oacute:"\xD3",Ocirc:"\xD4",Otilde:"\xD5",Ouml:"\xD6",Oslash:"\xD8",Ugrave:"\xD9",Uacute:"\xDA",Ucirc:"\xDB",Uuml:"\xDC",Yacute:"\xDD",THORN:"\xDE",szlig:"\xDF",agrave:"\xE0",aacute:"\xE1",acirc:"\xE2",atilde:"\xE3",auml:"\xE4",aring:"\xE5",aelig:"\xE6",ccedil:"\xE7",egrave:"\xE8",eacute:"\xE9",ecirc:"\xEA",euml:"\xEB",igrave:"\xEC",iacute:"\xED",icirc:"\xEE",iuml:"\xEF",eth:"\xF0",ntilde:"\xF1",ograve:"\xF2",oacute:"\xF3",ocirc:"\xF4",otilde:"\xF5",ouml:"\xF6",oslash:"\xF8",ugrave:"\xF9",uacute:"\xFA",ucirc:"\xFB",uuml:"\xFC",yacute:"\xFD",thorn:"\xFE",yuml:"\xFF",nbsp:"\xA0",iexcl:"\xA1",cent:"\xA2",pound:"\xA3",curren:"\xA4",yen:"\xA5",brvbar:"\xA6",sect:"\xA7",uml:"\xA8",copy:"\xA9",ordf:"\xAA",laquo:"\xAB",not:"\xAC",shy:"\xAD\xAD",reg:"\xAE",macr:"\xAF",deg:"\xB0",plusmn:"\xB1",sup2:"\xB2",sup3:"\xB3",acute:"\xB4",micro:"\xB5",para:"\xB6",middot:"\xB7",cedil:"\xB8",sup1:"\xB9",ordm:"\xBA",raquo:"\xBB",frac14:"\xBC",frac12:"\xBD",frac34:"\xBE",iquest:"\xBF",times:"\xD7",divide:"\xF7",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220B",prod:"\u220F",sum:"\u2211",minus:"\u2212",lowast:"\u2217",radic:"\u221A",prop:"\u221D",infin:"\u221E",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222A",int:"\u222B",there4:"\u2234",sim:"\u223C",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22A5",sdot:"\u22C5",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039A",Lambda:"\u039B",Mu:"\u039C",Nu:"\u039D",Xi:"\u039E",Omicron:"\u039F",Pi:"\u03A0",Rho:"\u03A1",Sigma:"\u03A3",Tau:"\u03A4",Upsilon:"\u03A5",Phi:"\u03A6",Chi:"\u03A7",Psi:"\u03A8",Omega:"\u03A9",alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u03B5",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",omicron:"\u03BF",pi:"\u03C0",rho:"\u03C1",sigmaf:"\u03C2",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",thetasym:"\u03D1",upsih:"\u03D2",piv:"\u03D6",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02C6",tilde:"\u02DC",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200C",zwj:"\u200D",lrm:"\u200E",rlm:"\u200F",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201A",ldquo:"\u201C",rdquo:"\u201D",bdquo:"\u201E",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203A",oline:"\u203E",euro:"\u20AC",trade:"\u2122",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",crarr:"\u21B5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230A",rfloor:"\u230B",loz:"\u25CA",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",diams:"\u2666"}),i.entityMap=i.HTML_ENTITIES})(ld);var uu={},ja=oi.NAMESPACE,fu=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,ud=new RegExp("[\\-\\.0-9"+fu.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),fd=new RegExp("^"+fu.source+ud.source+"*(?::"+fu.source+ud.source+"*)?$"),Wa=0,Gn=1,zi=2,za=3,Ki=4,Vi=5,Ka=6,oo=7;function Gi(i,e){this.message=i,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,Gi)}Gi.prototype=new Error;Gi.prototype.name=Gi.name;function cd(){}cd.prototype={parse:function(i,e,r){var n=this.domBuilder;n.startDocument(),pd(e,e={}),_E(i,e,r,n,this.errorHandler),n.endDocument()}};function _E(i,e,r,n,t){function a(C){if(C>65535){C-=65536;var M=55296+(C>>10),N=56320+(C&1023);return String.fromCharCode(M,N)}else return String.fromCharCode(C)}function s(C){var M=C.slice(1,-1);return M in r?r[M]:M.charAt(0)==="#"?a(parseInt(M.substr(1).replace("x","0x"))):(t.error("entity not found:"+C),C)}function o(C){if(C>T){var M=i.substring(T,C).replace(/&#?\w+;/g,s);h&&p(T),n.characters(M,0,C-T),T=C}}function p(C,M){for(;C>=g&&(M=d.exec(i));)x=M.index,g=x+M[0].length,h.lineNumber++;h.columnNumber=C-x+1}for(var x=0,g=0,d=/.*(?:\r\n?|\n)|.*$/g,h=n.locator,y=[{currentNSMap:e}],b={},T=0;;){try{var _=i.indexOf("<",T);if(_<0){if(!i.substr(T).match(/^\s*$/)){var c=n.doc,u=c.createTextNode(i.substr(T));c.appendChild(u),n.currentElement=u}return}switch(_>T&&o(_),i.charAt(_+1)){case"/":var f=i.indexOf(">",_+3),v=i.substring(_+2,f).replace(/[ \t\n\r]+$/g,""),l=y.pop();f<0?(v=i.substring(_+2).replace(/[\s<].*/,""),t.error("end tag name: "+v+" is not complete:"+l.tagName),f=_+1+v.length):v.match(/\s</)&&(v=v.replace(/[\s<].*/,""),t.error("end tag name: "+v+" maybe not complete"),f=_+1+v.length);var m=l.localNSMap,E=l.tagName==v,S=E||l.tagName&&l.tagName.toLowerCase()==v.toLowerCase();if(S){if(n.endElement(l.uri,l.localName,v),m)for(var O in m)n.endPrefixMapping(O);E||t.fatalError("end tag name: "+v+" is not match the current start tagName:"+l.tagName)}else y.push(l);f++;break;case"?":h&&p(_),f=OE(i,_,n);break;case"!":h&&p(_),f=TE(i,_,n,t);break;default:h&&p(_);var D=new vd,P=y[y.length-1].currentNSMap,f=xE(i,_,D,P,s,t),A=D.length;if(!D.closed&&SE(i,f,D.tagName,b)&&(D.closed=!0,r.nbsp||t.warning("unclosed xml attribute")),h&&A){for(var w=dd(h,{}),L=0;L<A;L++){var R=D[L];p(R.offset),R.locator=dd(h,{})}n.locator=w,hd(D,n,P)&&y.push(D),n.locator=h}else hd(D,n,P)&&y.push(D);ja.isHTML(D.uri)&&!D.closed?f=bE(i,f,D.tagName,s,n):f++}}catch(C){if(C instanceof Gi)throw C;t.error("element parse error: "+C),f=-1}f>T?T=f:o(Math.max(_,T)+1)}}function dd(i,e){return e.lineNumber=i.lineNumber,e.columnNumber=i.columnNumber,e}function xE(i,e,r,n,t,a){function s(h,y,b){r.attributeNames.hasOwnProperty(h)&&a.fatalError("Attribute "+h+" redefined"),r.addValue(h,y,b)}for(var o,p,x=++e,g=Wa;;){var d=i.charAt(x);switch(d){case"=":if(g===Gn)o=i.slice(e,x),g=za;else if(g===zi)g=za;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(g===za||g===Gn)if(g===Gn&&(a.warning('attribute value must after "="'),o=i.slice(e,x)),e=x+1,x=i.indexOf(d,e),x>0)p=i.slice(e,x).replace(/&#?\w+;/g,t),s(o,p,e-1),g=Vi;else throw new Error("attribute value no end '"+d+"' match");else if(g==Ki)p=i.slice(e,x).replace(/&#?\w+;/g,t),s(o,p,e),a.warning('attribute "'+o+'" missed start quot('+d+")!!"),e=x+1,g=Vi;else throw new Error('attribute value must after "="');break;case"/":switch(g){case Wa:r.setTagName(i.slice(e,x));case Vi:case Ka:case oo:g=oo,r.closed=!0;case Ki:case Gn:case zi:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),g==Wa&&r.setTagName(i.slice(e,x)),x;case">":switch(g){case Wa:r.setTagName(i.slice(e,x));case Vi:case Ka:case oo:break;case Ki:case Gn:p=i.slice(e,x),p.slice(-1)==="/"&&(r.closed=!0,p=p.slice(0,-1));case zi:g===zi&&(p=o),g==Ki?(a.warning('attribute "'+p+'" missed quot(")!'),s(o,p.replace(/&#?\w+;/g,t),e)):((!ja.isHTML(n[""])||!p.match(/^(?:disabled|checked|selected)$/i))&&a.warning('attribute "'+p+'" missed value!! "'+p+'" instead!!'),s(p,p,e));break;case za:throw new Error("attribute value missed!!")}return x;case"\x80":d=" ";default:if(d<=" ")switch(g){case Wa:r.setTagName(i.slice(e,x)),g=Ka;break;case Gn:o=i.slice(e,x),g=zi;break;case Ki:var p=i.slice(e,x).replace(/&#?\w+;/g,t);a.warning('attribute "'+p+'" missed quot(")!!'),s(o,p,e);case Vi:g=Ka;break}else switch(g){case zi:r.tagName,(!ja.isHTML(n[""])||!o.match(/^(?:disabled|checked|selected)$/i))&&a.warning('attribute "'+o+'" missed value!! "'+o+'" instead2!!'),s(o,o,e),e=x,g=Gn;break;case Vi:a.warning('attribute space is required"'+o+'"!!');case Ka:g=Gn,e=x;break;case za:g=Ki,e=x;break;case oo:throw new Error("elements closed character '/' and '>' must be connected to")}}x++}}function hd(i,e,r){for(var n=i.tagName,t=null,a=i.length;a--;){var s=i[a],o=s.qName,p=s.value,h=o.indexOf(":");if(h>0)var x=s.prefix=o.slice(0,h),g=o.slice(h+1),d=x==="xmlns"&&g;else g=o,x=null,d=o==="xmlns"&&"";s.localName=g,d!==!1&&(t==null&&(t={},pd(r,r={})),r[d]=t[d]=p,s.uri=ja.XMLNS,e.startPrefixMapping(d,p))}for(var a=i.length;a--;){s=i[a];var x=s.prefix;x&&(x==="xml"&&(s.uri=ja.XML),x!=="xmlns"&&(s.uri=r[x||""]))}var h=n.indexOf(":");h>0?(x=i.prefix=n.slice(0,h),g=i.localName=n.slice(h+1)):(x=null,g=i.localName=n);var y=i.uri=r[x||""];if(e.startElement(y,g,n,i),i.closed){if(e.endElement(y,g,n),t)for(x in t)e.endPrefixMapping(x)}else return i.currentNSMap=r,i.localNSMap=t,!0}function bE(i,e,r,n,t){if(/^(?:script|textarea)$/i.test(r)){var a=i.indexOf("</"+r+">",e),s=i.substring(e+1,a);if(/[&<]/.test(s))return/^script$/i.test(r)?(t.characters(s,0,s.length),a):(s=s.replace(/&#?\w+;/g,n),t.characters(s,0,s.length),a)}return e+1}function SE(i,e,r,n){var t=n[r];return t==null&&(t=i.lastIndexOf("</"+r+">"),t<e&&(t=i.lastIndexOf("</"+r)),n[r]=t),t<e}function pd(i,e){for(var r in i)e[r]=i[r]}function TE(i,e,r,n){var t=i.charAt(e+2);switch(t){case"-":if(i.charAt(e+3)==="-"){var a=i.indexOf("-->",e+4);return a>e?(r.comment(i,e+4,a-e-4),a+3):(n.error("Unclosed comment"),-1)}else return-1;default:if(i.substr(e+3,6)=="CDATA["){var a=i.indexOf("]]>",e+9);return r.startCDATA(),r.characters(i,e+9,a-e-9),r.endCDATA(),a+3}var s=AE(i,e),o=s.length;if(o>1&&/!doctype/i.test(s[0][0])){var p=s[1][0],x=!1,g=!1;o>3&&(/^public$/i.test(s[2][0])?(x=s[3][0],g=o>4&&s[4][0]):/^system$/i.test(s[2][0])&&(g=s[3][0]));var d=s[o-1];return r.startDTD(p,x,g),r.endDTD(),d.index+d[0].length}}return-1}function OE(i,e,r){var n=i.indexOf("?>",e);if(n){var t=i.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return t?(t[0].length,r.processingInstruction(t[1],t[2]),n+2):-1}return-1}function vd(){this.attributeNames={}}vd.prototype={setTagName:function(i){if(!fd.test(i))throw new Error("invalid tagName:"+i);this.tagName=i},addValue:function(i,e,r){if(!fd.test(i))throw new Error("invalid attribute:"+i);this.attributeNames[i]=this.length,this[this.length++]={qName:i,value:e,offset:r}},length:0,getLocalName:function(i){return this[i].localName},getLocator:function(i){return this[i].locator},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}};function AE(i,e){var r,n=[],t=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(t.lastIndex=e,t.exec(i);r=t.exec(i);)if(n.push(r),r[1])return n}uu.XMLReader=cd;uu.ParseError=Gi;var wE=oi,cu=wn,gd=ld,md=uu,LE=cu.DOMImplementation,yd=wE.NAMESPACE,DE=md.ParseError,PE=md.XMLReader;function Ed(i){this.options=i||{locator:{}}}Ed.prototype.parseFromString=function(i,e){var r=this.options,n=new PE,t=r.domBuilder||new Va,a=r.errorHandler,s=r.locator,o=r.xmlns||{},p=/\/x?html?$/.test(e),x=p?gd.HTML_ENTITIES:gd.XML_ENTITIES;return s&&t.setDocumentLocator(s),n.errorHandler=RE(a,t,s),n.domBuilder=r.domBuilder||t,p&&(o[""]=yd.HTML),o.xml=o.xml||yd.XML,i&&typeof i=="string"?n.parse(i,o,x):n.errorHandler.error("invalid doc source"),t.doc};function RE(i,e,r){if(!i){if(e instanceof Va)return e;i=e}var n={},t=i instanceof Function;r=r||{};function a(s){var o=i[s];!o&&t&&(o=i.length==2?function(p){i(s,p)}:i),n[s]=o&&function(p){o("[xmldom "+s+"]	"+p+du(r))}||function(){}}return a("warning"),a("error"),a("fatalError"),n}function Va(){this.cdata=!1}function Hi(i,e){e.lineNumber=i.lineNumber,e.columnNumber=i.columnNumber}Va.prototype={startDocument:function(){this.doc=new LE().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(i,e,r,n){var t=this.doc,a=t.createElementNS(i,r||e),s=n.length;lo(this,a),this.currentElement=a,this.locator&&Hi(this.locator,a);for(var o=0;o<s;o++){var i=n.getURI(o),p=n.getValue(o),r=n.getQName(o),x=t.createAttributeNS(i,r);this.locator&&Hi(n.getLocator(o),x),x.value=x.nodeValue=p,a.setAttributeNode(x)}},endElement:function(i,e,r){var n=this.currentElement;n.tagName,this.currentElement=n.parentNode},startPrefixMapping:function(i,e){},endPrefixMapping:function(i){},processingInstruction:function(i,e){var r=this.doc.createProcessingInstruction(i,e);this.locator&&Hi(this.locator,r),lo(this,r)},ignorableWhitespace:function(i,e,r){},characters:function(i,e,r){if(i=_d.apply(this,arguments),i){if(this.cdata)var n=this.doc.createCDATASection(i);else var n=this.doc.createTextNode(i);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(i)&&this.doc.appendChild(n),this.locator&&Hi(this.locator,n)}},skippedEntity:function(i){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(i){(this.locator=i)&&(i.lineNumber=0)},comment:function(i,e,r){i=_d.apply(this,arguments);var n=this.doc.createComment(i);this.locator&&Hi(this.locator,n),lo(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(i,e,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var t=n.createDocumentType(i,e,r);this.locator&&Hi(this.locator,t),lo(this,t),this.doc.doctype=t}},warning:function(i){console.warn("[xmldom warning]	"+i,du(this.locator))},error:function(i){console.error("[xmldom error]	"+i,du(this.locator))},fatalError:function(i){throw new DE(i,this.locator)}};function du(i){if(i)return`
@`+(i.systemId||"")+"#[line:"+i.lineNumber+",col:"+i.columnNumber+"]"}function _d(i,e,r){return typeof i=="string"?i.substr(e,r):i.length>=e+r||e?new java.lang.String(i,e,r)+"":i}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(i){Va.prototype[i]=function(){return null}});function lo(i,e){i.currentElement?i.currentElement.appendChild(e):i.doc.appendChild(e)}Ua.__DOMHandler=Va;Ua.DOMParser=Ed;Ua.DOMImplementation=cu.DOMImplementation;Ua.XMLSerializer=cu.XMLSerializer;var xd=wn;Ia.DOMImplementation=xd.DOMImplementation;Ia.XMLSerializer=xd.XMLSerializer;Ia.DOMParser=Ua.DOMParser;Object.defineProperty(nt,"__esModule",{value:!0});nt.RangeObject=void 0;nt.blob2base64=i_;nt.borders=VE;nt.bounds=KE;nt.createBase64Url=JE;nt.createBlob=Od;nt.createBlobUrl=ZE;nt.defaults=jE;nt.defer=a_;nt.documentHeight=NE;nt.extend=WE;nt.filterChildren=l_;nt.findChildren=o_;nt.getParentByTagName=u_;nt.indexOfElementNode=YE;nt.indexOfNode=pu;nt.indexOfSorted=hu;nt.indexOfTextNode=$E;nt.insert=zE;nt.isElement=BE;nt.isFloat=FE;nt.isNumber=Td;nt.isXml=XE;nt.locationOf=uo;nt.nodeBounds=GE;nt.parents=gu;nt.parse=e_;nt.prefixed=UE;nt.qs=t_;nt.qsa=Ad;nt.qsp=r_;nt.querySelectorByType=s_;nt.requestAnimationFrame=void 0;nt.revokeBlobUrl=QE;nt.sprint=n_;nt.treeWalker=wd;nt.type=qE;nt.uuid=Sd;nt.walk=vu;nt.windowBounds=HE;var CE=Ia;const IE=typeof window!="undefined"?window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame:!1;nt.requestAnimationFrame=IE;const ME=1,kE=3,bd=typeof URL!="undefined"?URL:typeof window!="undefined"?window.URL||window.webkitURL||window.mozURL:void 0;function Sd(){var i=new Date().getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var n=(i+Math.random()*16)%16|0;return i=Math.floor(i/16),(r=="x"?n:n&7|8).toString(16)});return e}function NE(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)}function BE(i){return!!(i&&i.nodeType==1)}function Td(i){return!isNaN(parseFloat(i))&&isFinite(i)}function FE(i){let e=parseFloat(i);return Td(i)===!1?!1:typeof i=="string"&&i.indexOf(".")>-1?!0:Math.floor(e)!==e}function UE(i){var e=["Webkit","webkit","Moz","O","ms"],r=["-webkit-","-webkit-","-moz-","-o-","-ms-"],n=i.toLowerCase(),t=e.length;if(typeof document=="undefined"||typeof document.body.style[n]!="undefined")return i;for(var a=0;a<t;a++)if(typeof document.body.style[r[a]+n]!="undefined")return r[a]+n;return i}function jE(i){for(var e=1,r=arguments.length;e<r;e++){var n=arguments[e];for(var t in n)i[t]===void 0&&(i[t]=n[t])}return i}function WE(i){var e=[].slice.call(arguments,1);return e.forEach(function(r){!r||Object.getOwnPropertyNames(r).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(r,n))})}),i}function zE(i,e,r){var n=uo(i,e,r);return e.splice(n,0,i),n}function uo(i,e,r,n,t){var a=n||0,s=t||e.length,o=parseInt(a+(s-a)/2),p;return r||(r=function(x,g){if(x>g)return 1;if(x<g)return-1;if(x==g)return 0}),s-a<=0?o:(p=r(e[o],i),s-a==1?p>=0?o:o+1:p===0?o:p===-1?uo(i,e,r,o,s):uo(i,e,r,a,o))}function hu(i,e,r,n,t){var a=n||0,s=t||e.length,o=parseInt(a+(s-a)/2),p;return r||(r=function(x,g){if(x>g)return 1;if(x<g)return-1;if(x==g)return 0}),s-a<=0?-1:(p=r(e[o],i),s-a==1?p===0?o:-1:p===0?o:p===-1?hu(i,e,r,o,s):hu(i,e,r,a,o))}function KE(i){var e=window.getComputedStyle(i),r=["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],n=["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],t=0,a=0;return r.forEach(function(s){t+=parseFloat(e[s])||0}),n.forEach(function(s){a+=parseFloat(e[s])||0}),{height:a,width:t}}function VE(i){var e=window.getComputedStyle(i),r=["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],n=["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],t=0,a=0;return r.forEach(function(s){t+=parseFloat(e[s])||0}),n.forEach(function(s){a+=parseFloat(e[s])||0}),{height:a,width:t}}function GE(i){let e,r=i.ownerDocument;if(i.nodeType==Node.TEXT_NODE){let n=r.createRange();n.selectNodeContents(i),e=n.getBoundingClientRect()}else e=i.getBoundingClientRect();return e}function HE(){var i=window.innerWidth,e=window.innerHeight;return{top:0,left:0,right:i,bottom:e,width:i,height:e}}function pu(i,e){for(var r=i.parentNode,n=r.childNodes,t,a=-1,s=0;s<n.length&&(t=n[s],t.nodeType===e&&a++,t!=i);s++);return a}function $E(i){return pu(i,kE)}function YE(i){return pu(i,ME)}function XE(i){return["xml","opf","ncx"].indexOf(i)>-1}function Od(i,e){return new Blob([i],{type:e})}function ZE(i,e){var r,n=Od(i,e);return r=bd.createObjectURL(n),r}function QE(i){return bd.revokeObjectURL(i)}function JE(i,e){var r,n;if(typeof i=="string")return r=btoa(i),n="data:"+e+";base64,"+r,n}function qE(i){return Object.prototype.toString.call(i).slice(8,-1)}function e_(i,e,r){var n,t;return typeof DOMParser=="undefined"||r?t=CE.DOMParser:t=DOMParser,i.charCodeAt(0)===65279&&(i=i.slice(1)),n=new t().parseFromString(i,e),n}function t_(i,e){var r;if(!i)throw new Error("No Element Provided");if(typeof i.querySelector!="undefined")return i.querySelector(e);if(r=i.getElementsByTagName(e),r.length)return r[0]}function Ad(i,e){return typeof i.querySelector!="undefined"?i.querySelectorAll(e):i.getElementsByTagName(e)}function r_(i,e,r){var n,t;if(typeof i.querySelector!="undefined"){e+="[";for(var a in r)e+=a+"~='"+r[a]+"'";return e+="]",i.querySelector(e)}else if(n=i.getElementsByTagName(e),t=Array.prototype.slice.call(n,0).filter(function(s){for(var o in r)if(s.getAttribute(o)===r[o])return!0;return!1}),t)return t[0]}function n_(i,e){var r=i.ownerDocument||i;typeof r.createTreeWalker!="undefined"?wd(i,e,NodeFilter.SHOW_TEXT):vu(i,function(n){n&&n.nodeType===3&&e(n)})}function wd(i,e,r){var n=document.createTreeWalker(i,r,null,!1);let t;for(;t=n.nextNode();)e(t)}function vu(i,e){if(e(i))return!0;if(i=i.firstChild,i)do{if(vu(i,e))return!0;i=i.nextSibling}while(i)}function i_(i){return new Promise(function(e,r){var n=new FileReader;n.readAsDataURL(i),n.onloadend=function(){e(n.result)}})}function a_(){this.resolve=null,this.reject=null,this.id=Sd(),this.promise=new Promise((i,e)=>{this.resolve=i,this.reject=e}),Object.freeze(this)}function s_(i,e,r){var n;if(typeof i.querySelector!="undefined"&&(n=i.querySelector(`${e}[*|type="${r}"]`)),!n||n.length===0){n=Ad(i,e);for(var t=0;t<n.length;t++)if(n[t].getAttributeNS("http://www.idpf.org/2007/ops","type")===r||n[t].getAttribute("epub:type")===r)return n[t]}else return n}function o_(i){for(var e=[],r=i.childNodes,n=0;n<r.length;n++){let t=r[n];t.nodeType===1&&e.push(t)}return e}function gu(i){for(var e=[i];i;i=i.parentNode)e.unshift(i);return e}function l_(i,e,r){for(var n=[],t=i.childNodes,a=0;a<t.length;a++){let s=t[a];if(s.nodeType===1&&s.nodeName.toLowerCase()===e){if(r)return s;n.push(s)}}if(!r)return n}function u_(i,e){let r;if(!(i===null||e===""))for(r=i.parentNode;r.nodeType===1;){if(r.tagName.toLowerCase()===e)return r;r=r.parentNode}}class f_{constructor(){this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}setStart(e,r){this.startContainer=e,this.startOffset=r,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}setEnd(e,r){this.endContainer=e,this.endOffset=r,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}collapse(e){this.collapsed=!0,e?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}selectNode(e){let r=e.parentNode,n=Array.prototype.indexOf.call(r.childNodes,e);this.setStart(r,n),this.setEnd(r,n+1)}selectNodeContents(e){e.childNodes[e.childNodes-1];let r=e.nodeType===3?e.textContent.length:parent.childNodes.length;this.setStart(e,0),this.setEnd(e,r)}_commonAncestorContainer(e,r){var n=gu(e||this.startContainer),t=gu(r||this.endContainer);if(n[0]==t[0]){for(var a=0;a<n.length;a++)if(n[a]!=t[a])return n[a-1]}}_checkCollapsed(){this.startContainer===this.endContainer&&this.startOffset===this.endOffset?this.collapsed=!0:this.collapsed=!1}toString(){}}nt.RangeObject=f_;var fi={},gn={};if(!Ld)var Ld={cwd:function(){return"/"}};function mn(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+i)}function Dd(i,e){for(var r="",n=-1,t=0,a,s=0;s<=i.length;++s){if(s<i.length)a=i.charCodeAt(s);else{if(a===47)break;a=47}if(a===47){if(!(n===s-1||t===1))if(n!==s-1&&t===2){if(r.length<2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){for(var o=r.length-1,p=o;p>=0&&r.charCodeAt(p)!==47;--p);if(p!==o){p===-1?r="":r=r.slice(0,p),n=s,t=0;continue}}else if(r.length===2||r.length===1){r="",n=s,t=0;continue}}e&&(r.length>0?r+="/..":r="..")}else r.length>0?r+="/"+i.slice(n+1,s):r=i.slice(n+1,s);n=s,t=0}else a===46&&t!==-1?++t:t=-1}return r}function c_(i,e){var r=e.dir||e.root,n=e.base||(e.name||"")+(e.ext||"");return r?r===e.root?r+n:r+i+n:n}var fo={resolve:function(){for(var e="",r=!1,n,t=arguments.length-1;t>=-1&&!r;t--){var a;t>=0?a=arguments[t]:(n===void 0&&(n=Ld.cwd()),a=n),mn(a),a.length!==0&&(e=a+"/"+e,r=a.charCodeAt(0)===47)}return e=Dd(e,!r),r?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(mn(e),e.length===0)return".";var r=e.charCodeAt(0)===47,n=e.charCodeAt(e.length-1)===47;return e=Dd(e,!r),e.length===0&&!r&&(e="."),e.length>0&&n&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return mn(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,r=0;r<arguments.length;++r){var n=arguments[r];mn(n),n.length>0&&(e===void 0?e=n:e+="/"+n)}return e===void 0?".":fo.normalize(e)},relative:function(e,r){if(mn(e),mn(r),e===r||(e=fo.resolve(e),r=fo.resolve(r),e===r))return"";for(var n=1;n<e.length&&e.charCodeAt(n)===47;++n);for(var t=e.length,a=t-n,s=1;s<r.length&&r.charCodeAt(s)===47;++s);for(var o=r.length,p=o-s,x=a<p?a:p,g=-1,d=0;d<=x;++d){if(d===x){if(p>x){if(r.charCodeAt(s+d)===47)return r.slice(s+d+1);if(d===0)return r.slice(s+d)}else a>x&&(e.charCodeAt(n+d)===47?g=d:d===0&&(g=0));break}var h=e.charCodeAt(n+d),y=r.charCodeAt(s+d);if(h!==y)break;h===47&&(g=d)}var b="";for(d=n+g+1;d<=t;++d)(d===t||e.charCodeAt(d)===47)&&(b.length===0?b+="..":b+="/..");return b.length>0?b+r.slice(s+g):(s+=g,r.charCodeAt(s)===47&&++s,r.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(mn(e),e.length===0)return".";for(var r=e.charCodeAt(0),n=r===47,t=-1,a=!0,s=e.length-1;s>=1;--s)if(r=e.charCodeAt(s),r===47){if(!a){t=s;break}}else a=!1;return t===-1?n?"/":".":n&&t===1?"//":e.slice(0,t)},basename:function(e,r){if(r!==void 0&&typeof r!="string")throw new TypeError('"ext" argument must be a string');mn(e);var n=0,t=-1,a=!0,s;if(r!==void 0&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var o=r.length-1,p=-1;for(s=e.length-1;s>=0;--s){var x=e.charCodeAt(s);if(x===47){if(!a){n=s+1;break}}else p===-1&&(a=!1,p=s+1),o>=0&&(x===r.charCodeAt(o)?--o==-1&&(t=s):(o=-1,t=p))}return n===t?t=p:t===-1&&(t=e.length),e.slice(n,t)}else{for(s=e.length-1;s>=0;--s)if(e.charCodeAt(s)===47){if(!a){n=s+1;break}}else t===-1&&(a=!1,t=s+1);return t===-1?"":e.slice(n,t)}},extname:function(e){mn(e);for(var r=-1,n=0,t=-1,a=!0,s=0,o=e.length-1;o>=0;--o){var p=e.charCodeAt(o);if(p===47){if(!a){n=o+1;break}continue}t===-1&&(a=!1,t=o+1),p===46?r===-1?r=o:s!==1&&(s=1):r!==-1&&(s=-1)}return r===-1||t===-1||s===0||s===1&&r===t-1&&r===n+1?"":e.slice(r,t)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('Parameter "pathObject" must be an object, not '+typeof e);return c_("/",e)},parse:function(e){mn(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return r;var n=e.charCodeAt(0),t=n===47,a;t?(r.root="/",a=1):a=0;for(var s=-1,o=0,p=-1,x=!0,g=e.length-1,d=0;g>=a;--g){if(n=e.charCodeAt(g),n===47){if(!x){o=g+1;break}continue}p===-1&&(x=!1,p=g+1),n===46?s===-1?s=g:d!==1&&(d=1):s!==-1&&(d=-1)}return s===-1||p===-1||d===0||d===1&&s===p-1&&s===o+1?p!==-1&&(o===0&&t?r.base=r.name=e.slice(1,p):r.base=r.name=e.slice(o,p)):(o===0&&t?(r.name=e.slice(1,s),r.base=e.slice(1,p)):(r.name=e.slice(o,s),r.base=e.slice(o,p)),r.ext=e.slice(s,p)),o>0?r.dir=e.slice(0,o-1):t&&(r.dir="/"),r},sep:"/",delimiter:":",posix:null},co=fo;Object.defineProperty(gn,"__esModule",{value:!0});gn.default=void 0;var ho=d_(co);function d_(i){return i&&i.__esModule?i:{default:i}}class h_{constructor(e){var r,n;r=e.indexOf("://"),r>-1&&(e=new URL(e).pathname),n=this.parse(e),this.path=e,this.isDirectory(e)?this.directory=e:this.directory=n.dir+"/",this.filename=n.base,this.extension=n.ext.slice(1)}parse(e){return ho.default.parse(e)}isAbsolute(e){return ho.default.isAbsolute(e||this.path)}isDirectory(e){return e.charAt(e.length-1)==="/"}resolve(e){return ho.default.resolve(this.directory,e)}relative(e){var r=e&&e.indexOf("://")>-1;return r?e:ho.default.relative(this.directory,e)}splitPath(e){return this.splitPathRe.exec(e).slice(1)}toString(){return this.path}}var p_=h_;gn.default=p_;Object.defineProperty(fi,"__esModule",{value:!0});fi.default=void 0;var Pd=Cd(gn),Rd=Cd(co);function Cd(i){return i&&i.__esModule?i:{default:i}}class v_{constructor(e,r){var n=e.indexOf("://")>-1,t=e,a;if(this.Url=void 0,this.href=e,this.protocol="",this.origin="",this.hash="",this.hash="",this.search="",this.base=r,!n&&r!==!1&&typeof r!="string"&&window&&window.location&&(this.base=window.location.href),n||this.base)try{this.base?this.Url=new URL(e,this.base):this.Url=new URL(e),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,t=this.Url.pathname+(this.Url.search?this.Url.search:"")}catch(s){this.Url=void 0,this.base&&(a=new Pd.default(this.base),t=a.resolve(t))}this.Path=new Pd.default(t),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}path(){return this.Path}resolve(e){var r=e.indexOf("://")>-1,n;return r?e:(n=Rd.default.resolve(this.directory,e),this.origin+n)}relative(e){return Rd.default.relative(e,this.directory)}toString(){return this.href}}var g_=v_;fi.default=g_;var po={},xr={};Object.defineProperty(xr,"__esModule",{value:!0});xr.default=void 0;var Hn=nt;const $i=1,$r=3,m_=9;class ci{constructor(e,r,n){var t;if(this.str="",this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof ci))return new ci(e,r,n);if(typeof r=="string"?this.base=this.parseComponent(r):typeof r=="object"&&r.steps&&(this.base=r),t=this.checkType(e),t==="string")return this.str=e,(0,Hn.extend)(this,this.parse(e));if(t==="range")return(0,Hn.extend)(this,this.fromRange(e,this.base,n));if(t==="node")return(0,Hn.extend)(this,this.fromNode(e,this.base,n));if(t==="EpubCFI"&&e.path)return e;if(e)throw new TypeError("not a valid argument for EpubCFI");return this}checkType(e){return this.isCfiString(e)?"string":e&&typeof e=="object"&&((0,Hn.type)(e)==="Range"||typeof e.startContainer!="undefined")?"range":e&&typeof e=="object"&&typeof e.nodeType!="undefined"?"node":e&&typeof e=="object"&&e instanceof ci?"EpubCFI":!1}parse(e){var r={spinePos:-1,range:!1,base:{},path:{},start:null,end:null},n,t,a;return typeof e!="string"?{spinePos:-1}:(e.indexOf("epubcfi(")===0&&e[e.length-1]===")"&&(e=e.slice(8,e.length-1)),n=this.getChapterComponent(e),n?(r.base=this.parseComponent(n),t=this.getPathComponent(e),r.path=this.parseComponent(t),a=this.getRange(e),a&&(r.range=!0,r.start=this.parseComponent(a[0]),r.end=this.parseComponent(a[1])),r.spinePos=r.base.steps[1].index,r):{spinePos:-1})}parseComponent(e){var r={steps:[],terminal:{offset:null,assertion:null}},n=e.split(":"),t=n[0].split("/"),a;return n.length>1&&(a=n[1],r.terminal=this.parseTerminal(a)),t[0]===""&&t.shift(),r.steps=t.map(function(s){return this.parseStep(s)}.bind(this)),r}parseStep(e){var r,n,t,a,s;if(a=e.match(/\[(.*)\]/),a&&a[1]&&(s=a[1]),n=parseInt(e),!isNaN(n))return n%2==0?(r="element",t=n/2-1):(r="text",t=(n-1)/2),{type:r,index:t,id:s||null}}parseTerminal(e){var r,n,t=e.match(/\[(.*)\]/);return t&&t[1]?(r=parseInt(e.split("[")[0]),n=t[1]):r=parseInt(e),(0,Hn.isNumber)(r)||(r=null),{offset:r,assertion:n}}getChapterComponent(e){var r=e.split("!");return r[0]}getPathComponent(e){var r=e.split("!");if(r[1])return r[1].split(",")[0]}getRange(e){var r=e.split(",");return r.length===3?[r[1],r[2]]:!1}getCharecterOffsetComponent(e){var r=e.split(":");return r[1]||""}joinSteps(e){return e?e.map(function(r){var n="";return r.type==="element"&&(n+=(r.index+1)*2),r.type==="text"&&(n+=1+2*r.index),r.id&&(n+="["+r.id+"]"),n}).join("/"):""}segmentString(e){var r="/";return r+=this.joinSteps(e.steps),e.terminal&&e.terminal.offset!=null&&(r+=":"+e.terminal.offset),e.terminal&&e.terminal.assertion!=null&&(r+="["+e.terminal.assertion+"]"),r}toString(){var e="epubcfi(";return e+=this.segmentString(this.base),e+="!",e+=this.segmentString(this.path),this.range&&this.start&&(e+=",",e+=this.segmentString(this.start)),this.range&&this.end&&(e+=",",e+=this.segmentString(this.end)),e+=")",e}compare(e,r){var n,t,a,s;if(typeof e=="string"&&(e=new ci(e)),typeof r=="string"&&(r=new ci(r)),e.spinePos>r.spinePos)return 1;if(e.spinePos<r.spinePos)return-1;e.range?(n=e.path.steps.concat(e.start.steps),a=e.start.terminal):(n=e.path.steps,a=e.path.terminal),r.range?(t=r.path.steps.concat(r.start.steps),s=r.start.terminal):(t=r.path.steps,s=r.path.terminal);for(var o=0;o<n.length;o++){if(!n[o])return-1;if(!t[o]||n[o].index>t[o].index)return 1;if(n[o].index<t[o].index)return-1}return n.length<t.length?-1:a.offset>s.offset?1:a.offset<s.offset?-1:0}step(e){var r=e.nodeType===$r?"text":"element";return{id:e.id,tagName:e.tagName,type:r,index:this.position(e)}}filteredStep(e,r){var n=this.filter(e,r),t;if(!!n)return t=n.nodeType===$r?"text":"element",{id:n.id,tagName:n.tagName,type:t,index:this.filteredPosition(n,r)}}pathTo(e,r,n){for(var t={steps:[],terminal:{offset:null,assertion:null}},a=e,s;a&&a.parentNode&&a.parentNode.nodeType!=m_;)n?s=this.filteredStep(a,n):s=this.step(a),s&&t.steps.unshift(s),a=a.parentNode;return r!=null&&r>=0&&(t.terminal.offset=r,t.steps[t.steps.length-1].type!="text"&&t.steps.push({type:"text",index:0})),t}equalStep(e,r){return!e||!r?!1:e.index===r.index&&e.id===r.id&&e.type===r.type}fromRange(e,r,n){var t={range:!1,base:{},path:{},start:null,end:null},a=e.startContainer,s=e.endContainer,o=e.startOffset,p=e.endOffset,x=!1;if(n&&(x=a.ownerDocument.querySelector("."+n)!=null),typeof r=="string"?(t.base=this.parseComponent(r),t.spinePos=t.base.steps[1].index):typeof r=="object"&&(t.base=r),e.collapsed)x&&(o=this.patchOffset(a,o,n)),t.path=this.pathTo(a,o,n);else{t.range=!0,x&&(o=this.patchOffset(a,o,n)),t.start=this.pathTo(a,o,n),x&&(p=this.patchOffset(s,p,n)),t.end=this.pathTo(s,p,n),t.path={steps:[],terminal:null};var g=t.start.steps.length,d;for(d=0;d<g&&this.equalStep(t.start.steps[d],t.end.steps[d]);d++)d===g-1?t.start.terminal===t.end.terminal&&(t.path.steps.push(t.start.steps[d]),t.range=!1):t.path.steps.push(t.start.steps[d]);t.start.steps=t.start.steps.slice(t.path.steps.length),t.end.steps=t.end.steps.slice(t.path.steps.length)}return t}fromNode(e,r,n){var t={range:!1,base:{},path:{},start:null,end:null};return typeof r=="string"?(t.base=this.parseComponent(r),t.spinePos=t.base.steps[1].index):typeof r=="object"&&(t.base=r),t.path=this.pathTo(e,null,n),t}filter(e,r){var n,t,a,s,o,p=!1;return e.nodeType===$r?(p=!0,a=e.parentNode,n=e.parentNode.classList.contains(r)):(p=!1,n=e.classList.contains(r)),n&&p?(s=a.previousSibling,o=a.nextSibling,s&&s.nodeType===$r?t=s:o&&o.nodeType===$r&&(t=o),t||e):n&&!p?!1:e}patchOffset(e,r,n){if(e.nodeType!=$r)throw new Error("Anchor must be a text node");var t=e,a=r;for(e.parentNode.classList.contains(n)&&(t=e.parentNode);t.previousSibling;){if(t.previousSibling.nodeType===$i)if(t.previousSibling.classList.contains(n))a+=t.previousSibling.textContent.length;else break;else a+=t.previousSibling.textContent.length;t=t.previousSibling}return a}normalizedMap(e,r,n){var t={},a=-1,s,o=e.length,p,x;for(s=0;s<o;s++)p=e[s].nodeType,p===$i&&e[s].classList.contains(n)&&(p=$r),s>0&&p===$r&&x===$r?t[s]=a:r===p&&(a=a+1,t[s]=a),x=p;return t}position(e){var r,n;return e.nodeType===$i?(r=e.parentNode.children,r||(r=(0,Hn.findChildren)(e.parentNode)),n=Array.prototype.indexOf.call(r,e)):(r=this.textNodes(e.parentNode),n=r.indexOf(e)),n}filteredPosition(e,r){var n,t,a;return e.nodeType===$i?(n=e.parentNode.children,a=this.normalizedMap(n,$i,r)):(n=e.parentNode.childNodes,e.parentNode.classList.contains(r)&&(e=e.parentNode,n=e.parentNode.childNodes),a=this.normalizedMap(n,$r,r)),t=Array.prototype.indexOf.call(n,e),a[t]}stepsToXpath(e){var r=[".","*"];return e.forEach(function(n){var t=n.index+1;n.id?r.push("*[position()="+t+" and @id='"+n.id+"']"):n.type==="text"?r.push("text()["+t+"]"):r.push("*["+t+"]")}),r.join("/")}stepsToQuerySelector(e){var r=["html"];return e.forEach(function(n){var t=n.index+1;n.id?r.push("#"+n.id):n.type==="text"||r.push("*:nth-child("+t+")")}),r.join(">")}textNodes(e,r){return Array.prototype.slice.call(e.childNodes).filter(function(n){return n.nodeType===$r?!0:!!(r&&n.classList.contains(r))})}walkToNode(e,r,n){var t=r||document,a=t.documentElement,s,o,p=e.length,x;for(x=0;x<p&&(o=e[x],o.type==="element"?o.id?a=t.getElementById(o.id):(s=a.children||(0,Hn.findChildren)(a),a=s[o.index]):o.type==="text"&&(a=this.textNodes(a,n)[o.index]),!!a);x++);return a}findNode(e,r,n){var t=r||document,a,s;return!n&&typeof t.evaluate!="undefined"?(s=this.stepsToXpath(e),a=t.evaluate(s,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue):n?a=this.walkToNode(e,t,n):a=this.walkToNode(e,t),a}fixMiss(e,r,n,t){var a=this.findNode(e.slice(0,-1),n,t),s=a.childNodes,o=this.normalizedMap(s,$r,t),p,x,g=e[e.length-1].index;for(let d in o){if(!o.hasOwnProperty(d))return;if(o[d]===g)if(p=s[d],x=p.textContent.length,r>x)r=r-x;else{p.nodeType===$i?a=p.childNodes[0]:a=p;break}}return{container:a,offset:r}}toRange(e,r){var n=e||document,t,a,s,o,p,x=this,g,d,h=r?n.querySelector("."+r)!=null:!1,y;if(typeof n.createRange!="undefined"?t=n.createRange():t=new Hn.RangeObject,x.range?(a=x.start,g=x.path.steps.concat(a.steps),o=this.findNode(g,n,h?r:null),s=x.end,d=x.path.steps.concat(s.steps),p=this.findNode(d,n,h?r:null)):(a=x.path,g=x.path.steps,o=this.findNode(x.path.steps,n,h?r:null)),o)try{a.terminal.offset!=null?t.setStart(o,a.terminal.offset):t.setStart(o,0)}catch(b){y=this.fixMiss(g,a.terminal.offset,n,h?r:null),t.setStart(y.container,y.offset)}else return console.log("No startContainer found for",this.toString()),null;if(p)try{s.terminal.offset!=null?t.setEnd(p,s.terminal.offset):t.setEnd(p,0)}catch(b){y=this.fixMiss(d,x.end.terminal.offset,n,h?r:null),t.setEnd(y.container,y.offset)}return t}isCfiString(e){return typeof e=="string"&&e.indexOf("epubcfi(")===0&&e[e.length-1]===")"}generateChapterComponent(e,r,n){var t=parseInt(r),a=(e+1)*2,s="/"+a+"/";return s+=(t+1)*2,n&&(s+="["+n+"]"),s}collapse(e){!this.range||(this.range=!1,e?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}var y_=ci;xr.default=y_;var Yi={};Object.defineProperty(Yi,"__esModule",{value:!0});Yi.default=void 0;class E_{constructor(e){this.context=e||this,this.hooks=[]}register(){for(var e=0;e<arguments.length;++e)if(typeof arguments[e]=="function")this.hooks.push(arguments[e]);else for(var r=0;r<arguments[e].length;++r)this.hooks.push(arguments[e][r])}deregister(e){let r;for(let n=0;n<this.hooks.length;n++)if(r=this.hooks[n],r===e){this.hooks.splice(n,1);break}}trigger(){var e=arguments,r=this.context,n=[];return this.hooks.forEach(function(t){try{var a=t.apply(r,e)}catch(s){console.log(s)}a&&typeof a.then=="function"&&n.push(a)}),Promise.all(n)}list(){return this.hooks}clear(){return this.hooks=[]}}var __=E_;Yi.default=__;var vo={},yn={};Object.defineProperty(yn,"__esModule",{value:!0});yn.replaceBase=b_;yn.replaceCanonical=S_;yn.replaceLinks=O_;yn.replaceMeta=T_;yn.substitute=A_;var di=nt,x_=Id(fi);Id(gn);function Id(i){return i&&i.__esModule?i:{default:i}}function b_(i,e){var r,n,t=e.url,a=t.indexOf("://")>-1;!i||(n=(0,di.qs)(i,"head"),r=(0,di.qs)(n,"base"),r||(r=i.createElement("base"),n.insertBefore(r,n.firstChild)),!a&&window&&window.location&&(t=window.location.origin+t),r.setAttribute("href",t))}function S_(i,e){var r,n,t=e.canonical;!i||(r=(0,di.qs)(i,"head"),n=(0,di.qs)(r,"link[rel='canonical']"),n?n.setAttribute("href",t):(n=i.createElement("link"),n.setAttribute("rel","canonical"),n.setAttribute("href",t),r.appendChild(n)))}function T_(i,e){var r,n,t=e.idref;!i||(r=(0,di.qs)(i,"head"),n=(0,di.qs)(r,"link[property='dc.identifier']"),n?n.setAttribute("content",t):(n=i.createElement("meta"),n.setAttribute("name","dc.identifier"),n.setAttribute("content",t),r.appendChild(n)))}function O_(i,e){var r=i.querySelectorAll("a[href]");if(!!r.length)for(var n=(0,di.qs)(i.ownerDocument,"base"),t=n?n.getAttribute("href"):void 0,a=function(o){var p=o.getAttribute("href");if(p.indexOf("mailto:")!==0){var x=p.indexOf("://")>-1;if(x)o.setAttribute("target","_blank");else{var g;try{g=new x_.default(p,t)}catch(d){}o.onclick=function(){return g&&g.hash?e(g.Path.path+g.hash):e(g?g.Path.path:p),!1}}}}.bind(this),s=0;s<r.length;s++)a(r[s])}function A_(i,e,r){return e.forEach(function(n,t){n&&r[t]&&(n=n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),i=i.replace(new RegExp(n,"g"),r[t]))}),i}var hi={};Object.defineProperty(hi,"__esModule",{value:!0});hi.default=void 0;var Xi=nt,w_=L_(gn);function L_(i){return i&&i.__esModule?i:{default:i}}function D_(i,e,r,n){var t=typeof window!="undefined"?window.URL:!1,a=t?"blob":"arraybuffer",s=new Xi.defer,o=new XMLHttpRequest,p=XMLHttpRequest.prototype,x;"overrideMimeType"in p||Object.defineProperty(p,"overrideMimeType",{value:function(){}}),r&&(o.withCredentials=!0),o.onreadystatechange=d,o.onerror=g,o.open("GET",i,!0);for(x in n)o.setRequestHeader(x,n[x]);e=="json"&&o.setRequestHeader("Accept","application/json"),e||(e=new w_.default(i).extension),e=="blob"&&(o.responseType=a),(0,Xi.isXml)(e)&&o.overrideMimeType("text/xml"),e=="binary"&&(o.responseType="arraybuffer"),o.send();function g(h){s.reject(h)}function d(){if(this.readyState===XMLHttpRequest.DONE){var h=!1;if((this.responseType===""||this.responseType==="document")&&(h=this.responseXML),this.status===200||this.status===0||h){var y;if(!this.response&&!h)return s.reject({status:this.status,message:"Empty Response",stack:new Error().stack}),s.promise;if(this.status===403)return s.reject({status:this.status,response:this.response,message:"Forbidden",stack:new Error().stack}),s.promise;h?y=this.responseXML:(0,Xi.isXml)(e)?y=(0,Xi.parse)(this.response,"text/xml"):e=="xhtml"?y=(0,Xi.parse)(this.response,"application/xhtml+xml"):e=="html"||e=="htm"?y=(0,Xi.parse)(this.response,"text/html"):e=="json"?y=JSON.parse(this.response):e=="blob"?t?y=this.response:y=new Blob([this.response]):y=this.response,s.resolve(y)}else s.reject({status:this.status,message:this.response,stack:new Error().stack})}}return s.promise}var P_=D_;hi.default=P_;Object.defineProperty(vo,"__esModule",{value:!0});vo.default=void 0;var mu=nt,Md=yu(xr),kd=yu(Yi),R_=yn,C_=yu(hi),I_=Ia;function yu(i){return i&&i.__esModule?i:{default:i}}class M_{constructor(e,r){this.idref=e.idref,this.linear=e.linear==="yes",this.properties=e.properties,this.index=e.index,this.href=e.href,this.url=e.url,this.canonical=e.canonical,this.next=e.next,this.prev=e.prev,this.cfiBase=e.cfiBase,r?this.hooks=r:(this.hooks={},this.hooks.serialize=new kd.default(this),this.hooks.content=new kd.default(this)),this.document=void 0,this.contents=void 0,this.output=void 0}load(e){var r=e||this.request||C_.default,n=new mu.defer,t=n.promise;return this.contents?n.resolve(this.contents):r(this.url).then(function(a){return this.document=a,this.contents=a.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){n.resolve(this.contents)}.bind(this)).catch(function(a){n.reject(a)}),t}base(){return(0,R_.replaceBase)(this.document,this)}render(e){var r=new mu.defer,n=r.promise;return this.output,this.load(e).then(function(t){var a=typeof navigator!="undefined"&&navigator.userAgent||"",s=a.indexOf("Trident")>=0,o;typeof XMLSerializer=="undefined"||s?o=I_.DOMParser:o=XMLSerializer;var p=new o;return this.output=p.serializeToString(t),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){r.resolve(this.output)}.bind(this)).catch(function(t){r.reject(t)}),n}find(e){var r=this,n=[],t=e.toLowerCase(),a=function(s){for(var o=s.textContent.toLowerCase(),p=r.document.createRange(),x,g,d=-1,h,y=150;g!=-1;)g=o.indexOf(t,d+1),g!=-1&&(p=r.document.createRange(),p.setStart(s,g),p.setEnd(s,g+t.length),x=r.cfiFromRange(p),s.textContent.length<y?h=s.textContent:(h=s.textContent.substring(g-y/2,g+y/2),h="..."+h+"..."),n.push({cfi:x,excerpt:h})),d=g};return(0,mu.sprint)(r.document,function(s){a(s)}),n}search(e,r=5){if(typeof document.createTreeWalker=="undefined")return this.find(e);let n=[];const t=150,a=this,s=e.toLowerCase(),o=function(d){const b=d.reduce((T,_)=>T+_.textContent,"").toLowerCase().indexOf(s);if(b!=-1){const T=0,_=b+s.length;let c=0,u=0;if(b<d[T].length){let f;for(;c<d.length-1&&(u+=d[c].length,!(_<=u));)c+=1;let v=d[T],l=d[c],m=a.document.createRange();m.setStart(v,b);let E=d.slice(0,c).reduce((O,D)=>O+D.textContent.length,0);m.setEnd(l,E>_?_:_-E),f=a.cfiFromRange(m);let S=d.slice(0,c+1).reduce((O,D)=>O+D.textContent,"");S.length>t&&(S=S.substring(b-t/2,b+t/2),S="..."+S+"..."),n.push({cfi:f,excerpt:S})}}},p=document.createTreeWalker(a.document,NodeFilter.SHOW_TEXT,null,!1);let x,g=[];for(;x=p.nextNode();)g.push(x),g.length==r&&(o(g.slice(0,r)),g=g.slice(1,r));return g.length>0&&o(g),n}reconcileLayoutSettings(e){var r={layout:e.layout,spread:e.spread,orientation:e.orientation};return this.properties.forEach(function(n){var t=n.replace("rendition:",""),a=t.indexOf("-"),s,o;a!=-1&&(s=t.slice(0,a),o=t.slice(a+1),r[s]=o)}),r}cfiFromRange(e){return new Md.default(e,this.cfiBase).toString()}cfiFromElement(e){return new Md.default(e,this.cfiBase).toString()}unload(){this.document=void 0,this.contents=void 0,this.output=void 0}destroy(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}}var k_=M_;vo.default=k_;Object.defineProperty(po,"__esModule",{value:!0});po.default=void 0;var Nd=_u(xr),Bd=_u(Yi),N_=_u(vo),Eu=yn;function _u(i){return i&&i.__esModule?i:{default:i}}class B_{constructor(){this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new Bd.default,this.hooks.content=new Bd.default,this.hooks.content.register(Eu.replaceBase),this.hooks.content.register(Eu.replaceCanonical),this.hooks.content.register(Eu.replaceMeta),this.epubcfi=new Nd.default,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}unpack(e,r,n){this.items=e.spine,this.manifest=e.manifest,this.spineNodeIndex=e.spineNodeIndex,this.baseUrl=e.baseUrl||e.basePath||"",this.length=this.items.length,this.items.forEach((t,a)=>{var s=this.manifest[t.idref],o;t.index=a,t.cfiBase=this.epubcfi.generateChapterComponent(this.spineNodeIndex,t.index,t.id),t.href&&(t.url=r(t.href,!0),t.canonical=n(t.href)),s&&(t.href=s.href,t.url=r(t.href,!0),t.canonical=n(t.href),s.properties.length&&t.properties.push.apply(t.properties,s.properties)),t.linear==="yes"?(t.prev=function(){let p=t.index;for(;p>0;){let x=this.get(p-1);if(x&&x.linear)return x;p-=1}}.bind(this),t.next=function(){let p=t.index;for(;p<this.spineItems.length-1;){let x=this.get(p+1);if(x&&x.linear)return x;p+=1}}.bind(this)):(t.prev=function(){},t.next=function(){}),o=new N_.default(t,this.hooks),this.append(o)}),this.loaded=!0}get(e){var r=0;if(typeof e=="undefined")for(;r<this.spineItems.length;){let n=this.spineItems[r];if(n&&n.linear)break;r+=1}else this.epubcfi.isCfiString(e)?r=new Nd.default(e).spinePos:typeof e=="number"||isNaN(e)===!1?r=e:typeof e=="string"&&e.indexOf("#")===0?r=this.spineById[e.substring(1)]:typeof e=="string"&&(e=e.split("#")[0],r=this.spineByHref[e]||this.spineByHref[encodeURI(e)]);return this.spineItems[r]||null}append(e){var r=this.spineItems.length;return e.index=r,this.spineItems.push(e),this.spineByHref[decodeURI(e.href)]=r,this.spineByHref[encodeURI(e.href)]=r,this.spineByHref[e.href]=r,this.spineById[e.idref]=r,r}prepend(e){return this.spineByHref[e.href]=0,this.spineById[e.idref]=0,this.spineItems.forEach(function(r,n){r.index=n}),0}remove(e){var r=this.spineItems.indexOf(e);if(r>-1)return delete this.spineByHref[e.href],delete this.spineById[e.idref],this.spineItems.splice(r,1)}each(){return this.spineItems.forEach.apply(this.spineItems,arguments)}first(){let e=0;do{let r=this.get(e);if(r&&r.linear)return r;e+=1}while(e<this.spineItems.length)}last(){let e=this.spineItems.length-1;do{let r=this.get(e);if(r&&r.linear)return r;e-=1}while(e>=0)}destroy(){this.each(e=>e.destroy()),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}}var F_=B_;po.default=F_;var go={},$n={};Object.defineProperty($n,"__esModule",{value:!0});$n.default=$n.Task=void 0;var mo=nt;class U_{constructor(e){this._q=[],this.context=e,this.tick=mo.requestAnimationFrame,this.running=!1,this.paused=!1}enqueue(){var e,r,n,t=[].shift.call(arguments),a=arguments;if(!t)throw new Error("No Task Provided");return typeof t=="function"?(e=new mo.defer,r=e.promise,n={task:t,args:a,deferred:e,promise:r}):n={promise:t},this._q.push(n),this.paused==!1&&!this.running&&this.run(),n.promise}dequeue(){var e,r,n;if(this._q.length&&!this.paused){if(e=this._q.shift(),r=e.task,r)return n=r.apply(this.context,e.args),n&&typeof n.then=="function"?n.then(function(){e.deferred.resolve.apply(this.context,arguments)}.bind(this),function(){e.deferred.reject.apply(this.context,arguments)}.bind(this)):(e.deferred.resolve.apply(this.context,n),e.promise);if(e.promise)return e.promise}else return e=new mo.defer,e.deferred.resolve(),e.promise}dump(){for(;this._q.length;)this.dequeue()}run(){return this.running||(this.running=!0,this.defered=new mo.defer),this.tick.call(window,()=>{this._q.length?this.dequeue().then(function(){this.run()}.bind(this)):(this.defered.resolve(),this.running=void 0)}),this.paused==!0&&(this.paused=!1),this.defered.promise}flush(){if(this.running)return this.running;if(this._q.length)return this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running}clear(){this._q=[]}length(){return this._q.length}pause(){this.paused=!0}stop(){this._q=[],this.running=!1,this.paused=!0}}class j_{constructor(e,r,n){return function(){var t=arguments||[];return new Promise((a,s)=>{var o=function(p,x){!p&&x?s(x):a(p)};t.push(o),e.apply(n||this,t)})}}}$n.Task=j_;var W_=U_;$n.default=W_;var nr={};Object.defineProperty(nr,"__esModule",{value:!0});nr.EVENTS=nr.EPUBJS_VERSION=nr.DOM_EVENTS=void 0;const z_="0.3";nr.EPUBJS_VERSION=z_;const K_=["keydown","keyup","keypressed","mouseup","mousedown","mousemove","click","touchend","touchstart","touchmove"];nr.DOM_EVENTS=K_;const V_={BOOK:{OPEN_FAILED:"openFailed"},CONTENTS:{EXPAND:"expand",RESIZE:"resize",SELECTED:"selected",SELECTED_RANGE:"selectedRange",LINK_CLICKED:"linkClicked"},LOCATIONS:{CHANGED:"changed"},MANAGERS:{RESIZE:"resize",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",ADDED:"added",SCROLL:"scroll",SCROLLED:"scrolled",REMOVED:"removed"},VIEWS:{AXIS:"axis",WRITING_MODE:"writingMode",LOAD_ERROR:"loaderror",RENDERED:"rendered",RESIZED:"resized",DISPLAYED:"displayed",SHOWN:"shown",HIDDEN:"hidden",MARK_CLICKED:"markClicked"},RENDITION:{STARTED:"started",ATTACHED:"attached",DISPLAYED:"displayed",DISPLAY_ERROR:"displayerror",RENDERED:"rendered",REMOVED:"removed",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",LOCATION_CHANGED:"locationChanged",RELOCATED:"relocated",MARK_CLICKED:"markClicked",SELECTED:"selected",LAYOUT:"layout"},LAYOUT:{UPDATED:"updated"},ANNOTATION:{ATTACH:"attach",DETACH:"detach"}};nr.EVENTS=V_;Object.defineProperty(go,"__esModule",{value:!0});go.default=void 0;var pi=nt,G_=xu($n),Yn=xu(xr),H_=nr,$_=xu(Hr.exports);function xu(i){return i&&i.__esModule?i:{default:i}}class Fd{constructor(e,r,n){this.spine=e,this.request=r,this.pause=n||100,this.q=new G_.default(this),this.epubcfi=new Yn.default,this._locations=[],this._locationsWords=[],this.total=0,this.break=150,this._current=0,this._wordCounter=0,this.currentLocation="",this._currentCfi="",this.processingTimeout=void 0}generate(e){return e&&(this.break=e),this.q.pause(),this.spine.each(function(r){r.linear&&this.q.enqueue(this.process.bind(this),r)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))}createRange(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}process(e){return e.load(this.request).then(function(r){var n=new pi.defer,t=this.parse(r,e.cfiBase);return this._locations=this._locations.concat(t),e.unload(),this.processingTimeout=setTimeout(()=>n.resolve(t),this.pause),n.promise}.bind(this))}parse(e,r,n){var t=[],a,s=e.ownerDocument,o=(0,pi.qs)(s,"body"),p=0,x,g=n||this.break,d=function(h){var y=h.length,b,T=0;if(h.textContent.trim().length===0)return!1;for(p==0&&(a=this.createRange(),a.startContainer=h,a.startOffset=0),b=g-p,b>y&&(p+=y,T=y);T<y;)if(b=g-p,p===0&&(T+=1,a=this.createRange(),a.startContainer=h,a.startOffset=T),T+b>=y)p+=y-T,T=y;else{T+=b,a.endContainer=h,a.endOffset=T;let _=new Yn.default(a,r).toString();t.push(_),p=0}x=h};if((0,pi.sprint)(o,d.bind(this)),a&&a.startContainer&&x){a.endContainer=x,a.endOffset=x.length;let h=new Yn.default(a,r).toString();t.push(h),p=0}return t}generateFromWords(e,r,n){var t=e?new Yn.default(e):void 0;return this.q.pause(),this._locationsWords=[],this._wordCounter=0,this.spine.each(function(a){a.linear&&(t?a.index>=t.spinePos&&this.q.enqueue(this.processWords.bind(this),a,r,t,n):this.q.enqueue(this.processWords.bind(this),a,r,t,n))}.bind(this)),this.q.run().then(function(){return this._currentCfi&&(this.currentLocation=this._currentCfi),this._locationsWords}.bind(this))}processWords(e,r,n,t){return t&&this._locationsWords.length>=t?Promise.resolve():e.load(this.request).then(function(a){var s=new pi.defer,o=this.parseWords(a,e,r,n),p=t-this._locationsWords.length;return this._locationsWords=this._locationsWords.concat(o.length>=t?o.slice(0,p):o),e.unload(),this.processingTimeout=setTimeout(()=>s.resolve(o),this.pause),s.promise}.bind(this))}countWords(e){return e=e.replace(/(^\s*)|(\s*$)/gi,""),e=e.replace(/[ ]{2,}/gi," "),e=e.replace(/\n /,`
`),e.split(" ").length}parseWords(e,r,n,t){var a=r.cfiBase,s=[],o=e.ownerDocument,p=(0,pi.qs)(o,"body"),x=n,g=t?t.spinePos!==r.index:!0,d;t&&r.index===t.spinePos&&(d=t.findNode(t.range?t.path.steps.concat(t.start.steps):t.path.steps,e.ownerDocument));var h=function(y){if(!g)if(y===d)g=!0;else return!1;if(y.textContent.length<10&&y.textContent.trim().length===0)return!1;var b=this.countWords(y.textContent),T,_=0;if(b===0)return!1;for(T=x-this._wordCounter,T>b&&(this._wordCounter+=b,_=b);_<b;)if(T=x-this._wordCounter,_+T>=b)this._wordCounter+=b-_,_=b;else{_+=T;let c=new Yn.default(y,a);s.push({cfi:c.toString(),wordCount:this._wordCounter}),this._wordCounter=0}};return(0,pi.sprint)(p,h.bind(this)),s}locationFromCfi(e){let r;return Yn.default.prototype.isCfiString(e)&&(e=new Yn.default(e)),this._locations.length===0?-1:(r=(0,pi.locationOf)(e,this._locations,this.epubcfi.compare),r>this.total?this.total:r)}percentageFromCfi(e){if(this._locations.length===0)return null;var r=this.locationFromCfi(e);return this.percentageFromLocation(r)}percentageFromLocation(e){return!e||!this.total?0:e/this.total}cfiFromLocation(e){var r=-1;return typeof e!="number"&&(e=parseInt(e)),e>=0&&e<this._locations.length&&(r=this._locations[e]),r}cfiFromPercentage(e){let r;if(e>1&&console.warn("Normalize cfiFromPercentage value to between 0 - 1"),e>=1){let n=new Yn.default(this._locations[this.total]);return n.collapse(),n.toString()}return r=Math.ceil(this.total*e),this.cfiFromLocation(r)}load(e){return typeof e=="string"?this._locations=JSON.parse(e):this._locations=e,this.total=this._locations.length-1,this._locations}save(){return JSON.stringify(this._locations)}getCurrent(){return this._current}setCurrent(e){var r;if(typeof e=="string")this._currentCfi=e;else if(typeof e=="number")this._current=e;else return;this._locations.length!==0&&(typeof e=="string"?(r=this.locationFromCfi(e),this._current=r):r=e,this.emit(H_.EVENTS.LOCATIONS.CHANGED,{percentage:this.percentageFromLocation(r)}))}get currentLocation(){return this._current}set currentLocation(e){this.setCurrent(e)}length(){return this._locations.length}destroy(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.stop(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}}(0,$_.default)(Fd.prototype);var Y_=Fd;go.default=Y_;var yo={};Object.defineProperty(yo,"__esModule",{value:!0});yo.default=void 0;var X_=Q_(co),Z_=nt;function Q_(i){return i&&i.__esModule?i:{default:i}}class J_{constructor(e){this.packagePath="",this.directory="",this.encoding="",e&&this.parse(e)}parse(e){var r;if(!e)throw new Error("Container File Not Found");if(r=(0,Z_.qs)(e,"rootfile"),!r)throw new Error("No RootFile Found");this.packagePath=r.getAttribute("full-path"),this.directory=X_.default.dirname(this.packagePath),this.encoding=e.xmlEncoding}destroy(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}}var q_=J_;yo.default=q_;var Eo={};Object.defineProperty(Eo,"__esModule",{value:!0});Eo.default=void 0;var Yr=nt;class ex{constructor(e){this.manifest={},this.navPath="",this.ncxPath="",this.coverPath="",this.spineNodeIndex=0,this.spine=[],this.metadata={},e&&this.parse(e)}parse(e){var r,n,t;if(!e)throw new Error("Package File Not Found");if(r=(0,Yr.qs)(e,"metadata"),!r)throw new Error("No Metadata Found");if(n=(0,Yr.qs)(e,"manifest"),!n)throw new Error("No Manifest Found");if(t=(0,Yr.qs)(e,"spine"),!t)throw new Error("No Spine Found");return this.manifest=this.parseManifest(n),this.navPath=this.findNavPath(n),this.ncxPath=this.findNcxPath(n,t),this.coverPath=this.findCoverPath(e),this.spineNodeIndex=(0,Yr.indexOfElementNode)(t),this.spine=this.parseSpine(t,this.manifest),this.uniqueIdentifier=this.findUniqueIdentifier(e),this.metadata=this.parseMetadata(r),this.metadata.direction=t.getAttribute("page-progression-direction"),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}parseMetadata(e){var r={};return r.title=this.getElementText(e,"title"),r.creator=this.getElementText(e,"creator"),r.description=this.getElementText(e,"description"),r.pubdate=this.getElementText(e,"date"),r.publisher=this.getElementText(e,"publisher"),r.identifier=this.getElementText(e,"identifier"),r.language=this.getElementText(e,"language"),r.rights=this.getElementText(e,"rights"),r.modified_date=this.getPropertyText(e,"dcterms:modified"),r.layout=this.getPropertyText(e,"rendition:layout"),r.orientation=this.getPropertyText(e,"rendition:orientation"),r.flow=this.getPropertyText(e,"rendition:flow"),r.viewport=this.getPropertyText(e,"rendition:viewport"),r.media_active_class=this.getPropertyText(e,"media:active-class"),r.spread=this.getPropertyText(e,"rendition:spread"),r}parseManifest(e){var r={},n=(0,Yr.qsa)(e,"item"),t=Array.prototype.slice.call(n);return t.forEach(function(a){var s=a.getAttribute("id"),o=a.getAttribute("href")||"",p=a.getAttribute("media-type")||"",x=a.getAttribute("media-overlay")||"",g=a.getAttribute("properties")||"";r[s]={href:o,type:p,overlay:x,properties:g.length?g.split(" "):[]}}),r}parseSpine(e,r){var n=[],t=(0,Yr.qsa)(e,"itemref"),a=Array.prototype.slice.call(t);return a.forEach(function(s,o){var p=s.getAttribute("idref"),x=s.getAttribute("properties")||"",g=x.length?x.split(" "):[],d={id:s.getAttribute("id"),idref:p,linear:s.getAttribute("linear")||"yes",properties:g,index:o};n.push(d)}),n}findUniqueIdentifier(e){var r=e.documentElement.getAttribute("unique-identifier");if(!r)return"";var n=e.getElementById(r);return n&&n.localName==="identifier"&&n.namespaceURI==="http://purl.org/dc/elements/1.1/"&&n.childNodes.length>0?n.childNodes[0].nodeValue.trim():""}findNavPath(e){var r=(0,Yr.qsp)(e,"item",{properties:"nav"});return r?r.getAttribute("href"):!1}findNcxPath(e,r){var n=(0,Yr.qsp)(e,"item",{"media-type":"application/x-dtbncx+xml"}),t;return n||(t=r.getAttribute("toc"),t&&(n=e.querySelector(`#${t}`))),n?n.getAttribute("href"):!1}findCoverPath(e){var r=(0,Yr.qs)(e,"package");r.getAttribute("version");var n=(0,Yr.qsp)(e,"item",{properties:"cover-image"});if(n)return n.getAttribute("href");var t=(0,Yr.qsp)(e,"meta",{name:"cover"});if(t){var a=t.getAttribute("content"),s=e.getElementById(a);return s?s.getAttribute("href"):""}else return!1}getElementText(e,r){var n=e.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",r),t;return!n||n.length===0?"":(t=n[0],t.childNodes.length?t.childNodes[0].nodeValue:"")}getPropertyText(e,r){var n=(0,Yr.qsp)(e,"meta",{property:r});return n&&n.childNodes.length?n.childNodes[0].nodeValue:""}load(e){this.metadata=e.metadata;let r=e.readingOrder||e.spine;return this.spine=r.map((n,t)=>(n.index=t,n.linear=n.linear||"yes",n)),e.resources.forEach((n,t)=>{this.manifest[t]=n,n.rel&&n.rel[0]==="cover"&&(this.coverPath=n.href)}),this.spineNodeIndex=0,this.toc=e.toc.map((n,t)=>(n.label=n.title,n)),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}destroy(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}}var tx=ex;Eo.default=tx;var _o={};Object.defineProperty(_o,"__esModule",{value:!0});_o.default=void 0;var Nr=nt;class rx{constructor(e){this.toc=[],this.tocByHref={},this.tocById={},this.landmarks=[],this.landmarksByType={},this.length=0,e&&this.parse(e)}parse(e){let r=e.nodeType,n,t;r&&(n=(0,Nr.qs)(e,"html"),t=(0,Nr.qs)(e,"ncx")),r?n?(this.toc=this.parseNav(e),this.landmarks=this.parseLandmarks(e)):t&&(this.toc=this.parseNcx(e)):this.toc=this.load(e),this.length=0,this.unpack(this.toc)}unpack(e){for(var r,n=0;n<e.length;n++)r=e[n],r.href&&(this.tocByHref[r.href]=n),r.id&&(this.tocById[r.id]=n),this.length++,r.subitems.length&&this.unpack(r.subitems)}get(e){var r;return e?(e.indexOf("#")===0?r=this.tocById[e.substring(1)]:e in this.tocByHref&&(r=this.tocByHref[e]),this.getByIndex(e,r,this.toc)):this.toc}getByIndex(e,r,n){if(n.length===0)return;const t=n[r];if(t&&(e===t.id||e===t.href))return t;{let a;for(let s=0;s<n.length&&(a=this.getByIndex(e,r,n[s].subitems),!a);++s);return a}}landmark(e){var r;return e?(r=this.landmarksByType[e],this.landmarks[r]):this.landmarks}parseNav(e){var r=(0,Nr.querySelectorByType)(e,"nav","toc"),n=[];if(!r)return n;let t=(0,Nr.filterChildren)(r,"ol",!0);return t&&(n=this.parseNavList(t)),n}parseNavList(e,r){const n=[];if(!e||!e.children)return n;for(let t=0;t<e.children.length;t++){const a=this.navItem(e.children[t],r);a&&n.push(a)}return n}navItem(e,r){let n=e.getAttribute("id")||void 0,t=(0,Nr.filterChildren)(e,"a",!0)||(0,Nr.filterChildren)(e,"span",!0);if(!t)return;let a=t.getAttribute("href")||"";n||(n=a);let s=t.textContent||"",o=[],p=(0,Nr.filterChildren)(e,"ol",!0);return p&&(o=this.parseNavList(p,n)),{id:n,href:a,label:s,subitems:o,parent:r}}parseLandmarks(e){var r=(0,Nr.querySelectorByType)(e,"nav","landmarks"),n=r?(0,Nr.qsa)(r,"li"):[],t=n.length,a,s=[],o;if(!n||t===0)return s;for(a=0;a<t;++a)o=this.landmarkItem(n[a]),o&&(s.push(o),this.landmarksByType[o.type]=a);return s}landmarkItem(e){let r=(0,Nr.filterChildren)(e,"a",!0);if(!r)return;let n=r.getAttributeNS("http://www.idpf.org/2007/ops","type")||void 0,t=r.getAttribute("href")||"",a=r.textContent||"";return{href:t,label:a,type:n}}parseNcx(e){var r=(0,Nr.qsa)(e,"navPoint"),n=r.length,t,a={},s=[],o,p;if(!r||n===0)return s;for(t=0;t<n;++t)o=this.ncxItem(r[t]),a[o.id]=o,o.parent?(p=a[o.parent],p.subitems.push(o)):s.push(o);return s}ncxItem(e){var r=e.getAttribute("id")||!1,n=(0,Nr.qs)(e,"content"),t=n.getAttribute("src"),a=(0,Nr.qs)(e,"navLabel"),s=a.textContent?a.textContent:"",o=[],p=e.parentNode,x;return p&&(p.nodeName==="navPoint"||p.nodeName.split(":").slice(-1)[0]==="navPoint")&&(x=p.getAttribute("id")),{id:r,href:t,label:s,subitems:o,parent:x}}load(e){return e.map(r=>(r.label=r.title,r.subitems=r.children?this.load(r.children):[],r))}forEach(e){return this.toc.forEach(e)}}var nx=rx;_o.default=nx;var xo={},Zi={};Object.defineProperty(Zi,"__esModule",{value:!0});Zi.default=void 0;var Ga={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},ix=function(){var i,e,r,n,t={};for(i in Ga)if(Ga.hasOwnProperty(i)){for(e in Ga[i])if(Ga[i].hasOwnProperty(e))if(r=Ga[i][e],typeof r=="string")t[r]=i+"/"+e;else for(n=0;n<r.length;n++)t[r[n]]=i+"/"+e}return t}(),ax="text/plain";function sx(i){return i&&ix[i.split(".").pop().toLowerCase()]||ax}var ox={lookup:sx};Zi.default=ox;Object.defineProperty(xo,"__esModule",{value:!0});xo.default=void 0;var Ud=yn,Ha=nt,lx=bo(fi),ux=bo(Zi),jd=bo(gn),fx=bo(co);function bo(i){return i&&i.__esModule?i:{default:i}}class cx{constructor(e,r){this.settings={replacements:r&&r.replacements||"base64",archive:r&&r.archive,resolver:r&&r.resolver,request:r&&r.request},this.process(e)}process(e){this.manifest=e,this.resources=Object.keys(e).map(function(r){return e[r]}),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}split(){this.html=this.resources.filter(function(e){if(e.type==="application/xhtml+xml"||e.type==="text/html")return!0}),this.assets=this.resources.filter(function(e){if(e.type!=="application/xhtml+xml"&&e.type!=="text/html")return!0}),this.css=this.resources.filter(function(e){if(e.type==="text/css")return!0})}splitUrls(){this.urls=this.assets.map(function(e){return e.href}.bind(this)),this.cssUrls=this.css.map(function(e){return e.href})}createUrl(e){var r=new lx.default(e),n=ux.default.lookup(r.filename);return this.settings.archive?this.settings.archive.createUrl(e,{base64:this.settings.replacements==="base64"}):this.settings.replacements==="base64"?this.settings.request(e,"blob").then(t=>(0,Ha.blob2base64)(t)).then(t=>(0,Ha.createBase64Url)(t,n)):this.settings.request(e,"blob").then(t=>(0,Ha.createBlobUrl)(t,n))}replacements(){if(this.settings.replacements==="none")return new Promise(function(r){r(this.urls)}.bind(this));var e=this.urls.map(r=>{var n=this.settings.resolver(r);return this.createUrl(n).catch(t=>(console.error(t),null))});return Promise.all(e).then(r=>(this.replacementUrls=r.filter(n=>typeof n=="string"),r))}replaceCss(e,r){var n=[];return e=e||this.settings.archive,r=r||this.settings.resolver,this.cssUrls.forEach(function(t){var a=this.createCssFile(t,e,r).then(function(s){var o=this.urls.indexOf(t);o>-1&&(this.replacementUrls[o]=s)}.bind(this));n.push(a)}.bind(this)),Promise.all(n)}createCssFile(e){var r;if(fx.default.isAbsolute(e))return new Promise(function(s){s()});var n=this.settings.resolver(e),t;this.settings.archive?t=this.settings.archive.getText(n):t=this.settings.request(n,"text");var a=this.urls.map(s=>{var o=this.settings.resolver(s),p=new jd.default(n).relative(o);return p});return t?t.then(s=>(s=(0,Ud.substitute)(s,a,this.replacementUrls),this.settings.replacements==="base64"?r=(0,Ha.createBase64Url)(s,"text/css"):r=(0,Ha.createBlobUrl)(s,"text/css"),r),s=>new Promise(function(o){o()})):new Promise(function(s){s()})}relativeTo(e,r){return r=r||this.settings.resolver,this.urls.map(function(n){var t=r(n),a=new jd.default(e).relative(t);return a}.bind(this))}get(e){var r=this.urls.indexOf(e);if(r!==-1)return this.replacementUrls.length?new Promise(function(n,t){n(this.replacementUrls[r])}.bind(this)):this.createUrl(e)}substitute(e,r){var n;return r?n=this.relativeTo(r):n=this.urls,(0,Ud.substitute)(e,n,this.replacementUrls)}destroy(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}}var dx=cx;xo.default=dx;var So={};Object.defineProperty(So,"__esModule",{value:!0});So.default=void 0;var hx=px(xr),Xr=nt;function px(i){return i&&i.__esModule?i:{default:i}}class vx{constructor(e){this.pages=[],this.locations=[],this.epubcfi=new hx.default,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,e&&(this.pageList=this.parse(e)),this.pageList&&this.pageList.length&&this.process(this.pageList)}parse(e){var r=(0,Xr.qs)(e,"html"),n=(0,Xr.qs)(e,"ncx");if(r)return this.parseNav(e);if(n)return this.parseNcx(e)}parseNav(e){var r=(0,Xr.querySelectorByType)(e,"nav","page-list"),n=r?(0,Xr.qsa)(r,"li"):[],t=n.length,a,s=[],o;if(!n||t===0)return s;for(a=0;a<t;++a)o=this.item(n[a]),s.push(o);return s}parseNcx(e){var r=[],n=0,t,a,s,o=0;if(a=(0,Xr.qs)(e,"pageList"),!a||(s=(0,Xr.qsa)(a,"pageTarget"),o=s.length,!s||s.length===0))return r;for(n=0;n<o;++n)t=this.ncxItem(s[n]),r.push(t);return r}ncxItem(e){var r=(0,Xr.qs)(e,"navLabel"),n=(0,Xr.qs)(r,"text"),t=n.textContent,a=(0,Xr.qs)(e,"content"),s=a.getAttribute("src"),o=parseInt(t,10);return{href:s,page:o}}item(e){var r=(0,Xr.qs)(e,"a"),n=r.getAttribute("href")||"",t=r.textContent||"",a=parseInt(t),s=n.indexOf("epubcfi"),o,p,x;return s!=-1?(o=n.split("#"),p=o[0],x=o.length>1?o[1]:!1,{cfi:x,href:n,packageUrl:p,page:a}):{href:n,page:a}}process(e){e.forEach(function(r){this.pages.push(r.page),r.cfi&&this.locations.push(r.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}pageFromCfi(e){var r=-1;if(this.locations.length===0)return-1;var n=(0,Xr.indexOfSorted)(e,this.locations,this.epubcfi.compare);return n!=-1?r=this.pages[n]:(n=(0,Xr.locationOf)(e,this.locations,this.epubcfi.compare),r=n-1>=0?this.pages[n-1]:this.pages[0],r!==void 0||(r=-1)),r}cfiFromPage(e){var r=-1;typeof e!="number"&&(e=parseInt(e));var n=this.pages.indexOf(e);return n!=-1&&(r=this.locations[n]),r}pageFromPercentage(e){var r=Math.round(this.totalPages*e);return r}percentageFromPage(e){var r=(e-this.firstPage)/this.totalPages;return Math.round(r*1e3)/1e3}percentageFromCfi(e){var r=this.pageFromCfi(e),n=this.percentageFromPage(r);return n}destroy(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}}var gx=vx;So.default=gx;var Qi={},$a={};Object.defineProperty($a,"__esModule",{value:!0});$a.default=void 0;var mx=nt,yx=nr,Ex=_x(Hr.exports);function _x(i){return i&&i.__esModule?i:{default:i}}class Wd{constructor(e){this.settings=e,this.name=e.layout||"reflowable",this._spread=e.spread!=="none",this._minSpreadWidth=e.minSpreadWidth||800,this._evenSpreads=e.evenSpreads||!1,e.flow==="scrolled"||e.flow==="scrolled-continuous"||e.flow==="scrolled-doc"?this._flow="scrolled":this._flow="paginated",this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}flow(e){return typeof e!="undefined"&&(e==="scrolled"||e==="scrolled-continuous"||e==="scrolled-doc"?this._flow="scrolled":this._flow="paginated",this.update({flow:this._flow})),this._flow}spread(e,r){return e&&(this._spread=e!=="none",this.update({spread:this._spread})),r>=0&&(this._minSpreadWidth=r),this._spread}calculate(e,r,n){var t=1,a=n||0,s=e,o=r,p=Math.floor(s/12),x,g,d,h;this._spread&&s>=this._minSpreadWidth?t=2:t=1,this.name==="reflowable"&&this._flow==="paginated"&&!(n>=0)&&(a=p%2==0?p:p-1),this.name==="pre-paginated"&&(a=0),t>1?(x=s/t-a,d=x+a):(x=s,d=s),this.name==="pre-paginated"&&t>1&&(s=x),g=x*t+a,h=s,this.width=s,this.height=o,this.spreadWidth=g,this.pageWidth=d,this.delta=h,this.columnWidth=x,this.gap=a,this.divisor=t,this.update({width:s,height:o,spreadWidth:g,pageWidth:d,delta:h,columnWidth:x,gap:a,divisor:t})}format(e,r,n){var t;return this.name==="pre-paginated"?t=e.fit(this.columnWidth,this.height,r):this._flow==="paginated"?t=e.columns(this.width,this.height,this.columnWidth,this.gap,this.settings.direction):n&&n==="horizontal"?t=e.size(null,this.height):t=e.size(this.width,null),t}count(e,r){let n,t;return this.name==="pre-paginated"?(n=1,t=1):this._flow==="paginated"?(r=r||this.delta,n=Math.ceil(e/r),t=n*this.divisor):(r=r||this.height,n=Math.ceil(e/r),t=n),{spreads:n,pages:t}}update(e){if(Object.keys(e).forEach(r=>{this.props[r]===e[r]&&delete e[r]}),Object.keys(e).length>0){let r=(0,mx.extend)(this.props,e);this.emit(yx.EVENTS.LAYOUT.UPDATED,r,e)}}}(0,Ex.default)(Wd.prototype);var xx=Wd;$a.default=xx;var To={};Object.defineProperty(To,"__esModule",{value:!0});To.default=void 0;var bx=Sx(fi);function Sx(i){return i&&i.__esModule?i:{default:i}}class Tx{constructor(e){this.rendition=e,this._themes={default:{rules:{},url:"",serialized:""}},this._overrides={},this._current="default",this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}register(){if(arguments.length!==0){if(arguments.length===1&&typeof arguments[0]=="object")return this.registerThemes(arguments[0]);if(arguments.length===1&&typeof arguments[0]=="string")return this.default(arguments[0]);if(arguments.length===2&&typeof arguments[1]=="string")return this.registerUrl(arguments[0],arguments[1]);if(arguments.length===2&&typeof arguments[1]=="object")return this.registerRules(arguments[0],arguments[1])}}default(e){if(!!e){if(typeof e=="string")return this.registerUrl("default",e);if(typeof e=="object")return this.registerRules("default",e)}}registerThemes(e){for(var r in e)e.hasOwnProperty(r)&&(typeof e[r]=="string"?this.registerUrl(r,e[r]):this.registerRules(r,e[r]))}registerCss(e,r){this._themes[e]={serialized:r},(this._injected[e]||e=="default")&&this.update(e)}registerUrl(e,r){var n=new bx.default(r);this._themes[e]={url:n.toString()},(this._injected[e]||e=="default")&&this.update(e)}registerRules(e,r){this._themes[e]={rules:r},(this._injected[e]||e=="default")&&this.update(e)}select(e){var r=this._current,n;this._current=e,this.update(e),n=this.rendition.getContents(),n.forEach(t=>{t.removeClass(r),t.addClass(e)})}update(e){var r=this.rendition.getContents();r.forEach(n=>{this.add(e,n)})}inject(e){var r=[],n=this._themes,t;for(var a in n)n.hasOwnProperty(a)&&(a===this._current||a==="default")&&(t=n[a],(t.rules&&Object.keys(t.rules).length>0||t.url&&r.indexOf(t.url)===-1)&&this.add(a,e),this._injected.push(a));this._current!="default"&&e.addClass(this._current)}add(e,r){var n=this._themes[e];!n||!r||(n.url?r.addStylesheet(n.url):n.serialized?(r.addStylesheetCss(n.serialized,e),n.injected=!0):n.rules&&(r.addStylesheetRules(n.rules,e),n.injected=!0))}override(e,r,n){var t=this.rendition.getContents();this._overrides[e]={value:r,priority:n===!0},t.forEach(a=>{a.css(e,this._overrides[e].value,this._overrides[e].priority)})}removeOverride(e){var r=this.rendition.getContents();delete this._overrides[e],r.forEach(n=>{n.css(e)})}overrides(e){var r=this._overrides;for(var n in r)r.hasOwnProperty(n)&&e.css(n,r[n].value,r[n].priority)}fontSize(e){this.override("font-size",e)}font(e){this.override("font-family",e,!0)}destroy(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}}var Ox=Tx;To.default=Ox;var vi={},Ya={};Object.defineProperty(Ya,"__esModule",{value:!0});Ya.default=void 0;var Oo=Ax(xr),zd=nt;function Ax(i){return i&&i.__esModule?i:{default:i}}class wx{constructor(e,r,n,t=!1){this.layout=e,this.horizontal=n==="horizontal",this.direction=r||"ltr",this._dev=t}section(e){var r=this.findRanges(e),n=this.rangeListToCfiList(e.section.cfiBase,r);return n}page(e,r,n,t){var a=e&&e.document?e.document.body:!1,s;if(!!a){if(s=this.rangePairToCfiPair(r,{start:this.findStart(a,n,t),end:this.findEnd(a,n,t)}),this._dev===!0){let o=e.document,p=new Oo.default(s.start).toRange(o),x=new Oo.default(s.end).toRange(o),g=o.defaultView.getSelection(),d=o.createRange();g.removeAllRanges(),d.setStart(p.startContainer,p.startOffset),d.setEnd(x.endContainer,x.endOffset),g.addRange(d)}return s}}walk(e,r){if(!(e&&e.nodeType===Node.TEXT_NODE)){var n={acceptNode:function(p){return p.data.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},t=n.acceptNode;t.acceptNode=n.acceptNode;for(var a=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,t,!1),s,o;(s=a.nextNode())&&(o=r(s),!o););return o}}findRanges(e){for(var r=[],n=e.contents.scrollWidth(),t=Math.ceil(n/this.layout.spreadWidth),a=t*this.layout.divisor,s=this.layout.columnWidth,o=this.layout.gap,p,x,g=0;g<a.pages;g++)p=(s+o)*g,x=s*(g+1)+o*g,r.push({start:this.findStart(e.document.body,p,x),end:this.findEnd(e.document.body,p,x)});return r}findStart(e,r,n){for(var t=[e],a,s,o=e;t.length;)if(a=t.shift(),s=this.walk(a,p=>{var x,g,d,h,y;if(y=(0,zd.nodeBounds)(p),this.horizontal&&this.direction==="ltr"){if(x=this.horizontal?y.left:y.top,g=this.horizontal?y.right:y.bottom,x>=r&&x<=n)return p;if(g>r)return p;o=p,t.push(p)}else if(this.horizontal&&this.direction==="rtl"){if(x=y.left,g=y.right,g<=n&&g>=r)return p;if(x<n)return p;o=p,t.push(p)}else{if(d=y.top,h=y.bottom,d>=r&&d<=n)return p;if(h>r)return p;o=p,t.push(p)}}),s)return this.findTextStartRange(s,r,n);return this.findTextStartRange(o,r,n)}findEnd(e,r,n){for(var t=[e],a,s=e,o;t.length;)if(a=t.shift(),o=this.walk(a,p=>{var x,g,d,h,y;if(y=(0,zd.nodeBounds)(p),this.horizontal&&this.direction==="ltr"){if(x=Math.round(y.left),g=Math.round(y.right),x>n&&s)return s;if(g>n)return p;s=p,t.push(p)}else if(this.horizontal&&this.direction==="rtl"){if(x=Math.round(this.horizontal?y.left:y.top),g=Math.round(this.horizontal?y.right:y.bottom),g<r&&s)return s;if(x<r)return p;s=p,t.push(p)}else{if(d=Math.round(y.top),h=Math.round(y.bottom),d>n&&s)return s;if(h>n)return p;s=p,t.push(p)}}),o)return this.findTextEndRange(o,r,n);return this.findTextEndRange(s,r,n)}findTextStartRange(e,r,n){for(var t=this.splitTextNodeIntoRanges(e),a,s,o,p,x,g=0;g<t.length;g++)if(a=t[g],s=a.getBoundingClientRect(),this.horizontal&&this.direction==="ltr"){if(o=s.left,o>=r)return a}else if(this.horizontal&&this.direction==="rtl"){if(x=s.right,x<=n)return a}else if(p=s.top,p>=r)return a;return t[0]}findTextEndRange(e,r,n){for(var t=this.splitTextNodeIntoRanges(e),a,s,o,p,x,g,d,h=0;h<t.length;h++){if(s=t[h],o=s.getBoundingClientRect(),this.horizontal&&this.direction==="ltr"){if(p=o.left,x=o.right,p>n&&a)return a;if(x>n)return s}else if(this.horizontal&&this.direction==="rtl"){if(p=o.left,x=o.right,x<r&&a)return a;if(p<r)return s}else{if(g=o.top,d=o.bottom,g>n&&a)return a;if(d>n)return s}a=s}return t[t.length-1]}splitTextNodeIntoRanges(e,r){var n=[],t=e.textContent||"",a=t.trim(),s,o=e.ownerDocument,p=r||" ",x=a.indexOf(p);if(x===-1||e.nodeType!=Node.TEXT_NODE)return s=o.createRange(),s.selectNodeContents(e),[s];for(s=o.createRange(),s.setStart(e,0),s.setEnd(e,x),n.push(s),s=!1;x!=-1;)x=a.indexOf(p,x+1),x>0&&(s&&(s.setEnd(e,x),n.push(s)),s=o.createRange(),s.setStart(e,x+1));return s&&(s.setEnd(e,a.length),n.push(s)),n}rangePairToCfiPair(e,r){var n=r.start,t=r.end;n.collapse(!0),t.collapse(!1);let a=new Oo.default(n,e).toString(),s=new Oo.default(t,e).toString();return{start:a,end:s}}rangeListToCfiList(e,r){for(var n=[],t,a=0;a<r.length;a++)t=this.rangePairToCfiPair(e,r[a]),n.push(t);return n}axis(e){return e&&(this.horizontal=e==="horizontal"),this.horizontal}}var Lx=wx;Ya.default=Lx;Object.defineProperty(vi,"__esModule",{value:!0});vi.default=void 0;var Dx=bu(Hr.exports),nn=nt,Ji=bu(xr),Kd=bu(Ya),Px=yn,Pn=nr;function bu(i){return i&&i.__esModule?i:{default:i}}const Vd=typeof navigator!="undefined",Rx=Vd&&/Chrome/.test(navigator.userAgent),Gd=Vd&&!Rx&&/AppleWebKit/.test(navigator.userAgent),Cx=1;class Hd{constructor(e,r,n,t){this.epubcfi=new Ji.default,this.document=e,this.documentElement=this.document.documentElement,this.content=r||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=t||0,this.cfiBase=n||"",this.epubReadingSystem("epub.js",Pn.EPUBJS_VERSION),this.called=0,this.active=!0,this.listeners()}static get listenedEvents(){return Pn.DOM_EVENTS}width(e){var r=this.content;return e&&(0,nn.isNumber)(e)&&(e=e+"px"),e&&(r.style.width=e),parseInt(this.window.getComputedStyle(r).width)}height(e){var r=this.content;return e&&(0,nn.isNumber)(e)&&(e=e+"px"),e&&(r.style.height=e),parseInt(this.window.getComputedStyle(r).height)}contentWidth(e){var r=this.content||this.document.body;return e&&(0,nn.isNumber)(e)&&(e=e+"px"),e&&(r.style.width=e),parseInt(this.window.getComputedStyle(r).width)}contentHeight(e){var r=this.content||this.document.body;return e&&(0,nn.isNumber)(e)&&(e=e+"px"),e&&(r.style.height=e),parseInt(this.window.getComputedStyle(r).height)}textWidth(){let e,r,n=this.document.createRange(),t=this.content||this.document.body,a=(0,nn.borders)(t);return n.selectNodeContents(t),e=n.getBoundingClientRect(),r=e.width,a&&a.width&&(r+=a.width),Math.round(r)}textHeight(){let e,r,n=this.document.createRange(),t=this.content||this.document.body;return n.selectNodeContents(t),e=n.getBoundingClientRect(),r=e.bottom,Math.round(r)}scrollWidth(){var e=this.documentElement.scrollWidth;return e}scrollHeight(){var e=this.documentElement.scrollHeight;return e}overflow(e){return e&&(this.documentElement.style.overflow=e),this.window.getComputedStyle(this.documentElement).overflow}overflowX(e){return e&&(this.documentElement.style.overflowX=e),this.window.getComputedStyle(this.documentElement).overflowX}overflowY(e){return e&&(this.documentElement.style.overflowY=e),this.window.getComputedStyle(this.documentElement).overflowY}css(e,r,n){var t=this.content||this.document.body;return r?t.style.setProperty(e,r,n?"important":""):t.style.removeProperty(e),this.window.getComputedStyle(t)[e]}viewport(e){var r=this.document.querySelector("meta[name='viewport']"),n={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},t=[],a={};if(r&&r.hasAttribute("content")){let s=r.getAttribute("content"),o=s.match(/width\s*=\s*([^,]*)/),p=s.match(/height\s*=\s*([^,]*)/),x=s.match(/initial-scale\s*=\s*([^,]*)/),g=s.match(/minimum-scale\s*=\s*([^,]*)/),d=s.match(/maximum-scale\s*=\s*([^,]*)/),h=s.match(/user-scalable\s*=\s*([^,]*)/);o&&o.length&&typeof o[1]!="undefined"&&(n.width=o[1]),p&&p.length&&typeof p[1]!="undefined"&&(n.height=p[1]),x&&x.length&&typeof x[1]!="undefined"&&(n.scale=x[1]),g&&g.length&&typeof g[1]!="undefined"&&(n.minimum=g[1]),d&&d.length&&typeof d[1]!="undefined"&&(n.maximum=d[1]),h&&h.length&&typeof h[1]!="undefined"&&(n.scalable=h[1])}return a=(0,nn.defaults)(e||{},n),e&&(a.width&&t.push("width="+a.width),a.height&&t.push("height="+a.height),a.scale&&t.push("initial-scale="+a.scale),a.scalable==="no"?(t.push("minimum-scale="+a.scale),t.push("maximum-scale="+a.scale),t.push("user-scalable="+a.scalable)):(a.scalable&&t.push("user-scalable="+a.scalable),a.minimum&&t.push("minimum-scale="+a.minimum),a.maximum&&t.push("minimum-scale="+a.maximum)),r||(r=this.document.createElement("meta"),r.setAttribute("name","viewport"),this.document.querySelector("head").appendChild(r)),r.setAttribute("content",t.join(", ")),this.window.scrollTo(0,0)),a}expand(){this.emit(Pn.EVENTS.CONTENTS.EXPAND)}listeners(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),typeof ResizeObserver=="undefined"?(this.resizeListeners(),this.visibilityListeners()):this.resizeObservers(),this.linksHandler()}removeListeners(){this.removeEventListeners(),this.removeSelectionListeners(),this.observer&&this.observer.disconnect(),clearTimeout(this.expanding)}resizeCheck(){let e=this.textWidth(),r=this.textHeight();(e!=this._size.width||r!=this._size.height)&&(this._size={width:e,height:r},this.onResize&&this.onResize(this._size),this.emit(Pn.EVENTS.CONTENTS.RESIZE,this._size))}resizeListeners(){clearTimeout(this.expanding),requestAnimationFrame(this.resizeCheck.bind(this)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}visibilityListeners(){document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.active===!1?(this.active=!0,this.resizeListeners()):(this.active=!1,clearTimeout(this.expanding))})}transitionListeners(){let e=this.content;e.style.transitionProperty="font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height",e.style.transitionDuration="0.001ms",e.style.transitionTimingFunction="linear",e.style.transitionDelay="0",this._resizeCheck=this.resizeCheck.bind(this),this.document.addEventListener("transitionend",this._resizeCheck)}mediaQueryListeners(){for(var e=this.document.styleSheets,r=function(o){o.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),n=0;n<e.length;n+=1){var t;try{t=e[n].cssRules}catch(o){return}if(!t)return;for(var a=0;a<t.length;a+=1)if(t[a].media){var s=this.window.matchMedia(t[a].media.mediaText);s.addListener(r)}}}resizeObservers(){this.observer=new ResizeObserver(e=>{requestAnimationFrame(this.resizeCheck.bind(this))}),this.observer.observe(this.document.documentElement)}mutationObservers(){this.observer=new MutationObserver(r=>{this.resizeCheck()});let e={attributes:!0,childList:!0,characterData:!0,subtree:!0};this.observer.observe(this.document,e)}imageLoadListeners(){for(var e=this.document.querySelectorAll("img"),r,n=0;n<e.length;n++)r=e[n],typeof r.naturalWidth!="undefined"&&r.naturalWidth===0&&(r.onload=this.expand.bind(this))}fontLoadListeners(){!this.document||!this.document.fonts||this.document.fonts.ready.then(function(){this.resizeCheck()}.bind(this))}root(){return this.document?this.document.documentElement:null}locationOf(e,r){var n,t={left:0,top:0};if(!this.document)return t;if(this.epubcfi.isCfiString(e)){let a=new Ji.default(e).toRange(this.document,r);if(a){try{if(!a.endContainer||a.startContainer==a.endContainer&&a.startOffset==a.endOffset){let s=a.startContainer.textContent.indexOf(" ",a.startOffset);s==-1&&(s=a.startContainer.textContent.length),a.setEnd(a.startContainer,s)}}catch(s){console.error("setting end offset to start container length failed",s)}if(a.startContainer.nodeType===Node.ELEMENT_NODE)n=a.startContainer.getBoundingClientRect(),t.left=n.left,t.top=n.top;else if(Gd){let s=a.startContainer,o=new Range;try{s.nodeType===Cx?n=s.getBoundingClientRect():a.startOffset+2<s.length?(o.setStart(s,a.startOffset),o.setEnd(s,a.startOffset+2),n=o.getBoundingClientRect()):a.startOffset-2>0?(o.setStart(s,a.startOffset-2),o.setEnd(s,a.startOffset),n=o.getBoundingClientRect()):n=s.parentNode.getBoundingClientRect()}catch(p){console.error(p,p.stack)}}else n=a.getBoundingClientRect()}}else if(typeof e=="string"&&e.indexOf("#")>-1){let a=e.substring(e.indexOf("#")+1),s=this.document.getElementById(a);if(s)if(Gd){let o=new Range;o.selectNode(s),n=o.getBoundingClientRect()}else n=s.getBoundingClientRect()}return n&&(t.left=n.left,t.top=n.top),t}addStylesheet(e){return new Promise(function(r,n){var t,a=!1;if(!this.document){r(!1);return}if(t=this.document.querySelector("link[href='"+e+"']"),t){r(!0);return}t=this.document.createElement("link"),t.type="text/css",t.rel="stylesheet",t.href=e,t.onload=t.onreadystatechange=function(){!a&&(!this.readyState||this.readyState=="complete")&&(a=!0,setTimeout(()=>{r(!0)},1))},this.document.head.appendChild(t)}.bind(this))}_getStylesheetNode(e){var r;return e="epubjs-inserted-css-"+(e||""),this.document?(r=this.document.getElementById(e),r||(r=this.document.createElement("style"),r.id=e,this.document.head.appendChild(r)),r):!1}addStylesheetCss(e,r){if(!this.document||!e)return!1;var n;return n=this._getStylesheetNode(r),n.innerHTML=e,!0}addStylesheetRules(e,r){var n;if(!(!this.document||!e||e.length===0))if(n=this._getStylesheetNode(r).sheet,Object.prototype.toString.call(e)==="[object Array]")for(var t=0,a=e.length;t<a;t++){var s=1,o=e[t],p=e[t][0],x="";Object.prototype.toString.call(o[1][0])==="[object Array]"&&(o=o[1],s=0);for(var g=o.length;s<g;s++){var d=o[s];x+=d[0]+":"+d[1]+(d[2]?" !important":"")+`;
`}n.insertRule(p+"{"+x+"}",n.cssRules.length)}else Object.keys(e).forEach(y=>{const b=e[y];if(Array.isArray(b))b.forEach(T=>{const c=Object.keys(T).map(u=>`${u}:${T[u]}`).join(";");n.insertRule(`${y}{${c}}`,n.cssRules.length)});else{const _=Object.keys(b).map(c=>`${c}:${b[c]}`).join(";");n.insertRule(`${y}{${_}}`,n.cssRules.length)}})}addScript(e){return new Promise(function(r,n){var t,a=!1;if(!this.document){r(!1);return}t=this.document.createElement("script"),t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){!a&&(!this.readyState||this.readyState=="complete")&&(a=!0,setTimeout(function(){r(!0)},1))},this.document.head.appendChild(t)}.bind(this))}addClass(e){var r;!this.document||(r=this.content||this.document.body,r&&r.classList.add(e))}removeClass(e){var r;!this.document||(r=this.content||this.document.body,r&&r.classList.remove(e))}addEventListeners(){!this.document||(this._triggerEvent=this.triggerEvent.bind(this),Pn.DOM_EVENTS.forEach(function(e){this.document.addEventListener(e,this._triggerEvent,{passive:!0})},this))}removeEventListeners(){!this.document||(Pn.DOM_EVENTS.forEach(function(e){this.document.removeEventListener(e,this._triggerEvent,{passive:!0})},this),this._triggerEvent=void 0)}triggerEvent(e){this.emit(e.type,e)}addSelectionListeners(){!this.document||(this._onSelectionChange=this.onSelectionChange.bind(this),this.document.addEventListener("selectionchange",this._onSelectionChange,{passive:!0}))}removeSelectionListeners(){!this.document||(this.document.removeEventListener("selectionchange",this._onSelectionChange,{passive:!0}),this._onSelectionChange=void 0)}onSelectionChange(e){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var r=this.window.getSelection();this.triggerSelectedEvent(r)}.bind(this),250)}triggerSelectedEvent(e){var r,n;e&&e.rangeCount>0&&(r=e.getRangeAt(0),r.collapsed||(n=new Ji.default(r,this.cfiBase).toString(),this.emit(Pn.EVENTS.CONTENTS.SELECTED,n),this.emit(Pn.EVENTS.CONTENTS.SELECTED_RANGE,r)))}range(e,r){var n=new Ji.default(e);return n.toRange(this.document,r)}cfiFromRange(e,r){return new Ji.default(e,this.cfiBase,r).toString()}cfiFromNode(e,r){return new Ji.default(e,this.cfiBase,r).toString()}map(e){var r=new Kd.default(e);return r.section()}size(e,r){var n={scale:1,scalable:"no"};this.layoutStyle("scrolling"),e>=0&&(this.width(e),n.width=e,this.css("padding","0 "+e/12+"px")),r>=0&&(this.height(r),n.height=r),this.css("margin","0"),this.css("box-sizing","border-box"),this.viewport(n)}columns(e,r,n,t,a){let s=(0,nn.prefixed)("column-axis"),o=(0,nn.prefixed)("column-gap"),p=(0,nn.prefixed)("column-width"),x=(0,nn.prefixed)("column-fill"),d=this.writingMode().indexOf("vertical")===0?"vertical":"horizontal";this.layoutStyle("paginated"),a==="rtl"&&d==="horizontal"&&this.direction(a),this.width(e),this.height(r),this.viewport({width:e,height:r,scale:1,scalable:"no"}),this.css("overflow-y","hidden"),this.css("margin","0",!0),d==="vertical"?(this.css("padding-top",t/2+"px",!0),this.css("padding-bottom",t/2+"px",!0),this.css("padding-left","20px"),this.css("padding-right","20px"),this.css(s,"vertical")):(this.css("padding-top","20px"),this.css("padding-bottom","20px"),this.css("padding-left",t/2+"px",!0),this.css("padding-right",t/2+"px",!0),this.css(s,"horizontal")),this.css("box-sizing","border-box"),this.css("max-width","inherit"),this.css(x,"auto"),this.css(o,t+"px"),this.css(p,n+"px"),this.css("-webkit-line-box-contain","block glyphs replaced")}scaler(e,r,n){var t="scale("+e+")",a="";this.css("transform-origin","top left"),(r>=0||n>=0)&&(a=" translate("+(r||0)+"px, "+(n||0)+"px )"),this.css("transform",t+a)}fit(e,r,n){var t=this.viewport(),a=parseInt(t.width),s=parseInt(t.height),o=e/a,p=r/s,x=o<p?o:p;if(this.layoutStyle("paginated"),this.width(a),this.height(s),this.overflow("hidden"),this.scaler(x,0,0),this.css("background-size",a*x+"px "+s*x+"px"),this.css("background-color","transparent"),n&&n.properties.includes("page-spread-left")){var g=e-a*x;this.css("margin-left",g+"px")}}direction(e){this.documentElement&&(this.documentElement.style.direction=e)}mapPage(e,r,n,t,a){var s=new Kd.default(r,a);return s.page(this,e,n,t)}linksHandler(){(0,Px.replaceLinks)(this.content,e=>{this.emit(Pn.EVENTS.CONTENTS.LINK_CLICKED,e)})}writingMode(e){let r=(0,nn.prefixed)("writing-mode");return e&&this.documentElement&&(this.documentElement.style[r]=e),this.window.getComputedStyle(this.documentElement)[r]||""}layoutStyle(e){return e&&(this._layoutStyle=e,navigator.epubReadingSystem.layoutStyle=this._layoutStyle),this._layoutStyle||"paginated"}epubReadingSystem(e,r){return navigator.epubReadingSystem={name:e,version:r,layoutStyle:this.layoutStyle(),hasFeature:function(n){switch(n){case"dom-manipulation":return!0;case"layout-changes":return!0;case"touch-events":return!0;case"mouse-events":return!0;case"keyboard-events":return!0;case"spine-scripting":return!1;default:return!1}}},navigator.epubReadingSystem}destroy(){this.removeListeners()}}(0,Dx.default)(Hd.prototype);var Ix=Hd;vi.default=Ix;var Ao={};Object.defineProperty(Ao,"__esModule",{value:!0});Ao.default=void 0;var Mx=Yd(Hr.exports),kx=Yd(xr),$d=nr;function Yd(i){return i&&i.__esModule?i:{default:i}}class Nx{constructor(e){this.rendition=e,this.highlights=[],this.underlines=[],this.marks=[],this._annotations={},this._annotationsBySectionIndex={},this.rendition.hooks.render.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.clear.bind(this))}add(e,r,n,t,a,s){let o=encodeURI(r+e),x=new kx.default(r).spinePos,g=new Xd({type:e,cfiRange:r,data:n,sectionIndex:x,cb:t,className:a,styles:s});return this._annotations[o]=g,x in this._annotationsBySectionIndex?this._annotationsBySectionIndex[x].push(o):this._annotationsBySectionIndex[x]=[o],this.rendition.views().forEach(h=>{g.sectionIndex===h.index&&g.attach(h)}),g}remove(e,r){let n=encodeURI(e+r);if(n in this._annotations){let t=this._annotations[n];if(r&&t.type!==r)return;this.rendition.views().forEach(s=>{this._removeFromAnnotationBySectionIndex(t.sectionIndex,n),t.sectionIndex===s.index&&t.detach(s)}),delete this._annotations[n]}}_removeFromAnnotationBySectionIndex(e,r){this._annotationsBySectionIndex[e]=this._annotationsAt(e).filter(n=>n!==r)}_annotationsAt(e){return this._annotationsBySectionIndex[e]}highlight(e,r,n,t,a){return this.add("highlight",e,r,n,t,a)}underline(e,r,n,t,a){return this.add("underline",e,r,n,t,a)}mark(e,r,n){return this.add("mark",e,r,n)}each(){return this._annotations.forEach.apply(this._annotations,arguments)}inject(e){let r=e.index;r in this._annotationsBySectionIndex&&this._annotationsBySectionIndex[r].forEach(t=>{this._annotations[t].attach(e)})}clear(e){let r=e.index;r in this._annotationsBySectionIndex&&this._annotationsBySectionIndex[r].forEach(t=>{this._annotations[t].detach(e)})}show(){}hide(){}}class Xd{constructor({type:e,cfiRange:r,data:n,sectionIndex:t,cb:a,className:s,styles:o}){this.type=e,this.cfiRange=r,this.data=n,this.sectionIndex=t,this.mark=void 0,this.cb=a,this.className=s,this.styles=o}update(e){this.data=e}attach(e){let{cfiRange:r,data:n,type:t,mark:a,cb:s,className:o,styles:p}=this,x;return t==="highlight"?x=e.highlight(r,n,s,o,p):t==="underline"?x=e.underline(r,n,s,o,p):t==="mark"&&(x=e.mark(r,n,s)),this.mark=x,this.emit($d.EVENTS.ANNOTATION.ATTACH,x),x}detach(e){let{cfiRange:r,type:n}=this,t;return e&&(n==="highlight"?t=e.unhighlight(r):n==="underline"?t=e.ununderline(r):n==="mark"&&(t=e.unmark(r))),this.mark=void 0,this.emit($d.EVENTS.ANNOTATION.DETACH,t),t}text(){}}(0,Mx.default)(Xd.prototype);var Bx=Nx;Ao.default=Bx;var Xa={},En={},wo={};Object.defineProperty(wo,"__esModule",{value:!0});wo.createElement=Zd;function Zd(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}wo.default={createElement:Zd};var Za={};Object.defineProperty(Za,"__esModule",{value:!0});Za.proxyMouse=Qd;Za.clone=Jd;Za.default={proxyMouse:Qd};function Qd(i,e){function r(s){for(var o=e.length-1;o>=0;o--){var p=e[o],x=s.clientX,g=s.clientY;if(s.touches&&s.touches.length&&(x=s.touches[0].clientX,g=s.touches[0].clientY),!!Fx(p,i,x,g)){p.dispatchEvent(Jd(s));break}}}if(i.nodeName==="iframe"||i.nodeName==="IFRAME")try{this.target=i.contentDocument}catch(s){this.target=i}else this.target=i;for(var n=["mouseup","mousedown","click","touchstart"],t=0;t<n.length;t++){var a=n[t];this.target.addEventListener(a,function(s){return r(s)},!1)}}function Jd(i){var e=Object.assign({},i,{bubbles:!1});try{return new MouseEvent(i.type,e)}catch(n){var r=document.createEvent("MouseEvents");return r.initMouseEvent(i.type,!1,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),r}}function Fx(i,e,r,n){var t=e.getBoundingClientRect();function a(g,d,h){var y=g.top-t.top,b=g.left-t.left,T=y+g.height,_=b+g.width;return y<=h&&b<=d&&T>h&&_>d}var s=i.getBoundingClientRect();if(!a(s,r,n))return!1;for(var o=i.getClientRects(),p=0,x=o.length;p<x;p++)if(a(o[p],r,n))return!0;return!1}Object.defineProperty(En,"__esModule",{value:!0});En.Underline=En.Highlight=En.Mark=En.Pane=void 0;var Ux=function i(e,r,n){e===null&&(e=Function.prototype);var t=Object.getOwnPropertyDescriptor(e,r);if(t===void 0){var a=Object.getPrototypeOf(e);return a===null?void 0:i(a,r,n)}else{if("value"in t)return t.value;var s=t.get;return s===void 0?void 0:s.call(n)}},Lo=function(){function i(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,r,n){return r&&i(e.prototype,r),n&&i(e,n),e}}(),jx=wo,Qa=qd(jx),Wx=Za,zx=qd(Wx);function qd(i){return i&&i.__esModule?i:{default:i}}function eh(i,e){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:i}function th(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(i,e):i.__proto__=e)}function Do(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}En.Pane=function(){function i(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document.body;Do(this,i),this.target=e,this.element=Qa.default.createElement("svg"),this.marks=[],this.element.style.position="absolute",this.element.setAttribute("pointer-events","none"),zx.default.proxyMouse(this.target,this.marks),this.container=r,this.container.appendChild(this.element),this.render()}return Lo(i,[{key:"addMark",value:function(r){var n=Qa.default.createElement("g");return this.element.appendChild(n),r.bind(n,this.container),this.marks.push(r),r.render(),r}},{key:"removeMark",value:function(r){var n=this.marks.indexOf(r);if(n!==-1){var t=r.unbind();this.element.removeChild(t),this.marks.splice(n,1)}}},{key:"render",value:function(){Hx(this.element,Gx(this.target,this.container));var r=!0,n=!1,t=void 0;try{for(var a=this.marks[Symbol.iterator](),s;!(r=(s=a.next()).done);r=!0){var o=s.value;o.render()}}catch(p){n=!0,t=p}finally{try{!r&&a.return&&a.return()}finally{if(n)throw t}}}}]),i}();var Kx=En.Mark=function(){function i(){Do(this,i),this.element=null}return Lo(i,[{key:"bind",value:function(r,n){this.element=r,this.container=n}},{key:"unbind",value:function(){var r=this.element;return this.element=null,r}},{key:"render",value:function(){}},{key:"dispatchEvent",value:function(r){!this.element||this.element.dispatchEvent(r)}},{key:"getBoundingClientRect",value:function(){return this.element.getBoundingClientRect()}},{key:"getClientRects",value:function(){for(var r=[],n=this.element.firstChild;n;)r.push(n.getBoundingClientRect()),n=n.nextSibling;return r}},{key:"filteredRanges",value:function(){var r=Array.from(this.range.getClientRects());return r.filter(function(n){for(var t=0;t<r.length;t++){if(r[t]===n)return!0;var a=$x(r[t],n);if(a)return!1}return!0})}}]),i}(),Vx=En.Highlight=function(i){th(e,i);function e(r,n,t,a){Do(this,e);var s=eh(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.range=r,s.className=n,s.data=t||{},s.attributes=a||{},s}return Lo(e,[{key:"bind",value:function(n,t){Ux(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"bind",this).call(this,n,t);for(var a in this.data)this.data.hasOwnProperty(a)&&(this.element.dataset[a]=this.data[a]);for(var a in this.attributes)this.attributes.hasOwnProperty(a)&&this.element.setAttribute(a,this.attributes[a]);this.className&&this.element.classList.add(this.className)}},{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var n=this.element.ownerDocument.createDocumentFragment(),t=this.filteredRanges(),a=this.element.getBoundingClientRect(),s=this.container.getBoundingClientRect(),o=0,p=t.length;o<p;o++){var x=t[o],g=Qa.default.createElement("rect");g.setAttribute("x",x.left-a.left+s.left),g.setAttribute("y",x.top-a.top+s.top),g.setAttribute("height",x.height),g.setAttribute("width",x.width),n.appendChild(g)}this.element.appendChild(n)}}]),e}(Kx);En.Underline=function(i){th(e,i);function e(r,n,t,a){return Do(this,e),eh(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n,t,a))}return Lo(e,[{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var n=this.element.ownerDocument.createDocumentFragment(),t=this.filteredRanges(),a=this.element.getBoundingClientRect(),s=this.container.getBoundingClientRect(),o=0,p=t.length;o<p;o++){var x=t[o],g=Qa.default.createElement("rect");g.setAttribute("x",x.left-a.left+s.left),g.setAttribute("y",x.top-a.top+s.top),g.setAttribute("height",x.height),g.setAttribute("width",x.width),g.setAttribute("fill","none");var d=Qa.default.createElement("line");d.setAttribute("x1",x.left-a.left+s.left),d.setAttribute("x2",x.left-a.left+s.left+x.width),d.setAttribute("y1",x.top-a.top+s.top+x.height-1),d.setAttribute("y2",x.top-a.top+s.top+x.height-1),d.setAttribute("stroke-width",1),d.setAttribute("stroke","black"),d.setAttribute("stroke-linecap","square"),n.appendChild(g),n.appendChild(d)}this.element.appendChild(n)}}]),e}(Vx);function Gx(i,e){var r=e.getBoundingClientRect(),n=i.getBoundingClientRect();return{top:n.top-r.top,left:n.left-r.left,height:i.scrollHeight,width:i.scrollWidth}}function Hx(i,e){i.style.setProperty("top",e.top+"px","important"),i.style.setProperty("left",e.left+"px","important"),i.style.setProperty("height",e.height+"px","important"),i.style.setProperty("width",e.width+"px","important")}function $x(i,e){return e.right<=i.right&&e.left>=i.left&&e.top>=i.top&&e.bottom<=i.bottom}Object.defineProperty(Xa,"__esModule",{value:!0});Xa.default=void 0;var Yx=Su(Hr.exports),or=nt,Xx=Su(xr),Zx=Su(vi),Br=nr,Po=En;function Su(i){return i&&i.__esModule?i:{default:i}}class rh{constructor(e,r){this.settings=(0,or.extend)({ignoreClass:"",axis:void 0,direction:void 0,width:0,height:0,layout:void 0,globalLayoutProperties:{},method:void 0,forceRight:!1,allowScriptedContent:!1,allowPopups:!1},r||{}),this.id="epubjs-view-"+(0,or.uuid)(),this.section=e,this.index=e.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new Xx.default,this.layout=this.settings.layout,this.pane=void 0,this.highlights={},this.underlines={},this.marks={}}container(e){var r=document.createElement("div");return r.classList.add("epub-view"),r.style.height="0px",r.style.width="0px",r.style.overflow="hidden",r.style.position="relative",r.style.display="block",e&&e=="horizontal"?r.style.flex="none":r.style.flex="initial",r}create(){return this.iframe?this.iframe:(this.element||(this.element=this.createContainer()),this.iframe=document.createElement("iframe"),this.iframe.id=this.id,this.iframe.scrolling="no",this.iframe.style.overflow="hidden",this.iframe.seamless="seamless",this.iframe.style.border="none",this.iframe.sandbox="allow-same-origin",this.settings.allowScriptedContent&&(this.iframe.sandbox+=" allow-scripts"),this.settings.allowPopups&&(this.iframe.sandbox+=" allow-popups"),this.iframe.setAttribute("enable-annotation","true"),this.resizing=!0,this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this.element.setAttribute("ref",this.index),this.added=!0,this.elementBounds=(0,or.bounds)(this.element),"srcdoc"in this.iframe?this.supportsSrcdoc=!0:this.supportsSrcdoc=!1,this.settings.method||(this.settings.method=this.supportsSrcdoc?"srcdoc":"write"),this.iframe)}render(e,r){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(e)),this.sectionRender.then(function(n){return this.load(n)}.bind(this)).then(function(){let n=this.contents.writingMode(),t;return this.settings.flow==="scrolled"?t=n.indexOf("vertical")===0?"horizontal":"vertical":t=n.indexOf("vertical")===0?"vertical":"horizontal",n.indexOf("vertical")===0&&this.settings.flow==="paginated"&&(this.layout.delta=this.layout.height),this.setAxis(t),this.emit(Br.EVENTS.VIEWS.AXIS,t),this.setWritingMode(n),this.emit(Br.EVENTS.VIEWS.WRITING_MODE,n),this.layout.format(this.contents,this.section,this.axis),this.addListeners(),new Promise((a,s)=>{this.expand(),this.settings.forceRight&&(this.element.style.marginLeft=this.width()+"px"),a()})}.bind(this),function(n){return this.emit(Br.EVENTS.VIEWS.LOAD_ERROR,n),new Promise((t,a)=>{a(n)})}.bind(this)).then(function(){this.emit(Br.EVENTS.VIEWS.RENDERED,this.section)}.bind(this))}reset(){this.iframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this._textWidth=void 0,this._contentWidth=void 0,this._textHeight=void 0,this._contentHeight=void 0),this._needsReframe=!0}size(e,r){var n=e||this.settings.width,t=r||this.settings.height;this.layout.name==="pre-paginated"?this.lock("both",n,t):this.settings.axis==="horizontal"?this.lock("height",n,t):this.lock("width",n,t),this.settings.width=n,this.settings.height=t}lock(e,r,n){var t=(0,or.borders)(this.element),a;this.iframe?a=(0,or.borders)(this.iframe):a={width:0,height:0},e=="width"&&(0,or.isNumber)(r)&&(this.lockedWidth=r-t.width-a.width),e=="height"&&(0,or.isNumber)(n)&&(this.lockedHeight=n-t.height-a.height),e==="both"&&(0,or.isNumber)(r)&&(0,or.isNumber)(n)&&(this.lockedWidth=r-t.width-a.width,this.lockedHeight=n-t.height-a.height),this.displayed&&this.iframe&&this.expand()}expand(e){var r=this.lockedWidth,n=this.lockedHeight,t;!this.iframe||this._expanding||(this._expanding=!0,this.layout.name==="pre-paginated"?(r=this.layout.columnWidth,n=this.layout.height):this.settings.axis==="horizontal"?(r=this.contents.textWidth(),r%this.layout.pageWidth>0&&(r=Math.ceil(r/this.layout.pageWidth)*this.layout.pageWidth),this.settings.forceEvenPages&&(t=r/this.layout.pageWidth,this.layout.divisor>1&&this.layout.name==="reflowable"&&t%2>0&&(r+=this.layout.pageWidth))):this.settings.axis==="vertical"&&(n=this.contents.textHeight(),this.settings.flow==="paginated"&&n%this.layout.height>0&&(n=Math.ceil(n/this.layout.height)*this.layout.height)),(this._needsReframe||r!=this._width||n!=this._height)&&this.reframe(r,n),this._expanding=!1)}reframe(e,r){var n;(0,or.isNumber)(e)&&(this.element.style.width=e+"px",this.iframe.style.width=e+"px",this._width=e),(0,or.isNumber)(r)&&(this.element.style.height=r+"px",this.iframe.style.height=r+"px",this._height=r);let t=this.prevBounds?e-this.prevBounds.width:e,a=this.prevBounds?r-this.prevBounds.height:r;n={width:e,height:r,widthDelta:t,heightDelta:a},this.pane&&this.pane.render(),requestAnimationFrame(()=>{let s;for(let o in this.marks)this.marks.hasOwnProperty(o)&&(s=this.marks[o],this.placeMark(s.element,s.range))}),this.onResize(this,n),this.emit(Br.EVENTS.VIEWS.RESIZED,n),this.prevBounds=n,this.elementBounds=(0,or.bounds)(this.element)}load(e){var r=new or.defer,n=r.promise;if(!this.iframe)return r.reject(new Error("No Iframe Available")),n;if(this.iframe.onload=function(a){this.onLoad(a,r)}.bind(this),this.settings.method==="blobUrl")this.blobUrl=(0,or.createBlobUrl)(e,"application/xhtml+xml"),this.iframe.src=this.blobUrl,this.element.appendChild(this.iframe);else if(this.settings.method==="srcdoc")this.iframe.srcdoc=e,this.element.appendChild(this.iframe);else{if(this.element.appendChild(this.iframe),this.document=this.iframe.contentDocument,!this.document)return r.reject(new Error("No Document Available")),n;if(this.iframe.contentDocument.open(),window.MSApp&&MSApp.execUnsafeLocalFunction){var t=this;MSApp.execUnsafeLocalFunction(function(){t.iframe.contentDocument.write(e)})}else this.iframe.contentDocument.write(e);this.iframe.contentDocument.close()}return n}onLoad(e,r){this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new Zx.default(this.document,this.document.body,this.section.cfiBase,this.section.index),this.rendering=!1;var n=this.document.querySelector("link[rel='canonical']");n?n.setAttribute("href",this.section.canonical):(n=this.document.createElement("link"),n.setAttribute("rel","canonical"),n.setAttribute("href",this.section.canonical),this.document.querySelector("head").appendChild(n)),this.contents.on(Br.EVENTS.CONTENTS.EXPAND,()=>{this.displayed&&this.iframe&&(this.expand(),this.contents&&this.layout.format(this.contents))}),this.contents.on(Br.EVENTS.CONTENTS.RESIZE,t=>{this.displayed&&this.iframe&&(this.expand(),this.contents&&this.layout.format(this.contents))}),r.resolve(this.contents)}setLayout(e){this.layout=e,this.contents&&(this.layout.format(this.contents),this.expand())}setAxis(e){this.settings.axis=e,e=="horizontal"?this.element.style.flex="none":this.element.style.flex="initial",this.size()}setWritingMode(e){this.writingMode=e}addListeners(){}removeListeners(e){}display(e){var r=new or.defer;return this.displayed?r.resolve(this):this.render(e).then(function(){this.emit(Br.EVENTS.VIEWS.DISPLAYED,this),this.onDisplayed(this),this.displayed=!0,r.resolve(this)}.bind(this),function(n){r.reject(n,this)}),r.promise}show(){this.element.style.visibility="visible",this.iframe&&(this.iframe.style.visibility="visible",this.iframe.style.transform="translateZ(0)",this.iframe.offsetWidth,this.iframe.style.transform=null),this.emit(Br.EVENTS.VIEWS.SHOWN,this)}hide(){this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.stopExpanding=!0,this.emit(Br.EVENTS.VIEWS.HIDDEN,this)}offset(){return{top:this.element.offsetTop,left:this.element.offsetLeft}}width(){return this._width}height(){return this._height}position(){return this.element.getBoundingClientRect()}locationOf(e){this.iframe.getBoundingClientRect();var r=this.contents.locationOf(e,this.settings.ignoreClass);return{left:r.left,top:r.top}}onDisplayed(e){}onResize(e,r){}bounds(e){return(e||!this.elementBounds)&&(this.elementBounds=(0,or.bounds)(this.element)),this.elementBounds}highlight(e,r={},n,t="epubjs-hl",a={}){if(!this.contents)return;const s=Object.assign({fill:"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"},a);let o=this.contents.range(e),p=()=>{this.emit(Br.EVENTS.VIEWS.MARK_CLICKED,e,r)};r.epubcfi=e,this.pane||(this.pane=new Po.Pane(this.iframe,this.element));let x=new Po.Highlight(o,t,r,s),g=this.pane.addMark(x);return this.highlights[e]={mark:g,element:g.element,listeners:[p,n]},g.element.setAttribute("ref",t),g.element.addEventListener("click",p),g.element.addEventListener("touchstart",p),n&&(g.element.addEventListener("click",n),g.element.addEventListener("touchstart",n)),g}underline(e,r={},n,t="epubjs-ul",a={}){if(!this.contents)return;const s=Object.assign({stroke:"black","stroke-opacity":"0.3","mix-blend-mode":"multiply"},a);let o=this.contents.range(e),p=()=>{this.emit(Br.EVENTS.VIEWS.MARK_CLICKED,e,r)};r.epubcfi=e,this.pane||(this.pane=new Po.Pane(this.iframe,this.element));let x=new Po.Underline(o,t,r,s),g=this.pane.addMark(x);return this.underlines[e]={mark:g,element:g.element,listeners:[p,n]},g.element.setAttribute("ref",t),g.element.addEventListener("click",p),g.element.addEventListener("touchstart",p),n&&(g.element.addEventListener("click",n),g.element.addEventListener("touchstart",n)),g}mark(e,r={},n){if(!this.contents)return;if(e in this.marks)return this.marks[e];let t=this.contents.range(e);if(!t)return;let a=t.commonAncestorContainer,s=a.nodeType===1?a:a.parentNode,o=x=>{this.emit(Br.EVENTS.VIEWS.MARK_CLICKED,e,r)};t.collapsed&&a.nodeType===1?(t=new Range,t.selectNodeContents(a)):t.collapsed&&(t=new Range,t.selectNodeContents(s));let p=this.document.createElement("a");return p.setAttribute("ref","epubjs-mk"),p.style.position="absolute",p.dataset.epubcfi=e,r&&Object.keys(r).forEach(x=>{p.dataset[x]=r[x]}),n&&(p.addEventListener("click",n),p.addEventListener("touchstart",n)),p.addEventListener("click",o),p.addEventListener("touchstart",o),this.placeMark(p,t),this.element.appendChild(p),this.marks[e]={element:p,range:t,listeners:[o,n]},s}placeMark(e,r){let n,t,a;if(this.layout.name==="pre-paginated"||this.settings.axis!=="horizontal"){let o=r.getBoundingClientRect();n=o.top,t=o.right}else{let o=r.getClientRects(),p;for(var s=0;s!=o.length;s++)p=o[s],(!a||p.left<a)&&(a=p.left,t=Math.ceil(a/this.layout.props.pageWidth)*this.layout.props.pageWidth-this.layout.gap/2,n=p.top)}e.style.top=`${n}px`,e.style.left=`${t}px`}unhighlight(e){let r;e in this.highlights&&(r=this.highlights[e],this.pane.removeMark(r.mark),r.listeners.forEach(n=>{n&&(r.element.removeEventListener("click",n),r.element.removeEventListener("touchstart",n))}),delete this.highlights[e])}ununderline(e){let r;e in this.underlines&&(r=this.underlines[e],this.pane.removeMark(r.mark),r.listeners.forEach(n=>{n&&(r.element.removeEventListener("click",n),r.element.removeEventListener("touchstart",n))}),delete this.underlines[e])}unmark(e){let r;e in this.marks&&(r=this.marks[e],this.element.removeChild(r.element),r.listeners.forEach(n=>{n&&(r.element.removeEventListener("click",n),r.element.removeEventListener("touchstart",n))}),delete this.marks[e])}destroy(){for(let e in this.highlights)this.unhighlight(e);for(let e in this.underlines)this.ununderline(e);for(let e in this.marks)this.unmark(e);this.blobUrl&&(0,or.revokeBlobUrl)(this.blobUrl),this.displayed&&(this.displayed=!1,this.removeListeners(),this.contents.destroy(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.pane&&(this.pane.element.remove(),this.pane=void 0),this.iframe=void 0,this.contents=void 0,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}(0,Yx.default)(rh.prototype);var Qx=rh;Xa.default=Qx;var qi={},Ro={};Object.defineProperty(Ro,"__esModule",{value:!0});Ro.createDefiner=nh;Ro.default=Jx;function Jx(){var i="reverse",e=nh();return document.body.appendChild(e),e.scrollLeft>0?i="default":typeof Element!="undefined"&&Element.prototype.scrollIntoView?(e.children[0].children[1].scrollIntoView(),e.scrollLeft<0&&(i="negative")):(e.scrollLeft=1,e.scrollLeft===0&&(i="negative")),document.body.removeChild(e),i}function nh(){var i=document.createElement("div");i.dir="rtl",i.style.position="fixed",i.style.width="1px",i.style.height="1px",i.style.top="0px",i.style.left="0px",i.style.overflow="hidden";var e=document.createElement("div");e.style.width="2px";var r=document.createElement("span");r.style.width="1px",r.style.display="inline-block";var n=document.createElement("span");return n.style.width="1px",n.style.display="inline-block",e.appendChild(r),e.appendChild(n),i.appendChild(e),i}var Co={};function qx(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}var Tu=qx,eb=typeof Er=="object"&&Er&&Er.Object===Object&&Er,tb=eb,rb=tb,nb=typeof self=="object"&&self&&self.Object===Object&&self,ib=rb||nb||Function("return this")(),ih=ib,ab=ih,sb=function(){return ab.Date.now()},ob=sb,lb=/\s/;function ub(i){for(var e=i.length;e--&&lb.test(i.charAt(e)););return e}var fb=ub,cb=fb,db=/^\s+/;function hb(i){return i&&i.slice(0,cb(i)+1).replace(db,"")}var pb=hb,vb=ih,gb=vb.Symbol,ah=gb,sh=ah,oh=Object.prototype,mb=oh.hasOwnProperty,yb=oh.toString,Ja=sh?sh.toStringTag:void 0;function Eb(i){var e=mb.call(i,Ja),r=i[Ja];try{i[Ja]=void 0;var n=!0}catch(a){}var t=yb.call(i);return n&&(e?i[Ja]=r:delete i[Ja]),t}var _b=Eb,xb=Object.prototype,bb=xb.toString;function Sb(i){return bb.call(i)}var Tb=Sb,lh=ah,Ob=_b,Ab=Tb,wb="[object Null]",Lb="[object Undefined]",uh=lh?lh.toStringTag:void 0;function Db(i){return i==null?i===void 0?Lb:wb:uh&&uh in Object(i)?Ob(i):Ab(i)}var Pb=Db;function Rb(i){return i!=null&&typeof i=="object"}var Cb=Rb,Ib=Pb,Mb=Cb,kb="[object Symbol]";function Nb(i){return typeof i=="symbol"||Mb(i)&&Ib(i)==kb}var Bb=Nb,Fb=pb,fh=Tu,Ub=Bb,ch=0/0,jb=/^[-+]0x[0-9a-f]+$/i,Wb=/^0b[01]+$/i,zb=/^0o[0-7]+$/i,Kb=parseInt;function Vb(i){if(typeof i=="number")return i;if(Ub(i))return ch;if(fh(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=fh(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=Fb(i);var r=Wb.test(i);return r||zb.test(i)?Kb(i.slice(2),r?2:8):jb.test(i)?ch:+i}var Gb=Vb,Hb=Tu,Ou=ob,dh=Gb,$b="Expected a function",Yb=Math.max,Xb=Math.min;function Zb(i,e,r){var n,t,a,s,o,p,x=0,g=!1,d=!1,h=!0;if(typeof i!="function")throw new TypeError($b);e=dh(e)||0,Hb(r)&&(g=!!r.leading,d="maxWait"in r,a=d?Yb(dh(r.maxWait)||0,e):a,h="trailing"in r?!!r.trailing:h);function y(m){var E=n,S=t;return n=t=void 0,x=m,s=i.apply(S,E),s}function b(m){return x=m,o=setTimeout(c,e),g?y(m):s}function T(m){var E=m-p,S=m-x,O=e-E;return d?Xb(O,a-S):O}function _(m){var E=m-p,S=m-x;return p===void 0||E>=e||E<0||d&&S>=a}function c(){var m=Ou();if(_(m))return u(m);o=setTimeout(c,T(m))}function u(m){return o=void 0,h&&n?y(m):(n=t=void 0,s)}function f(){o!==void 0&&clearTimeout(o),x=0,n=p=t=o=void 0}function v(){return o===void 0?s:u(Ou())}function l(){var m=Ou(),E=_(m);if(n=arguments,t=this,p=m,E){if(o===void 0)return b(p);if(d)return clearTimeout(o),o=setTimeout(c,e),y(p)}return o===void 0&&(o=setTimeout(c,e)),s}return l.cancel=f,l.flush=v,l}var hh=Zb,Qb=hh,Jb=Tu,qb="Expected a function";function eS(i,e,r){var n=!0,t=!0;if(typeof i!="function")throw new TypeError(qb);return Jb(r)&&(n="leading"in r?!!r.leading:n,t="trailing"in r?!!r.trailing:t),Qb(i,e,{leading:n,maxWait:e,trailing:t})}var tS=eS;Object.defineProperty(Co,"__esModule",{value:!0});Co.default=void 0;var Fr=nt,rS=nS(tS);function nS(i){return i&&i.__esModule?i:{default:i}}class iS{constructor(e){this.settings=e||{},this.id="epubjs-container-"+(0,Fr.uuid)(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}create(e){let r=e.height,n=e.width,t=e.overflow||!1,a=e.axis||"vertical",s=e.direction;(0,Fr.extend)(this.settings,e),e.height&&(0,Fr.isNumber)(e.height)&&(r=e.height+"px"),e.width&&(0,Fr.isNumber)(e.width)&&(n=e.width+"px");let o=document.createElement("div");return o.id=this.id,o.classList.add("epub-container"),o.style.wordSpacing="0",o.style.lineHeight="0",o.style.verticalAlign="top",o.style.position="relative",a==="horizontal"&&(o.style.display="flex",o.style.flexDirection="row",o.style.flexWrap="nowrap"),n&&(o.style.width=n),r&&(o.style.height=r),t&&(t==="scroll"&&a==="vertical"?(o.style["overflow-y"]=t,o.style["overflow-x"]="hidden"):t==="scroll"&&a==="horizontal"?(o.style["overflow-y"]="hidden",o.style["overflow-x"]=t):o.style.overflow=t),s&&(o.dir=s,o.style.direction=s),s&&this.settings.fullsize&&(document.body.style.direction=s),o}wrap(e){var r=document.createElement("div");return r.style.visibility="hidden",r.style.overflow="hidden",r.style.width="0",r.style.height="0",r.appendChild(e),r}getElement(e){var r;if((0,Fr.isElement)(e)?r=e:typeof e=="string"&&(r=document.getElementById(e)),!r)throw new Error("Not an Element");return r}attachTo(e){var r=this.getElement(e),n;if(!!r)return this.settings.hidden?n=this.wrapper:n=this.container,r.appendChild(n),this.element=r,r}getContainer(){return this.container}onResize(e){(!(0,Fr.isNumber)(this.settings.width)||!(0,Fr.isNumber)(this.settings.height))&&(this.resizeFunc=(0,rS.default)(e,50),window.addEventListener("resize",this.resizeFunc,!1))}onOrientationChange(e){this.orientationChangeFunc=e,window.addEventListener("orientationchange",this.orientationChangeFunc,!1)}size(e,r){var n;let t=e||this.settings.width,a=r||this.settings.height;e===null?(n=this.element.getBoundingClientRect(),n.width&&(e=Math.floor(n.width),this.container.style.width=e+"px")):(0,Fr.isNumber)(e)?this.container.style.width=e+"px":this.container.style.width=e,r===null?(n=n||this.element.getBoundingClientRect(),n.height&&(r=n.height,this.container.style.height=r+"px")):(0,Fr.isNumber)(r)?this.container.style.height=r+"px":this.container.style.height=r,(0,Fr.isNumber)(e)||(e=this.container.clientWidth),(0,Fr.isNumber)(r)||(r=this.container.clientHeight),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles["padding-left"])||0,right:parseFloat(this.containerStyles["padding-right"])||0,top:parseFloat(this.containerStyles["padding-top"])||0,bottom:parseFloat(this.containerStyles["padding-bottom"])||0};let s=(0,Fr.windowBounds)(),o=window.getComputedStyle(document.body),p={left:parseFloat(o["padding-left"])||0,right:parseFloat(o["padding-right"])||0,top:parseFloat(o["padding-top"])||0,bottom:parseFloat(o["padding-bottom"])||0};return t||(e=s.width-p.left-p.right),(this.settings.fullsize&&!a||!a)&&(r=s.height-p.top-p.bottom),{width:e-this.containerPadding.left-this.containerPadding.right,height:r-this.containerPadding.top-this.containerPadding.bottom}}bounds(){let e;return this.container.style.overflow!=="visible"&&(e=this.container&&this.container.getBoundingClientRect()),!e||!e.width||!e.height?(0,Fr.windowBounds)():e}getSheet(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}addStyleRules(e,r){var n="#"+this.id+" ",t="";this.sheet||(this.sheet=this.getSheet()),r.forEach(function(a){for(var s in a)a.hasOwnProperty(s)&&(t+=s+":"+a[s]+";")}),this.sheet.insertRule(n+e+" {"+t+"}",0)}axis(e){e==="horizontal"?(this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.flexWrap="nowrap"):this.container.style.display="block",this.settings.axis=e}direction(e){this.container&&(this.container.dir=e,this.container.style.direction=e),this.settings.fullsize&&(document.body.style.direction=e),this.settings.dir=e}overflow(e){this.container&&(e==="scroll"&&this.settings.axis==="vertical"?(this.container.style["overflow-y"]=e,this.container.style["overflow-x"]="hidden"):e==="scroll"&&this.settings.axis==="horizontal"?(this.container.style["overflow-y"]="hidden",this.container.style["overflow-x"]=e):this.container.style.overflow=e),this.settings.overflow=e}destroy(){this.element&&(this.settings.hidden,this.element.contains(this.container)&&this.element.removeChild(this.container),window.removeEventListener("resize",this.resizeFunc),window.removeEventListener("orientationChange",this.orientationChangeFunc))}}var aS=iS;Co.default=aS;var Io={};Object.defineProperty(Io,"__esModule",{value:!0});Io.default=void 0;class sS{constructor(e){this.container=e,this._views=[],this.length=0,this.hidden=!1}all(){return this._views}first(){return this._views[0]}last(){return this._views[this._views.length-1]}indexOf(e){return this._views.indexOf(e)}slice(){return this._views.slice.apply(this._views,arguments)}get(e){return this._views[e]}append(e){return this._views.push(e),this.container&&this.container.appendChild(e.element),this.length++,e}prepend(e){return this._views.unshift(e),this.container&&this.container.insertBefore(e.element,this.container.firstChild),this.length++,e}insert(e,r){return this._views.splice(r,0,e),this.container&&(r<this.container.children.length?this.container.insertBefore(e.element,this.container.children[r]):this.container.appendChild(e.element)),this.length++,e}remove(e){var r=this._views.indexOf(e);r>-1&&this._views.splice(r,1),this.destroy(e),this.length--}destroy(e){e.displayed&&e.destroy(),this.container&&this.container.removeChild(e.element),e=null}forEach(){return this._views.forEach.apply(this._views,arguments)}clear(){var e,r=this.length;if(!!this.length){for(var n=0;n<r;n++)e=this._views[n],this.destroy(e);this._views=[],this.length=0}}find(e){for(var r,n=this.length,t=0;t<n;t++)if(r=this._views[t],r.displayed&&r.section.index==e.index)return r}displayed(){for(var e=[],r,n=this.length,t=0;t<n;t++)r=this._views[t],r.displayed&&e.push(r);return e}show(){for(var e,r=this.length,n=0;n<r;n++)e=this._views[n],e.displayed&&e.show();this.hidden=!1}hide(){for(var e,r=this.length,n=0;n<r;n++)e=this._views[n],e.displayed&&e.hide();this.hidden=!0}}var oS=sS;Io.default=oS;Object.defineProperty(qi,"__esModule",{value:!0});qi.default=void 0;var lS=ta(Hr.exports),ea=nt,uS=ta(Ro),ph=ta(Ya),fS=ta($n),cS=ta(Co),dS=ta(Io),Ur=nr;function ta(i){return i&&i.__esModule?i:{default:i}}class vh{constructor(e){this.name="default",this.optsSettings=e.settings,this.View=e.view,this.request=e.request,this.renditionQueue=e.queue,this.q=new fS.default(this),this.settings=(0,ea.extend)(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:void 0,writingMode:void 0,flow:"scrolled",ignoreClass:"",fullsize:void 0,allowScriptedContent:!1,allowPopups:!1}),(0,ea.extend)(this.settings,e.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,method:this.settings.method,width:0,height:0,forceEvenPages:!0,allowScriptedContent:this.settings.allowScriptedContent,allowPopups:this.settings.allowPopups},this.rendered=!1}render(e,r){let n=e.tagName;typeof this.settings.fullsize=="undefined"&&n&&(n.toLowerCase()=="body"||n.toLowerCase()=="html")&&(this.settings.fullsize=!0),this.settings.fullsize&&(this.settings.overflow="visible",this.overflow=this.settings.overflow),this.settings.size=r,this.settings.rtlScrollType=(0,uS.default)(),this.stage=new cS.default({width:r.width,height:r.height,overflow:this.overflow,hidden:this.settings.hidden,axis:this.settings.axis,fullsize:this.settings.fullsize,direction:this.settings.direction}),this.stage.attachTo(e),this.container=this.stage.getContainer(),this.views=new dS.default(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.stage.onOrientationChange(this.onOrientationChange.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout(),this.rendered=!0}addEventListeners(){var e;window.addEventListener("unload",function(r){this.destroy()}.bind(this)),this.settings.fullsize?e=window:e=this.container,this._onScroll=this.onScroll.bind(this),e.addEventListener("scroll",this._onScroll)}removeEventListeners(){var e;this.settings.fullsize?e=window:e=this.container,e.removeEventListener("scroll",this._onScroll),this._onScroll=void 0}destroy(){clearTimeout(this.orientationTimeout),clearTimeout(this.resizeTimeout),clearTimeout(this.afterScrolled),this.clear(),this.removeEventListeners(),this.stage.destroy(),this.rendered=!1}onOrientationChange(e){let{orientation:r}=window;this.optsSettings.resizeOnOrientationChange&&this.resize(),clearTimeout(this.orientationTimeout),this.orientationTimeout=setTimeout(function(){this.orientationTimeout=void 0,this.optsSettings.resizeOnOrientationChange&&this.resize(),this.emit(Ur.EVENTS.MANAGERS.ORIENTATION_CHANGE,r)}.bind(this),500)}onResized(e){this.resize()}resize(e,r,n){let t=this.stage.size(e,r);if(this.winBounds=(0,ea.windowBounds)(),this.orientationTimeout&&this.winBounds.width===this.winBounds.height){this._stageSize=void 0;return}this._stageSize&&this._stageSize.width===t.width&&this._stageSize.height===t.height||(this._stageSize=t,this._bounds=this.bounds(),this.clear(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.emit(Ur.EVENTS.MANAGERS.RESIZED,{width:this._stageSize.width,height:this._stageSize.height},n))}createView(e,r){return new this.View(e,(0,ea.extend)(this.viewSettings,{forceRight:r}))}handleNextPrePaginated(e,r,n){let t;if(this.layout.name==="pre-paginated"&&this.layout.divisor>1){if(e||r.index===0)return;if(t=r.next(),t&&!t.properties.includes("page-spread-left"))return n.call(this,t)}}display(e,r){var n=new ea.defer,t=n.promise;(r===e.href||(0,ea.isNumber)(r))&&(r=void 0);var a=this.views.find(e);if(a&&e&&this.layout.name!=="pre-paginated"){let o=a.offset();if(this.settings.direction==="ltr")this.scrollTo(o.left,o.top,!0);else{let p=a.width();this.scrollTo(o.left+p,o.top,!0)}if(r){let p=a.locationOf(r),x=a.width();this.moveTo(p,x)}return n.resolve(),t}this.clear();let s=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&e.properties.includes("page-spread-right")&&(s=!0),this.add(e,s).then(function(o){if(r){let p=o.locationOf(r),x=o.width();this.moveTo(p,x)}}.bind(this),o=>{n.reject(o)}).then(function(){return this.handleNextPrePaginated(s,e,this.add)}.bind(this)).then(function(){this.views.show(),n.resolve()}.bind(this)),t}afterDisplayed(e){this.emit(Ur.EVENTS.MANAGERS.ADDED,e)}afterResized(e){this.emit(Ur.EVENTS.MANAGERS.RESIZE,e.section)}moveTo(e,r){var n=0,t=0;this.isPaginated?(n=Math.floor(e.left/this.layout.delta)*this.layout.delta,n+this.layout.delta>this.container.scrollWidth&&(n=this.container.scrollWidth-this.layout.delta),t=Math.floor(e.top/this.layout.delta)*this.layout.delta,t+this.layout.delta>this.container.scrollHeight&&(t=this.container.scrollHeight-this.layout.delta)):t=e.top,this.settings.direction==="rtl"&&(n=n+this.layout.delta,n=n-r),this.scrollTo(n,t,!0)}add(e,r){var n=this.createView(e,r);return this.views.append(n),n.onDisplayed=this.afterDisplayed.bind(this),n.onResize=this.afterResized.bind(this),n.on(Ur.EVENTS.VIEWS.AXIS,t=>{this.updateAxis(t)}),n.on(Ur.EVENTS.VIEWS.WRITING_MODE,t=>{this.updateWritingMode(t)}),n.display(this.request)}append(e,r){var n=this.createView(e,r);return this.views.append(n),n.onDisplayed=this.afterDisplayed.bind(this),n.onResize=this.afterResized.bind(this),n.on(Ur.EVENTS.VIEWS.AXIS,t=>{this.updateAxis(t)}),n.on(Ur.EVENTS.VIEWS.WRITING_MODE,t=>{this.updateWritingMode(t)}),n.display(this.request)}prepend(e,r){var n=this.createView(e,r);return n.on(Ur.EVENTS.VIEWS.RESIZED,t=>{this.counter(t)}),this.views.prepend(n),n.onDisplayed=this.afterDisplayed.bind(this),n.onResize=this.afterResized.bind(this),n.on(Ur.EVENTS.VIEWS.AXIS,t=>{this.updateAxis(t)}),n.on(Ur.EVENTS.VIEWS.WRITING_MODE,t=>{this.updateWritingMode(t)}),n.display(this.request)}counter(e){this.settings.axis==="vertical"?this.scrollBy(0,e.heightDelta,!0):this.scrollBy(e.widthDelta,0,!0)}next(){var e,r;let n=this.settings.direction;if(!!this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"&&(!n||n==="ltr")?(this.scrollLeft=this.container.scrollLeft,r=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,r<=this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next()):this.isPaginated&&this.settings.axis==="horizontal"&&n==="rtl"?(this.scrollLeft=this.container.scrollLeft,this.settings.rtlScrollType==="default"?(r=this.container.scrollLeft,r>0?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next()):(r=this.container.scrollLeft+this.layout.delta*-1,r>this.container.scrollWidth*-1?this.scrollBy(this.layout.delta,0,!0):e=this.views.last().section.next())):this.isPaginated&&this.settings.axis==="vertical"?(this.scrollTop=this.container.scrollTop,this.container.scrollTop+this.container.offsetHeight<this.container.scrollHeight?this.scrollBy(0,this.layout.height,!0):e=this.views.last().section.next()):e=this.views.last().section.next(),e)){this.clear(),this.updateLayout();let t=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&e.properties.includes("page-spread-right")&&(t=!0),this.append(e,t).then(function(){return this.handleNextPrePaginated(t,e,this.append)}.bind(this),a=>a).then(function(){!this.isPaginated&&this.settings.axis==="horizontal"&&this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"&&this.scrollTo(this.container.scrollWidth,0,!0),this.views.show()}.bind(this))}}prev(){var e,r;let n=this.settings.direction;if(!!this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"&&(!n||n==="ltr")?(this.scrollLeft=this.container.scrollLeft,r=this.container.scrollLeft,r>0?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev()):this.isPaginated&&this.settings.axis==="horizontal"&&n==="rtl"?(this.scrollLeft=this.container.scrollLeft,this.settings.rtlScrollType==="default"?(r=this.container.scrollLeft+this.container.offsetWidth,r<this.container.scrollWidth?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev()):(r=this.container.scrollLeft,r<0?this.scrollBy(-this.layout.delta,0,!0):e=this.views.first().section.prev())):this.isPaginated&&this.settings.axis==="vertical"?(this.scrollTop=this.container.scrollTop,this.container.scrollTop>0?this.scrollBy(0,-this.layout.height,!0):e=this.views.first().section.prev()):e=this.views.first().section.prev(),e)){this.clear(),this.updateLayout();let t=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&typeof e.prev()!="object"&&(t=!0),this.prepend(e,t).then(function(){var a;if(this.layout.name==="pre-paginated"&&this.layout.divisor>1&&(a=e.prev(),a))return this.prepend(a)}.bind(this),a=>a).then(function(){this.isPaginated&&this.settings.axis==="horizontal"&&(this.settings.direction==="rtl"?this.settings.rtlScrollType==="default"?this.scrollTo(0,0,!0):this.scrollTo(this.container.scrollWidth*-1+this.layout.delta,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)),this.views.show()}.bind(this))}}current(){var e=this.visible();return e.length?e[e.length-1]:null}clear(){this.views&&(this.views.hide(),this.scrollTo(0,0,!0),this.views.clear())}currentLocation(){return this.updateLayout(),this.isPaginated&&this.settings.axis==="horizontal"?this.location=this.paginatedLocation():this.location=this.scrolledLocation(),this.location}scrolledLocation(){let e=this.visible(),r=this.container.getBoundingClientRect(),n=r.height<window.innerHeight?r.height:window.innerHeight,t=r.width<window.innerWidth?r.width:window.innerWidth,a=this.settings.axis==="vertical";this.settings.direction;let s=0,o=0;return this.settings.fullsize&&(s=a?window.scrollY:window.scrollX),e.map(x=>{let{index:g,href:d}=x.section,h=x.position(),y=x.width(),b=x.height(),T,_,c,u;a?(T=s+r.top-h.top+o,_=T+n-o,u=this.layout.count(b,n).pages,c=n):(T=s+r.left-h.left+o,_=T+t-o,u=this.layout.count(y,t).pages,c=t);let f=Math.ceil(T/c),v=[],l=Math.ceil(_/c);if(this.settings.direction==="rtl"&&!a){let S=f;f=u-l,l=u-S}v=[];for(var m=f;m<=l;m++){let S=m+1;v.push(S)}let E=this.mapping.page(x.contents,x.section.cfiBase,T,_);return{index:g,href:d,pages:v,totalPages:u,mapping:E}})}paginatedLocation(){let e=this.visible(),r=this.container.getBoundingClientRect(),n=0,t=0;return this.settings.fullsize&&(n=window.scrollX),e.map(s=>{let{index:o,href:p}=s.section,x,g=s.position(),d=s.width(),h,y,b;this.settings.direction==="rtl"?(x=r.right-n,b=Math.min(Math.abs(x-g.left),this.layout.width)-t,y=g.width-(g.right-x)-t,h=y-b):(x=r.left+n,b=Math.min(g.right-x,this.layout.width)-t,h=x-g.left+t,y=h+b),t+=b;let T=this.mapping.page(s.contents,s.section.cfiBase,h,y),_=this.layout.count(d).pages,c=Math.floor(h/this.layout.pageWidth),u=[],f=Math.floor(y/this.layout.pageWidth);if(c<0&&(c=0,f=f+1),this.settings.direction==="rtl"){let l=c;c=_-f,f=_-l}for(var v=c+1;v<=f;v++){let l=v;u.push(l)}return{index:o,href:p,pages:u,totalPages:_,mapping:T}})}isVisible(e,r,n,t){var a=e.position(),s=t||this.bounds();return this.settings.axis==="horizontal"&&a.right>s.left-r&&a.left<s.right+n?!0:this.settings.axis==="vertical"&&a.bottom>s.top-r&&a.top<s.bottom+n}visible(){for(var e=this.bounds(),r=this.views.displayed(),n=r.length,t=[],a,s,o=0;o<n;o++)s=r[o],a=this.isVisible(s,0,0,e),a===!0&&t.push(s);return t}scrollBy(e,r,n){let t=this.settings.direction==="rtl"?-1:1;n&&(this.ignore=!0),this.settings.fullsize?window.scrollBy(e*t,r*t):(e&&(this.container.scrollLeft+=e*t),r&&(this.container.scrollTop+=r)),this.scrolled=!0}scrollTo(e,r,n){n&&(this.ignore=!0),this.settings.fullsize?window.scrollTo(e,r):(this.container.scrollLeft=e,this.container.scrollTop=r),this.scrolled=!0}onScroll(){let e,r;this.settings.fullsize?(e=window.scrollY,r=window.scrollX):(e=this.container.scrollTop,r=this.container.scrollLeft),this.scrollTop=e,this.scrollLeft=r,this.ignore?this.ignore=!1:(this.emit(Ur.EVENTS.MANAGERS.SCROLL,{top:e,left:r}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit(Ur.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this),20))}bounds(){var e;return e=this.stage.bounds(),e}applyLayout(e){this.layout=e,this.updateLayout(),this.views&&this.views.length>0&&this.layout.name==="pre-paginated"&&this.display(this.views.first().section)}updateLayout(){!this.stage||(this._stageSize=this.stage.size(),this.isPaginated?(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta/this.layout.divisor):this.layout.calculate(this._stageSize.width,this._stageSize.height),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}setLayout(e){this.viewSettings.layout=e,this.mapping=new ph.default(e.props,this.settings.direction,this.settings.axis),this.views&&this.views.forEach(function(r){r&&r.setLayout(e)})}updateWritingMode(e){this.writingMode=e}updateAxis(e,r){!r&&e===this.settings.axis||(this.settings.axis=e,this.stage&&this.stage.axis(e),this.viewSettings.axis=e,this.mapping&&(this.mapping=new ph.default(this.layout.props,this.settings.direction,this.settings.axis)),this.layout&&(e==="vertical"?this.layout.spread("none"):this.layout.spread(this.layout.settings.spread)))}updateFlow(e,r="auto"){let n=e==="paginated"||e==="auto";this.isPaginated=n,e==="scrolled-doc"||e==="scrolled-continuous"||e==="scrolled"?this.updateAxis("vertical"):this.updateAxis("horizontal"),this.viewSettings.flow=e,this.settings.overflow?this.overflow=this.settings.overflow:this.overflow=n?"hidden":r,this.stage&&this.stage.overflow(this.overflow),this.updateLayout()}getContents(){var e=[];return this.views&&this.views.forEach(function(r){const n=r&&r.contents;n&&e.push(n)}),e}direction(e="ltr"){this.settings.direction=e,this.stage&&this.stage.direction(e),this.viewSettings.direction=e,this.updateLayout()}isRendered(){return this.rendered}}(0,lS.default)(vh.prototype);var hS=vh;qi.default=hS;var qa={},Mo={};Object.defineProperty(Mo,"__esModule",{value:!0});Mo.default=void 0;var gh=nt,mh=nr,pS=vS(Hr.exports);function vS(i){return i&&i.__esModule?i:{default:i}}const gS=Math.PI/2,mS={easeOutSine:function(i){return Math.sin(i*gS)},easeInOutSine:function(i){return-.5*(Math.cos(Math.PI*i)-1)},easeInOutQuint:function(i){return(i/=.5)<1?.5*Math.pow(i,5):.5*(Math.pow(i-2,5)+2)},easeInCubic:function(i){return Math.pow(i,3)}};class yh{constructor(e,r){this.settings=(0,gh.extend)({duration:80,minVelocity:.2,minDistance:10,easing:mS.easeInCubic},r||{}),this.supportsTouch=this.supportsTouch(),this.supportsTouch&&this.setup(e)}setup(e){this.manager=e,this.layout=this.manager.layout,this.fullsize=this.manager.settings.fullsize,this.fullsize?(this.element=this.manager.stage.element,this.scroller=window,this.disableScroll()):(this.element=this.manager.stage.container,this.scroller=this.element,this.element.style.WebkitOverflowScrolling="touch"),this.manager.settings.offset=this.layout.width,this.manager.settings.afterScrolledTimeout=this.settings.duration*2,this.isVertical=this.manager.settings.axis==="vertical",!(!this.manager.isPaginated||this.isVertical)&&(this.touchCanceler=!1,this.resizeCanceler=!1,this.snapping=!1,this.scrollLeft,this.scrollTop,this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0,this.addListeners())}supportsTouch(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}disableScroll(){this.element.style.overflow="hidden"}enableScroll(){this.element.style.overflow=""}addListeners(){this._onResize=this.onResize.bind(this),window.addEventListener("resize",this._onResize),this._onScroll=this.onScroll.bind(this),this.scroller.addEventListener("scroll",this._onScroll),this._onTouchStart=this.onTouchStart.bind(this),this.scroller.addEventListener("touchstart",this._onTouchStart,{passive:!0}),this.on("touchstart",this._onTouchStart),this._onTouchMove=this.onTouchMove.bind(this),this.scroller.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.on("touchmove",this._onTouchMove),this._onTouchEnd=this.onTouchEnd.bind(this),this.scroller.addEventListener("touchend",this._onTouchEnd,{passive:!0}),this.on("touchend",this._onTouchEnd),this._afterDisplayed=this.afterDisplayed.bind(this),this.manager.on(mh.EVENTS.MANAGERS.ADDED,this._afterDisplayed)}removeListeners(){window.removeEventListener("resize",this._onResize),this._onResize=void 0,this.scroller.removeEventListener("scroll",this._onScroll),this._onScroll=void 0,this.scroller.removeEventListener("touchstart",this._onTouchStart,{passive:!0}),this.off("touchstart",this._onTouchStart),this._onTouchStart=void 0,this.scroller.removeEventListener("touchmove",this._onTouchMove,{passive:!0}),this.off("touchmove",this._onTouchMove),this._onTouchMove=void 0,this.scroller.removeEventListener("touchend",this._onTouchEnd,{passive:!0}),this.off("touchend",this._onTouchEnd),this._onTouchEnd=void 0,this.manager.off(mh.EVENTS.MANAGERS.ADDED,this._afterDisplayed),this._afterDisplayed=void 0}afterDisplayed(e){let r=e.contents;["touchstart","touchmove","touchend"].forEach(n=>{r.on(n,t=>this.triggerViewEvent(t,r))})}triggerViewEvent(e,r){this.emit(e.type,e,r)}onScroll(e){this.scrollLeft=this.fullsize?window.scrollX:this.scroller.scrollLeft,this.scrollTop=this.fullsize?window.scrollY:this.scroller.scrollTop}onResize(e){this.resizeCanceler=!0}onTouchStart(e){let{screenX:r,screenY:n}=e.touches[0];this.fullsize&&this.enableScroll(),this.touchCanceler=!0,this.startTouchX||(this.startTouchX=r,this.startTouchY=n,this.startTime=this.now()),this.endTouchX=r,this.endTouchY=n,this.endTime=this.now()}onTouchMove(e){let{screenX:r,screenY:n}=e.touches[0],t=Math.abs(n-this.endTouchY);this.touchCanceler=!0,!this.fullsize&&t<10&&(this.element.scrollLeft-=r-this.endTouchX),this.endTouchX=r,this.endTouchY=n,this.endTime=this.now()}onTouchEnd(e){this.fullsize&&this.disableScroll(),this.touchCanceler=!1;let r=this.wasSwiped();r!==0?this.snap(r):this.snap(),this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0}wasSwiped(){let e=this.layout.pageWidth*this.layout.divisor,r=this.endTouchX-this.startTouchX,n=Math.abs(r),t=this.endTime-this.startTime,a=r/t,s=this.settings.minVelocity;if(n<=this.settings.minDistance||n>=e)return 0;if(a>s)return-1;if(a<-s)return 1}needsSnap(){let e=this.scrollLeft,r=this.layout.pageWidth*this.layout.divisor;return e%r!=0}snap(e=0){let r=this.scrollLeft,n=this.layout.pageWidth*this.layout.divisor,t=Math.round(r/n)*n;return e&&(t+=e*n),this.smoothScrollTo(t)}smoothScrollTo(e){const r=new gh.defer,n=this.scrollLeft,t=this.now(),a=this.settings.duration,s=this.settings.easing;this.snapping=!0;function o(){const p=this.now(),x=Math.min(1,(p-t)/a);if(s(x),this.touchCanceler||this.resizeCanceler){this.resizeCanceler=!1,this.snapping=!1,r.resolve();return}x<1?(window.requestAnimationFrame(o.bind(this)),this.scrollTo(n+(e-n)*x,0)):(this.scrollTo(e,0),this.snapping=!1,r.resolve())}return o.call(this),r.promise}scrollTo(e=0,r=0){this.fullsize?window.scroll(e,r):(this.scroller.scrollLeft=e,this.scroller.scrollTop=r)}now(){return"now"in window.performance?performance.now():new Date().getTime()}destroy(){!this.scroller||(this.fullsize&&this.enableScroll(),this.removeListeners(),this.scroller=void 0)}}(0,pS.default)(yh.prototype);var yS=yh;Mo.default=yS;Object.defineProperty(qa,"__esModule",{value:!0});qa.default=void 0;var gi=nt,Eh=Au(qi),_h=Au(Mo),Zr=nr,ES=Au(hh);function Au(i){return i&&i.__esModule?i:{default:i}}class _S extends Eh.default{constructor(e){super(e);this.name="continuous",this.settings=(0,gi.extend)(this.settings||{},{infinite:!0,overflow:void 0,axis:void 0,writingMode:void 0,flow:"scrolled",offset:500,offsetDelta:250,width:void 0,height:void 0,snap:!1,afterScrolledTimeout:10,allowScriptedContent:!1,allowPopups:!1}),(0,gi.extend)(this.settings,e.settings||{}),e.settings.gap!="undefined"&&e.settings.gap===0&&(this.settings.gap=e.settings.gap),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,width:0,height:0,forceEvenPages:!1,allowScriptedContent:this.settings.allowScriptedContent,allowPopups:this.settings.allowPopups},this.scrollTop=0,this.scrollLeft=0}display(e,r){return Eh.default.prototype.display.call(this,e,r).then(function(){return this.fill()}.bind(this))}fill(e){var r=e||new gi.defer;return this.q.enqueue(()=>this.check()).then(n=>{n?this.fill(r):r.resolve()}),r.promise}moveTo(e){var r=0,n=0;this.isPaginated?(r=Math.floor(e.left/this.layout.delta)*this.layout.delta,r+this.settings.offsetDelta):(n=e.top,e.top+this.settings.offsetDelta),(r>0||n>0)&&this.scrollBy(r,n,!0)}afterResized(e){this.emit(Zr.EVENTS.MANAGERS.RESIZE,e.section)}removeShownListeners(e){e.onDisplayed=function(){}}add(e){var r=this.createView(e);return this.views.append(r),r.on(Zr.EVENTS.VIEWS.RESIZED,n=>{r.expanded=!0}),r.on(Zr.EVENTS.VIEWS.AXIS,n=>{this.updateAxis(n)}),r.on(Zr.EVENTS.VIEWS.WRITING_MODE,n=>{this.updateWritingMode(n)}),r.onDisplayed=this.afterDisplayed.bind(this),r.onResize=this.afterResized.bind(this),r.display(this.request)}append(e){var r=this.createView(e);return r.on(Zr.EVENTS.VIEWS.RESIZED,n=>{r.expanded=!0}),r.on(Zr.EVENTS.VIEWS.AXIS,n=>{this.updateAxis(n)}),r.on(Zr.EVENTS.VIEWS.WRITING_MODE,n=>{this.updateWritingMode(n)}),this.views.append(r),r.onDisplayed=this.afterDisplayed.bind(this),r}prepend(e){var r=this.createView(e);return r.on(Zr.EVENTS.VIEWS.RESIZED,n=>{this.counter(n),r.expanded=!0}),r.on(Zr.EVENTS.VIEWS.AXIS,n=>{this.updateAxis(n)}),r.on(Zr.EVENTS.VIEWS.WRITING_MODE,n=>{this.updateWritingMode(n)}),this.views.prepend(r),r.onDisplayed=this.afterDisplayed.bind(this),r}counter(e){this.settings.axis==="vertical"?this.scrollBy(0,e.heightDelta,!0):this.scrollBy(e.widthDelta,0,!0)}update(e){for(var r=this.bounds(),n=this.views.all(),t=n.length,a=typeof e!="undefined"?e:this.settings.offset||0,s,o,p=new gi.defer,x=[],g=0;g<t;g++)if(o=n[g],s=this.isVisible(o,a,a,r),s===!0)if(o.displayed)o.show();else{let d=o.display(this.request).then(function(h){h.show()},h=>{o.hide()});x.push(d)}else this.q.enqueue(o.destroy.bind(o)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim.bind(this))}.bind(this),250);return x.length?Promise.all(x).catch(d=>{p.reject(d)}):(p.resolve(),p.promise)}check(e,r){var n=new gi.defer,t=[],a=this.settings.axis==="horizontal",s=this.settings.offset||0;e&&a&&(s=e),r&&!a&&(s=r);var o=this._bounds;let p=a?this.scrollLeft:this.scrollTop,x=a?Math.floor(o.width):o.height,g=a?this.container.scrollWidth:this.container.scrollHeight,d=this.writingMode&&this.writingMode.indexOf("vertical")===0?"vertical":"horizontal",h=this.settings.rtlScrollType,y=this.settings.direction==="rtl";this.settings.fullsize?(a&&y&&h==="negative"||!a&&y&&h==="default")&&(p=p*-1):(y&&h==="default"&&d==="horizontal"&&(p=g-x-p),y&&h==="negative"&&d==="horizontal"&&(p=p*-1));let b=()=>{let f=this.views.first(),v=f&&f.section.prev();v&&t.push(this.prepend(v))},T=()=>{let f=this.views.last(),v=f&&f.section.next();v&&t.push(this.append(v))},_=p+x+s,c=p-s;_>=g&&T(),c<0&&b();let u=t.map(f=>f.display(this.request));return t.length?Promise.all(u).then(()=>this.check()).then(()=>this.update(s),f=>f):(this.q.enqueue(function(){this.update()}.bind(this)),n.resolve(!1),n.promise)}trim(){for(var e=new gi.defer,r=this.views.displayed(),n=r[0],t=r[r.length-1],a=this.views.indexOf(n),s=this.views.indexOf(t),o=this.views.slice(0,a),p=this.views.slice(s+1),x=0;x<o.length-1;x++)this.erase(o[x],o);for(var g=1;g<p.length;g++)this.erase(p[g]);return e.resolve(),e.promise}erase(e,r){var n,t;this.settings.fullsize?(n=window.scrollY,t=window.scrollX):(n=this.container.scrollTop,t=this.container.scrollLeft);var a=e.bounds();this.views.remove(e),r&&(this.settings.axis==="vertical"?this.scrollTo(0,n-a.height,!0):this.settings.direction==="rtl"?this.settings.fullsize?this.scrollTo(t+Math.floor(a.width),0,!0):this.scrollTo(t,0,!0):this.scrollTo(t-Math.floor(a.width),0,!0))}addEventListeners(e){window.addEventListener("unload",function(r){this.ignore=!0,this.destroy()}.bind(this)),this.addScrollListeners(),this.isPaginated&&this.settings.snap&&(this.snapper=new _h.default(this,this.settings.snap&&typeof this.settings.snap=="object"&&this.settings.snap))}addScrollListeners(){var e;this.tick=gi.requestAnimationFrame;let r=this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"?-1:1;this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.fullsize?(e=window,this.scrollTop=window.scrollY*r,this.scrollLeft=window.scrollX*r):(e=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft),this._onScroll=this.onScroll.bind(this),e.addEventListener("scroll",this._onScroll),this._scrolled=(0,ES.default)(this.scrolled.bind(this),30),this.didScroll=!1}removeEventListeners(){var e;this.settings.fullsize?e=window:e=this.container,e.removeEventListener("scroll",this._onScroll),this._onScroll=void 0}onScroll(){let e,r,n=this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"?-1:1;this.settings.fullsize?(e=window.scrollY*n,r=window.scrollX*n):(e=this.container.scrollTop,r=this.container.scrollLeft),this.scrollTop=e,this.scrollLeft=r,this.ignore?this.ignore=!1:this._scrolled(),this.scrollDeltaVert+=Math.abs(e-this.prevScrollTop),this.scrollDeltaHorz+=Math.abs(r-this.prevScrollLeft),this.prevScrollTop=e,this.prevScrollLeft=r,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),clearTimeout(this.afterScrolled),this.didScroll=!1}scrolled(){this.q.enqueue(function(){return this.check()}.bind(this)),this.emit(Zr.EVENTS.MANAGERS.SCROLL,{top:this.scrollTop,left:this.scrollLeft}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.snapper&&this.snapper.supportsTouch&&this.snapper.needsSnap()||this.emit(Zr.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this),this.settings.afterScrolledTimeout)}next(){let e=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?this.layout.props.delta*2:this.layout.props.delta;!this.views.length||(this.isPaginated&&this.settings.axis==="horizontal"?this.scrollBy(e,0,!0):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(function(){return this.check()}.bind(this)))}prev(){let e=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?this.layout.props.delta*2:this.layout.props.delta;!this.views.length||(this.isPaginated&&this.settings.axis==="horizontal"?this.scrollBy(-e,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(function(){return this.check()}.bind(this)))}updateFlow(e){this.rendered&&this.snapper&&(this.snapper.destroy(),this.snapper=void 0),super.updateFlow(e,"scroll"),this.rendered&&this.isPaginated&&this.settings.snap&&(this.snapper=new _h.default(this,this.settings.snap&&typeof this.settings.snap=="object"&&this.settings.snap))}destroy(){super.destroy(),this.snapper&&this.snapper.destroy()}}var xS=_S;qa.default=xS;Object.defineProperty(Qi,"__esModule",{value:!0});Qi.default=void 0;var bS=an(Hr.exports),es=nt,mi=an(Yi),xh=an(xr),SS=an($n),TS=an($a),OS=an(To);an(vi);var AS=an(Ao),Bt=nr,wS=an(Xa),LS=an(qi),DS=an(qa);function an(i){return i&&i.__esModule?i:{default:i}}class bh{constructor(e,r){this.settings=(0,es.extend)(this.settings||{},{width:null,height:null,ignoreClass:"",manager:"default",view:"iframe",flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,resizeOnOrientationChange:!0,script:null,snap:!1,defaultDirection:"ltr",allowScriptedContent:!1,allowPopups:!1}),(0,es.extend)(this.settings,r),typeof this.settings.manager=="object"&&(this.manager=this.settings.manager),this.book=e,this.hooks={},this.hooks.display=new mi.default(this),this.hooks.serialize=new mi.default(this),this.hooks.content=new mi.default(this),this.hooks.unloaded=new mi.default(this),this.hooks.layout=new mi.default(this),this.hooks.render=new mi.default(this),this.hooks.show=new mi.default(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.spine.hooks.content.register(this.injectIdentifier.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new OS.default(this),this.annotations=new AS.default(this),this.epubcfi=new xh.default,this.q=new SS.default(this),this.location=void 0,this.q.enqueue(this.book.opened),this.starting=new es.defer,this.started=this.starting.promise,this.q.enqueue(this.start)}setManager(e){this.manager=e}requireManager(e){var r;return typeof e=="string"&&e==="default"?r=LS.default:typeof e=="string"&&e==="continuous"?r=DS.default:r=e,r}requireView(e){var r;return typeof e=="string"&&e==="iframe"?r=wS.default:r=e,r}start(){switch(!this.settings.layout&&(this.book.package.metadata.layout==="pre-paginated"||this.book.displayOptions.fixedLayout==="true")&&(this.settings.layout="pre-paginated"),this.book.package.metadata.spread){case"none":this.settings.spread="none";break;case"both":this.settings.spread=!0;break}this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.direction(this.book.package.metadata.direction||this.settings.defaultDirection),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on(Bt.EVENTS.MANAGERS.ADDED,this.afterDisplayed.bind(this)),this.manager.on(Bt.EVENTS.MANAGERS.REMOVED,this.afterRemoved.bind(this)),this.manager.on(Bt.EVENTS.MANAGERS.RESIZED,this.onResized.bind(this)),this.manager.on(Bt.EVENTS.MANAGERS.ORIENTATION_CHANGE,this.onOrientationChange.bind(this)),this.manager.on(Bt.EVENTS.MANAGERS.SCROLLED,this.reportLocation.bind(this)),this.emit(Bt.EVENTS.RENDITION.STARTED),this.starting.resolve()}attachTo(e){return this.q.enqueue(function(){this.manager.render(e,{width:this.settings.width,height:this.settings.height}),this.emit(Bt.EVENTS.RENDITION.ATTACHED)}.bind(this))}display(e){return this.displaying&&this.displaying.resolve(),this.q.enqueue(this._display,e)}_display(e){if(!!this.book){this.epubcfi.isCfiString(e);var r=new es.defer,n=r.promise,t;return this.displaying=r,this.book.locations.length()&&(0,es.isFloat)(e)&&(e=this.book.locations.cfiFromPercentage(parseFloat(e))),t=this.book.spine.get(e),t?(this.manager.display(t,e).then(()=>{r.resolve(t),this.displaying=void 0,this.emit(Bt.EVENTS.RENDITION.DISPLAYED,t),this.reportLocation()},a=>{this.emit(Bt.EVENTS.RENDITION.DISPLAY_ERROR,a)}),n):(r.reject(new Error("No Section Found")),n)}}afterDisplayed(e){e.on(Bt.EVENTS.VIEWS.MARK_CLICKED,(r,n)=>this.triggerMarkEvent(r,n,e.contents)),this.hooks.render.trigger(e,this).then(()=>{e.contents?this.hooks.content.trigger(e.contents,this).then(()=>{this.emit(Bt.EVENTS.RENDITION.RENDERED,e.section,e)}):this.emit(Bt.EVENTS.RENDITION.RENDERED,e.section,e)})}afterRemoved(e){this.hooks.unloaded.trigger(e,this).then(()=>{this.emit(Bt.EVENTS.RENDITION.REMOVED,e.section,e)})}onResized(e,r){this.emit(Bt.EVENTS.RENDITION.RESIZED,{width:e.width,height:e.height},r),this.location&&this.location.start&&this.display(r||this.location.start.cfi)}onOrientationChange(e){this.emit(Bt.EVENTS.RENDITION.ORIENTATION_CHANGE,e)}moveTo(e){this.manager.moveTo(e)}resize(e,r,n){e&&(this.settings.width=e),r&&(this.settings.height=r),this.manager.resize(e,r,n)}clear(){this.manager.clear()}next(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}prev(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}determineLayoutProperties(e){var r,n=this.settings.layout||e.layout||"reflowable",t=this.settings.spread||e.spread||"auto",a=this.settings.orientation||e.orientation||"auto",s=this.settings.flow||e.flow||"auto",o=e.viewport||"",p=this.settings.minSpreadWidth||e.minSpreadWidth||800,x=this.settings.direction||e.direction||"ltr";return(this.settings.width===0||this.settings.width>0)&&(this.settings.height===0||this.settings.height>0),r={layout:n,spread:t,orientation:a,flow:s,viewport:o,minSpreadWidth:p,direction:x},r}flow(e){var r=e;(e==="scrolled"||e==="scrolled-doc"||e==="scrolled-continuous")&&(r="scrolled"),(e==="auto"||e==="paginated")&&(r="paginated"),this.settings.flow=e,this._layout&&this._layout.flow(r),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this.manager&&this.manager.updateFlow(r),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}layout(e){return e&&(this._layout=new TS.default(e),this._layout.spread(e.spread,this.settings.minSpreadWidth),this._layout.on(Bt.EVENTS.LAYOUT.UPDATED,(r,n)=>{this.emit(Bt.EVENTS.RENDITION.LAYOUT,r,n)})),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}spread(e,r){this.settings.spread=e,r&&(this.settings.minSpreadWidth=r),this._layout&&this._layout.spread(e,r),this.manager&&this.manager.isRendered()&&this.manager.updateLayout()}direction(e){this.settings.direction=e||"ltr",this.manager&&this.manager.direction(this.settings.direction),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}reportLocation(){return this.q.enqueue(function(){requestAnimationFrame(function(){var n=this.manager.currentLocation();if(n&&n.then&&typeof n.then=="function")n.then(function(t){let a=this.located(t);!a||!a.start||!a.end||(this.location=a,this.emit(Bt.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(Bt.EVENTS.RENDITION.RELOCATED,this.location))}.bind(this));else if(n){let t=this.located(n);if(!t||!t.start||!t.end)return;this.location=t,this.emit(Bt.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(Bt.EVENTS.RENDITION.RELOCATED,this.location)}}.bind(this))}.bind(this))}currentLocation(){var e=this.manager.currentLocation();if(e&&e.then&&typeof e.then=="function")e.then(function(r){return this.located(r)}.bind(this));else if(e)return this.located(e)}located(e){if(!e.length)return{};let r=e[0],n=e[e.length-1],t={start:{index:r.index,href:r.href,cfi:r.mapping.start,displayed:{page:r.pages[0]||1,total:r.totalPages}},end:{index:n.index,href:n.href,cfi:n.mapping.end,displayed:{page:n.pages[n.pages.length-1]||1,total:n.totalPages}}},a=this.book.locations.locationFromCfi(r.mapping.start),s=this.book.locations.locationFromCfi(n.mapping.end);a!=null&&(t.start.location=a,t.start.percentage=this.book.locations.percentageFromLocation(a)),s!=null&&(t.end.location=s,t.end.percentage=this.book.locations.percentageFromLocation(s));let o=this.book.pageList.pageFromCfi(r.mapping.start),p=this.book.pageList.pageFromCfi(n.mapping.end);return o!=-1&&(t.start.page=o),p!=-1&&(t.end.page=p),n.index===this.book.spine.last().index&&t.end.displayed.page>=t.end.displayed.total&&(t.atEnd=!0),r.index===this.book.spine.first().index&&t.start.displayed.page===1&&(t.atStart=!0),t}destroy(){this.manager&&this.manager.destroy(),this.book=void 0}passEvents(e){Bt.DOM_EVENTS.forEach(r=>{e.on(r,n=>this.triggerViewEvent(n,e))}),e.on(Bt.EVENTS.CONTENTS.SELECTED,r=>this.triggerSelectedEvent(r,e))}triggerViewEvent(e,r){this.emit(e.type,e,r)}triggerSelectedEvent(e,r){this.emit(Bt.EVENTS.RENDITION.SELECTED,e,r)}triggerMarkEvent(e,r,n){this.emit(Bt.EVENTS.RENDITION.MARK_CLICKED,e,r,n)}getRange(e,r){var n=new xh.default(e),t=this.manager.visible().filter(function(a){if(n.spinePos===a.index)return!0});if(t.length)return t[0].contents.range(n,r)}adjustImages(e){if(this._layout.name==="pre-paginated")return new Promise(function(a){a()});let r=e.window.getComputedStyle(e.content,null),n=(e.content.offsetHeight-(parseFloat(r.paddingTop)+parseFloat(r.paddingBottom)))*.95,t=parseFloat(r.paddingLeft)+parseFloat(r.paddingRight);return e.addStylesheetRules({img:{"max-width":(this._layout.columnWidth?this._layout.columnWidth-t+"px":"100%")+"!important","max-height":n+"px!important","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"},svg:{"max-width":(this._layout.columnWidth?this._layout.columnWidth-t+"px":"100%")+"!important","max-height":n+"px!important","page-break-inside":"avoid","break-inside":"avoid"}}),new Promise(function(a,s){setTimeout(function(){a()},1)})}getContents(){return this.manager?this.manager.getContents():[]}views(){return(this.manager?this.manager.views:void 0)||[]}handleLinks(e){e&&e.on(Bt.EVENTS.CONTENTS.LINK_CLICKED,r=>{let n=this.book.path.relative(r);this.display(n)})}injectStylesheet(e,r){let n=e.createElement("link");n.setAttribute("type","text/css"),n.setAttribute("rel","stylesheet"),n.setAttribute("href",this.settings.stylesheet),e.getElementsByTagName("head")[0].appendChild(n)}injectScript(e,r){let n=e.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",this.settings.script),n.textContent=" ",e.getElementsByTagName("head")[0].appendChild(n)}injectIdentifier(e,r){let n=this.book.packaging.metadata.identifier,t=e.createElement("meta");t.setAttribute("name","dc.relation.ispartof"),n&&t.setAttribute("content",n),e.getElementsByTagName("head")[0].appendChild(t)}}(0,bS.default)(bh.prototype);var PS=bh;Qi.default=PS;var ko={},Sh={exports:{}};/*!

JSZip v3.7.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/(function(i,e){(function(r){i.exports=r()})(function(){return function r(n,t,a){function s(x,g){if(!t[x]){if(!n[x]){var d=typeof Mn=="function"&&Mn;if(!g&&d)return d(x,!0);if(o)return o(x,!0);var h=new Error("Cannot find module '"+x+"'");throw h.code="MODULE_NOT_FOUND",h}var y=t[x]={exports:{}};n[x][0].call(y.exports,function(b){var T=n[x][1][b];return s(T||b)},y,y.exports,r,n,t,a)}return t[x].exports}for(var o=typeof Mn=="function"&&Mn,p=0;p<a.length;p++)s(a[p]);return s}({1:[function(r,n,t){var a=r("./utils"),s=r("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.encode=function(p){for(var x=[],g,d,h,y,b,T,_,c=0,u=p.length,f=u,v=a.getTypeOf(p)!=="string";c<p.length;)f=u-c,v?(g=p[c++],d=c<u?p[c++]:0,h=c<u?p[c++]:0):(g=p.charCodeAt(c++),d=c<u?p.charCodeAt(c++):0,h=c<u?p.charCodeAt(c++):0),y=g>>2,b=(g&3)<<4|d>>4,T=f>1?(d&15)<<2|h>>6:64,_=f>2?h&63:64,x.push(o.charAt(y)+o.charAt(b)+o.charAt(T)+o.charAt(_));return x.join("")},t.decode=function(p){var x,g,d,h,y,b,T,_=0,c=0,u="data:";if(p.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");p=p.replace(/[^A-Za-z0-9\+\/\=]/g,"");var f=p.length*3/4;if(p.charAt(p.length-1)===o.charAt(64)&&f--,p.charAt(p.length-2)===o.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");var v;for(s.uint8array?v=new Uint8Array(f|0):v=new Array(f|0);_<p.length;)h=o.indexOf(p.charAt(_++)),y=o.indexOf(p.charAt(_++)),b=o.indexOf(p.charAt(_++)),T=o.indexOf(p.charAt(_++)),x=h<<2|y>>4,g=(y&15)<<4|b>>2,d=(b&3)<<6|T,v[c++]=x,b!==64&&(v[c++]=g),T!==64&&(v[c++]=d);return v}},{"./support":30,"./utils":32}],2:[function(r,n,t){var a=r("./external"),s=r("./stream/DataWorker"),o=r("./stream/Crc32Probe"),p=r("./stream/DataLengthProbe");function x(g,d,h,y,b){this.compressedSize=g,this.uncompressedSize=d,this.crc32=h,this.compression=y,this.compressedContent=b}x.prototype={getContentWorker:function(){var g=new s(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new p("data_length")),d=this;return g.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),g},getCompressedWorker:function(){return new s(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},x.createWorkerFrom=function(g,d,h){return g.pipe(new o).pipe(new p("uncompressedSize")).pipe(d.compressWorker(h)).pipe(new p("compressedSize")).withStreamInfo("compression",d)},n.exports=x},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,n,t){var a=r("./stream/GenericWorker");t.STORE={magic:"\0\0",compressWorker:function(s){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}},t.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,n,t){var a=r("./utils");function s(){for(var g,d=[],h=0;h<256;h++){g=h;for(var y=0;y<8;y++)g=g&1?3988292384^g>>>1:g>>>1;d[h]=g}return d}var o=s();function p(g,d,h,y){var b=o,T=y+h;g=g^-1;for(var _=y;_<T;_++)g=g>>>8^b[(g^d[_])&255];return g^-1}function x(g,d,h,y){var b=o,T=y+h;g=g^-1;for(var _=y;_<T;_++)g=g>>>8^b[(g^d.charCodeAt(_))&255];return g^-1}n.exports=function(d,h){if(typeof d=="undefined"||!d.length)return 0;var y=a.getTypeOf(d)!=="string";return y?p(h|0,d,d.length,0):x(h|0,d,d.length,0)}},{"./utils":32}],5:[function(r,n,t){t.base64=!1,t.binary=!1,t.dir=!1,t.createFolders=!0,t.date=null,t.compression=null,t.compressionOptions=null,t.comment=null,t.unixPermissions=null,t.dosPermissions=null},{}],6:[function(r,n,t){var a=null;typeof Promise!="undefined"?a=Promise:a=r("lie"),n.exports={Promise:a}},{lie:37}],7:[function(r,n,t){var a=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",s=r("pako"),o=r("./utils"),p=r("./stream/GenericWorker"),x=a?"uint8array":"array";t.magic="\b\0";function g(d,h){p.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=h,this.meta={}}o.inherits(g,p),g.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(x,d.data),!1)},g.prototype.flush=function(){p.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},g.prototype.cleanUp=function(){p.prototype.cleanUp.call(this),this._pako=null},g.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(h){d.push({data:h,meta:d.meta})}},t.compressWorker=function(d){return new g("Deflate",d)},t.uncompressWorker=function(){return new g("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,n,t){var a=r("../utils"),s=r("../stream/GenericWorker"),o=r("../utf8"),p=r("../crc32"),x=r("../signature"),g=function(c,u){var f="",v;for(v=0;v<u;v++)f+=String.fromCharCode(c&255),c=c>>>8;return f},d=function(c,u){var f=c;return c||(f=u?16893:33204),(f&65535)<<16},h=function(c,u){return(c||0)&63},y=function(c,u,f,v,l,m){var E=c.file,S=c.compression,O=m!==o.utf8encode,D=a.transformTo("string",m(E.name)),P=a.transformTo("string",o.utf8encode(E.name)),A=E.comment,w=a.transformTo("string",m(A)),L=a.transformTo("string",o.utf8encode(A)),R=P.length!==E.name.length,C=L.length!==A.length,M,N,U="",K="",V="",W=E.dir,G=E.date,Y={crc32:0,compressedSize:0,uncompressedSize:0};(!u||f)&&(Y.crc32=c.crc32,Y.compressedSize=c.compressedSize,Y.uncompressedSize=c.uncompressedSize);var q=0;u&&(q|=8),!O&&(R||C)&&(q|=2048);var ee=0,re=0;W&&(ee|=16),l==="UNIX"?(re=798,ee|=d(E.unixPermissions,W)):(re=20,ee|=h(E.dosPermissions)),M=G.getUTCHours(),M=M<<6,M=M|G.getUTCMinutes(),M=M<<5,M=M|G.getUTCSeconds()/2,N=G.getUTCFullYear()-1980,N=N<<4,N=N|G.getUTCMonth()+1,N=N<<5,N=N|G.getUTCDate(),R&&(K=g(1,1)+g(p(D),4)+P,U+="up"+g(K.length,2)+K),C&&(V=g(1,1)+g(p(w),4)+L,U+="uc"+g(V.length,2)+V);var pe="";pe+=`
\0`,pe+=g(q,2),pe+=S.magic,pe+=g(M,2),pe+=g(N,2),pe+=g(Y.crc32,4),pe+=g(Y.compressedSize,4),pe+=g(Y.uncompressedSize,4),pe+=g(D.length,2),pe+=g(U.length,2);var Le=x.LOCAL_FILE_HEADER+pe+D+U,Te=x.CENTRAL_FILE_HEADER+g(re,2)+pe+g(w.length,2)+"\0\0\0\0"+g(ee,4)+g(v,4)+D+U+w;return{fileRecord:Le,dirRecord:Te}},b=function(c,u,f,v,l){var m="",E=a.transformTo("string",l(v));return m=x.CENTRAL_DIRECTORY_END+"\0\0\0\0"+g(c,2)+g(c,2)+g(u,4)+g(f,4)+g(E.length,2)+E,m},T=function(c){var u="";return u=x.DATA_DESCRIPTOR+g(c.crc32,4)+g(c.compressedSize,4)+g(c.uncompressedSize,4),u};function _(c,u,f,v){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=u,this.zipPlatform=f,this.encodeFileName=v,this.streamFiles=c,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(_,s),_.prototype.push=function(c){var u=c.meta.percent||0,f=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(c):(this.bytesWritten+=c.data.length,s.prototype.push.call(this,{data:c.data,meta:{currentFile:this.currentFile,percent:f?(u+100*(f-v-1))/f:100}}))},_.prototype.openedSource=function(c){this.currentSourceOffset=this.bytesWritten,this.currentFile=c.file.name;var u=this.streamFiles&&!c.file.dir;if(u){var f=y(c,u,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:f.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(c){this.accumulate=!1;var u=this.streamFiles&&!c.file.dir,f=y(c,u,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(f.dirRecord),u)this.push({data:T(c),meta:{percent:100}});else for(this.push({data:f.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var c=this.bytesWritten,u=0;u<this.dirRecords.length;u++)this.push({data:this.dirRecords[u],meta:{percent:100}});var f=this.bytesWritten-c,v=b(this.dirRecords.length,f,c,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(c){this._sources.push(c);var u=this;return c.on("data",function(f){u.processChunk(f)}),c.on("end",function(){u.closedSource(u.previous.streamInfo),u._sources.length?u.prepareNextSource():u.end()}),c.on("error",function(f){u.error(f)}),this},_.prototype.resume=function(){if(!s.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&!this._sources.length&&!this.generatedError)return this.end(),!0},_.prototype.error=function(c){var u=this._sources;if(!s.prototype.error.call(this,c))return!1;for(var f=0;f<u.length;f++)try{u[f].error(c)}catch(v){}return!0},_.prototype.lock=function(){s.prototype.lock.call(this);for(var c=this._sources,u=0;u<c.length;u++)c[u].lock()},n.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,n,t){var a=r("../compressions"),s=r("./ZipFileWorker"),o=function(p,x){var g=p||x,d=a[g];if(!d)throw new Error(g+" is not a valid compression method !");return d};t.generateWorker=function(p,x,g){var d=new s(x.streamFiles,g,x.platform,x.encodeFileName),h=0;try{p.forEach(function(y,b){h++;var T=o(b.options.compression,x.compression),_=b.options.compressionOptions||x.compressionOptions||{},c=b.dir,u=b.date;b._compressWorker(T,_).withStreamInfo("file",{name:y,dir:c,date:u,comment:b.comment||"",unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions}).pipe(d)}),d.entriesCount=h}catch(y){d.error(y)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,n,t){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new a;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}a.prototype=r("./object"),a.prototype.loadAsync=r("./load"),a.support=r("./support"),a.defaults=r("./defaults"),a.version="3.7.1",a.loadAsync=function(s,o){return new a().loadAsync(s,o)},a.external=r("./external"),n.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,n,t){var a=r("./utils"),s=r("./external"),o=r("./utf8"),p=r("./zipEntries"),x=r("./stream/Crc32Probe"),g=r("./nodejsUtils");function d(h){return new s.Promise(function(y,b){var T=h.decompressed.getContentWorker().pipe(new x);T.on("error",function(_){b(_)}).on("end",function(){T.streamInfo.crc32!==h.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):y()}).resume()})}n.exports=function(h,y){var b=this;return y=a.extend(y||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),g.isNode&&g.isStream(h)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",h,!0,y.optimizedBinaryString,y.base64).then(function(T){var _=new p(y);return _.load(T),_}).then(function(_){var c=[s.Promise.resolve(_)],u=_.files;if(y.checkCRC32)for(var f=0;f<u.length;f++)c.push(d(u[f]));return s.Promise.all(c)}).then(function(_){for(var c=_.shift(),u=c.files,f=0;f<u.length;f++){var v=u[f];b.file(v.fileNameStr,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:y.createFolders})}return c.zipComment.length&&(b.comment=c.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,n,t){var a=r("../utils"),s=r("../stream/GenericWorker");function o(p,x){s.call(this,"Nodejs stream input adapter for "+p),this._upstreamEnded=!1,this._bindStream(x)}a.inherits(o,s),o.prototype._bindStream=function(p){var x=this;this._stream=p,p.pause(),p.on("data",function(g){x.push({data:g,meta:{percent:0}})}).on("error",function(g){x.isPaused?this.generatedError=g:x.error(g)}).on("end",function(){x.isPaused?x._upstreamEnded=!0:x.end()})},o.prototype.pause=function(){return s.prototype.pause.call(this)?(this._stream.pause(),!0):!1},o.prototype.resume=function(){return s.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,n,t){var a=r("readable-stream").Readable,s=r("../utils");s.inherits(o,a);function o(p,x,g){a.call(this,x),this._helper=p;var d=this;p.on("data",function(h,y){d.push(h)||d._helper.pause(),g&&g(y)}).on("error",function(h){d.emit("error",h)}).on("end",function(){d.push(null)})}o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(r,n,t){n.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(a,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,s);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,s)},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);var s=new Buffer(a);return s.fill(0),s},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"}}},{}],15:[function(r,n,t){var a=r("./utf8"),s=r("./utils"),o=r("./stream/GenericWorker"),p=r("./stream/StreamHelper"),x=r("./defaults"),g=r("./compressedObject"),d=r("./zipObject"),h=r("./generate"),y=r("./nodejsUtils"),b=r("./nodejs/NodejsStreamInputAdapter"),T=function(l,m,E){var S=s.getTypeOf(m),O,D=s.extend(E||{},x);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&D.unixPermissions&16384&&(D.dir=!0),D.dosPermissions&&D.dosPermissions&16&&(D.dir=!0),D.dir&&(l=c(l)),D.createFolders&&(O=_(l))&&u.call(this,O,!0);var P=S==="string"&&D.binary===!1&&D.base64===!1;(!E||typeof E.binary=="undefined")&&(D.binary=!P);var A=m instanceof g&&m.uncompressedSize===0;(A||D.dir||!m||m.length===0)&&(D.base64=!1,D.binary=!0,m="",D.compression="STORE",S="string");var w=null;m instanceof g||m instanceof o?w=m:y.isNode&&y.isStream(m)?w=new b(l,m):w=s.prepareContent(l,m,D.binary,D.optimizedBinaryString,D.base64);var L=new d(l,w,D);this.files[l]=L},_=function(l){l.slice(-1)==="/"&&(l=l.substring(0,l.length-1));var m=l.lastIndexOf("/");return m>0?l.substring(0,m):""},c=function(l){return l.slice(-1)!=="/"&&(l+="/"),l},u=function(l,m){return m=typeof m!="undefined"?m:x.createFolders,l=c(l),this.files[l]||T.call(this,l,null,{dir:!0,createFolders:m}),this.files[l]};function f(l){return Object.prototype.toString.call(l)==="[object RegExp]"}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(l){var m,E,S;for(m in this.files)S=this.files[m],E=m.slice(this.root.length,m.length),E&&m.slice(0,this.root.length)===this.root&&l(E,S)},filter:function(l){var m=[];return this.forEach(function(E,S){l(E,S)&&m.push(S)}),m},file:function(l,m,E){if(arguments.length===1)if(f(l)){var S=l;return this.filter(function(D,P){return!P.dir&&S.test(D)})}else{var O=this.files[this.root+l];return O&&!O.dir?O:null}else l=this.root+l,T.call(this,l,m,E);return this},folder:function(l){if(!l)return this;if(f(l))return this.filter(function(O,D){return D.dir&&l.test(O)});var m=this.root+l,E=u.call(this,m),S=this.clone();return S.root=E.name,S},remove:function(l){l=this.root+l;var m=this.files[l];if(m||(l.slice(-1)!=="/"&&(l+="/"),m=this.files[l]),m&&!m.dir)delete this.files[l];else for(var E=this.filter(function(O,D){return D.name.slice(0,l.length)===l}),S=0;S<E.length;S++)delete this.files[E[S].name];return this},generate:function(l){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(l){var m,E={};try{if(E=s.extend(l||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode}),E.type=E.type.toLowerCase(),E.compression=E.compression.toUpperCase(),E.type==="binarystring"&&(E.type="string"),!E.type)throw new Error("No output type specified.");s.checkSupport(E.type),(E.platform==="darwin"||E.platform==="freebsd"||E.platform==="linux"||E.platform==="sunos")&&(E.platform="UNIX"),E.platform==="win32"&&(E.platform="DOS");var S=E.comment||this.comment||"";m=h.generateWorker(this,E,S)}catch(O){m=new o("error"),m.error(O)}return new p(m,E.type||"string",E.mimeType)},generateAsync:function(l,m){return this.generateInternalStream(l).accumulate(m)},generateNodeStream:function(l,m){return l=l||{},l.type||(l.type="nodebuffer"),this.generateInternalStream(l).toNodejsStream(m)}};n.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,n,t){n.exports=r("stream")},{stream:void 0}],17:[function(r,n,t){var a=r("./DataReader"),s=r("../utils");function o(p){a.call(this,p);for(var x=0;x<this.data.length;x++)p[x]=p[x]&255}s.inherits(o,a),o.prototype.byteAt=function(p){return this.data[this.zero+p]},o.prototype.lastIndexOfSignature=function(p){for(var x=p.charCodeAt(0),g=p.charCodeAt(1),d=p.charCodeAt(2),h=p.charCodeAt(3),y=this.length-4;y>=0;--y)if(this.data[y]===x&&this.data[y+1]===g&&this.data[y+2]===d&&this.data[y+3]===h)return y-this.zero;return-1},o.prototype.readAndCheckSignature=function(p){var x=p.charCodeAt(0),g=p.charCodeAt(1),d=p.charCodeAt(2),h=p.charCodeAt(3),y=this.readData(4);return x===y[0]&&g===y[1]&&d===y[2]&&h===y[3]},o.prototype.readData=function(p){if(this.checkOffset(p),p===0)return[];var x=this.data.slice(this.zero+this.index,this.zero+this.index+p);return this.index+=p,x},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(r,n,t){var a=r("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(o){},readInt:function(o){var p=0,x;for(this.checkOffset(o),x=this.index+o-1;x>=this.index;x--)p=(p<<8)+this.byteAt(x);return this.index+=o,p},readString:function(o){return a.transformTo("string",this.readData(o))},readData:function(o){},lastIndexOfSignature:function(o){},readAndCheckSignature:function(o){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC((o>>25&127)+1980,(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(o&31)<<1))}},n.exports=s},{"../utils":32}],19:[function(r,n,t){var a=r("./Uint8ArrayReader"),s=r("../utils");function o(p){a.call(this,p)}s.inherits(o,a),o.prototype.readData=function(p){this.checkOffset(p);var x=this.data.slice(this.zero+this.index,this.zero+this.index+p);return this.index+=p,x},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,n,t){var a=r("./DataReader"),s=r("../utils");function o(p){a.call(this,p)}s.inherits(o,a),o.prototype.byteAt=function(p){return this.data.charCodeAt(this.zero+p)},o.prototype.lastIndexOfSignature=function(p){return this.data.lastIndexOf(p)-this.zero},o.prototype.readAndCheckSignature=function(p){var x=this.readData(4);return p===x},o.prototype.readData=function(p){this.checkOffset(p);var x=this.data.slice(this.zero+this.index,this.zero+this.index+p);return this.index+=p,x},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(r,n,t){var a=r("./ArrayReader"),s=r("../utils");function o(p){a.call(this,p)}s.inherits(o,a),o.prototype.readData=function(p){if(this.checkOffset(p),p===0)return new Uint8Array(0);var x=this.data.subarray(this.zero+this.index,this.zero+this.index+p);return this.index+=p,x},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(r,n,t){var a=r("../utils"),s=r("../support"),o=r("./ArrayReader"),p=r("./StringReader"),x=r("./NodeBufferReader"),g=r("./Uint8ArrayReader");n.exports=function(d){var h=a.getTypeOf(d);return a.checkSupport(h),h==="string"&&!s.uint8array?new p(d):h==="nodebuffer"?new x(d):s.uint8array?new g(a.transformTo("uint8array",d)):new o(a.transformTo("array",d))}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,n,t){t.LOCAL_FILE_HEADER="PK",t.CENTRAL_FILE_HEADER="PK",t.CENTRAL_DIRECTORY_END="PK",t.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",t.ZIP64_CENTRAL_DIRECTORY_END="PK",t.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,n,t){var a=r("./GenericWorker"),s=r("../utils");function o(p){a.call(this,"ConvertWorker to "+p),this.destType=p}s.inherits(o,a),o.prototype.processChunk=function(p){this.push({data:s.transformTo(this.destType,p.data),meta:p.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(r,n,t){var a=r("./GenericWorker"),s=r("../crc32"),o=r("../utils");function p(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}o.inherits(p,a),p.prototype.processChunk=function(x){this.streamInfo.crc32=s(x.data,this.streamInfo.crc32||0),this.push(x)},n.exports=p},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,n,t){var a=r("../utils"),s=r("./GenericWorker");function o(p){s.call(this,"DataLengthProbe for "+p),this.propName=p,this.withStreamInfo(p,0)}a.inherits(o,s),o.prototype.processChunk=function(p){if(p){var x=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=x+p.data.length}s.prototype.processChunk.call(this,p)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(r,n,t){var a=r("../utils"),s=r("./GenericWorker"),o=16*1024;function p(x){s.call(this,"DataWorker");var g=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,x.then(function(d){g.dataIsReady=!0,g.data=d,g.max=d&&d.length||0,g.type=a.getTypeOf(d),g.isPaused||g._tickAndRepeat()},function(d){g.error(d)})}a.inherits(p,s),p.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},p.prototype.resume=function(){return s.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0):!1},p.prototype._tickAndRepeat=function(){this._tickScheduled=!1,!(this.isPaused||this.isFinished)&&(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},p.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var x=o,g=null,d=Math.min(this.max,this.index+x);if(this.index>=this.max)return this.end();switch(this.type){case"string":g=this.data.substring(this.index,d);break;case"uint8array":g=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":g=this.data.slice(this.index,d);break}return this.index=d,this.push({data:g,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=p},{"../utils":32,"./GenericWorker":28}],28:[function(r,n,t){function a(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return this.isFinished?!1:(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var p=0;p<this._listeners[s].length;p++)this._listeners[s][p].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(p){o.processChunk(p)}),s.on("end",function(){o.end()}),s.on("error",function(p){o.error(p)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var s=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)!this.extraStreamInfo.hasOwnProperty(s)||(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=a},{}],29:[function(r,n,t){var a=r("../utils"),s=r("./ConvertWorker"),o=r("./GenericWorker"),p=r("../base64"),x=r("../support"),g=r("../external"),d=null;if(x.nodestream)try{d=r("../nodejs/NodejsStreamOutputAdapter")}catch(_){}function h(_,c,u){switch(_){case"blob":return a.newBlob(a.transformTo("arraybuffer",c),u);case"base64":return p.encode(c);default:return a.transformTo(_,c)}}function y(_,c){var u,f=0,v=null,l=0;for(u=0;u<c.length;u++)l+=c[u].length;switch(_){case"string":return c.join("");case"array":return Array.prototype.concat.apply([],c);case"uint8array":for(v=new Uint8Array(l),u=0;u<c.length;u++)v.set(c[u],f),f+=c[u].length;return v;case"nodebuffer":return Buffer.concat(c);default:throw new Error("concat : unsupported type '"+_+"'")}}function b(_,c){return new g.Promise(function(u,f){var v=[],l=_._internalType,m=_._outputType,E=_._mimeType;_.on("data",function(S,O){v.push(S),c&&c(O)}).on("error",function(S){v=[],f(S)}).on("end",function(){try{var S=h(m,y(l,v),E);u(S)}catch(O){f(O)}v=[]}).resume()})}function T(_,c,u){var f=c;switch(c){case"blob":case"arraybuffer":f="uint8array";break;case"base64":f="string";break}try{this._internalType=f,this._outputType=c,this._mimeType=u,a.checkSupport(f),this._worker=_.pipe(new s(f)),_.lock()}catch(v){this._worker=new o("error"),this._worker.error(v)}}T.prototype={accumulate:function(_){return b(this,_)},on:function(_,c){var u=this;return _==="data"?this._worker.on(_,function(f){c.call(u,f.data,f.meta)}):this._worker.on(_,function(){a.delay(c,arguments,u)}),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(_){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},_)}},n.exports=T},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,n,t){if(t.base64=!0,t.array=!0,t.string=!0,t.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",t.nodebuffer=typeof Buffer!="undefined",t.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")t.blob=!1;else{var a=new ArrayBuffer(0);try{t.blob=new Blob([a],{type:"application/zip"}).size===0}catch(p){try{var s=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,o=new s;o.append(a),t.blob=o.getBlob("application/zip").size===0}catch(x){t.blob=!1}}}try{t.nodestream=!!r("readable-stream").Readable}catch(p){t.nodestream=!1}},{"readable-stream":16}],31:[function(r,n,t){for(var a=r("./utils"),s=r("./support"),o=r("./nodejsUtils"),p=r("./stream/GenericWorker"),x=new Array(256),g=0;g<256;g++)x[g]=g>=252?6:g>=248?5:g>=240?4:g>=224?3:g>=192?2:1;x[254]=x[254]=1;var d=function(_){var c,u,f,v,l,m=_.length,E=0;for(v=0;v<m;v++)u=_.charCodeAt(v),(u&64512)==55296&&v+1<m&&(f=_.charCodeAt(v+1),(f&64512)==56320&&(u=65536+(u-55296<<10)+(f-56320),v++)),E+=u<128?1:u<2048?2:u<65536?3:4;for(s.uint8array?c=new Uint8Array(E):c=new Array(E),l=0,v=0;l<E;v++)u=_.charCodeAt(v),(u&64512)==55296&&v+1<m&&(f=_.charCodeAt(v+1),(f&64512)==56320&&(u=65536+(u-55296<<10)+(f-56320),v++)),u<128?c[l++]=u:u<2048?(c[l++]=192|u>>>6,c[l++]=128|u&63):u<65536?(c[l++]=224|u>>>12,c[l++]=128|u>>>6&63,c[l++]=128|u&63):(c[l++]=240|u>>>18,c[l++]=128|u>>>12&63,c[l++]=128|u>>>6&63,c[l++]=128|u&63);return c},h=function(_,c){var u;for(c=c||_.length,c>_.length&&(c=_.length),u=c-1;u>=0&&(_[u]&192)==128;)u--;return u<0||u===0?c:u+x[_[u]]>c?u:c},y=function(_){var c,u,f,v,l=_.length,m=new Array(l*2);for(u=0,c=0;c<l;){if(f=_[c++],f<128){m[u++]=f;continue}if(v=x[f],v>4){m[u++]=65533,c+=v-1;continue}for(f&=v===2?31:v===3?15:7;v>1&&c<l;)f=f<<6|_[c++]&63,v--;if(v>1){m[u++]=65533;continue}f<65536?m[u++]=f:(f-=65536,m[u++]=55296|f>>10&1023,m[u++]=56320|f&1023)}return m.length!==u&&(m.subarray?m=m.subarray(0,u):m.length=u),a.applyFromCharCode(m)};t.utf8encode=function(c){return s.nodebuffer?o.newBufferFrom(c,"utf-8"):d(c)},t.utf8decode=function(c){return s.nodebuffer?a.transformTo("nodebuffer",c).toString("utf-8"):(c=a.transformTo(s.uint8array?"uint8array":"array",c),y(c))};function b(){p.call(this,"utf-8 decode"),this.leftOver=null}a.inherits(b,p),b.prototype.processChunk=function(_){var c=a.transformTo(s.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var u=c;c=new Uint8Array(u.length+this.leftOver.length),c.set(this.leftOver,0),c.set(u,this.leftOver.length)}else c=this.leftOver.concat(c);this.leftOver=null}var f=h(c),v=c;f!==c.length&&(s.uint8array?(v=c.subarray(0,f),this.leftOver=c.subarray(f,c.length)):(v=c.slice(0,f),this.leftOver=c.slice(f,c.length))),this.push({data:t.utf8decode(v),meta:_.meta})},b.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:t.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},t.Utf8DecodeWorker=b;function T(){p.call(this,"utf-8 encode")}a.inherits(T,p),T.prototype.processChunk=function(_){this.push({data:t.utf8encode(_.data),meta:_.meta})},t.Utf8EncodeWorker=T},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,n,t){var a=r("./support"),s=r("./base64"),o=r("./nodejsUtils"),p=r("set-immediate-shim"),x=r("./external");function g(c){var u=null;return a.uint8array?u=new Uint8Array(c.length):u=new Array(c.length),h(c,u)}t.newBlob=function(c,u){t.checkSupport("blob");try{return new Blob([c],{type:u})}catch(l){try{var f=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,v=new f;return v.append(c),v.getBlob(u)}catch(m){throw new Error("Bug : can't construct the Blob.")}}};function d(c){return c}function h(c,u){for(var f=0;f<c.length;++f)u[f]=c.charCodeAt(f)&255;return u}var y={stringifyByChunk:function(c,u,f){var v=[],l=0,m=c.length;if(m<=f)return String.fromCharCode.apply(null,c);for(;l<m;)u==="array"||u==="nodebuffer"?v.push(String.fromCharCode.apply(null,c.slice(l,Math.min(l+f,m)))):v.push(String.fromCharCode.apply(null,c.subarray(l,Math.min(l+f,m)))),l+=f;return v.join("")},stringifyByChar:function(c){for(var u="",f=0;f<c.length;f++)u+=String.fromCharCode(c[f]);return u},applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(c){return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch(c){return!1}}()}};function b(c){var u=65536,f=t.getTypeOf(c),v=!0;if(f==="uint8array"?v=y.applyCanBeUsed.uint8array:f==="nodebuffer"&&(v=y.applyCanBeUsed.nodebuffer),v)for(;u>1;)try{return y.stringifyByChunk(c,f,u)}catch(l){u=Math.floor(u/2)}return y.stringifyByChar(c)}t.applyFromCharCode=b;function T(c,u){for(var f=0;f<c.length;f++)u[f]=c[f];return u}var _={};_.string={string:d,array:function(c){return h(c,new Array(c.length))},arraybuffer:function(c){return _.string.uint8array(c).buffer},uint8array:function(c){return h(c,new Uint8Array(c.length))},nodebuffer:function(c){return h(c,o.allocBuffer(c.length))}},_.array={string:b,array:d,arraybuffer:function(c){return new Uint8Array(c).buffer},uint8array:function(c){return new Uint8Array(c)},nodebuffer:function(c){return o.newBufferFrom(c)}},_.arraybuffer={string:function(c){return b(new Uint8Array(c))},array:function(c){return T(new Uint8Array(c),new Array(c.byteLength))},arraybuffer:d,uint8array:function(c){return new Uint8Array(c)},nodebuffer:function(c){return o.newBufferFrom(new Uint8Array(c))}},_.uint8array={string:b,array:function(c){return T(c,new Array(c.length))},arraybuffer:function(c){return c.buffer},uint8array:d,nodebuffer:function(c){return o.newBufferFrom(c)}},_.nodebuffer={string:b,array:function(c){return T(c,new Array(c.length))},arraybuffer:function(c){return _.nodebuffer.uint8array(c).buffer},uint8array:function(c){return T(c,new Uint8Array(c.length))},nodebuffer:d},t.transformTo=function(c,u){if(u||(u=""),!c)return u;t.checkSupport(c);var f=t.getTypeOf(u),v=_[f][c](u);return v},t.getTypeOf=function(c){if(typeof c=="string")return"string";if(Object.prototype.toString.call(c)==="[object Array]")return"array";if(a.nodebuffer&&o.isBuffer(c))return"nodebuffer";if(a.uint8array&&c instanceof Uint8Array)return"uint8array";if(a.arraybuffer&&c instanceof ArrayBuffer)return"arraybuffer"},t.checkSupport=function(c){var u=a[c.toLowerCase()];if(!u)throw new Error(c+" is not supported by this platform")},t.MAX_VALUE_16BITS=65535,t.MAX_VALUE_32BITS=-1,t.pretty=function(c){var u="",f,v;for(v=0;v<(c||"").length;v++)f=c.charCodeAt(v),u+="\\x"+(f<16?"0":"")+f.toString(16).toUpperCase();return u},t.delay=function(c,u,f){p(function(){c.apply(f||null,u||[])})},t.inherits=function(c,u){var f=function(){};f.prototype=u.prototype,c.prototype=new f},t.extend=function(){var c={},u,f;for(u=0;u<arguments.length;u++)for(f in arguments[u])arguments[u].hasOwnProperty(f)&&typeof c[f]=="undefined"&&(c[f]=arguments[u][f]);return c},t.prepareContent=function(c,u,f,v,l){var m=x.Promise.resolve(u).then(function(E){var S=a.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1);return S&&typeof FileReader!="undefined"?new x.Promise(function(O,D){var P=new FileReader;P.onload=function(A){O(A.target.result)},P.onerror=function(A){D(A.target.error)},P.readAsArrayBuffer(E)}):E});return m.then(function(E){var S=t.getTypeOf(E);return S?(S==="arraybuffer"?E=t.transformTo("uint8array",E):S==="string"&&(l?E=s.decode(E):f&&v!==!0&&(E=g(E))),E):x.Promise.reject(new Error("Can't read the data of '"+c+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(r,n,t){var a=r("./reader/readerFor"),s=r("./utils"),o=r("./signature"),p=r("./zipEntry");r("./utf8");var x=r("./support");function g(d){this.files=[],this.loadOptions=d}g.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(h)+", expected "+s.pretty(d)+")")}},isSignature:function(d,h){var y=this.reader.index;this.reader.setIndex(d);var b=this.reader.readString(4),T=b===h;return this.reader.setIndex(y),T},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),h=x.uint8array?"uint8array":"array",y=s.transformTo(h,d);this.zipComment=this.loadOptions.decodeFileName(y)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d=this.zip64EndOfCentralSize-44,h=0,y,b,T;h<d;)y=this.reader.readInt(2),b=this.reader.readInt(4),T=this.reader.readData(b),this.zip64ExtensibleData[y]={id:y,length:b,value:T}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,h;for(d=0;d<this.files.length;d++)h=this.files[d],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)d=new p({zip64:this.zip64},this.loadOptions),d.readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0){var h=!this.isSignature(0,o.LOCAL_FILE_HEADER);throw h?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(d);var y=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),d<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var b=this.centralDirOffset+this.centralDirSize;this.zip64&&(b+=20,b+=12+this.zip64EndOfCentralSize);var T=y-b;if(T>0)this.isSignature(y,o.CENTRAL_FILE_HEADER)||(this.reader.zero=T);else if(T<0)throw new Error("Corrupted zip: missing "+Math.abs(T)+" bytes.")},prepareReader:function(d){this.reader=a(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=g},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(r,n,t){var a=r("./reader/readerFor"),s=r("./utils"),o=r("./compressedObject"),p=r("./crc32"),x=r("./utf8"),g=r("./compressions"),d=r("./support"),h=0,y=3,b=function(_){for(var c in g)if(!!g.hasOwnProperty(c)&&g[c].magic===_)return g[c];return null};function T(_,c){this.options=_,this.loadOptions=c}T.prototype={isEncrypted:function(){return(this.bitFlag&1)==1},useUTF8:function(){return(this.bitFlag&2048)==2048},readLocalPart:function(_){var c,u;if(_.skip(22),this.fileNameLength=_.readInt(2),u=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip(u),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(c=b(this.compressionMethod),c===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,c,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var c=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(c),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(this.externalFileAttributes&16),_===h&&(this.dosPermissions=this.externalFileAttributes&63),_===y&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(_){if(!!this.extraFields[1]){var c=a(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(_){var c=_.index+this.extraFieldsLength,u,f,v;for(this.extraFields||(this.extraFields={});_.index+4<c;)u=_.readInt(2),f=_.readInt(2),v=_.readData(f),this.extraFields[u]={id:u,length:f,value:v};_.setIndex(c)},handleUTF8:function(){var _=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=x.utf8decode(this.fileName),this.fileCommentStr=x.utf8decode(this.fileComment);else{var c=this.findExtraFieldUnicodePath();if(c!==null)this.fileNameStr=c;else{var u=s.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(u)}var f=this.findExtraFieldUnicodeComment();if(f!==null)this.fileCommentStr=f;else{var v=s.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var c=a(_.value);return c.readInt(1)!==1||p(this.fileName)!==c.readInt(4)?null:x.utf8decode(c.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var c=a(_.value);return c.readInt(1)!==1||p(this.fileComment)!==c.readInt(4)?null:x.utf8decode(c.readData(_.length-5))}return null}},n.exports=T},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,n,t){var a=r("./stream/StreamHelper"),s=r("./stream/DataWorker"),o=r("./utf8"),p=r("./compressedObject"),x=r("./stream/GenericWorker"),g=function(b,T,_){this.name=b,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=T,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}};g.prototype={internalStream:function(b){var T=null,_="string";try{if(!b)throw new Error("No output type specified.");_=b.toLowerCase();var c=_==="string"||_==="text";(_==="binarystring"||_==="text")&&(_="string"),T=this._decompressWorker();var u=!this._dataBinary;u&&!c&&(T=T.pipe(new o.Utf8EncodeWorker)),!u&&c&&(T=T.pipe(new o.Utf8DecodeWorker))}catch(f){T=new x("error"),T.error(f)}return new a(T,_,"")},async:function(b,T){return this.internalStream(b).accumulate(T)},nodeStream:function(b,T){return this.internalStream(b||"nodebuffer").toNodejsStream(T)},_compressWorker:function(b,T){if(this._data instanceof p&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new o.Utf8EncodeWorker)),p.createWorkerFrom(_,b,T)},_decompressWorker:function(){return this._data instanceof p?this._data.getContentWorker():this._data instanceof x?this._data:new s(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},y=0;y<d.length;y++)g.prototype[d[y]]=h;n.exports=g},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,n,t){(function(a){var s=a.MutationObserver||a.WebKitMutationObserver,o;if(s){var p=0,x=new s(b),g=a.document.createTextNode("");x.observe(g,{characterData:!0}),o=function(){g.data=p=++p%2}}else if(!a.setImmediate&&typeof a.MessageChannel!="undefined"){var d=new a.MessageChannel;d.port1.onmessage=b,o=function(){d.port2.postMessage(0)}}else"document"in a&&"onreadystatechange"in a.document.createElement("script")?o=function(){var _=a.document.createElement("script");_.onreadystatechange=function(){b(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},a.document.documentElement.appendChild(_)}:o=function(){setTimeout(b,0)};var h,y=[];function b(){h=!0;for(var _,c,u=y.length;u;){for(c=y,y=[],_=-1;++_<u;)c[_]();u=y.length}h=!1}n.exports=T;function T(_){y.push(_)===1&&!h&&o()}}).call(this,typeof Er!="undefined"?Er:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(r,n,t){var a=r("immediate");function s(){}var o={},p=["REJECTED"],x=["FULFILLED"],g=["PENDING"];n.exports=d;function d(l){if(typeof l!="function")throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,l!==s&&T(this,l)}d.prototype.finally=function(l){if(typeof l!="function")return this;var m=this.constructor;return this.then(E,S);function E(O){function D(){return O}return m.resolve(l()).then(D)}function S(O){function D(){throw O}return m.resolve(l()).then(D)}},d.prototype.catch=function(l){return this.then(null,l)},d.prototype.then=function(l,m){if(typeof l!="function"&&this.state===x||typeof m!="function"&&this.state===p)return this;var E=new this.constructor(s);if(this.state!==g){var S=this.state===x?l:m;y(E,S,this.outcome)}else this.queue.push(new h(E,l,m));return E};function h(l,m,E){this.promise=l,typeof m=="function"&&(this.onFulfilled=m,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}h.prototype.callFulfilled=function(l){o.resolve(this.promise,l)},h.prototype.otherCallFulfilled=function(l){y(this.promise,this.onFulfilled,l)},h.prototype.callRejected=function(l){o.reject(this.promise,l)},h.prototype.otherCallRejected=function(l){y(this.promise,this.onRejected,l)};function y(l,m,E){a(function(){var S;try{S=m(E)}catch(O){return o.reject(l,O)}S===l?o.reject(l,new TypeError("Cannot resolve promise with itself")):o.resolve(l,S)})}o.resolve=function(l,m){var E=_(b,m);if(E.status==="error")return o.reject(l,E.value);var S=E.value;if(S)T(l,S);else{l.state=x,l.outcome=m;for(var O=-1,D=l.queue.length;++O<D;)l.queue[O].callFulfilled(m)}return l},o.reject=function(l,m){l.state=p,l.outcome=m;for(var E=-1,S=l.queue.length;++E<S;)l.queue[E].callRejected(m);return l};function b(l){var m=l&&l.then;if(l&&(typeof l=="object"||typeof l=="function")&&typeof m=="function")return function(){m.apply(l,arguments)}}function T(l,m){var E=!1;function S(A){E||(E=!0,o.reject(l,A))}function O(A){E||(E=!0,o.resolve(l,A))}function D(){m(O,S)}var P=_(D);P.status==="error"&&S(P.value)}function _(l,m){var E={};try{E.value=l(m),E.status="success"}catch(S){E.status="error",E.value=S}return E}d.resolve=c;function c(l){return l instanceof this?l:o.resolve(new this(s),l)}d.reject=u;function u(l){var m=new this(s);return o.reject(m,l)}d.all=f;function f(l){var m=this;if(Object.prototype.toString.call(l)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=l.length,S=!1;if(!E)return this.resolve([]);for(var O=new Array(E),D=0,P=-1,A=new this(s);++P<E;)w(l[P],P);return A;function w(L,R){m.resolve(L).then(C,function(M){S||(S=!0,o.reject(A,M))});function C(M){O[R]=M,++D===E&&!S&&(S=!0,o.resolve(A,O))}}}d.race=v;function v(l){var m=this;if(Object.prototype.toString.call(l)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=l.length,S=!1;if(!E)return this.resolve([]);for(var O=-1,D=new this(s);++O<E;)P(l[O]);return D;function P(A){m.resolve(A).then(function(w){S||(S=!0,o.resolve(D,w))},function(w){S||(S=!0,o.reject(D,w))})}}},{immediate:36}],38:[function(r,n,t){var a=r("./lib/utils/common").assign,s=r("./lib/deflate"),o=r("./lib/inflate"),p=r("./lib/zlib/constants"),x={};a(x,s,o,p),n.exports=x},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,n,t){var a=r("./zlib/deflate"),s=r("./utils/common"),o=r("./utils/strings"),p=r("./zlib/messages"),x=r("./zlib/zstream"),g=Object.prototype.toString,d=0,h=4,y=0,b=1,T=2,_=-1,c=0,u=8;function f(E){if(!(this instanceof f))return new f(E);this.options=s.assign({level:_,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},E||{});var S=this.options;S.raw&&S.windowBits>0?S.windowBits=-S.windowBits:S.gzip&&S.windowBits>0&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new x,this.strm.avail_out=0;var O=a.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(O!==y)throw new Error(p[O]);if(S.header&&a.deflateSetHeader(this.strm,S.header),S.dictionary){var D;if(typeof S.dictionary=="string"?D=o.string2buf(S.dictionary):g.call(S.dictionary)==="[object ArrayBuffer]"?D=new Uint8Array(S.dictionary):D=S.dictionary,O=a.deflateSetDictionary(this.strm,D),O!==y)throw new Error(p[O]);this._dict_set=!0}}f.prototype.push=function(E,S){var O=this.strm,D=this.options.chunkSize,P,A;if(this.ended)return!1;A=S===~~S?S:S===!0?h:d,typeof E=="string"?O.input=o.string2buf(E):g.call(E)==="[object ArrayBuffer]"?O.input=new Uint8Array(E):O.input=E,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new s.Buf8(D),O.next_out=0,O.avail_out=D),P=a.deflate(O,A),P!==b&&P!==y)return this.onEnd(P),this.ended=!0,!1;(O.avail_out===0||O.avail_in===0&&(A===h||A===T))&&(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(O.output,O.next_out))):this.onData(s.shrinkBuf(O.output,O.next_out)))}while((O.avail_in>0||O.avail_out===0)&&P!==b);return A===h?(P=a.deflateEnd(this.strm),this.onEnd(P),this.ended=!0,P===y):(A===T&&(this.onEnd(y),O.avail_out=0),!0)},f.prototype.onData=function(E){this.chunks.push(E)},f.prototype.onEnd=function(E){E===y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg};function v(E,S){var O=new f(S);if(O.push(E,!0),O.err)throw O.msg||p[O.err];return O.result}function l(E,S){return S=S||{},S.raw=!0,v(E,S)}function m(E,S){return S=S||{},S.gzip=!0,v(E,S)}t.Deflate=f,t.deflate=v,t.deflateRaw=l,t.gzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,n,t){var a=r("./zlib/inflate"),s=r("./utils/common"),o=r("./utils/strings"),p=r("./zlib/constants"),x=r("./zlib/messages"),g=r("./zlib/zstream"),d=r("./zlib/gzheader"),h=Object.prototype.toString;function y(_){if(!(this instanceof y))return new y(_);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},_||{});var c=this.options;c.raw&&c.windowBits>=0&&c.windowBits<16&&(c.windowBits=-c.windowBits,c.windowBits===0&&(c.windowBits=-15)),c.windowBits>=0&&c.windowBits<16&&!(_&&_.windowBits)&&(c.windowBits+=32),c.windowBits>15&&c.windowBits<48&&(c.windowBits&15)==0&&(c.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;var u=a.inflateInit2(this.strm,c.windowBits);if(u!==p.Z_OK)throw new Error(x[u]);this.header=new d,a.inflateGetHeader(this.strm,this.header)}y.prototype.push=function(_,c){var u=this.strm,f=this.options.chunkSize,v=this.options.dictionary,l,m,E,S,O,D,P=!1;if(this.ended)return!1;m=c===~~c?c:c===!0?p.Z_FINISH:p.Z_NO_FLUSH,typeof _=="string"?u.input=o.binstring2buf(_):h.call(_)==="[object ArrayBuffer]"?u.input=new Uint8Array(_):u.input=_,u.next_in=0,u.avail_in=u.input.length;do{if(u.avail_out===0&&(u.output=new s.Buf8(f),u.next_out=0,u.avail_out=f),l=a.inflate(u,p.Z_NO_FLUSH),l===p.Z_NEED_DICT&&v&&(typeof v=="string"?D=o.string2buf(v):h.call(v)==="[object ArrayBuffer]"?D=new Uint8Array(v):D=v,l=a.inflateSetDictionary(this.strm,D)),l===p.Z_BUF_ERROR&&P===!0&&(l=p.Z_OK,P=!1),l!==p.Z_STREAM_END&&l!==p.Z_OK)return this.onEnd(l),this.ended=!0,!1;u.next_out&&(u.avail_out===0||l===p.Z_STREAM_END||u.avail_in===0&&(m===p.Z_FINISH||m===p.Z_SYNC_FLUSH))&&(this.options.to==="string"?(E=o.utf8border(u.output,u.next_out),S=u.next_out-E,O=o.buf2string(u.output,E),u.next_out=S,u.avail_out=f-S,S&&s.arraySet(u.output,u.output,E,S,0),this.onData(O)):this.onData(s.shrinkBuf(u.output,u.next_out))),u.avail_in===0&&u.avail_out===0&&(P=!0)}while((u.avail_in>0||u.avail_out===0)&&l!==p.Z_STREAM_END);return l===p.Z_STREAM_END&&(m=p.Z_FINISH),m===p.Z_FINISH?(l=a.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===p.Z_OK):(m===p.Z_SYNC_FLUSH&&(this.onEnd(p.Z_OK),u.avail_out=0),!0)},y.prototype.onData=function(_){this.chunks.push(_)},y.prototype.onEnd=function(_){_===p.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg};function b(_,c){var u=new y(c);if(u.push(_,!0),u.err)throw u.msg||x[u.err];return u.result}function T(_,c){return c=c||{},c.raw=!0,b(_,c)}t.Inflate=y,t.inflate=b,t.inflateRaw=T,t.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,n,t){var a=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";t.assign=function(p){for(var x=Array.prototype.slice.call(arguments,1);x.length;){var g=x.shift();if(!!g){if(typeof g!="object")throw new TypeError(g+"must be non-object");for(var d in g)g.hasOwnProperty(d)&&(p[d]=g[d])}}return p},t.shrinkBuf=function(p,x){return p.length===x?p:p.subarray?p.subarray(0,x):(p.length=x,p)};var s={arraySet:function(p,x,g,d,h){if(x.subarray&&p.subarray){p.set(x.subarray(g,g+d),h);return}for(var y=0;y<d;y++)p[h+y]=x[g+y]},flattenChunks:function(p){var x,g,d,h,y,b;for(d=0,x=0,g=p.length;x<g;x++)d+=p[x].length;for(b=new Uint8Array(d),h=0,x=0,g=p.length;x<g;x++)y=p[x],b.set(y,h),h+=y.length;return b}},o={arraySet:function(p,x,g,d,h){for(var y=0;y<d;y++)p[h+y]=x[g+y]},flattenChunks:function(p){return[].concat.apply([],p)}};t.setTyped=function(p){p?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(a)},{}],42:[function(r,n,t){var a=r("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(d){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(d){o=!1}for(var p=new a.Buf8(256),x=0;x<256;x++)p[x]=x>=252?6:x>=248?5:x>=240?4:x>=224?3:x>=192?2:1;p[254]=p[254]=1,t.string2buf=function(d){var h,y,b,T,_,c=d.length,u=0;for(T=0;T<c;T++)y=d.charCodeAt(T),(y&64512)==55296&&T+1<c&&(b=d.charCodeAt(T+1),(b&64512)==56320&&(y=65536+(y-55296<<10)+(b-56320),T++)),u+=y<128?1:y<2048?2:y<65536?3:4;for(h=new a.Buf8(u),_=0,T=0;_<u;T++)y=d.charCodeAt(T),(y&64512)==55296&&T+1<c&&(b=d.charCodeAt(T+1),(b&64512)==56320&&(y=65536+(y-55296<<10)+(b-56320),T++)),y<128?h[_++]=y:y<2048?(h[_++]=192|y>>>6,h[_++]=128|y&63):y<65536?(h[_++]=224|y>>>12,h[_++]=128|y>>>6&63,h[_++]=128|y&63):(h[_++]=240|y>>>18,h[_++]=128|y>>>12&63,h[_++]=128|y>>>6&63,h[_++]=128|y&63);return h};function g(d,h){if(h<65537&&(d.subarray&&o||!d.subarray&&s))return String.fromCharCode.apply(null,a.shrinkBuf(d,h));for(var y="",b=0;b<h;b++)y+=String.fromCharCode(d[b]);return y}t.buf2binstring=function(d){return g(d,d.length)},t.binstring2buf=function(d){for(var h=new a.Buf8(d.length),y=0,b=h.length;y<b;y++)h[y]=d.charCodeAt(y);return h},t.buf2string=function(d,h){var y,b,T,_,c=h||d.length,u=new Array(c*2);for(b=0,y=0;y<c;){if(T=d[y++],T<128){u[b++]=T;continue}if(_=p[T],_>4){u[b++]=65533,y+=_-1;continue}for(T&=_===2?31:_===3?15:7;_>1&&y<c;)T=T<<6|d[y++]&63,_--;if(_>1){u[b++]=65533;continue}T<65536?u[b++]=T:(T-=65536,u[b++]=55296|T>>10&1023,u[b++]=56320|T&1023)}return g(u,b)},t.utf8border=function(d,h){var y;for(h=h||d.length,h>d.length&&(h=d.length),y=h-1;y>=0&&(d[y]&192)==128;)y--;return y<0||y===0?h:y+p[d[y]]>h?y:h}},{"./common":41}],43:[function(r,n,t){function a(s,o,p,x){for(var g=s&65535|0,d=s>>>16&65535|0,h=0;p!==0;){h=p>2e3?2e3:p,p-=h;do g=g+o[x++]|0,d=d+g|0;while(--h);g%=65521,d%=65521}return g|d<<16|0}n.exports=a},{}],44:[function(r,n,t){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,n,t){function a(){for(var p,x=[],g=0;g<256;g++){p=g;for(var d=0;d<8;d++)p=p&1?3988292384^p>>>1:p>>>1;x[g]=p}return x}var s=a();function o(p,x,g,d){var h=s,y=d+g;p^=-1;for(var b=d;b<y;b++)p=p>>>8^h[(p^x[b])&255];return p^-1}n.exports=o},{}],46:[function(r,n,t){var a=r("../utils/common"),s=r("./trees"),o=r("./adler32"),p=r("./crc32"),x=r("./messages"),g=0,d=1,h=3,y=4,b=5,T=0,_=1,c=-2,u=-3,f=-5,v=-1,l=1,m=2,E=3,S=4,O=0,D=2,P=8,A=9,w=15,L=8,R=29,C=256,M=C+1+R,N=30,U=19,K=2*M+1,V=15,W=3,G=258,Y=G+W+1,q=32,ee=42,re=69,pe=73,Le=91,Te=103,be=113,Re=666,Se=1,Ge=2,$e=3,st=4,Ze=3;function et(B,ge){return B.msg=x[ge],ge}function ft(B){return(B<<1)-(B>4?9:0)}function dt(B){for(var ge=B.length;--ge>=0;)B[ge]=0}function ht(B){var ge=B.state,xe=ge.pending;xe>B.avail_out&&(xe=B.avail_out),xe!==0&&(a.arraySet(B.output,ge.pending_buf,ge.pending_out,xe,B.next_out),B.next_out+=xe,ge.pending_out+=xe,B.total_out+=xe,B.avail_out-=xe,ge.pending-=xe,ge.pending===0&&(ge.pending_out=0))}function He(B,ge){s._tr_flush_block(B,B.block_start>=0?B.block_start:-1,B.strstart-B.block_start,ge),B.block_start=B.strstart,ht(B.strm)}function rt(B,ge){B.pending_buf[B.pending++]=ge}function xt(B,ge){B.pending_buf[B.pending++]=ge>>>8&255,B.pending_buf[B.pending++]=ge&255}function pt(B,ge,xe,$){var ae=B.avail_in;return ae>$&&(ae=$),ae===0?0:(B.avail_in-=ae,a.arraySet(ge,B.input,B.next_in,ae,xe),B.state.wrap===1?B.adler=o(B.adler,ge,ae,xe):B.state.wrap===2&&(B.adler=p(B.adler,ge,ae,xe)),B.next_in+=ae,B.total_in+=ae,ae)}function ot(B,ge){var xe=B.max_chain_length,$=B.strstart,ae,me,at=B.prev_length,Xe=B.nice_match,Qe=B.strstart>B.w_size-Y?B.strstart-(B.w_size-Y):0,bt=B.window,lr=B.w_mask,Nt=B.prev,St=B.strstart+G,Wt=bt[$+at-1],Zt=bt[$+at];B.prev_length>=B.good_match&&(xe>>=2),Xe>B.lookahead&&(Xe=B.lookahead);do if(ae=ge,!(bt[ae+at]!==Zt||bt[ae+at-1]!==Wt||bt[ae]!==bt[$]||bt[++ae]!==bt[$+1])){$+=2,ae++;do;while(bt[++$]===bt[++ae]&&bt[++$]===bt[++ae]&&bt[++$]===bt[++ae]&&bt[++$]===bt[++ae]&&bt[++$]===bt[++ae]&&bt[++$]===bt[++ae]&&bt[++$]===bt[++ae]&&bt[++$]===bt[++ae]&&$<St);if(me=G-(St-$),$=St-G,me>at){if(B.match_start=ge,at=me,me>=Xe)break;Wt=bt[$+at-1],Zt=bt[$+at]}}while((ge=Nt[ge&lr])>Qe&&--xe!=0);return at<=B.lookahead?at:B.lookahead}function Lt(B){var ge=B.w_size,xe,$,ae,me,at;do{if(me=B.window_size-B.lookahead-B.strstart,B.strstart>=ge+(ge-Y)){a.arraySet(B.window,B.window,ge,ge,0),B.match_start-=ge,B.strstart-=ge,B.block_start-=ge,$=B.hash_size,xe=$;do ae=B.head[--xe],B.head[xe]=ae>=ge?ae-ge:0;while(--$);$=ge,xe=$;do ae=B.prev[--xe],B.prev[xe]=ae>=ge?ae-ge:0;while(--$);me+=ge}if(B.strm.avail_in===0)break;if($=pt(B.strm,B.window,B.strstart+B.lookahead,me),B.lookahead+=$,B.lookahead+B.insert>=W)for(at=B.strstart-B.insert,B.ins_h=B.window[at],B.ins_h=(B.ins_h<<B.hash_shift^B.window[at+1])&B.hash_mask;B.insert&&(B.ins_h=(B.ins_h<<B.hash_shift^B.window[at+W-1])&B.hash_mask,B.prev[at&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=at,at++,B.insert--,!(B.lookahead+B.insert<W)););}while(B.lookahead<Y&&B.strm.avail_in!==0)}function wt(B,ge){var xe=65535;for(xe>B.pending_buf_size-5&&(xe=B.pending_buf_size-5);;){if(B.lookahead<=1){if(Lt(B),B.lookahead===0&&ge===g)return Se;if(B.lookahead===0)break}B.strstart+=B.lookahead,B.lookahead=0;var $=B.block_start+xe;if((B.strstart===0||B.strstart>=$)&&(B.lookahead=B.strstart-$,B.strstart=$,He(B,!1),B.strm.avail_out===0)||B.strstart-B.block_start>=B.w_size-Y&&(He(B,!1),B.strm.avail_out===0))return Se}return B.insert=0,ge===y?(He(B,!0),B.strm.avail_out===0?$e:st):(B.strstart>B.block_start&&(He(B,!1),B.strm.avail_out===0),Se)}function Pt(B,ge){for(var xe,$;;){if(B.lookahead<Y){if(Lt(B),B.lookahead<Y&&ge===g)return Se;if(B.lookahead===0)break}if(xe=0,B.lookahead>=W&&(B.ins_h=(B.ins_h<<B.hash_shift^B.window[B.strstart+W-1])&B.hash_mask,xe=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart),xe!==0&&B.strstart-xe<=B.w_size-Y&&(B.match_length=ot(B,xe)),B.match_length>=W)if($=s._tr_tally(B,B.strstart-B.match_start,B.match_length-W),B.lookahead-=B.match_length,B.match_length<=B.max_lazy_match&&B.lookahead>=W){B.match_length--;do B.strstart++,B.ins_h=(B.ins_h<<B.hash_shift^B.window[B.strstart+W-1])&B.hash_mask,xe=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart;while(--B.match_length!=0);B.strstart++}else B.strstart+=B.match_length,B.match_length=0,B.ins_h=B.window[B.strstart],B.ins_h=(B.ins_h<<B.hash_shift^B.window[B.strstart+1])&B.hash_mask;else $=s._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++;if($&&(He(B,!1),B.strm.avail_out===0))return Se}return B.insert=B.strstart<W-1?B.strstart:W-1,ge===y?(He(B,!0),B.strm.avail_out===0?$e:st):B.last_lit&&(He(B,!1),B.strm.avail_out===0)?Se:Ge}function ve(B,ge){for(var xe,$,ae;;){if(B.lookahead<Y){if(Lt(B),B.lookahead<Y&&ge===g)return Se;if(B.lookahead===0)break}if(xe=0,B.lookahead>=W&&(B.ins_h=(B.ins_h<<B.hash_shift^B.window[B.strstart+W-1])&B.hash_mask,xe=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart),B.prev_length=B.match_length,B.prev_match=B.match_start,B.match_length=W-1,xe!==0&&B.prev_length<B.max_lazy_match&&B.strstart-xe<=B.w_size-Y&&(B.match_length=ot(B,xe),B.match_length<=5&&(B.strategy===l||B.match_length===W&&B.strstart-B.match_start>4096)&&(B.match_length=W-1)),B.prev_length>=W&&B.match_length<=B.prev_length){ae=B.strstart+B.lookahead-W,$=s._tr_tally(B,B.strstart-1-B.prev_match,B.prev_length-W),B.lookahead-=B.prev_length-1,B.prev_length-=2;do++B.strstart<=ae&&(B.ins_h=(B.ins_h<<B.hash_shift^B.window[B.strstart+W-1])&B.hash_mask,xe=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart);while(--B.prev_length!=0);if(B.match_available=0,B.match_length=W-1,B.strstart++,$&&(He(B,!1),B.strm.avail_out===0))return Se}else if(B.match_available){if($=s._tr_tally(B,0,B.window[B.strstart-1]),$&&He(B,!1),B.strstart++,B.lookahead--,B.strm.avail_out===0)return Se}else B.match_available=1,B.strstart++,B.lookahead--}return B.match_available&&($=s._tr_tally(B,0,B.window[B.strstart-1]),B.match_available=0),B.insert=B.strstart<W-1?B.strstart:W-1,ge===y?(He(B,!0),B.strm.avail_out===0?$e:st):B.last_lit&&(He(B,!1),B.strm.avail_out===0)?Se:Ge}function Ce(B,ge){for(var xe,$,ae,me,at=B.window;;){if(B.lookahead<=G){if(Lt(B),B.lookahead<=G&&ge===g)return Se;if(B.lookahead===0)break}if(B.match_length=0,B.lookahead>=W&&B.strstart>0&&(ae=B.strstart-1,$=at[ae],$===at[++ae]&&$===at[++ae]&&$===at[++ae])){me=B.strstart+G;do;while($===at[++ae]&&$===at[++ae]&&$===at[++ae]&&$===at[++ae]&&$===at[++ae]&&$===at[++ae]&&$===at[++ae]&&$===at[++ae]&&ae<me);B.match_length=G-(me-ae),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=W?(xe=s._tr_tally(B,1,B.match_length-W),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(xe=s._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),xe&&(He(B,!1),B.strm.avail_out===0))return Se}return B.insert=0,ge===y?(He(B,!0),B.strm.avail_out===0?$e:st):B.last_lit&&(He(B,!1),B.strm.avail_out===0)?Se:Ge}function ke(B,ge){for(var xe;;){if(B.lookahead===0&&(Lt(B),B.lookahead===0)){if(ge===g)return Se;break}if(B.match_length=0,xe=s._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,xe&&(He(B,!1),B.strm.avail_out===0))return Se}return B.insert=0,ge===y?(He(B,!0),B.strm.avail_out===0?$e:st):B.last_lit&&(He(B,!1),B.strm.avail_out===0)?Se:Ge}function Ue(B,ge,xe,$,ae){this.good_length=B,this.max_lazy=ge,this.nice_length=xe,this.max_chain=$,this.func=ae}var Je;Je=[new Ue(0,0,0,0,wt),new Ue(4,4,8,4,Pt),new Ue(4,5,16,8,Pt),new Ue(4,6,32,32,Pt),new Ue(4,4,16,16,ve),new Ue(8,16,32,32,ve),new Ue(8,16,128,128,ve),new Ue(8,32,128,256,ve),new Ue(32,128,258,1024,ve),new Ue(32,258,258,4096,ve)];function it(B){B.window_size=2*B.w_size,dt(B.head),B.max_lazy_match=Je[B.level].max_lazy,B.good_match=Je[B.level].good_length,B.nice_match=Je[B.level].nice_length,B.max_chain_length=Je[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=W-1,B.match_available=0,B.ins_h=0}function X(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=P,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(K*2),this.dyn_dtree=new a.Buf16((2*N+1)*2),this.bl_tree=new a.Buf16((2*U+1)*2),dt(this.dyn_ltree),dt(this.dyn_dtree),dt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(V+1),this.heap=new a.Buf16(2*M+1),dt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*M+1),dt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ae(B){var ge;return!B||!B.state?et(B,c):(B.total_in=B.total_out=0,B.data_type=D,ge=B.state,ge.pending=0,ge.pending_out=0,ge.wrap<0&&(ge.wrap=-ge.wrap),ge.status=ge.wrap?ee:be,B.adler=ge.wrap===2?0:1,ge.last_flush=g,s._tr_init(ge),T)}function Me(B){var ge=Ae(B);return ge===T&&it(B.state),ge}function Ke(B,ge){return!B||!B.state||B.state.wrap!==2?c:(B.state.gzhead=ge,T)}function ne(B,ge,xe,$,ae,me){if(!B)return c;var at=1;if(ge===v&&(ge=6),$<0?(at=0,$=-$):$>15&&(at=2,$-=16),ae<1||ae>A||xe!==P||$<8||$>15||ge<0||ge>9||me<0||me>S)return et(B,c);$===8&&($=9);var Xe=new X;return B.state=Xe,Xe.strm=B,Xe.wrap=at,Xe.gzhead=null,Xe.w_bits=$,Xe.w_size=1<<Xe.w_bits,Xe.w_mask=Xe.w_size-1,Xe.hash_bits=ae+7,Xe.hash_size=1<<Xe.hash_bits,Xe.hash_mask=Xe.hash_size-1,Xe.hash_shift=~~((Xe.hash_bits+W-1)/W),Xe.window=new a.Buf8(Xe.w_size*2),Xe.head=new a.Buf16(Xe.hash_size),Xe.prev=new a.Buf16(Xe.w_size),Xe.lit_bufsize=1<<ae+6,Xe.pending_buf_size=Xe.lit_bufsize*4,Xe.pending_buf=new a.Buf8(Xe.pending_buf_size),Xe.d_buf=1*Xe.lit_bufsize,Xe.l_buf=(1+2)*Xe.lit_bufsize,Xe.level=ge,Xe.strategy=me,Xe.method=xe,Me(B)}function _e(B,ge){return ne(B,ge,P,w,L,O)}function H(B,ge){var xe,$,ae,me;if(!B||!B.state||ge>b||ge<0)return B?et(B,c):c;if($=B.state,!B.output||!B.input&&B.avail_in!==0||$.status===Re&&ge!==y)return et(B,B.avail_out===0?f:c);if($.strm=B,xe=$.last_flush,$.last_flush=ge,$.status===ee)if($.wrap===2)B.adler=0,rt($,31),rt($,139),rt($,8),$.gzhead?(rt($,($.gzhead.text?1:0)+($.gzhead.hcrc?2:0)+($.gzhead.extra?4:0)+($.gzhead.name?8:0)+($.gzhead.comment?16:0)),rt($,$.gzhead.time&255),rt($,$.gzhead.time>>8&255),rt($,$.gzhead.time>>16&255),rt($,$.gzhead.time>>24&255),rt($,$.level===9?2:$.strategy>=m||$.level<2?4:0),rt($,$.gzhead.os&255),$.gzhead.extra&&$.gzhead.extra.length&&(rt($,$.gzhead.extra.length&255),rt($,$.gzhead.extra.length>>8&255)),$.gzhead.hcrc&&(B.adler=p(B.adler,$.pending_buf,$.pending,0)),$.gzindex=0,$.status=re):(rt($,0),rt($,0),rt($,0),rt($,0),rt($,0),rt($,$.level===9?2:$.strategy>=m||$.level<2?4:0),rt($,Ze),$.status=be);else{var at=P+($.w_bits-8<<4)<<8,Xe=-1;$.strategy>=m||$.level<2?Xe=0:$.level<6?Xe=1:$.level===6?Xe=2:Xe=3,at|=Xe<<6,$.strstart!==0&&(at|=q),at+=31-at%31,$.status=be,xt($,at),$.strstart!==0&&(xt($,B.adler>>>16),xt($,B.adler&65535)),B.adler=1}if($.status===re)if($.gzhead.extra){for(ae=$.pending;$.gzindex<($.gzhead.extra.length&65535)&&!($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>ae&&(B.adler=p(B.adler,$.pending_buf,$.pending-ae,ae)),ht(B),ae=$.pending,$.pending===$.pending_buf_size));)rt($,$.gzhead.extra[$.gzindex]&255),$.gzindex++;$.gzhead.hcrc&&$.pending>ae&&(B.adler=p(B.adler,$.pending_buf,$.pending-ae,ae)),$.gzindex===$.gzhead.extra.length&&($.gzindex=0,$.status=pe)}else $.status=pe;if($.status===pe)if($.gzhead.name){ae=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>ae&&(B.adler=p(B.adler,$.pending_buf,$.pending-ae,ae)),ht(B),ae=$.pending,$.pending===$.pending_buf_size)){me=1;break}$.gzindex<$.gzhead.name.length?me=$.gzhead.name.charCodeAt($.gzindex++)&255:me=0,rt($,me)}while(me!==0);$.gzhead.hcrc&&$.pending>ae&&(B.adler=p(B.adler,$.pending_buf,$.pending-ae,ae)),me===0&&($.gzindex=0,$.status=Le)}else $.status=Le;if($.status===Le)if($.gzhead.comment){ae=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>ae&&(B.adler=p(B.adler,$.pending_buf,$.pending-ae,ae)),ht(B),ae=$.pending,$.pending===$.pending_buf_size)){me=1;break}$.gzindex<$.gzhead.comment.length?me=$.gzhead.comment.charCodeAt($.gzindex++)&255:me=0,rt($,me)}while(me!==0);$.gzhead.hcrc&&$.pending>ae&&(B.adler=p(B.adler,$.pending_buf,$.pending-ae,ae)),me===0&&($.status=Te)}else $.status=Te;if($.status===Te&&($.gzhead.hcrc?($.pending+2>$.pending_buf_size&&ht(B),$.pending+2<=$.pending_buf_size&&(rt($,B.adler&255),rt($,B.adler>>8&255),B.adler=0,$.status=be)):$.status=be),$.pending!==0){if(ht(B),B.avail_out===0)return $.last_flush=-1,T}else if(B.avail_in===0&&ft(ge)<=ft(xe)&&ge!==y)return et(B,f);if($.status===Re&&B.avail_in!==0)return et(B,f);if(B.avail_in!==0||$.lookahead!==0||ge!==g&&$.status!==Re){var Qe=$.strategy===m?ke($,ge):$.strategy===E?Ce($,ge):Je[$.level].func($,ge);if((Qe===$e||Qe===st)&&($.status=Re),Qe===Se||Qe===$e)return B.avail_out===0&&($.last_flush=-1),T;if(Qe===Ge&&(ge===d?s._tr_align($):ge!==b&&(s._tr_stored_block($,0,0,!1),ge===h&&(dt($.head),$.lookahead===0&&($.strstart=0,$.block_start=0,$.insert=0))),ht(B),B.avail_out===0))return $.last_flush=-1,T}return ge!==y?T:$.wrap<=0?_:($.wrap===2?(rt($,B.adler&255),rt($,B.adler>>8&255),rt($,B.adler>>16&255),rt($,B.adler>>24&255),rt($,B.total_in&255),rt($,B.total_in>>8&255),rt($,B.total_in>>16&255),rt($,B.total_in>>24&255)):(xt($,B.adler>>>16),xt($,B.adler&65535)),ht(B),$.wrap>0&&($.wrap=-$.wrap),$.pending!==0?T:_)}function De(B){var ge;return!B||!B.state?c:(ge=B.state.status,ge!==ee&&ge!==re&&ge!==pe&&ge!==Le&&ge!==Te&&ge!==be&&ge!==Re?et(B,c):(B.state=null,ge===be?et(B,u):T))}function ut(B,ge){var xe=ge.length,$,ae,me,at,Xe,Qe,bt,lr;if(!B||!B.state||($=B.state,at=$.wrap,at===2||at===1&&$.status!==ee||$.lookahead))return c;for(at===1&&(B.adler=o(B.adler,ge,xe,0)),$.wrap=0,xe>=$.w_size&&(at===0&&(dt($.head),$.strstart=0,$.block_start=0,$.insert=0),lr=new a.Buf8($.w_size),a.arraySet(lr,ge,xe-$.w_size,$.w_size,0),ge=lr,xe=$.w_size),Xe=B.avail_in,Qe=B.next_in,bt=B.input,B.avail_in=xe,B.next_in=0,B.input=ge,Lt($);$.lookahead>=W;){ae=$.strstart,me=$.lookahead-(W-1);do $.ins_h=($.ins_h<<$.hash_shift^$.window[ae+W-1])&$.hash_mask,$.prev[ae&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=ae,ae++;while(--me);$.strstart=ae,$.lookahead=W-1,Lt($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=W-1,$.match_available=0,B.next_in=Qe,B.input=bt,B.avail_in=Xe,$.wrap=at,T}t.deflateInit=_e,t.deflateInit2=ne,t.deflateReset=Me,t.deflateResetKeep=Ae,t.deflateSetHeader=Ke,t.deflate=H,t.deflateEnd=De,t.deflateSetDictionary=ut,t.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,n,t){function a(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}n.exports=a},{}],48:[function(r,n,t){var a=30,s=12;n.exports=function(p,x){var g,d,h,y,b,T,_,c,u,f,v,l,m,E,S,O,D,P,A,w,L,R,C,M,N;g=p.state,d=p.next_in,M=p.input,h=d+(p.avail_in-5),y=p.next_out,N=p.output,b=y-(x-p.avail_out),T=y+(p.avail_out-257),_=g.dmax,c=g.wsize,u=g.whave,f=g.wnext,v=g.window,l=g.hold,m=g.bits,E=g.lencode,S=g.distcode,O=(1<<g.lenbits)-1,D=(1<<g.distbits)-1;e:do{m<15&&(l+=M[d++]<<m,m+=8,l+=M[d++]<<m,m+=8),P=E[l&O];t:for(;;){if(A=P>>>24,l>>>=A,m-=A,A=P>>>16&255,A===0)N[y++]=P&65535;else if(A&16){w=P&65535,A&=15,A&&(m<A&&(l+=M[d++]<<m,m+=8),w+=l&(1<<A)-1,l>>>=A,m-=A),m<15&&(l+=M[d++]<<m,m+=8,l+=M[d++]<<m,m+=8),P=S[l&D];r:for(;;){if(A=P>>>24,l>>>=A,m-=A,A=P>>>16&255,A&16){if(L=P&65535,A&=15,m<A&&(l+=M[d++]<<m,m+=8,m<A&&(l+=M[d++]<<m,m+=8)),L+=l&(1<<A)-1,L>_){p.msg="invalid distance too far back",g.mode=a;break e}if(l>>>=A,m-=A,A=y-b,L>A){if(A=L-A,A>u&&g.sane){p.msg="invalid distance too far back",g.mode=a;break e}if(R=0,C=v,f===0){if(R+=c-A,A<w){w-=A;do N[y++]=v[R++];while(--A);R=y-L,C=N}}else if(f<A){if(R+=c+f-A,A-=f,A<w){w-=A;do N[y++]=v[R++];while(--A);if(R=0,f<w){A=f,w-=A;do N[y++]=v[R++];while(--A);R=y-L,C=N}}}else if(R+=f-A,A<w){w-=A;do N[y++]=v[R++];while(--A);R=y-L,C=N}for(;w>2;)N[y++]=C[R++],N[y++]=C[R++],N[y++]=C[R++],w-=3;w&&(N[y++]=C[R++],w>1&&(N[y++]=C[R++]))}else{R=y-L;do N[y++]=N[R++],N[y++]=N[R++],N[y++]=N[R++],w-=3;while(w>2);w&&(N[y++]=N[R++],w>1&&(N[y++]=N[R++]))}}else if((A&64)==0){P=S[(P&65535)+(l&(1<<A)-1)];continue r}else{p.msg="invalid distance code",g.mode=a;break e}break}}else if((A&64)==0){P=E[(P&65535)+(l&(1<<A)-1)];continue t}else if(A&32){g.mode=s;break e}else{p.msg="invalid literal/length code",g.mode=a;break e}break}}while(d<h&&y<T);w=m>>3,d-=w,m-=w<<3,l&=(1<<m)-1,p.next_in=d,p.next_out=y,p.avail_in=d<h?5+(h-d):5-(d-h),p.avail_out=y<T?257+(T-y):257-(y-T),g.hold=l,g.bits=m}},{}],49:[function(r,n,t){var a=r("../utils/common"),s=r("./adler32"),o=r("./crc32"),p=r("./inffast"),x=r("./inftrees"),g=0,d=1,h=2,y=4,b=5,T=6,_=0,c=1,u=2,f=-2,v=-3,l=-4,m=-5,E=8,S=1,O=2,D=3,P=4,A=5,w=6,L=7,R=8,C=9,M=10,N=11,U=12,K=13,V=14,W=15,G=16,Y=17,q=18,ee=19,re=20,pe=21,Le=22,Te=23,be=24,Re=25,Se=26,Ge=27,$e=28,st=29,Ze=30,et=31,ft=32,dt=852,ht=592,He=15,rt=He;function xt(ne){return(ne>>>24&255)+(ne>>>8&65280)+((ne&65280)<<8)+((ne&255)<<24)}function pt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ot(ne){var _e;return!ne||!ne.state?f:(_e=ne.state,ne.total_in=ne.total_out=_e.total=0,ne.msg="",_e.wrap&&(ne.adler=_e.wrap&1),_e.mode=S,_e.last=0,_e.havedict=0,_e.dmax=32768,_e.head=null,_e.hold=0,_e.bits=0,_e.lencode=_e.lendyn=new a.Buf32(dt),_e.distcode=_e.distdyn=new a.Buf32(ht),_e.sane=1,_e.back=-1,_)}function Lt(ne){var _e;return!ne||!ne.state?f:(_e=ne.state,_e.wsize=0,_e.whave=0,_e.wnext=0,ot(ne))}function wt(ne,_e){var H,De;return!ne||!ne.state||(De=ne.state,_e<0?(H=0,_e=-_e):(H=(_e>>4)+1,_e<48&&(_e&=15)),_e&&(_e<8||_e>15))?f:(De.window!==null&&De.wbits!==_e&&(De.window=null),De.wrap=H,De.wbits=_e,Lt(ne))}function Pt(ne,_e){var H,De;return ne?(De=new pt,ne.state=De,De.window=null,H=wt(ne,_e),H!==_&&(ne.state=null),H):f}function ve(ne){return Pt(ne,rt)}var Ce=!0,ke,Ue;function Je(ne){if(Ce){var _e;for(ke=new a.Buf32(512),Ue=new a.Buf32(32),_e=0;_e<144;)ne.lens[_e++]=8;for(;_e<256;)ne.lens[_e++]=9;for(;_e<280;)ne.lens[_e++]=7;for(;_e<288;)ne.lens[_e++]=8;for(x(d,ne.lens,0,288,ke,0,ne.work,{bits:9}),_e=0;_e<32;)ne.lens[_e++]=5;x(h,ne.lens,0,32,Ue,0,ne.work,{bits:5}),Ce=!1}ne.lencode=ke,ne.lenbits=9,ne.distcode=Ue,ne.distbits=5}function it(ne,_e,H,De){var ut,B=ne.state;return B.window===null&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new a.Buf8(B.wsize)),De>=B.wsize?(a.arraySet(B.window,_e,H-B.wsize,B.wsize,0),B.wnext=0,B.whave=B.wsize):(ut=B.wsize-B.wnext,ut>De&&(ut=De),a.arraySet(B.window,_e,H-De,ut,B.wnext),De-=ut,De?(a.arraySet(B.window,_e,H-De,De,0),B.wnext=De,B.whave=B.wsize):(B.wnext+=ut,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=ut))),0}function X(ne,_e){var H,De,ut,B,ge,xe,$,ae,me,at,Xe,Qe,bt,lr,Nt=0,St,Wt,Zt,qt,_n,xn,Ft,ir,Gt=new a.Buf8(4),Sr,yr,Zn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ne||!ne.state||!ne.output||!ne.input&&ne.avail_in!==0)return f;H=ne.state,H.mode===U&&(H.mode=K),ge=ne.next_out,ut=ne.output,$=ne.avail_out,B=ne.next_in,De=ne.input,xe=ne.avail_in,ae=H.hold,me=H.bits,at=xe,Xe=$,ir=_;e:for(;;)switch(H.mode){case S:if(H.wrap===0){H.mode=K;break}for(;me<16;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}if(H.wrap&2&&ae===35615){H.check=0,Gt[0]=ae&255,Gt[1]=ae>>>8&255,H.check=o(H.check,Gt,2,0),ae=0,me=0,H.mode=O;break}if(H.flags=0,H.head&&(H.head.done=!1),!(H.wrap&1)||(((ae&255)<<8)+(ae>>8))%31){ne.msg="incorrect header check",H.mode=Ze;break}if((ae&15)!==E){ne.msg="unknown compression method",H.mode=Ze;break}if(ae>>>=4,me-=4,Ft=(ae&15)+8,H.wbits===0)H.wbits=Ft;else if(Ft>H.wbits){ne.msg="invalid window size",H.mode=Ze;break}H.dmax=1<<Ft,ne.adler=H.check=1,H.mode=ae&512?M:U,ae=0,me=0;break;case O:for(;me<16;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}if(H.flags=ae,(H.flags&255)!==E){ne.msg="unknown compression method",H.mode=Ze;break}if(H.flags&57344){ne.msg="unknown header flags set",H.mode=Ze;break}H.head&&(H.head.text=ae>>8&1),H.flags&512&&(Gt[0]=ae&255,Gt[1]=ae>>>8&255,H.check=o(H.check,Gt,2,0)),ae=0,me=0,H.mode=D;case D:for(;me<32;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}H.head&&(H.head.time=ae),H.flags&512&&(Gt[0]=ae&255,Gt[1]=ae>>>8&255,Gt[2]=ae>>>16&255,Gt[3]=ae>>>24&255,H.check=o(H.check,Gt,4,0)),ae=0,me=0,H.mode=P;case P:for(;me<16;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}H.head&&(H.head.xflags=ae&255,H.head.os=ae>>8),H.flags&512&&(Gt[0]=ae&255,Gt[1]=ae>>>8&255,H.check=o(H.check,Gt,2,0)),ae=0,me=0,H.mode=A;case A:if(H.flags&1024){for(;me<16;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}H.length=ae,H.head&&(H.head.extra_len=ae),H.flags&512&&(Gt[0]=ae&255,Gt[1]=ae>>>8&255,H.check=o(H.check,Gt,2,0)),ae=0,me=0}else H.head&&(H.head.extra=null);H.mode=w;case w:if(H.flags&1024&&(Qe=H.length,Qe>xe&&(Qe=xe),Qe&&(H.head&&(Ft=H.head.extra_len-H.length,H.head.extra||(H.head.extra=new Array(H.head.extra_len)),a.arraySet(H.head.extra,De,B,Qe,Ft)),H.flags&512&&(H.check=o(H.check,De,Qe,B)),xe-=Qe,B+=Qe,H.length-=Qe),H.length))break e;H.length=0,H.mode=L;case L:if(H.flags&2048){if(xe===0)break e;Qe=0;do Ft=De[B+Qe++],H.head&&Ft&&H.length<65536&&(H.head.name+=String.fromCharCode(Ft));while(Ft&&Qe<xe);if(H.flags&512&&(H.check=o(H.check,De,Qe,B)),xe-=Qe,B+=Qe,Ft)break e}else H.head&&(H.head.name=null);H.length=0,H.mode=R;case R:if(H.flags&4096){if(xe===0)break e;Qe=0;do Ft=De[B+Qe++],H.head&&Ft&&H.length<65536&&(H.head.comment+=String.fromCharCode(Ft));while(Ft&&Qe<xe);if(H.flags&512&&(H.check=o(H.check,De,Qe,B)),xe-=Qe,B+=Qe,Ft)break e}else H.head&&(H.head.comment=null);H.mode=C;case C:if(H.flags&512){for(;me<16;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}if(ae!==(H.check&65535)){ne.msg="header crc mismatch",H.mode=Ze;break}ae=0,me=0}H.head&&(H.head.hcrc=H.flags>>9&1,H.head.done=!0),ne.adler=H.check=0,H.mode=U;break;case M:for(;me<32;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}ne.adler=H.check=xt(ae),ae=0,me=0,H.mode=N;case N:if(H.havedict===0)return ne.next_out=ge,ne.avail_out=$,ne.next_in=B,ne.avail_in=xe,H.hold=ae,H.bits=me,u;ne.adler=H.check=1,H.mode=U;case U:if(_e===b||_e===T)break e;case K:if(H.last){ae>>>=me&7,me-=me&7,H.mode=Ge;break}for(;me<3;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}switch(H.last=ae&1,ae>>>=1,me-=1,ae&3){case 0:H.mode=V;break;case 1:if(Je(H),H.mode=re,_e===T){ae>>>=2,me-=2;break e}break;case 2:H.mode=Y;break;case 3:ne.msg="invalid block type",H.mode=Ze}ae>>>=2,me-=2;break;case V:for(ae>>>=me&7,me-=me&7;me<32;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}if((ae&65535)!=(ae>>>16^65535)){ne.msg="invalid stored block lengths",H.mode=Ze;break}if(H.length=ae&65535,ae=0,me=0,H.mode=W,_e===T)break e;case W:H.mode=G;case G:if(Qe=H.length,Qe){if(Qe>xe&&(Qe=xe),Qe>$&&(Qe=$),Qe===0)break e;a.arraySet(ut,De,B,Qe,ge),xe-=Qe,B+=Qe,$-=Qe,ge+=Qe,H.length-=Qe;break}H.mode=U;break;case Y:for(;me<14;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}if(H.nlen=(ae&31)+257,ae>>>=5,me-=5,H.ndist=(ae&31)+1,ae>>>=5,me-=5,H.ncode=(ae&15)+4,ae>>>=4,me-=4,H.nlen>286||H.ndist>30){ne.msg="too many length or distance symbols",H.mode=Ze;break}H.have=0,H.mode=q;case q:for(;H.have<H.ncode;){for(;me<3;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}H.lens[Zn[H.have++]]=ae&7,ae>>>=3,me-=3}for(;H.have<19;)H.lens[Zn[H.have++]]=0;if(H.lencode=H.lendyn,H.lenbits=7,Sr={bits:H.lenbits},ir=x(g,H.lens,0,19,H.lencode,0,H.work,Sr),H.lenbits=Sr.bits,ir){ne.msg="invalid code lengths set",H.mode=Ze;break}H.have=0,H.mode=ee;case ee:for(;H.have<H.nlen+H.ndist;){for(;Nt=H.lencode[ae&(1<<H.lenbits)-1],St=Nt>>>24,Wt=Nt>>>16&255,Zt=Nt&65535,!(St<=me);){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}if(Zt<16)ae>>>=St,me-=St,H.lens[H.have++]=Zt;else{if(Zt===16){for(yr=St+2;me<yr;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}if(ae>>>=St,me-=St,H.have===0){ne.msg="invalid bit length repeat",H.mode=Ze;break}Ft=H.lens[H.have-1],Qe=3+(ae&3),ae>>>=2,me-=2}else if(Zt===17){for(yr=St+3;me<yr;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}ae>>>=St,me-=St,Ft=0,Qe=3+(ae&7),ae>>>=3,me-=3}else{for(yr=St+7;me<yr;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}ae>>>=St,me-=St,Ft=0,Qe=11+(ae&127),ae>>>=7,me-=7}if(H.have+Qe>H.nlen+H.ndist){ne.msg="invalid bit length repeat",H.mode=Ze;break}for(;Qe--;)H.lens[H.have++]=Ft}}if(H.mode===Ze)break;if(H.lens[256]===0){ne.msg="invalid code -- missing end-of-block",H.mode=Ze;break}if(H.lenbits=9,Sr={bits:H.lenbits},ir=x(d,H.lens,0,H.nlen,H.lencode,0,H.work,Sr),H.lenbits=Sr.bits,ir){ne.msg="invalid literal/lengths set",H.mode=Ze;break}if(H.distbits=6,H.distcode=H.distdyn,Sr={bits:H.distbits},ir=x(h,H.lens,H.nlen,H.ndist,H.distcode,0,H.work,Sr),H.distbits=Sr.bits,ir){ne.msg="invalid distances set",H.mode=Ze;break}if(H.mode=re,_e===T)break e;case re:H.mode=pe;case pe:if(xe>=6&&$>=258){ne.next_out=ge,ne.avail_out=$,ne.next_in=B,ne.avail_in=xe,H.hold=ae,H.bits=me,p(ne,Xe),ge=ne.next_out,ut=ne.output,$=ne.avail_out,B=ne.next_in,De=ne.input,xe=ne.avail_in,ae=H.hold,me=H.bits,H.mode===U&&(H.back=-1);break}for(H.back=0;Nt=H.lencode[ae&(1<<H.lenbits)-1],St=Nt>>>24,Wt=Nt>>>16&255,Zt=Nt&65535,!(St<=me);){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}if(Wt&&(Wt&240)==0){for(qt=St,_n=Wt,xn=Zt;Nt=H.lencode[xn+((ae&(1<<qt+_n)-1)>>qt)],St=Nt>>>24,Wt=Nt>>>16&255,Zt=Nt&65535,!(qt+St<=me);){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}ae>>>=qt,me-=qt,H.back+=qt}if(ae>>>=St,me-=St,H.back+=St,H.length=Zt,Wt===0){H.mode=Se;break}if(Wt&32){H.back=-1,H.mode=U;break}if(Wt&64){ne.msg="invalid literal/length code",H.mode=Ze;break}H.extra=Wt&15,H.mode=Le;case Le:if(H.extra){for(yr=H.extra;me<yr;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}H.length+=ae&(1<<H.extra)-1,ae>>>=H.extra,me-=H.extra,H.back+=H.extra}H.was=H.length,H.mode=Te;case Te:for(;Nt=H.distcode[ae&(1<<H.distbits)-1],St=Nt>>>24,Wt=Nt>>>16&255,Zt=Nt&65535,!(St<=me);){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}if((Wt&240)==0){for(qt=St,_n=Wt,xn=Zt;Nt=H.distcode[xn+((ae&(1<<qt+_n)-1)>>qt)],St=Nt>>>24,Wt=Nt>>>16&255,Zt=Nt&65535,!(qt+St<=me);){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}ae>>>=qt,me-=qt,H.back+=qt}if(ae>>>=St,me-=St,H.back+=St,Wt&64){ne.msg="invalid distance code",H.mode=Ze;break}H.offset=Zt,H.extra=Wt&15,H.mode=be;case be:if(H.extra){for(yr=H.extra;me<yr;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}H.offset+=ae&(1<<H.extra)-1,ae>>>=H.extra,me-=H.extra,H.back+=H.extra}if(H.offset>H.dmax){ne.msg="invalid distance too far back",H.mode=Ze;break}H.mode=Re;case Re:if($===0)break e;if(Qe=Xe-$,H.offset>Qe){if(Qe=H.offset-Qe,Qe>H.whave&&H.sane){ne.msg="invalid distance too far back",H.mode=Ze;break}Qe>H.wnext?(Qe-=H.wnext,bt=H.wsize-Qe):bt=H.wnext-Qe,Qe>H.length&&(Qe=H.length),lr=H.window}else lr=ut,bt=ge-H.offset,Qe=H.length;Qe>$&&(Qe=$),$-=Qe,H.length-=Qe;do ut[ge++]=lr[bt++];while(--Qe);H.length===0&&(H.mode=pe);break;case Se:if($===0)break e;ut[ge++]=H.length,$--,H.mode=pe;break;case Ge:if(H.wrap){for(;me<32;){if(xe===0)break e;xe--,ae|=De[B++]<<me,me+=8}if(Xe-=$,ne.total_out+=Xe,H.total+=Xe,Xe&&(ne.adler=H.check=H.flags?o(H.check,ut,Xe,ge-Xe):s(H.check,ut,Xe,ge-Xe)),Xe=$,(H.flags?ae:xt(ae))!==H.check){ne.msg="incorrect data check",H.mode=Ze;break}ae=0,me=0}H.mode=$e;case $e:if(H.wrap&&H.flags){for(;me<32;){if(xe===0)break e;xe--,ae+=De[B++]<<me,me+=8}if(ae!==(H.total&4294967295)){ne.msg="incorrect length check",H.mode=Ze;break}ae=0,me=0}H.mode=st;case st:ir=c;break e;case Ze:ir=v;break e;case et:return l;case ft:default:return f}return ne.next_out=ge,ne.avail_out=$,ne.next_in=B,ne.avail_in=xe,H.hold=ae,H.bits=me,(H.wsize||Xe!==ne.avail_out&&H.mode<Ze&&(H.mode<Ge||_e!==y))&&it(ne,ne.output,ne.next_out,Xe-ne.avail_out),at-=ne.avail_in,Xe-=ne.avail_out,ne.total_in+=at,ne.total_out+=Xe,H.total+=Xe,H.wrap&&Xe&&(ne.adler=H.check=H.flags?o(H.check,ut,Xe,ne.next_out-Xe):s(H.check,ut,Xe,ne.next_out-Xe)),ne.data_type=H.bits+(H.last?64:0)+(H.mode===U?128:0)+(H.mode===re||H.mode===W?256:0),(at===0&&Xe===0||_e===y)&&ir===_&&(ir=m),ir}function Ae(ne){if(!ne||!ne.state)return f;var _e=ne.state;return _e.window&&(_e.window=null),ne.state=null,_}function Me(ne,_e){var H;return!ne||!ne.state||(H=ne.state,(H.wrap&2)==0)?f:(H.head=_e,_e.done=!1,_)}function Ke(ne,_e){var H=_e.length,De,ut,B;return!ne||!ne.state||(De=ne.state,De.wrap!==0&&De.mode!==N)?f:De.mode===N&&(ut=1,ut=s(ut,_e,H,0),ut!==De.check)?v:(B=it(ne,_e,H,H),B?(De.mode=et,l):(De.havedict=1,_))}t.inflateReset=Lt,t.inflateReset2=wt,t.inflateResetKeep=ot,t.inflateInit=ve,t.inflateInit2=Pt,t.inflate=X,t.inflateEnd=Ae,t.inflateGetHeader=Me,t.inflateSetDictionary=Ke,t.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,n,t){var a=r("../utils/common"),s=15,o=852,p=592,x=0,g=1,d=2,h=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],y=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],b=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],T=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(c,u,f,v,l,m,E,S){var O=S.bits,D=0,P=0,A=0,w=0,L=0,R=0,C=0,M=0,N=0,U=0,K,V,W,G,Y,q=null,ee=0,re,pe=new a.Buf16(s+1),Le=new a.Buf16(s+1),Te=null,be=0,Re,Se,Ge;for(D=0;D<=s;D++)pe[D]=0;for(P=0;P<v;P++)pe[u[f+P]]++;for(L=O,w=s;w>=1&&pe[w]===0;w--);if(L>w&&(L=w),w===0)return l[m++]=1<<24|64<<16|0,l[m++]=1<<24|64<<16|0,S.bits=1,0;for(A=1;A<w&&pe[A]===0;A++);for(L<A&&(L=A),M=1,D=1;D<=s;D++)if(M<<=1,M-=pe[D],M<0)return-1;if(M>0&&(c===x||w!==1))return-1;for(Le[1]=0,D=1;D<s;D++)Le[D+1]=Le[D]+pe[D];for(P=0;P<v;P++)u[f+P]!==0&&(E[Le[u[f+P]]++]=P);if(c===x?(q=Te=E,re=19):c===g?(q=h,ee-=257,Te=y,be-=257,re=256):(q=b,Te=T,re=-1),U=0,P=0,D=A,Y=m,R=L,C=0,W=-1,N=1<<L,G=N-1,c===g&&N>o||c===d&&N>p)return 1;for(;;){Re=D-C,E[P]<re?(Se=0,Ge=E[P]):E[P]>re?(Se=Te[be+E[P]],Ge=q[ee+E[P]]):(Se=32+64,Ge=0),K=1<<D-C,V=1<<R,A=V;do V-=K,l[Y+(U>>C)+V]=Re<<24|Se<<16|Ge|0;while(V!==0);for(K=1<<D-1;U&K;)K>>=1;if(K!==0?(U&=K-1,U+=K):U=0,P++,--pe[D]==0){if(D===w)break;D=u[f+E[P]]}if(D>L&&(U&G)!==W){for(C===0&&(C=L),Y+=A,R=D-C,M=1<<R;R+C<w&&(M-=pe[R+C],!(M<=0));)R++,M<<=1;if(N+=1<<R,c===g&&N>o||c===d&&N>p)return 1;W=U&G,l[W]=L<<24|R<<16|Y-m|0}}return U!==0&&(l[Y+U]=D-C<<24|64<<16|0),S.bits=L,0}},{"../utils/common":41}],51:[function(r,n,t){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,n,t){var a=r("../utils/common"),s=4,o=0,p=1,x=2;function g(X){for(var Ae=X.length;--Ae>=0;)X[Ae]=0}var d=0,h=1,y=2,b=3,T=258,_=29,c=256,u=c+1+_,f=30,v=19,l=2*u+1,m=15,E=16,S=7,O=256,D=16,P=17,A=18,w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],M=512,N=new Array((u+2)*2);g(N);var U=new Array(f*2);g(U);var K=new Array(M);g(K);var V=new Array(T-b+1);g(V);var W=new Array(_);g(W);var G=new Array(f);g(G);function Y(X,Ae,Me,Ke,ne){this.static_tree=X,this.extra_bits=Ae,this.extra_base=Me,this.elems=Ke,this.max_length=ne,this.has_stree=X&&X.length}var q,ee,re;function pe(X,Ae){this.dyn_tree=X,this.max_code=0,this.stat_desc=Ae}function Le(X){return X<256?K[X]:K[256+(X>>>7)]}function Te(X,Ae){X.pending_buf[X.pending++]=Ae&255,X.pending_buf[X.pending++]=Ae>>>8&255}function be(X,Ae,Me){X.bi_valid>E-Me?(X.bi_buf|=Ae<<X.bi_valid&65535,Te(X,X.bi_buf),X.bi_buf=Ae>>E-X.bi_valid,X.bi_valid+=Me-E):(X.bi_buf|=Ae<<X.bi_valid&65535,X.bi_valid+=Me)}function Re(X,Ae,Me){be(X,Me[Ae*2],Me[Ae*2+1])}function Se(X,Ae){var Me=0;do Me|=X&1,X>>>=1,Me<<=1;while(--Ae>0);return Me>>>1}function Ge(X){X.bi_valid===16?(Te(X,X.bi_buf),X.bi_buf=0,X.bi_valid=0):X.bi_valid>=8&&(X.pending_buf[X.pending++]=X.bi_buf&255,X.bi_buf>>=8,X.bi_valid-=8)}function $e(X,Ae){var Me=Ae.dyn_tree,Ke=Ae.max_code,ne=Ae.stat_desc.static_tree,_e=Ae.stat_desc.has_stree,H=Ae.stat_desc.extra_bits,De=Ae.stat_desc.extra_base,ut=Ae.stat_desc.max_length,B,ge,xe,$,ae,me,at=0;for($=0;$<=m;$++)X.bl_count[$]=0;for(Me[X.heap[X.heap_max]*2+1]=0,B=X.heap_max+1;B<l;B++)ge=X.heap[B],$=Me[Me[ge*2+1]*2+1]+1,$>ut&&($=ut,at++),Me[ge*2+1]=$,!(ge>Ke)&&(X.bl_count[$]++,ae=0,ge>=De&&(ae=H[ge-De]),me=Me[ge*2],X.opt_len+=me*($+ae),_e&&(X.static_len+=me*(ne[ge*2+1]+ae)));if(at!==0){do{for($=ut-1;X.bl_count[$]===0;)$--;X.bl_count[$]--,X.bl_count[$+1]+=2,X.bl_count[ut]--,at-=2}while(at>0);for($=ut;$!==0;$--)for(ge=X.bl_count[$];ge!==0;)xe=X.heap[--B],!(xe>Ke)&&(Me[xe*2+1]!==$&&(X.opt_len+=($-Me[xe*2+1])*Me[xe*2],Me[xe*2+1]=$),ge--)}}function st(X,Ae,Me){var Ke=new Array(m+1),ne=0,_e,H;for(_e=1;_e<=m;_e++)Ke[_e]=ne=ne+Me[_e-1]<<1;for(H=0;H<=Ae;H++){var De=X[H*2+1];De!==0&&(X[H*2]=Se(Ke[De]++,De))}}function Ze(){var X,Ae,Me,Ke,ne,_e=new Array(m+1);for(Me=0,Ke=0;Ke<_-1;Ke++)for(W[Ke]=Me,X=0;X<1<<w[Ke];X++)V[Me++]=Ke;for(V[Me-1]=Ke,ne=0,Ke=0;Ke<16;Ke++)for(G[Ke]=ne,X=0;X<1<<L[Ke];X++)K[ne++]=Ke;for(ne>>=7;Ke<f;Ke++)for(G[Ke]=ne<<7,X=0;X<1<<L[Ke]-7;X++)K[256+ne++]=Ke;for(Ae=0;Ae<=m;Ae++)_e[Ae]=0;for(X=0;X<=143;)N[X*2+1]=8,X++,_e[8]++;for(;X<=255;)N[X*2+1]=9,X++,_e[9]++;for(;X<=279;)N[X*2+1]=7,X++,_e[7]++;for(;X<=287;)N[X*2+1]=8,X++,_e[8]++;for(st(N,u+1,_e),X=0;X<f;X++)U[X*2+1]=5,U[X*2]=Se(X,5);q=new Y(N,w,c+1,u,m),ee=new Y(U,L,0,f,m),re=new Y(new Array(0),R,0,v,S)}function et(X){var Ae;for(Ae=0;Ae<u;Ae++)X.dyn_ltree[Ae*2]=0;for(Ae=0;Ae<f;Ae++)X.dyn_dtree[Ae*2]=0;for(Ae=0;Ae<v;Ae++)X.bl_tree[Ae*2]=0;X.dyn_ltree[O*2]=1,X.opt_len=X.static_len=0,X.last_lit=X.matches=0}function ft(X){X.bi_valid>8?Te(X,X.bi_buf):X.bi_valid>0&&(X.pending_buf[X.pending++]=X.bi_buf),X.bi_buf=0,X.bi_valid=0}function dt(X,Ae,Me,Ke){ft(X),Ke&&(Te(X,Me),Te(X,~Me)),a.arraySet(X.pending_buf,X.window,Ae,Me,X.pending),X.pending+=Me}function ht(X,Ae,Me,Ke){var ne=Ae*2,_e=Me*2;return X[ne]<X[_e]||X[ne]===X[_e]&&Ke[Ae]<=Ke[Me]}function He(X,Ae,Me){for(var Ke=X.heap[Me],ne=Me<<1;ne<=X.heap_len&&(ne<X.heap_len&&ht(Ae,X.heap[ne+1],X.heap[ne],X.depth)&&ne++,!ht(Ae,Ke,X.heap[ne],X.depth));)X.heap[Me]=X.heap[ne],Me=ne,ne<<=1;X.heap[Me]=Ke}function rt(X,Ae,Me){var Ke,ne,_e=0,H,De;if(X.last_lit!==0)do Ke=X.pending_buf[X.d_buf+_e*2]<<8|X.pending_buf[X.d_buf+_e*2+1],ne=X.pending_buf[X.l_buf+_e],_e++,Ke===0?Re(X,ne,Ae):(H=V[ne],Re(X,H+c+1,Ae),De=w[H],De!==0&&(ne-=W[H],be(X,ne,De)),Ke--,H=Le(Ke),Re(X,H,Me),De=L[H],De!==0&&(Ke-=G[H],be(X,Ke,De)));while(_e<X.last_lit);Re(X,O,Ae)}function xt(X,Ae){var Me=Ae.dyn_tree,Ke=Ae.stat_desc.static_tree,ne=Ae.stat_desc.has_stree,_e=Ae.stat_desc.elems,H,De,ut=-1,B;for(X.heap_len=0,X.heap_max=l,H=0;H<_e;H++)Me[H*2]!==0?(X.heap[++X.heap_len]=ut=H,X.depth[H]=0):Me[H*2+1]=0;for(;X.heap_len<2;)B=X.heap[++X.heap_len]=ut<2?++ut:0,Me[B*2]=1,X.depth[B]=0,X.opt_len--,ne&&(X.static_len-=Ke[B*2+1]);for(Ae.max_code=ut,H=X.heap_len>>1;H>=1;H--)He(X,Me,H);B=_e;do H=X.heap[1],X.heap[1]=X.heap[X.heap_len--],He(X,Me,1),De=X.heap[1],X.heap[--X.heap_max]=H,X.heap[--X.heap_max]=De,Me[B*2]=Me[H*2]+Me[De*2],X.depth[B]=(X.depth[H]>=X.depth[De]?X.depth[H]:X.depth[De])+1,Me[H*2+1]=Me[De*2+1]=B,X.heap[1]=B++,He(X,Me,1);while(X.heap_len>=2);X.heap[--X.heap_max]=X.heap[1],$e(X,Ae),st(Me,ut,X.bl_count)}function pt(X,Ae,Me){var Ke,ne=-1,_e,H=Ae[0*2+1],De=0,ut=7,B=4;for(H===0&&(ut=138,B=3),Ae[(Me+1)*2+1]=65535,Ke=0;Ke<=Me;Ke++)_e=H,H=Ae[(Ke+1)*2+1],!(++De<ut&&_e===H)&&(De<B?X.bl_tree[_e*2]+=De:_e!==0?(_e!==ne&&X.bl_tree[_e*2]++,X.bl_tree[D*2]++):De<=10?X.bl_tree[P*2]++:X.bl_tree[A*2]++,De=0,ne=_e,H===0?(ut=138,B=3):_e===H?(ut=6,B=3):(ut=7,B=4))}function ot(X,Ae,Me){var Ke,ne=-1,_e,H=Ae[0*2+1],De=0,ut=7,B=4;for(H===0&&(ut=138,B=3),Ke=0;Ke<=Me;Ke++)if(_e=H,H=Ae[(Ke+1)*2+1],!(++De<ut&&_e===H)){if(De<B)do Re(X,_e,X.bl_tree);while(--De!=0);else _e!==0?(_e!==ne&&(Re(X,_e,X.bl_tree),De--),Re(X,D,X.bl_tree),be(X,De-3,2)):De<=10?(Re(X,P,X.bl_tree),be(X,De-3,3)):(Re(X,A,X.bl_tree),be(X,De-11,7));De=0,ne=_e,H===0?(ut=138,B=3):_e===H?(ut=6,B=3):(ut=7,B=4)}}function Lt(X){var Ae;for(pt(X,X.dyn_ltree,X.l_desc.max_code),pt(X,X.dyn_dtree,X.d_desc.max_code),xt(X,X.bl_desc),Ae=v-1;Ae>=3&&X.bl_tree[C[Ae]*2+1]===0;Ae--);return X.opt_len+=3*(Ae+1)+5+5+4,Ae}function wt(X,Ae,Me,Ke){var ne;for(be(X,Ae-257,5),be(X,Me-1,5),be(X,Ke-4,4),ne=0;ne<Ke;ne++)be(X,X.bl_tree[C[ne]*2+1],3);ot(X,X.dyn_ltree,Ae-1),ot(X,X.dyn_dtree,Me-1)}function Pt(X){var Ae=4093624447,Me;for(Me=0;Me<=31;Me++,Ae>>>=1)if(Ae&1&&X.dyn_ltree[Me*2]!==0)return o;if(X.dyn_ltree[9*2]!==0||X.dyn_ltree[10*2]!==0||X.dyn_ltree[13*2]!==0)return p;for(Me=32;Me<c;Me++)if(X.dyn_ltree[Me*2]!==0)return p;return o}var ve=!1;function Ce(X){ve||(Ze(),ve=!0),X.l_desc=new pe(X.dyn_ltree,q),X.d_desc=new pe(X.dyn_dtree,ee),X.bl_desc=new pe(X.bl_tree,re),X.bi_buf=0,X.bi_valid=0,et(X)}function ke(X,Ae,Me,Ke){be(X,(d<<1)+(Ke?1:0),3),dt(X,Ae,Me,!0)}function Ue(X){be(X,h<<1,3),Re(X,O,N),Ge(X)}function Je(X,Ae,Me,Ke){var ne,_e,H=0;X.level>0?(X.strm.data_type===x&&(X.strm.data_type=Pt(X)),xt(X,X.l_desc),xt(X,X.d_desc),H=Lt(X),ne=X.opt_len+3+7>>>3,_e=X.static_len+3+7>>>3,_e<=ne&&(ne=_e)):ne=_e=Me+5,Me+4<=ne&&Ae!==-1?ke(X,Ae,Me,Ke):X.strategy===s||_e===ne?(be(X,(h<<1)+(Ke?1:0),3),rt(X,N,U)):(be(X,(y<<1)+(Ke?1:0),3),wt(X,X.l_desc.max_code+1,X.d_desc.max_code+1,H+1),rt(X,X.dyn_ltree,X.dyn_dtree)),et(X),Ke&&ft(X)}function it(X,Ae,Me){return X.pending_buf[X.d_buf+X.last_lit*2]=Ae>>>8&255,X.pending_buf[X.d_buf+X.last_lit*2+1]=Ae&255,X.pending_buf[X.l_buf+X.last_lit]=Me&255,X.last_lit++,Ae===0?X.dyn_ltree[Me*2]++:(X.matches++,Ae--,X.dyn_ltree[(V[Me]+c+1)*2]++,X.dyn_dtree[Le(Ae)*2]++),X.last_lit===X.lit_bufsize-1}t._tr_init=Ce,t._tr_stored_block=ke,t._tr_flush_block=Je,t._tr_tally=it,t._tr_align=Ue},{"../utils/common":41}],53:[function(r,n,t){function a(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}n.exports=a},{}],54:[function(r,n,t){n.exports=typeof setImmediate=="function"?setImmediate:function(){var s=[].slice.apply(arguments);s.splice(1,0,0),setTimeout.apply(null,s)}},{}]},{},[10])(10)})})(Sh);Object.defineProperty(ko,"__esModule",{value:!0});ko.default=void 0;var ra=nt,RS=No(hi),Th=No(Zi),CS=No(gn),IS=No(Sh.exports);function No(i){return i&&i.__esModule?i:{default:i}}class MS{constructor(){this.zip=void 0,this.urlCache={},this.checkRequirements()}checkRequirements(){try{this.zip=new IS.default}catch(e){throw new Error("JSZip lib not loaded")}}open(e,r){return this.zip.loadAsync(e,{base64:r})}openUrl(e,r){return(0,RS.default)(e,"binary").then(function(n){return this.zip.loadAsync(n,{base64:r})}.bind(this))}request(e,r){var n=new ra.defer,t,a=new CS.default(e);return r||(r=a.extension),r=="blob"?t=this.getBlob(e):t=this.getText(e),t?t.then(function(s){let o=this.handleResponse(s,r);n.resolve(o)}.bind(this)):n.reject({message:"File not found in the epub: "+e,stack:new Error().stack}),n.promise}handleResponse(e,r){var n;return r=="json"?n=JSON.parse(e):(0,ra.isXml)(r)?n=(0,ra.parse)(e,"text/xml"):r=="xhtml"?n=(0,ra.parse)(e,"application/xhtml+xml"):r=="html"||r=="htm"?n=(0,ra.parse)(e,"text/html"):n=e,n}getBlob(e,r){var n=window.decodeURIComponent(e.substr(1)),t=this.zip.file(n);if(t)return r=r||Th.default.lookup(t.name),t.async("uint8array").then(function(a){return new Blob([a],{type:r})})}getText(e,r){var n=window.decodeURIComponent(e.substr(1)),t=this.zip.file(n);if(t)return t.async("string").then(function(a){return a})}getBase64(e,r){var n=window.decodeURIComponent(e.substr(1)),t=this.zip.file(n);if(t)return r=r||Th.default.lookup(t.name),t.async("base64").then(function(a){return"data:"+r+";base64,"+a})}createUrl(e,r){var n=new ra.defer,t=window.URL||window.webkitURL||window.mozURL,a,s,o=r&&r.base64;return e in this.urlCache?(n.resolve(this.urlCache[e]),n.promise):(o?(s=this.getBase64(e),s&&s.then(function(p){this.urlCache[e]=p,n.resolve(p)}.bind(this))):(s=this.getBlob(e),s&&s.then(function(p){a=t.createObjectURL(p),this.urlCache[e]=a,n.resolve(a)}.bind(this))),s||n.reject({message:"File not found in the epub: "+e,stack:new Error().stack}),n.promise)}revokeUrl(e){var r=window.URL||window.webkitURL||window.mozURL,n=this.urlCache[e];n&&r.revokeObjectURL(n)}destroy(){var e=window.URL||window.webkitURL||window.mozURL;for(let r in this.urlCache)e.revokeObjectURL(r);this.zip=void 0,this.urlCache={}}}var kS=MS;ko.default=kS;var Bo={},Oh={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(i,e){(function(r){i.exports=r()})(function(){return function r(n,t,a){function s(x,g){if(!t[x]){if(!n[x]){var d=typeof Mn=="function"&&Mn;if(!g&&d)return d(x,!0);if(o)return o(x,!0);var h=new Error("Cannot find module '"+x+"'");throw h.code="MODULE_NOT_FOUND",h}var y=t[x]={exports:{}};n[x][0].call(y.exports,function(b){var T=n[x][1][b];return s(T||b)},y,y.exports,r,n,t,a)}return t[x].exports}for(var o=typeof Mn=="function"&&Mn,p=0;p<a.length;p++)s(a[p]);return s}({1:[function(r,n,t){(function(a){var s=a.MutationObserver||a.WebKitMutationObserver,o;if(s){var p=0,x=new s(b),g=a.document.createTextNode("");x.observe(g,{characterData:!0}),o=function(){g.data=p=++p%2}}else if(!a.setImmediate&&typeof a.MessageChannel!="undefined"){var d=new a.MessageChannel;d.port1.onmessage=b,o=function(){d.port2.postMessage(0)}}else"document"in a&&"onreadystatechange"in a.document.createElement("script")?o=function(){var _=a.document.createElement("script");_.onreadystatechange=function(){b(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},a.document.documentElement.appendChild(_)}:o=function(){setTimeout(b,0)};var h,y=[];function b(){h=!0;for(var _,c,u=y.length;u;){for(c=y,y=[],_=-1;++_<u;)c[_]();u=y.length}h=!1}n.exports=T;function T(_){y.push(_)===1&&!h&&o()}}).call(this,typeof Er!="undefined"?Er:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],2:[function(r,n,t){var a=r(1);function s(){}var o={},p=["REJECTED"],x=["FULFILLED"],g=["PENDING"];n.exports=d;function d(l){if(typeof l!="function")throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,l!==s&&T(this,l)}d.prototype.catch=function(l){return this.then(null,l)},d.prototype.then=function(l,m){if(typeof l!="function"&&this.state===x||typeof m!="function"&&this.state===p)return this;var E=new this.constructor(s);if(this.state!==g){var S=this.state===x?l:m;y(E,S,this.outcome)}else this.queue.push(new h(E,l,m));return E};function h(l,m,E){this.promise=l,typeof m=="function"&&(this.onFulfilled=m,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}h.prototype.callFulfilled=function(l){o.resolve(this.promise,l)},h.prototype.otherCallFulfilled=function(l){y(this.promise,this.onFulfilled,l)},h.prototype.callRejected=function(l){o.reject(this.promise,l)},h.prototype.otherCallRejected=function(l){y(this.promise,this.onRejected,l)};function y(l,m,E){a(function(){var S;try{S=m(E)}catch(O){return o.reject(l,O)}S===l?o.reject(l,new TypeError("Cannot resolve promise with itself")):o.resolve(l,S)})}o.resolve=function(l,m){var E=_(b,m);if(E.status==="error")return o.reject(l,E.value);var S=E.value;if(S)T(l,S);else{l.state=x,l.outcome=m;for(var O=-1,D=l.queue.length;++O<D;)l.queue[O].callFulfilled(m)}return l},o.reject=function(l,m){l.state=p,l.outcome=m;for(var E=-1,S=l.queue.length;++E<S;)l.queue[E].callRejected(m);return l};function b(l){var m=l&&l.then;if(l&&(typeof l=="object"||typeof l=="function")&&typeof m=="function")return function(){m.apply(l,arguments)}}function T(l,m){var E=!1;function S(A){E||(E=!0,o.reject(l,A))}function O(A){E||(E=!0,o.resolve(l,A))}function D(){m(O,S)}var P=_(D);P.status==="error"&&S(P.value)}function _(l,m){var E={};try{E.value=l(m),E.status="success"}catch(S){E.status="error",E.value=S}return E}d.resolve=c;function c(l){return l instanceof this?l:o.resolve(new this(s),l)}d.reject=u;function u(l){var m=new this(s);return o.reject(m,l)}d.all=f;function f(l){var m=this;if(Object.prototype.toString.call(l)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=l.length,S=!1;if(!E)return this.resolve([]);for(var O=new Array(E),D=0,P=-1,A=new this(s);++P<E;)w(l[P],P);return A;function w(L,R){m.resolve(L).then(C,function(M){S||(S=!0,o.reject(A,M))});function C(M){O[R]=M,++D===E&&!S&&(S=!0,o.resolve(A,O))}}}d.race=v;function v(l){var m=this;if(Object.prototype.toString.call(l)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=l.length,S=!1;if(!E)return this.resolve([]);for(var O=-1,D=new this(s);++O<E;)P(l[O]);return D;function P(A){m.resolve(A).then(function(w){S||(S=!0,o.resolve(D,w))},function(w){S||(S=!0,o.reject(D,w))})}}},{"1":1}],3:[function(r,n,t){(function(a){typeof a.Promise!="function"&&(a.Promise=r(2))}).call(this,typeof Er!="undefined"?Er:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"2":2}],4:[function(r,n,t){var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Z){return typeof Z}:function(Z){return Z&&typeof Symbol=="function"&&Z.constructor===Symbol&&Z!==Symbol.prototype?"symbol":typeof Z};function s(Z,ie){if(!(Z instanceof ie))throw new TypeError("Cannot call a class as a function")}function o(){try{if(typeof indexedDB!="undefined")return indexedDB;if(typeof webkitIndexedDB!="undefined")return webkitIndexedDB;if(typeof mozIndexedDB!="undefined")return mozIndexedDB;if(typeof OIndexedDB!="undefined")return OIndexedDB;if(typeof msIndexedDB!="undefined")return msIndexedDB}catch(Z){return}}var p=o();function x(){try{if(!p||!p.open)return!1;var Z=typeof openDatabase!="undefined"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),ie=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!Z||ie)&&typeof indexedDB!="undefined"&&typeof IDBKeyRange!="undefined"}catch(J){return!1}}function g(Z,ie){Z=Z||[],ie=ie||{};try{return new Blob(Z,ie)}catch(ue){if(ue.name!=="TypeError")throw ue;for(var J=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,fe=new J,he=0;he<Z.length;he+=1)fe.append(Z[he]);return fe.getBlob(ie.type)}}typeof Promise=="undefined"&&r(3);var d=Promise;function h(Z,ie){ie&&Z.then(function(J){ie(null,J)},function(J){ie(J)})}function y(Z,ie,J){typeof ie=="function"&&Z.then(ie),typeof J=="function"&&Z.catch(J)}function b(Z){return typeof Z!="string"&&(console.warn(Z+" used as a key, but it is not a string."),Z=String(Z)),Z}function T(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var _="local-forage-detect-blob-support",c=void 0,u={},f=Object.prototype.toString,v="readonly",l="readwrite";function m(Z){for(var ie=Z.length,J=new ArrayBuffer(ie),fe=new Uint8Array(J),he=0;he<ie;he++)fe[he]=Z.charCodeAt(he);return J}function E(Z){return new d(function(ie){var J=Z.transaction(_,l),fe=g([""]);J.objectStore(_).put(fe,"key"),J.onabort=function(he){he.preventDefault(),he.stopPropagation(),ie(!1)},J.oncomplete=function(){var he=navigator.userAgent.match(/Chrome\/(\d+)/),ue=navigator.userAgent.match(/Edge\//);ie(ue||!he||parseInt(he[1],10)>=43)}}).catch(function(){return!1})}function S(Z){return typeof c=="boolean"?d.resolve(c):E(Z).then(function(ie){return c=ie,c})}function O(Z){var ie=u[Z.name],J={};J.promise=new d(function(fe,he){J.resolve=fe,J.reject=he}),ie.deferredOperations.push(J),ie.dbReady?ie.dbReady=ie.dbReady.then(function(){return J.promise}):ie.dbReady=J.promise}function D(Z){var ie=u[Z.name],J=ie.deferredOperations.pop();if(J)return J.resolve(),J.promise}function P(Z,ie){var J=u[Z.name],fe=J.deferredOperations.pop();if(fe)return fe.reject(ie),fe.promise}function A(Z,ie){return new d(function(J,fe){if(u[Z.name]=u[Z.name]||W(),Z.db)if(ie)O(Z),Z.db.close();else return J(Z.db);var he=[Z.name];ie&&he.push(Z.version);var ue=p.open.apply(p,he);ie&&(ue.onupgradeneeded=function(we){var Be=ue.result;try{Be.createObjectStore(Z.storeName),we.oldVersion<=1&&Be.createObjectStore(_)}catch(je){if(je.name==="ConstraintError")console.warn('The database "'+Z.name+'" has been upgraded from version '+we.oldVersion+" to version "+we.newVersion+', but the storage "'+Z.storeName+'" already exists.');else throw je}}),ue.onerror=function(we){we.preventDefault(),fe(ue.error)},ue.onsuccess=function(){var we=ue.result;we.onversionchange=function(Be){Be.target.close()},J(we),D(Z)}})}function w(Z){return A(Z,!1)}function L(Z){return A(Z,!0)}function R(Z,ie){if(!Z.db)return!0;var J=!Z.db.objectStoreNames.contains(Z.storeName),fe=Z.version<Z.db.version,he=Z.version>Z.db.version;if(fe&&(Z.version!==ie&&console.warn('The database "'+Z.name+`" can't be downgraded from version `+Z.db.version+" to version "+Z.version+"."),Z.version=Z.db.version),he||J){if(J){var ue=Z.db.version+1;ue>Z.version&&(Z.version=ue)}return!0}return!1}function C(Z){return new d(function(ie,J){var fe=new FileReader;fe.onerror=J,fe.onloadend=function(he){var ue=btoa(he.target.result||"");ie({__local_forage_encoded_blob:!0,data:ue,type:Z.type})},fe.readAsBinaryString(Z)})}function M(Z){var ie=m(atob(Z.data));return g([ie],{type:Z.type})}function N(Z){return Z&&Z.__local_forage_encoded_blob}function U(Z){var ie=this,J=ie._initReady().then(function(){var fe=u[ie._dbInfo.name];if(fe&&fe.dbReady)return fe.dbReady});return y(J,Z,Z),J}function K(Z){O(Z);for(var ie=u[Z.name],J=ie.forages,fe=0;fe<J.length;fe++){var he=J[fe];he._dbInfo.db&&(he._dbInfo.db.close(),he._dbInfo.db=null)}return Z.db=null,w(Z).then(function(ue){return Z.db=ue,R(Z)?L(Z):ue}).then(function(ue){Z.db=ie.db=ue;for(var we=0;we<J.length;we++)J[we]._dbInfo.db=ue}).catch(function(ue){throw P(Z,ue),ue})}function V(Z,ie,J,fe){fe===void 0&&(fe=1);try{var he=Z.db.transaction(Z.storeName,ie);J(null,he)}catch(ue){if(fe>0&&(!Z.db||ue.name==="InvalidStateError"||ue.name==="NotFoundError"))return d.resolve().then(function(){if(!Z.db||ue.name==="NotFoundError"&&!Z.db.objectStoreNames.contains(Z.storeName)&&Z.version<=Z.db.version)return Z.db&&(Z.version=Z.db.version+1),L(Z)}).then(function(){return K(Z).then(function(){V(Z,ie,J,fe-1)})}).catch(J);J(ue)}}function W(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function G(Z){var ie=this,J={db:null};if(Z)for(var fe in Z)J[fe]=Z[fe];var he=u[J.name];he||(he=W(),u[J.name]=he),he.forages.push(ie),ie._initReady||(ie._initReady=ie.ready,ie.ready=U);var ue=[];function we(){return d.resolve()}for(var Be=0;Be<he.forages.length;Be++){var je=he.forages[Be];je!==ie&&ue.push(je._initReady().catch(we))}var We=he.forages.slice(0);return d.all(ue).then(function(){return J.db=he.db,w(J)}).then(function(Ve){return J.db=Ve,R(J,ie._defaultConfig.version)?L(J):Ve}).then(function(Ve){J.db=he.db=Ve,ie._dbInfo=J;for(var lt=0;lt<We.length;lt++){var At=We[lt];At!==ie&&(At._dbInfo.db=J.db,At._dbInfo.version=J.version)}})}function Y(Z,ie){var J=this;Z=b(Z);var fe=new d(function(he,ue){J.ready().then(function(){V(J._dbInfo,v,function(we,Be){if(we)return ue(we);try{var je=Be.objectStore(J._dbInfo.storeName),We=je.get(Z);We.onsuccess=function(){var Ve=We.result;Ve===void 0&&(Ve=null),N(Ve)&&(Ve=M(Ve)),he(Ve)},We.onerror=function(){ue(We.error)}}catch(Ve){ue(Ve)}})}).catch(ue)});return h(fe,ie),fe}function q(Z,ie){var J=this,fe=new d(function(he,ue){J.ready().then(function(){V(J._dbInfo,v,function(we,Be){if(we)return ue(we);try{var je=Be.objectStore(J._dbInfo.storeName),We=je.openCursor(),Ve=1;We.onsuccess=function(){var lt=We.result;if(lt){var At=lt.value;N(At)&&(At=M(At));var Dt=Z(At,lt.key,Ve++);Dt!==void 0?he(Dt):lt.continue()}else he()},We.onerror=function(){ue(We.error)}}catch(lt){ue(lt)}})}).catch(ue)});return h(fe,ie),fe}function ee(Z,ie,J){var fe=this;Z=b(Z);var he=new d(function(ue,we){var Be;fe.ready().then(function(){return Be=fe._dbInfo,f.call(ie)==="[object Blob]"?S(Be.db).then(function(je){return je?ie:C(ie)}):ie}).then(function(je){V(fe._dbInfo,l,function(We,Ve){if(We)return we(We);try{var lt=Ve.objectStore(fe._dbInfo.storeName);je===null&&(je=void 0);var At=lt.put(je,Z);Ve.oncomplete=function(){je===void 0&&(je=null),ue(je)},Ve.onabort=Ve.onerror=function(){var Dt=At.error?At.error:At.transaction.error;we(Dt)}}catch(Dt){we(Dt)}})}).catch(we)});return h(he,J),he}function re(Z,ie){var J=this;Z=b(Z);var fe=new d(function(he,ue){J.ready().then(function(){V(J._dbInfo,l,function(we,Be){if(we)return ue(we);try{var je=Be.objectStore(J._dbInfo.storeName),We=je.delete(Z);Be.oncomplete=function(){he()},Be.onerror=function(){ue(We.error)},Be.onabort=function(){var Ve=We.error?We.error:We.transaction.error;ue(Ve)}}catch(Ve){ue(Ve)}})}).catch(ue)});return h(fe,ie),fe}function pe(Z){var ie=this,J=new d(function(fe,he){ie.ready().then(function(){V(ie._dbInfo,l,function(ue,we){if(ue)return he(ue);try{var Be=we.objectStore(ie._dbInfo.storeName),je=Be.clear();we.oncomplete=function(){fe()},we.onabort=we.onerror=function(){var We=je.error?je.error:je.transaction.error;he(We)}}catch(We){he(We)}})}).catch(he)});return h(J,Z),J}function Le(Z){var ie=this,J=new d(function(fe,he){ie.ready().then(function(){V(ie._dbInfo,v,function(ue,we){if(ue)return he(ue);try{var Be=we.objectStore(ie._dbInfo.storeName),je=Be.count();je.onsuccess=function(){fe(je.result)},je.onerror=function(){he(je.error)}}catch(We){he(We)}})}).catch(he)});return h(J,Z),J}function Te(Z,ie){var J=this,fe=new d(function(he,ue){if(Z<0){he(null);return}J.ready().then(function(){V(J._dbInfo,v,function(we,Be){if(we)return ue(we);try{var je=Be.objectStore(J._dbInfo.storeName),We=!1,Ve=je.openKeyCursor();Ve.onsuccess=function(){var lt=Ve.result;if(!lt){he(null);return}Z===0||We?he(lt.key):(We=!0,lt.advance(Z))},Ve.onerror=function(){ue(Ve.error)}}catch(lt){ue(lt)}})}).catch(ue)});return h(fe,ie),fe}function be(Z){var ie=this,J=new d(function(fe,he){ie.ready().then(function(){V(ie._dbInfo,v,function(ue,we){if(ue)return he(ue);try{var Be=we.objectStore(ie._dbInfo.storeName),je=Be.openKeyCursor(),We=[];je.onsuccess=function(){var Ve=je.result;if(!Ve){fe(We);return}We.push(Ve.key),Ve.continue()},je.onerror=function(){he(je.error)}}catch(Ve){he(Ve)}})}).catch(he)});return h(J,Z),J}function Re(Z,ie){ie=T.apply(this,arguments);var J=this.config();Z=typeof Z!="function"&&Z||{},Z.name||(Z.name=Z.name||J.name,Z.storeName=Z.storeName||J.storeName);var fe=this,he;if(!Z.name)he=d.reject("Invalid arguments");else{var ue=Z.name===J.name&&fe._dbInfo.db,we=ue?d.resolve(fe._dbInfo.db):w(Z).then(function(Be){var je=u[Z.name],We=je.forages;je.db=Be;for(var Ve=0;Ve<We.length;Ve++)We[Ve]._dbInfo.db=Be;return Be});Z.storeName?he=we.then(function(Be){if(!!Be.objectStoreNames.contains(Z.storeName)){var je=Be.version+1;O(Z);var We=u[Z.name],Ve=We.forages;Be.close();for(var lt=0;lt<Ve.length;lt++){var At=Ve[lt];At._dbInfo.db=null,At._dbInfo.version=je}var Dt=new d(function(Ct,Ht){var zt=p.open(Z.name,je);zt.onerror=function(Tr){var Jn=zt.result;Jn.close(),Ht(Tr)},zt.onupgradeneeded=function(){var Tr=zt.result;Tr.deleteObjectStore(Z.storeName)},zt.onsuccess=function(){var Tr=zt.result;Tr.close(),Ct(Tr)}});return Dt.then(function(Ct){We.db=Ct;for(var Ht=0;Ht<Ve.length;Ht++){var zt=Ve[Ht];zt._dbInfo.db=Ct,D(zt._dbInfo)}}).catch(function(Ct){throw(P(Z,Ct)||d.resolve()).catch(function(){}),Ct})}}):he=we.then(function(Be){O(Z);var je=u[Z.name],We=je.forages;Be.close();for(var Ve=0;Ve<We.length;Ve++){var lt=We[Ve];lt._dbInfo.db=null}var At=new d(function(Dt,Ct){var Ht=p.deleteDatabase(Z.name);Ht.onerror=function(){var zt=Ht.result;zt&&zt.close(),Ct(Ht.error)},Ht.onblocked=function(){console.warn('dropInstance blocked for database "'+Z.name+'" until all open connections are closed')},Ht.onsuccess=function(){var zt=Ht.result;zt&&zt.close(),Dt(zt)}});return At.then(function(Dt){je.db=Dt;for(var Ct=0;Ct<We.length;Ct++){var Ht=We[Ct];D(Ht._dbInfo)}}).catch(function(Dt){throw(P(Z,Dt)||d.resolve()).catch(function(){}),Dt})})}return h(he,ie),he}var Se={_driver:"asyncStorage",_initStorage:G,_support:x(),iterate:q,getItem:Y,setItem:ee,removeItem:re,clear:pe,length:Le,key:Te,keys:be,dropInstance:Re};function Ge(){return typeof openDatabase=="function"}var $e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",st="~~local_forage_type~",Ze=/^~~local_forage_type~([^~]+)~/,et="__lfsc__:",ft=et.length,dt="arbf",ht="blob",He="si08",rt="ui08",xt="uic8",pt="si16",ot="si32",Lt="ur16",wt="ui32",Pt="fl32",ve="fl64",Ce=ft+dt.length,ke=Object.prototype.toString;function Ue(Z){var ie=Z.length*.75,J=Z.length,fe,he=0,ue,we,Be,je;Z[Z.length-1]==="="&&(ie--,Z[Z.length-2]==="="&&ie--);var We=new ArrayBuffer(ie),Ve=new Uint8Array(We);for(fe=0;fe<J;fe+=4)ue=$e.indexOf(Z[fe]),we=$e.indexOf(Z[fe+1]),Be=$e.indexOf(Z[fe+2]),je=$e.indexOf(Z[fe+3]),Ve[he++]=ue<<2|we>>4,Ve[he++]=(we&15)<<4|Be>>2,Ve[he++]=(Be&3)<<6|je&63;return We}function Je(Z){var ie=new Uint8Array(Z),J="",fe;for(fe=0;fe<ie.length;fe+=3)J+=$e[ie[fe]>>2],J+=$e[(ie[fe]&3)<<4|ie[fe+1]>>4],J+=$e[(ie[fe+1]&15)<<2|ie[fe+2]>>6],J+=$e[ie[fe+2]&63];return ie.length%3==2?J=J.substring(0,J.length-1)+"=":ie.length%3==1&&(J=J.substring(0,J.length-2)+"=="),J}function it(Z,ie){var J="";if(Z&&(J=ke.call(Z)),Z&&(J==="[object ArrayBuffer]"||Z.buffer&&ke.call(Z.buffer)==="[object ArrayBuffer]")){var fe,he=et;Z instanceof ArrayBuffer?(fe=Z,he+=dt):(fe=Z.buffer,J==="[object Int8Array]"?he+=He:J==="[object Uint8Array]"?he+=rt:J==="[object Uint8ClampedArray]"?he+=xt:J==="[object Int16Array]"?he+=pt:J==="[object Uint16Array]"?he+=Lt:J==="[object Int32Array]"?he+=ot:J==="[object Uint32Array]"?he+=wt:J==="[object Float32Array]"?he+=Pt:J==="[object Float64Array]"?he+=ve:ie(new Error("Failed to get type for BinaryArray"))),ie(he+Je(fe))}else if(J==="[object Blob]"){var ue=new FileReader;ue.onload=function(){var we=st+Z.type+"~"+Je(this.result);ie(et+ht+we)},ue.readAsArrayBuffer(Z)}else try{ie(JSON.stringify(Z))}catch(we){console.error("Couldn't convert value into a JSON string: ",Z),ie(null,we)}}function X(Z){if(Z.substring(0,ft)!==et)return JSON.parse(Z);var ie=Z.substring(Ce),J=Z.substring(ft,Ce),fe;if(J===ht&&Ze.test(ie)){var he=ie.match(Ze);fe=he[1],ie=ie.substring(he[0].length)}var ue=Ue(ie);switch(J){case dt:return ue;case ht:return g([ue],{type:fe});case He:return new Int8Array(ue);case rt:return new Uint8Array(ue);case xt:return new Uint8ClampedArray(ue);case pt:return new Int16Array(ue);case Lt:return new Uint16Array(ue);case ot:return new Int32Array(ue);case wt:return new Uint32Array(ue);case Pt:return new Float32Array(ue);case ve:return new Float64Array(ue);default:throw new Error("Unkown type: "+J)}}var Ae={serialize:it,deserialize:X,stringToBuffer:Ue,bufferToString:Je};function Me(Z,ie,J,fe){Z.executeSql("CREATE TABLE IF NOT EXISTS "+ie.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],J,fe)}function Ke(Z){var ie=this,J={db:null};if(Z)for(var fe in Z)J[fe]=typeof Z[fe]!="string"?Z[fe].toString():Z[fe];var he=new d(function(ue,we){try{J.db=openDatabase(J.name,String(J.version),J.description,J.size)}catch(Be){return we(Be)}J.db.transaction(function(Be){Me(Be,J,function(){ie._dbInfo=J,ue()},function(je,We){we(We)})},we)});return J.serializer=Ae,he}function ne(Z,ie,J,fe,he,ue){Z.executeSql(J,fe,he,function(we,Be){Be.code===Be.SYNTAX_ERR?we.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[ie.storeName],function(je,We){We.rows.length?ue(je,Be):Me(je,ie,function(){je.executeSql(J,fe,he,ue)},ue)},ue):ue(we,Be)},ue)}function _e(Z,ie){var J=this;Z=b(Z);var fe=new d(function(he,ue){J.ready().then(function(){var we=J._dbInfo;we.db.transaction(function(Be){ne(Be,we,"SELECT * FROM "+we.storeName+" WHERE key = ? LIMIT 1",[Z],function(je,We){var Ve=We.rows.length?We.rows.item(0).value:null;Ve&&(Ve=we.serializer.deserialize(Ve)),he(Ve)},function(je,We){ue(We)})})}).catch(ue)});return h(fe,ie),fe}function H(Z,ie){var J=this,fe=new d(function(he,ue){J.ready().then(function(){var we=J._dbInfo;we.db.transaction(function(Be){ne(Be,we,"SELECT * FROM "+we.storeName,[],function(je,We){for(var Ve=We.rows,lt=Ve.length,At=0;At<lt;At++){var Dt=Ve.item(At),Ct=Dt.value;if(Ct&&(Ct=we.serializer.deserialize(Ct)),Ct=Z(Ct,Dt.key,At+1),Ct!==void 0){he(Ct);return}}he()},function(je,We){ue(We)})})}).catch(ue)});return h(fe,ie),fe}function De(Z,ie,J,fe){var he=this;Z=b(Z);var ue=new d(function(we,Be){he.ready().then(function(){ie===void 0&&(ie=null);var je=ie,We=he._dbInfo;We.serializer.serialize(ie,function(Ve,lt){lt?Be(lt):We.db.transaction(function(At){ne(At,We,"INSERT OR REPLACE INTO "+We.storeName+" (key, value) VALUES (?, ?)",[Z,Ve],function(){we(je)},function(Dt,Ct){Be(Ct)})},function(At){if(At.code===At.QUOTA_ERR){if(fe>0){we(De.apply(he,[Z,je,J,fe-1]));return}Be(At)}})})}).catch(Be)});return h(ue,J),ue}function ut(Z,ie,J){return De.apply(this,[Z,ie,J,1])}function B(Z,ie){var J=this;Z=b(Z);var fe=new d(function(he,ue){J.ready().then(function(){var we=J._dbInfo;we.db.transaction(function(Be){ne(Be,we,"DELETE FROM "+we.storeName+" WHERE key = ?",[Z],function(){he()},function(je,We){ue(We)})})}).catch(ue)});return h(fe,ie),fe}function ge(Z){var ie=this,J=new d(function(fe,he){ie.ready().then(function(){var ue=ie._dbInfo;ue.db.transaction(function(we){ne(we,ue,"DELETE FROM "+ue.storeName,[],function(){fe()},function(Be,je){he(je)})})}).catch(he)});return h(J,Z),J}function xe(Z){var ie=this,J=new d(function(fe,he){ie.ready().then(function(){var ue=ie._dbInfo;ue.db.transaction(function(we){ne(we,ue,"SELECT COUNT(key) as c FROM "+ue.storeName,[],function(Be,je){var We=je.rows.item(0).c;fe(We)},function(Be,je){he(je)})})}).catch(he)});return h(J,Z),J}function $(Z,ie){var J=this,fe=new d(function(he,ue){J.ready().then(function(){var we=J._dbInfo;we.db.transaction(function(Be){ne(Be,we,"SELECT key FROM "+we.storeName+" WHERE id = ? LIMIT 1",[Z+1],function(je,We){var Ve=We.rows.length?We.rows.item(0).key:null;he(Ve)},function(je,We){ue(We)})})}).catch(ue)});return h(fe,ie),fe}function ae(Z){var ie=this,J=new d(function(fe,he){ie.ready().then(function(){var ue=ie._dbInfo;ue.db.transaction(function(we){ne(we,ue,"SELECT key FROM "+ue.storeName,[],function(Be,je){for(var We=[],Ve=0;Ve<je.rows.length;Ve++)We.push(je.rows.item(Ve).key);fe(We)},function(Be,je){he(je)})})}).catch(he)});return h(J,Z),J}function me(Z){return new d(function(ie,J){Z.transaction(function(fe){fe.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(he,ue){for(var we=[],Be=0;Be<ue.rows.length;Be++)we.push(ue.rows.item(Be).name);ie({db:Z,storeNames:we})},function(he,ue){J(ue)})},function(fe){J(fe)})})}function at(Z,ie){ie=T.apply(this,arguments);var J=this.config();Z=typeof Z!="function"&&Z||{},Z.name||(Z.name=Z.name||J.name,Z.storeName=Z.storeName||J.storeName);var fe=this,he;return Z.name?he=new d(function(ue){var we;Z.name===J.name?we=fe._dbInfo.db:we=openDatabase(Z.name,"","",0),Z.storeName?ue({db:we,storeNames:[Z.storeName]}):ue(me(we))}).then(function(ue){return new d(function(we,Be){ue.db.transaction(function(je){function We(Dt){return new d(function(Ct,Ht){je.executeSql("DROP TABLE IF EXISTS "+Dt,[],function(){Ct()},function(zt,Tr){Ht(Tr)})})}for(var Ve=[],lt=0,At=ue.storeNames.length;lt<At;lt++)Ve.push(We(ue.storeNames[lt]));d.all(Ve).then(function(){we()}).catch(function(Dt){Be(Dt)})},function(je){Be(je)})})}):he=d.reject("Invalid arguments"),h(he,ie),he}var Xe={_driver:"webSQLStorage",_initStorage:Ke,_support:Ge(),iterate:H,getItem:_e,setItem:ut,removeItem:B,clear:ge,length:xe,key:$,keys:ae,dropInstance:at};function Qe(){try{return typeof localStorage!="undefined"&&"setItem"in localStorage&&!!localStorage.setItem}catch(Z){return!1}}function bt(Z,ie){var J=Z.name+"/";return Z.storeName!==ie.storeName&&(J+=Z.storeName+"/"),J}function lr(){var Z="_localforage_support_test";try{return localStorage.setItem(Z,!0),localStorage.removeItem(Z),!1}catch(ie){return!0}}function Nt(){return!lr()||localStorage.length>0}function St(Z){var ie=this,J={};if(Z)for(var fe in Z)J[fe]=Z[fe];return J.keyPrefix=bt(Z,ie._defaultConfig),Nt()?(ie._dbInfo=J,J.serializer=Ae,d.resolve()):d.reject()}function Wt(Z){var ie=this,J=ie.ready().then(function(){for(var fe=ie._dbInfo.keyPrefix,he=localStorage.length-1;he>=0;he--){var ue=localStorage.key(he);ue.indexOf(fe)===0&&localStorage.removeItem(ue)}});return h(J,Z),J}function Zt(Z,ie){var J=this;Z=b(Z);var fe=J.ready().then(function(){var he=J._dbInfo,ue=localStorage.getItem(he.keyPrefix+Z);return ue&&(ue=he.serializer.deserialize(ue)),ue});return h(fe,ie),fe}function qt(Z,ie){var J=this,fe=J.ready().then(function(){for(var he=J._dbInfo,ue=he.keyPrefix,we=ue.length,Be=localStorage.length,je=1,We=0;We<Be;We++){var Ve=localStorage.key(We);if(Ve.indexOf(ue)===0){var lt=localStorage.getItem(Ve);if(lt&&(lt=he.serializer.deserialize(lt)),lt=Z(lt,Ve.substring(we),je++),lt!==void 0)return lt}}});return h(fe,ie),fe}function _n(Z,ie){var J=this,fe=J.ready().then(function(){var he=J._dbInfo,ue;try{ue=localStorage.key(Z)}catch(we){ue=null}return ue&&(ue=ue.substring(he.keyPrefix.length)),ue});return h(fe,ie),fe}function xn(Z){var ie=this,J=ie.ready().then(function(){for(var fe=ie._dbInfo,he=localStorage.length,ue=[],we=0;we<he;we++){var Be=localStorage.key(we);Be.indexOf(fe.keyPrefix)===0&&ue.push(Be.substring(fe.keyPrefix.length))}return ue});return h(J,Z),J}function Ft(Z){var ie=this,J=ie.keys().then(function(fe){return fe.length});return h(J,Z),J}function ir(Z,ie){var J=this;Z=b(Z);var fe=J.ready().then(function(){var he=J._dbInfo;localStorage.removeItem(he.keyPrefix+Z)});return h(fe,ie),fe}function Gt(Z,ie,J){var fe=this;Z=b(Z);var he=fe.ready().then(function(){ie===void 0&&(ie=null);var ue=ie;return new d(function(we,Be){var je=fe._dbInfo;je.serializer.serialize(ie,function(We,Ve){if(Ve)Be(Ve);else try{localStorage.setItem(je.keyPrefix+Z,We),we(ue)}catch(lt){(lt.name==="QuotaExceededError"||lt.name==="NS_ERROR_DOM_QUOTA_REACHED")&&Be(lt),Be(lt)}})})});return h(he,J),he}function Sr(Z,ie){if(ie=T.apply(this,arguments),Z=typeof Z!="function"&&Z||{},!Z.name){var J=this.config();Z.name=Z.name||J.name,Z.storeName=Z.storeName||J.storeName}var fe=this,he;return Z.name?he=new d(function(ue){Z.storeName?ue(bt(Z,fe._defaultConfig)):ue(Z.name+"/")}).then(function(ue){for(var we=localStorage.length-1;we>=0;we--){var Be=localStorage.key(we);Be.indexOf(ue)===0&&localStorage.removeItem(Be)}}):he=d.reject("Invalid arguments"),h(he,ie),he}var yr={_driver:"localStorageWrapper",_initStorage:St,_support:Qe(),iterate:qt,getItem:Zt,setItem:Gt,removeItem:ir,clear:Wt,length:Ft,key:_n,keys:xn,dropInstance:Sr},Zn=function(ie,J){return ie===J||typeof ie=="number"&&typeof J=="number"&&isNaN(ie)&&isNaN(J)},$o=function(ie,J){for(var fe=ie.length,he=0;he<fe;){if(Zn(ie[he],J))return!0;he++}return!1},ia=Array.isArray||function(Z){return Object.prototype.toString.call(Z)==="[object Array]"},Cn={},aa={},bn={INDEXEDDB:Se,WEBSQL:Xe,LOCALSTORAGE:yr},as=[bn.INDEXEDDB._driver,bn.WEBSQL._driver,bn.LOCALSTORAGE._driver],Qn=["dropInstance"],sa=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Qn),Yo={description:"",driver:as.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ss(Z,ie){Z[ie]=function(){var J=arguments;return Z.ready().then(function(){return Z[ie].apply(Z,J)})}}function xi(){for(var Z=1;Z<arguments.length;Z++){var ie=arguments[Z];if(ie)for(var J in ie)ie.hasOwnProperty(J)&&(ia(ie[J])?arguments[0][J]=ie[J].slice():arguments[0][J]=ie[J])}return arguments[0]}var os=function(){function Z(ie){s(this,Z);for(var J in bn)if(bn.hasOwnProperty(J)){var fe=bn[J],he=fe._driver;this[J]=he,Cn[he]||this.defineDriver(fe)}this._defaultConfig=xi({},Yo),this._config=xi({},this._defaultConfig,ie),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return Z.prototype.config=function(J){if((typeof J=="undefined"?"undefined":a(J))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var fe in J){if(fe==="storeName"&&(J[fe]=J[fe].replace(/\W/g,"_")),fe==="version"&&typeof J[fe]!="number")return new Error("Database version must be a number.");this._config[fe]=J[fe]}return"driver"in J&&J.driver?this.setDriver(this._config.driver):!0}else return typeof J=="string"?this._config[J]:this._config},Z.prototype.defineDriver=function(J,fe,he){var ue=new d(function(we,Be){try{var je=J._driver,We=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!J._driver){Be(We);return}for(var Ve=sa.concat("_initStorage"),lt=0,At=Ve.length;lt<At;lt++){var Dt=Ve[lt],Ct=!$o(Qn,Dt);if((Ct||J[Dt])&&typeof J[Dt]!="function"){Be(We);return}}var Ht=function(){for(var Jn=function(Zo){return function(){var Qo=new Error("Method "+Zo+" is not implemented by the current driver"),ua=d.reject(Qo);return h(ua,arguments[arguments.length-1]),ua}},oa=0,Xo=Qn.length;oa<Xo;oa++){var la=Qn[oa];J[la]||(J[la]=Jn(la))}};Ht();var zt=function(Jn){Cn[je]&&console.info("Redefining LocalForage driver: "+je),Cn[je]=J,aa[je]=Jn,we()};"_support"in J?J._support&&typeof J._support=="function"?J._support().then(zt,Be):zt(!!J._support):zt(!0)}catch(Tr){Be(Tr)}});return y(ue,fe,he),ue},Z.prototype.driver=function(){return this._driver||null},Z.prototype.getDriver=function(J,fe,he){var ue=Cn[J]?d.resolve(Cn[J]):d.reject(new Error("Driver not found."));return y(ue,fe,he),ue},Z.prototype.getSerializer=function(J){var fe=d.resolve(Ae);return y(fe,J),fe},Z.prototype.ready=function(J){var fe=this,he=fe._driverSet.then(function(){return fe._ready===null&&(fe._ready=fe._initDriver()),fe._ready});return y(he,J,J),he},Z.prototype.setDriver=function(J,fe,he){var ue=this;ia(J)||(J=[J]);var we=this._getSupportedDrivers(J);function Be(){ue._config.driver=ue.driver()}function je(lt){return ue._extend(lt),Be(),ue._ready=ue._initStorage(ue._config),ue._ready}function We(lt){return function(){var At=0;function Dt(){for(;At<lt.length;){var Ct=lt[At];return At++,ue._dbInfo=null,ue._ready=null,ue.getDriver(Ct).then(je).catch(Dt)}Be();var Ht=new Error("No available storage method found.");return ue._driverSet=d.reject(Ht),ue._driverSet}return Dt()}}var Ve=this._driverSet!==null?this._driverSet.catch(function(){return d.resolve()}):d.resolve();return this._driverSet=Ve.then(function(){var lt=we[0];return ue._dbInfo=null,ue._ready=null,ue.getDriver(lt).then(function(At){ue._driver=At._driver,Be(),ue._wrapLibraryMethodsWithReady(),ue._initDriver=We(we)})}).catch(function(){Be();var lt=new Error("No available storage method found.");return ue._driverSet=d.reject(lt),ue._driverSet}),y(this._driverSet,fe,he),this._driverSet},Z.prototype.supports=function(J){return!!aa[J]},Z.prototype._extend=function(J){xi(this,J)},Z.prototype._getSupportedDrivers=function(J){for(var fe=[],he=0,ue=J.length;he<ue;he++){var we=J[he];this.supports(we)&&fe.push(we)}return fe},Z.prototype._wrapLibraryMethodsWithReady=function(){for(var J=0,fe=sa.length;J<fe;J++)ss(this,sa[J])},Z.prototype.createInstance=function(J){return new Z(J)},Z}(),ls=new os;n.exports=ls},{"3":3}]},{},[4])(4)})})(Oh);Object.defineProperty(Bo,"__esModule",{value:!0});Bo.default=void 0;var Rn=nt,NS=ts(hi),wu=ts(Zi),BS=ts(gn),FS=ts(Hr.exports),Ah=ts(Oh.exports);function ts(i){return i&&i.__esModule?i:{default:i}}class wh{constructor(e,r,n){this.urlCache={},this.storage=void 0,this.name=e,this.requester=r||NS.default,this.resolver=n,this.online=!0,this.checkRequirements(),this.addListeners()}checkRequirements(){try{let e;typeof Ah.default=="undefined"&&(e=Ah.default),this.storage=e.createInstance({name:this.name})}catch(e){throw new Error("localForage lib not loaded")}}addListeners(){this._status=this.status.bind(this),window.addEventListener("online",this._status),window.addEventListener("offline",this._status)}removeListeners(){window.removeEventListener("online",this._status),window.removeEventListener("offline",this._status),this._status=void 0}status(e){let r=navigator.onLine;this.online=r,r?this.emit("online",this):this.emit("offline",this)}add(e,r){let n=e.resources.map(t=>{let{href:a}=t,s=this.resolver(a),o=window.encodeURIComponent(s);return this.storage.getItem(o).then(p=>!p||r?this.requester(s,"binary").then(x=>this.storage.setItem(o,x)):p)});return Promise.all(n)}put(e,r,n){let t=window.encodeURIComponent(e);return this.storage.getItem(t).then(a=>a||this.requester(e,"binary",r,n).then(s=>this.storage.setItem(t,s)))}request(e,r,n,t){return this.online?this.requester(e,r,n,t).then(a=>(this.put(e),a)):this.retrieve(e,r)}retrieve(e,r){new Rn.defer;var n,t=new BS.default(e);return r||(r=t.extension),r=="blob"?n=this.getBlob(e):n=this.getText(e),n.then(a=>{var s=new Rn.defer,o;return a?(o=this.handleResponse(a,r),s.resolve(o)):s.reject({message:"File not found in storage: "+e,stack:new Error().stack}),s.promise})}handleResponse(e,r){var n;return r=="json"?n=JSON.parse(e):(0,Rn.isXml)(r)?n=(0,Rn.parse)(e,"text/xml"):r=="xhtml"?n=(0,Rn.parse)(e,"application/xhtml+xml"):r=="html"||r=="htm"?n=(0,Rn.parse)(e,"text/html"):n=e,n}getBlob(e,r){let n=window.encodeURIComponent(e);return this.storage.getItem(n).then(function(t){if(!!t)return r=r||wu.default.lookup(e),new Blob([t],{type:r})})}getText(e,r){let n=window.encodeURIComponent(e);return r=r||wu.default.lookup(e),this.storage.getItem(n).then(function(t){var a=new Rn.defer,s=new FileReader,o;if(!!t)return o=new Blob([t],{type:r}),s.addEventListener("loadend",()=>{a.resolve(s.result)}),s.readAsText(o,r),a.promise})}getBase64(e,r){let n=window.encodeURIComponent(e);return r=r||wu.default.lookup(e),this.storage.getItem(n).then(t=>{var a=new Rn.defer,s=new FileReader,o;if(!!t)return o=new Blob([t],{type:r}),s.addEventListener("loadend",()=>{a.resolve(s.result)}),s.readAsDataURL(o,r),a.promise})}createUrl(e,r){var n=new Rn.defer,t=window.URL||window.webkitURL||window.mozURL,a,s,o=r&&r.base64;return e in this.urlCache?(n.resolve(this.urlCache[e]),n.promise):(o?(s=this.getBase64(e),s&&s.then(function(p){this.urlCache[e]=p,n.resolve(p)}.bind(this))):(s=this.getBlob(e),s&&s.then(function(p){a=t.createObjectURL(p),this.urlCache[e]=a,n.resolve(a)}.bind(this))),s||n.reject({message:"File not found in storage: "+e,stack:new Error().stack}),n.promise)}revokeUrl(e){var r=window.URL||window.webkitURL||window.mozURL,n=this.urlCache[e];n&&r.revokeObjectURL(n)}destroy(){var e=window.URL||window.webkitURL||window.mozURL;for(let r in this.urlCache)e.revokeObjectURL(r);this.urlCache={},this.removeListeners()}}(0,FS.default)(wh.prototype);var US=wh;Bo.default=US;var Fo={};Object.defineProperty(Fo,"__esModule",{value:!0});Fo.default=void 0;var Lh=nt;class jS{constructor(e){this.interactive="",this.fixedLayout="",this.openToSpread="",this.orientationLock="",e&&this.parse(e)}parse(e){if(!e)return this;const r=(0,Lh.qs)(e,"display_options");return r?((0,Lh.qsa)(r,"option").forEach(t=>{let a="";switch(t.childNodes.length&&(a=t.childNodes[0].nodeValue),t.attributes.name.value){case"interactive":this.interactive=a;break;case"fixed-layout":this.fixedLayout=a;break;case"open-to-spread":this.openToSpread=a;break;case"orientation-lock":this.orientationLock=a;break}}),this):this}destroy(){this.interactive=void 0,this.fixedLayout=void 0,this.openToSpread=void 0,this.orientationLock=void 0}}var WS=jS;Fo.default=WS;Object.defineProperty(Ra,"__esModule",{value:!0});Ra.default=void 0;var zS=mr(Hr.exports),sn=nt,Xn=mr(fi),Dh=mr(gn),KS=mr(po),VS=mr(go),GS=mr(yo),Ph=mr(Eo),Lu=mr(_o),HS=mr(xo),Du=mr(So),$S=mr(Qi),YS=mr(ko),Rh=mr(hi),XS=mr(xr),ZS=mr(Bo),Pu=mr(Fo),Ch=nr;function mr(i){return i&&i.__esModule?i:{default:i}}const Ih="META-INF/container.xml",QS="META-INF/com.apple.ibooks.display-options.xml",on={BINARY:"binary",BASE64:"base64",EPUB:"epub",OPF:"opf",MANIFEST:"json",DIRECTORY:"directory"};class Mh{constructor(e,r){typeof r=="undefined"&&typeof e!="string"&&!(e instanceof Blob)&&!(e instanceof ArrayBuffer)&&(r=e,e=void 0),this.settings=(0,sn.extend)(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0,canonical:void 0,openAs:void 0,store:void 0}),(0,sn.extend)(this.settings,r),this.opening=new sn.defer,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new sn.defer,spine:new sn.defer,metadata:new sn.defer,cover:new sn.defer,navigation:new sn.defer,pageList:new sn.defer,resources:new sn.defer,displayOptions:new sn.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise,displayOptions:this.loading.displayOptions.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources,this.loaded.displayOptions]),this.isRendered=!1,this.request=this.settings.requestMethod||Rh.default,this.spine=new KS.default,this.locations=new VS.default(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.storage=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,this.displayOptions=void 0,this.settings.store&&this.store(this.settings.store),e&&this.open(e,this.settings.openAs).catch(n=>{var t=new Error("Cannot load book at "+e);this.emit(Ch.EVENTS.BOOK.OPEN_FAILED,t)})}open(e,r){var n,t=r||this.determineType(e);return t===on.BINARY?(this.archived=!0,this.url=new Xn.default("/",""),n=this.openEpub(e)):t===on.BASE64?(this.archived=!0,this.url=new Xn.default("/",""),n=this.openEpub(e,t)):t===on.EPUB?(this.archived=!0,this.url=new Xn.default("/",""),n=this.request(e,"binary",this.settings.requestCredentials,this.settings.requestHeaders).then(this.openEpub.bind(this))):t==on.OPF?(this.url=new Xn.default(e),n=this.openPackaging(this.url.Path.toString())):t==on.MANIFEST?(this.url=new Xn.default(e),n=this.openManifest(this.url.Path.toString())):(this.url=new Xn.default(e),n=this.openContainer(Ih).then(this.openPackaging.bind(this))),n}openEpub(e,r){return this.unarchive(e,r||this.settings.encoding).then(()=>this.openContainer(Ih)).then(n=>this.openPackaging(n))}openContainer(e){return this.load(e).then(r=>(this.container=new GS.default(r),this.resolve(this.container.packagePath)))}openPackaging(e){return this.path=new Dh.default(e),this.load(e).then(r=>(this.packaging=new Ph.default(r),this.unpack(this.packaging)))}openManifest(e){return this.path=new Dh.default(e),this.load(e).then(r=>(this.packaging=new Ph.default,this.packaging.load(r),this.unpack(this.packaging)))}load(e){var r=this.resolve(e);return this.archived?this.archive.request(r):this.request(r,null,this.settings.requestCredentials,this.settings.requestHeaders)}resolve(e,r){if(!!e){var n=e,t=e.indexOf("://")>-1;return t?e:(this.path&&(n=this.path.resolve(e)),r!=!1&&this.url&&(n=this.url.resolve(n)),n)}}canonical(e){var r=e;return e?(this.settings.canonical?r=this.settings.canonical(e):r=this.resolve(e,!0),r):""}determineType(e){var r,n,t;if(this.settings.encoding==="base64")return on.BASE64;if(typeof e!="string")return on.BINARY;if(r=new Xn.default(e),n=r.path(),t=n.extension,t&&(t=t.replace(/\?.*$/,"")),!t)return on.DIRECTORY;if(t==="epub")return on.EPUB;if(t==="opf")return on.OPF;if(t==="json")return on.MANIFEST}unpack(e){this.package=e,this.packaging.metadata.layout===""?this.load(this.url.resolve(QS)).then(r=>{this.displayOptions=new Pu.default(r),this.loading.displayOptions.resolve(this.displayOptions)}).catch(r=>{this.displayOptions=new Pu.default,this.loading.displayOptions.resolve(this.displayOptions)}):(this.displayOptions=new Pu.default,this.loading.displayOptions.resolve(this.displayOptions)),this.spine.unpack(this.packaging,this.resolve.bind(this),this.canonical.bind(this)),this.resources=new HS.default(this.packaging.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||(this.archived?"blobUrl":"base64")}),this.loadNavigation(this.packaging).then(()=>{this.loading.navigation.resolve(this.navigation)}),this.packaging.coverPath&&(this.cover=this.resolve(this.packaging.coverPath)),this.loading.manifest.resolve(this.packaging.manifest),this.loading.metadata.resolve(this.packaging.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&this.settings.replacements!="none"?this.replacements().then(()=>{this.loaded.displayOptions.then(()=>{this.opening.resolve(this)})}).catch(r=>{console.error(r)}):this.loaded.displayOptions.then(()=>{this.opening.resolve(this)})}loadNavigation(e){let r=e.navPath||e.ncxPath,n=e.toc;return n?new Promise((t,a)=>{this.navigation=new Lu.default(n),e.pageList&&(this.pageList=new Du.default(e.pageList)),t(this.navigation)}):r?this.load(r,"xml").then(t=>(this.navigation=new Lu.default(t),this.pageList=new Du.default(t),this.navigation)):new Promise((t,a)=>{this.navigation=new Lu.default,this.pageList=new Du.default,t(this.navigation)})}section(e){return this.spine.get(e)}renderTo(e,r){return this.rendition=new $S.default(this,r),this.rendition.attachTo(e),this.rendition}setRequestCredentials(e){this.settings.requestCredentials=e}setRequestHeaders(e){this.settings.requestHeaders=e}unarchive(e,r){return this.archive=new YS.default,this.archive.open(e,r)}store(e){let r=this.settings.replacements&&this.settings.replacements!=="none",n=this.url,t=this.settings.requestMethod||Rh.default.bind(this);return this.storage=new ZS.default(e,t,this.resolve.bind(this)),this.request=this.storage.request.bind(this.storage),this.opened.then(()=>{this.archived&&(this.storage.requester=this.archive.request.bind(this.archive));let a=(s,o)=>{o.output=this.resources.substitute(s,o.url)};this.resources.settings.replacements=r||"blobUrl",this.resources.replacements().then(()=>this.resources.replaceCss()),this.storage.on("offline",()=>{this.url=new Xn.default("/",""),this.spine.hooks.serialize.register(a)}),this.storage.on("online",()=>{this.url=n,this.spine.hooks.serialize.deregister(a)})}),this.storage}coverUrl(){return this.loaded.cover.then(()=>this.cover?this.archived?this.archive.createUrl(this.cover):this.cover:null)}replacements(){return this.spine.hooks.serialize.register((e,r)=>{r.output=this.resources.substitute(e,r.url)}),this.resources.replacements().then(()=>this.resources.replaceCss())}getRange(e){var r=new XS.default(e),n=this.spine.get(r.spinePos),t=this.load.bind(this);return n?n.load(t).then(function(a){var s=r.toRange(n.document);return s}):new Promise((a,s)=>{s("CFI could not be found")})}key(e){var r=e||this.packaging.metadata.identifier||this.url.filename;return`epubjs:${Ch.EPUBJS_VERSION}:${r}`}destroy(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.displayOptions&&this.displayOptions.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1}}(0,zS.default)(Mh.prototype);var JS=Mh;Ra.default=JS;var Uo={};Object.defineProperty(Uo,"__esModule",{value:!0});Uo.default=void 0;var kh=yi(Ra),qS=yi(Qi),eT=yi(xr),tT=yi(vi),rT=nT(nt),Nh=nr;yi(Xa);yi(qi);yi(qa);function Bh(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Bh=function(n){return n?r:e})(i)}function nT(i,e){if(!e&&i&&i.__esModule)return i;if(i===null||typeof i!="object"&&typeof i!="function")return{default:i};var r=Bh(e);if(r&&r.has(i))return r.get(i);var n={},t=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in i)if(a!=="default"&&Object.prototype.hasOwnProperty.call(i,a)){var s=t?Object.getOwnPropertyDescriptor(i,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=i[a]}return n.default=i,r&&r.set(i,n),n}function yi(i){return i&&i.__esModule?i:{default:i}}function Ei(i,e){return new kh.default(i,e)}Ei.VERSION=Nh.EPUBJS_VERSION;typeof Er!="undefined"&&(Er.EPUBJS_VERSION=Nh.EPUBJS_VERSION);Ei.Book=kh.default;Ei.Rendition=qS.default;Ei.Contents=tT.default;Ei.CFI=eT.default;Ei.utils=rT;var iT=Ei;Uo.default=iT;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"Book",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(i,"Contents",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(i,"EpubCFI",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(i,"Layout",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(i,"Rendition",{enumerable:!0,get:function(){return n.default}}),i.default=void 0;var e=o(Ra),r=o(xr),n=o(Qi),t=o(vi),a=o($a),s=o(Uo);function o(x){return x&&x.__esModule?x:{default:x}}var p=s.default;i.default=p})(Rc);var rs={};Object.defineProperty(rs,"__esModule",{value:!0});rs.default=void 0;var aT={viewHolder:{position:"relative",height:"100%",width:"100%"},view:{height:"100%"}},sT=aT;rs.default=sT;function jo(i){return jo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jo(i)}Object.defineProperty(eo,"__esModule",{value:!0});eo.default=void 0;var Wo=uT(vt.exports),br=Ru(Zl.exports),oT=Ru(Rc),lT=Ru(rs);function Ru(i){return i&&i.__esModule?i:{default:i}}function Fh(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Fh=function(t){return t?r:e})(i)}function uT(i,e){if(!e&&i&&i.__esModule)return i;if(i===null||jo(i)!=="object"&&typeof i!="function")return{default:i};var r=Fh(e);if(r&&r.has(i))return r.get(i);var n={},t=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in i)if(a!=="default"&&Object.prototype.hasOwnProperty.call(i,a)){var s=t?Object.getOwnPropertyDescriptor(i,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=i[a]}return n.default=i,r&&r.set(i,n),n}function Uh(i,e){var r=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})),r.push.apply(r,n)}return r}function fT(i){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Uh(Object(r),!0).forEach(function(n){Mu(i,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):Uh(Object(r)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(r,n))})}return i}function cT(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function jh(i,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function dT(i,e,r){return e&&jh(i.prototype,e),r&&jh(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}function hT(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&Cu(i,e)}function Cu(i,e){return Cu=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},Cu(i,e)}function pT(i){var e=gT();return function(){var n=zo(i),t;if(e){var a=zo(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return vT(this,t)}}function vT(i,e){if(e&&(jo(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Iu(i)}function Iu(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function gT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function zo(i){return zo=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},zo(i)}function Mu(i,e,r){return e in i?Object.defineProperty(i,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[e]=r,i}var ku=function(i){hT(r,i);var e=pT(r);function r(n){var t;return cT(this,r),t=e.call(this,n),Mu(Iu(t),"onLocationChange",function(a){var s=t.props,o=s.location,p=s.locationChanged,x=a&&a.start;o!==x&&(t.location=x,p&&p(x))}),Mu(Iu(t),"handleKeyPress",function(a){var s=a.key;s&&s==="ArrowRight"&&t.nextPage(),s&&s==="ArrowLeft"&&t.prevPage()}),t.state={isLoaded:!1,toc:[]},t.viewerRef=Wo.default.createRef(),t.location=n.location,t.book=t.rendition=t.prevPage=t.nextPage=null,t}return dT(r,[{key:"componentDidMount",value:function(){this.initBook(!0),document.addEventListener("keyup",this.handleKeyPress,!1)}},{key:"initBook",value:function(){var t=this,a=this.props,s=a.url,o=a.tocChanged,p=a.epubInitOptions;this.book&&this.book.destroy(),this.book=new oT.default(s,p),this.book.loaded.navigation.then(function(x){var g=x.toc;t.setState({isLoaded:!0,toc:g},function(){o&&o(g),t.initReader()})})}},{key:"componentWillUnmount",value:function(){this.book=this.rendition=this.prevPage=this.nextPage=null,document.removeEventListener("keyup",this.handleKeyPress,!1)}},{key:"shouldComponentUpdate",value:function(t){return!this.state.isLoaded||t.location!==this.props.location||t.location!==this.props.location}},{key:"componentDidUpdate",value:function(t){t.location!==this.props.location&&this.location!==this.props.location&&this.rendition.display(this.props.location),t.url!==this.props.url&&this.initBook()}},{key:"initReader",value:function(){var t=this,a=this.state.toc,s=this.props,o=s.location,p=s.epubOptions,x=s.getRendition,g=this.viewerRef.current;this.rendition=this.book.renderTo(g,fT({contained:!0,width:"100%",height:"100%"},p)),this.prevPage=function(){t.rendition.prev()},this.nextPage=function(){t.rendition.next()},this.registerEvents(),x&&x(this.rendition),typeof o=="string"||typeof o=="number"?this.rendition.display(o):a.length>0&&a[0].href?this.rendition.display(a[0].href):this.rendition.display()}},{key:"registerEvents",value:function(){var t=this.props,a=t.handleKeyPress,s=t.handleTextSelected;this.rendition.on("locationChanged",this.onLocationChange),this.rendition.on("keyup",a||this.handleKeyPress),s&&this.rendition.on("selected",s)}},{key:"renderBook",value:function(){var t=this.props.styles;return Wo.default.createElement("div",{ref:this.viewerRef,style:t.view})}},{key:"render",value:function(){var t=this.state.isLoaded,a=this.props,s=a.loadingView,o=a.styles;return Wo.default.createElement("div",{style:o.viewHolder},t&&this.renderBook()||s)}}]),r}(Wo.Component);ku.defaultProps={loadingView:null,locationChanged:null,tocChanged:null,styles:lT.default,epubOptions:{},epubInitOptions:{}};ku.propTypes={url:br.default.oneOfType([br.default.string,br.default.instanceOf(ArrayBuffer)]),loadingView:br.default.element,location:br.default.oneOfType([br.default.string,br.default.number]),locationChanged:br.default.func,tocChanged:br.default.func,styles:br.default.object,epubInitOptions:br.default.object,epubOptions:br.default.object,getRendition:br.default.func,handleKeyPress:br.default.func,handleTextSelected:br.default.func};var mT=ku;eo.default=mT;var Ko={};function ln(){return ln=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])}return i},ln.apply(this,arguments)}var Wh="Left",zh="Right",Kh="Up",Vh="Down",Nu={delta:10,preventDefaultTouchmoveEvent:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0},Bu={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},Gh="mousemove",Hh="mouseup",yT="touchend",ET="touchmove",_T="touchstart";function xT(i,e,r,n){return i>e?r>0?zh:Wh:n>0?Vh:Kh}function $h(i,e){if(e===0)return i;var r=Math.PI/180*e,n=i[0]*Math.cos(r)+i[1]*Math.sin(r),t=i[1]*Math.cos(r)-i[0]*Math.sin(r);return[n,t]}function bT(i,e){var r=function(d){d&&"touches"in d&&d.touches.length>1||i(function(h,y){y.trackMouse&&(document.addEventListener(Gh,n),document.addEventListener(Hh,s));var b="touches"in d?d.touches[0]:d,T=b.clientX,_=b.clientY,c=$h([T,_],y.rotationAngle);return ln({},h,Bu,{initial:[].concat(c),xy:c,start:d.timeStamp||0})})},n=function(d){i(function(h,y){if("touches"in d&&d.touches.length>1)return h;var b="touches"in d?d.touches[0]:d,T=b.clientX,_=b.clientY,c=$h([T,_],y.rotationAngle),u=c[0],f=c[1],v=u-h.xy[0],l=f-h.xy[1],m=Math.abs(v),E=Math.abs(l),S=(d.timeStamp||0)-h.start,O=Math.sqrt(m*m+E*E)/(S||1),D=[v/(S||1),l/(S||1)],P=xT(m,E,v,l),A=typeof y.delta=="number"?y.delta:y.delta[P.toLowerCase()]||Nu.delta;if(m<A&&E<A&&!h.swiping)return h;var w={absX:m,absY:E,deltaX:v,deltaY:l,dir:P,event:d,first:h.first,initial:h.initial,velocity:O,vxvy:D};w.first&&y.onSwipeStart&&y.onSwipeStart(w),y.onSwiping&&y.onSwiping(w);var L=!1;return(y.onSwiping||y.onSwiped||"onSwiped"+P in y)&&(L=!0),L&&y.preventDefaultTouchmoveEvent&&y.trackTouch&&d.cancelable&&d.preventDefault(),ln({},h,{first:!1,eventData:w,swiping:!0})})},t=function(d){i(function(h,y){var b;if(h.swiping&&h.eventData){b=ln({},h.eventData,{event:d}),y.onSwiped&&y.onSwiped(b);var T=y["onSwiped"+b.dir];T&&T(b)}else y.onTap&&y.onTap({event:d});return ln({},h,Bu,{eventData:b})})},a=function(){document.removeEventListener(Gh,n),document.removeEventListener(Hh,s)},s=function(d){a(),t(d)},o=function(d,h){var y=function(){};if(d&&d.addEventListener){var b=[[_T,r],[ET,n],[yT,t]];b.forEach(function(T){var _=T[0],c=T[1];return d.addEventListener(_,c,{passive:h})}),y=function(){return b.forEach(function(_){var c=_[0],u=_[1];return d.removeEventListener(c,u)})}}return y},p=function(d){d!==null&&i(function(h,y){if(h.el===d)return h;var b={};return h.el&&h.el!==d&&h.cleanUpTouch&&(h.cleanUpTouch(),b.cleanUpTouch=void 0),y.trackTouch&&d&&(b.cleanUpTouch=o(d,!y.preventDefaultTouchmoveEvent)),ln({},h,{el:d},b)})},x={ref:p};return e.trackMouse&&(x.onMouseDown=r),[x,o]}function ST(i,e,r){var n={};return!e.trackTouch&&i.cleanUpTouch?(i.cleanUpTouch(),n.cleanUpTouch=void 0):e.trackTouch&&!i.cleanUpTouch&&i.el&&(n.cleanUpTouch=r(i.el,!e.preventDefaultTouchmoveEvent)),ln({},i,n)}function TT(i){var e=i.trackMouse,r=vt.exports.useRef(ln({},Bu)),n=vt.exports.useRef(ln({},Nu));n.current=ln({},Nu,i);var t=vt.exports.useMemo(function(){return bT(function(o){return r.current=o(r.current,n.current)},{trackMouse:e})},[e]),a=t[0],s=t[1];return r.current=ST(r.current,n.current,s),a}var OT=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",DOWN:Vh,LEFT:Wh,RIGHT:zh,UP:Kh,useSwipeable:TT}),AT=qo(OT),ns={};Object.defineProperty(ns,"__esModule",{value:!0});ns.default=void 0;var wT={container:{overflow:"hidden",height:"100%"},readerArea:{position:"relative",zIndex:1,height:"100%",width:"100%",backgroundColor:"#fff",transition:"all .3s ease"},containerExpanded:{transform:"translateX(256px)"},titleArea:{position:"absolute",top:20,left:50,right:50,textAlign:"center",color:"#999"},reader:{position:"absolute",top:50,left:50,bottom:20,right:50},swipeWrapper:{position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:200},prev:{left:1},next:{right:1},arrow:{outline:"none",border:"none",background:"none",position:"absolute",top:"50%",marginTop:-32,fontSize:64,padding:"0 10px",color:"#E2E2E2",fontFamily:"arial, sans-serif",cursor:"pointer",userSelect:"none",appearance:"none",fontWeight:"normal"},arrowHover:{color:"#777"},tocBackground:{position:"absolute",left:256,top:0,bottom:0,right:0,zIndex:1},tocArea:{position:"absolute",left:0,top:0,bottom:0,zIndex:0,width:256,overflowY:"auto",WebkitOverflowScrolling:"touch",background:"#f2f2f2",padding:"10px 0"},tocAreaButton:{userSelect:"none",appearance:"none",background:"none",border:"none",display:"block",fontFamily:"sans-serif",width:"100%",fontSize:".9em",textAlign:"left",padding:".9em 1em",borderBottom:"1px solid #ddd",color:"#aaa",boxSizing:"border-box",outline:"none",cursor:"pointer"},tocButton:{background:"none",border:"none",width:32,height:32,position:"absolute",top:10,left:10,borderRadius:2,outline:"none",cursor:"pointer"},tocButtonExpanded:{background:"#f2f2f2"},tocButtonBar:{position:"absolute",width:"60%",background:"#ccc",height:2,left:"50%",margin:"-1px -30%",top:"50%",transition:"all .5s ease"},tocButtonBarTop:{top:"35%"},tocButtonBottom:{top:"66%"},loadingView:{position:"absolute",top:"50%",left:"10%",right:"10%",color:"#ccc",textAlign:"center",margintop:"-.5em"}},LT=wT;ns.default=LT;function Vo(i){return Vo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vo(i)}Object.defineProperty(Ko,"__esModule",{value:!0});Ko.default=void 0;var Vt=IT(vt.exports),Qr=Xh(Zl.exports),DT=AT,PT=Xl,Yh=Xh(ns),RT=["children"],CT=["title","showToc","loadingView","styles","locationChanged","swipeable","epubViewStyles"];function Xh(i){return i&&i.__esModule?i:{default:i}}function Zh(i){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Zh=function(t){return t?r:e})(i)}function IT(i,e){if(!e&&i&&i.__esModule)return i;if(i===null||Vo(i)!=="object"&&typeof i!="function")return{default:i};var r=Zh(e);if(r&&r.has(i))return r.get(i);var n={},t=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in i)if(a!=="default"&&Object.prototype.hasOwnProperty.call(i,a)){var s=t?Object.getOwnPropertyDescriptor(i,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=i[a]}return n.default=i,r&&r.set(i,n),n}function Go(){return Go=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])}return i},Go.apply(this,arguments)}function Qh(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Jh(i,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function qh(i,e,r){return e&&Jh(i.prototype,e),r&&Jh(i,r),Object.defineProperty(i,"prototype",{writable:!1}),i}function ep(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&Fu(i,e)}function Fu(i,e){return Fu=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},Fu(i,e)}function tp(i){var e=kT();return function(){var n=Ho(i),t;if(e){var a=Ho(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return MT(this,t)}}function MT(i,e){if(e&&(Vo(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _i(i)}function _i(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function kT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Ho(i){return Ho=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Ho(i)}function na(i,e,r){return e in i?Object.defineProperty(i,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[e]=r,i}function rp(i,e){if(i==null)return{};var r=NT(i,e),n,t;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);for(t=0;t<a.length;t++)n=a[t],!(e.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,n)||(r[n]=i[n]))}return r}function NT(i,e){if(i==null)return{};var r={},n=Object.keys(i),t,a;for(a=0;a<n.length;a++)t=n[a],!(e.indexOf(t)>=0)&&(r[t]=i[t]);return r}var BT=function(e){var r=e.children,n=rp(e,RT),t=(0,DT.useSwipeable)(n);return Vt.default.createElement("div",t,r)},np=function(i){ep(r,i);var e=tp(r);function r(){var n;Qh(this,r);for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return n=e.call.apply(e,[this].concat(a)),na(_i(n),"setLocation",function(){n.props.setLocation(n.props.href)}),n}return qh(r,[{key:"render",value:function(){var t=this.props,a=t.label,s=t.styles;return Vt.default.createElement("button",{onClick:this.setLocation,style:s},a)}}]),r}(Vt.PureComponent);np.propTypes={label:Qr.default.string,href:Qr.default.string,setLocation:Qr.default.func,styles:Qr.default.object};var Uu=function(i){ep(r,i);var e=tp(r);function r(n){var t;return Qh(this,r),t=e.call(this,n),na(_i(t),"toggleToc",function(){t.setState({expandedToc:!t.state.expandedToc})}),na(_i(t),"next",function(){var a=t.readerRef.current;a.nextPage()}),na(_i(t),"prev",function(){var a=t.readerRef.current;a.prevPage()}),na(_i(t),"onTocChange",function(a){var s=t.props.tocChanged;t.setState({toc:a},function(){return s&&s(a)})}),na(_i(t),"setLocation",function(a){var s=t.props.locationChanged;t.setState({expandedToc:!1},function(){return s&&s(a)})}),t.readerRef=Vt.default.createRef(),t.state={expandedToc:!1,toc:!1},t}return qh(r,[{key:"renderToc",value:function(){var t=this,a=this.state,s=a.toc,o=a.expandedToc,p=this.props.styles;return Vt.default.createElement("div",null,Vt.default.createElement("div",{style:p.tocArea},Vt.default.createElement("div",{style:p.toc},s.map(function(x,g){return Vt.default.createElement(np,Go({},x,{key:g,setLocation:t.setLocation,styles:p.tocAreaButton}))}))),o&&Vt.default.createElement("div",{style:p.tocBackground,onClick:this.toggleToc}))}},{key:"renderTocToggle",value:function(){var t=this.state.expandedToc,a=this.props.styles;return Vt.default.createElement("button",{style:Object.assign({},a.tocButton,t?a.tocButtonExpanded:{}),onClick:this.toggleToc},Vt.default.createElement("span",{style:Object.assign({},a.tocButtonBar,a.tocButtonBarTop)}),Vt.default.createElement("span",{style:Object.assign({},a.tocButtonBar,a.tocButtonBottom)}))}},{key:"render",value:function(){var t=this.props,a=t.title,s=t.showToc,o=t.loadingView,p=t.styles,x=t.locationChanged,g=t.swipeable,d=t.epubViewStyles,h=rp(t,CT),y=this.state,b=y.toc,T=y.expandedToc;return Vt.default.createElement("div",{style:p.container},Vt.default.createElement("div",{style:Object.assign({},p.readerArea,T?p.containerExpanded:{})},s&&this.renderTocToggle(),Vt.default.createElement("div",{style:p.titleArea},a),Vt.default.createElement(BT,{onSwipedRight:this.prev,onSwipedLeft:this.next,trackMouse:!0},Vt.default.createElement("div",{style:p.reader},Vt.default.createElement(PT.EpubView,Go({ref:this.readerRef,loadingView:o,styles:d},h,{tocChanged:this.onTocChange,locationChanged:x})),g&&Vt.default.createElement("div",{style:p.swipeWrapper}))),Vt.default.createElement("button",{style:Object.assign({},p.arrow,p.prev),onClick:this.prev},"\u2039"),Vt.default.createElement("button",{style:Object.assign({},p.arrow,p.next),onClick:this.next},"\u203A")),s&&b&&this.renderToc())}}]),r}(Vt.PureComponent);Uu.defaultProps={loadingView:Vt.default.createElement("div",{style:Yh.default.loadingView},"Loading\u2026"),locationChanged:null,tocChanged:null,showToc:!0,styles:Yh.default};Uu.propTypes={title:Qr.default.string,loadingView:Qr.default.element,showToc:Qr.default.bool,locationChanged:Qr.default.func,tocChanged:Qr.default.func,styles:Qr.default.object,epubViewStyles:Qr.default.object,swipeable:Qr.default.bool};var FT=Uu;Ko.default=FT;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"EpubView",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(i,"EpubViewStyle",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(i,"ReactReader",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(i,"ReactReaderStyle",{enumerable:!0,get:function(){return t.default}});var e=a(eo),r=a(rs),n=a(Ko),t=a(ns);function a(s){return s&&s.__esModule?s:{default:s}}})(Xl);const ip=(i=!0)=>{const{setShowUnfold:e,unfold:r}=vt.exports.useContext(Sn);return vt.exports.useEffect(()=>(i&&e(!0),()=>{e(!1)}),[]),{unfold:r,setShowUnfold:e}},UT=-1,jT=["epub"],WT=({file:i})=>{const[e,r]=vt.exports.useState(void 0),n=s=>{r(s)},{unfold:t}=ip(!0),a=kn();return oe.createElement(bi,{w:"full",h:t?"full":"75vh",pos:t?"fixed":"unset",left:t?"0":"unset",top:t?"0":"unset",transition:"all 0.3s",backdropFilter:"blur(10px)",className:"epub-box"},oe.createElement(Xl.ReactReader,{location:e,locationChanged:n,url:a()}))};var zT=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",type:UT,exts:jT,default:WT});const KT=6,VT=[],GT=({file:i})=>{const e=kn(),[r,n]=vt.exports.useState(""),{getSetting:t,password:a}=vt.exports.useContext(Sn);return vt.exports.useEffect(()=>{n(e(i))},[]),oe.createElement(Si,{className:"image-box",w:"full"},oe.createElement(Op,{maxH:"75vh",fallback:oe.createElement(Ap,{color:t("icon color")||"#1890ff",size:"xl"}),rounded:"lg",src:r}))};var HT=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",type:KT,exts:VT,default:GT});let ju="/";ju==="/"&&(ju=window.location.origin+"/");const $T=ju,YT=-1,XT=["ipa"],ZT=({file:i})=>{const{getSetting:e}=vt.exports.useContext(Sn),r=i.name.split(".").pop()||"",n=kn(),{t}=ca(),a=n(),[s,o]=vt.exports.useState(!1);return oe.createElement(Si,{className:"no-preview",p:"4"},oe.createElement(el,{spacing:"8"},oe.createElement(da,{color:e("icon color")||"#1890ff",boxSize:20,as:cs(i.type,r)}),oe.createElement(fs,{size:"md"},i.name),oe.createElement(Vu,{spacing:"8"},oe.createElement(jr,{onClick:()=>{window.open(a,"_blank")}},t("Download")),oe.createElement(tl,{href:`itms-services://?action=download-manifest&url=${$T}i/${btoa(a).replaceAll("/","_").replaceAll("=","-")}/ipa.plist`},oe.createElement(jr,{onClick:()=>{o(!0)},colorScheme:"green"},t(s?"Installing":"Install"))))))};var QT=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",type:YT,exts:XT,default:ZT});const JT=-1,qT=[],ap=({url:i,unfold:e})=>oe.createElement(Si,{w:"full",h:"full",className:"pdf-preview-box"},oe.createElement("iframe",{title:"pdf-viewer",width:"100%",height:"100%",src:`https://alist-org.github.io/pdf.js/web/viewer.html?file=${i}`}));var e1=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",type:JT,exts:qT,default:ap});const t1=2,r1=[],n1=({file:i})=>{const{pathname:e}=wp(),{password:r}=vt.exports.useContext(Sn);let n=kn(!1,!1);const{unfold:t,setShowUnfold:a}=ip(!1),[s,o]=oe.useState(""),[p,x]=oe.useState(""),g=n(),[d,h]=oe.useState("office"),y=[{name:"office",url:`https://view.officeapps.live.com/op/view.aspx?src=${encodeURIComponent(g)}`},{name:"google",url:`https://docs.google.com/gview?url=${encodeURIComponent(g)}&embedded=true`}],b=()=>{i.driver==="AliDrive"?Wp.post("preview",{path:e,password:r}).then(T=>{const _=T.data;if(_.code!==200)return;aliyun.config({mount:document.querySelector("#office-preview"),url:_.data.preview_url}).setToken({token:_.data.access_token})}):(i.name.endsWith(".pdf")?(x(n()),o("pdf")):o("office"),a(!0))};return vt.exports.useEffect(()=>{b()},[]),oe.createElement(bi,{w:"full",h:t?"full":"75vh",pos:t?"fixed":"unset",left:t?"0":"unset",top:t?"0":"unset",id:"office-preview",transition:"all 0.3s",backdropFilter:"blur(10px)",className:"office-preview-box"},s==="office"&&oe.createElement(bi,{w:"full",h:"full"},oe.createElement(Lp,{m:"1",onChange:h,value:d},oe.createElement(Dp,{direction:"row"},y.map(T=>oe.createElement(Pp,{value:T.name,key:T.name},T.name)))),y.map(T=>T.name===d&&oe.createElement("iframe",{key:T.name,width:"100%",style:{height:"calc(100% - 24px - 0.25rem)"},src:T.url,frameBorder:"0"}))),s==="pdf"&&oe.createElement(ap,{url:p,unfold:t||!1}))};var i1=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",type:t1,exts:r1,default:n1});const a1=-1,s1=["plist"],o1=({file:i})=>{const{getSetting:e}=vt.exports.useContext(Sn),r=i.name.split(".").pop()||"",n=kn(),{t}=ca(),a=n(),[s,o]=vt.exports.useState(!1);return oe.createElement(Si,{className:"no-preview",p:"4"},oe.createElement(el,{spacing:"8"},oe.createElement(da,{color:e("icon color")||"#1890ff",boxSize:20,as:cs(i.type,r)}),oe.createElement(fs,{size:"md"},i.name),oe.createElement(Vu,{spacing:"8"},oe.createElement(jr,{onClick:()=>{window.open(a,"_blank")}},t("Download")),oe.createElement(tl,{href:"itms-services://?action=download-manifest&url="+a},oe.createElement(jr,{onClick:()=>{o(!0)},colorScheme:"green"},t(s?"Installing":"Install"))))))};var l1=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",type:a1,exts:s1,default:o1}),sp={exports:{}};/*!
 * artplayer.js v4.3.1
 * Github: https://github.com/zhw2590582/ArtPlayer#readme
 * (c) 2017-2022 Harvey Zack
 * Released under the MIT License.
 */(function(i,e){(function(r,n){i.exports=n()})(Er,function(){function r(z,F){if(!(z instanceof F))throw new TypeError("Cannot call a class as a function")}function n(z,F){for(var I=0;I<F.length;I++){var k=F[I];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(z,k.key,k)}}function t(z,F,I){return F&&n(z.prototype,F),I&&n(z,I),Object.defineProperty(z,"prototype",{writable:!1}),z}function a(z){if(z===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z}function s(z,F){return s=Object.setPrototypeOf||function(I,k){return I.__proto__=k,I},s(z,F)}function o(z,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function");z.prototype=Object.create(F&&F.prototype,{constructor:{value:z,writable:!0,configurable:!0}}),Object.defineProperty(z,"prototype",{writable:!1}),F&&s(z,F)}function p(z){return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},p(z)}function x(z,F){if(F&&(p(F)==="object"||typeof F=="function"))return F;if(F!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return a(z)}function g(z){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},g(z)}(function(z,F){F===void 0&&(F={});var I=F.insertAt;if(z&&typeof document!="undefined"){var k=document.head||document.getElementsByTagName("head")[0],j=document.createElement("style");j.type="text/css",I==="top"&&k.firstChild?k.insertBefore(j,k.firstChild):k.appendChild(j),j.styleSheet?j.styleSheet.cssText=z:j.appendChild(document.createTextNode(z))}})('.art-video-player{zoom:1;-webkit-tap-highlight-color:rgba(0,0,0,0);-ms-high-contrast-adjust:none;background-color:#000;color:#eee;direction:ltr;display:flex;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;height:100%;line-height:1.3;margin:0 auto;outline:0;position:relative;text-align:left;touch-action:manipulation;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:100%;z-index:20}.art-video-player *{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{height:5px;width:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{align-items:center;display:inline-flex;justify-content:center;line-height:1.5}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter:initial) or (backdrop-filter:initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter:saturate(180%) blur(20px);background-color:rgba(0,0,0,.7)!important}}.art-video-player .art-video{background-color:#000;cursor:pointer;z-index:10}.art-video-player .art-poster,.art-video-player .art-video{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.art-video-player .art-poster{background-position:50%;background-repeat:no-repeat;background-size:cover;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:11}.art-video-player .art-subtitle{bottom:10px;color:#fff;display:none;font-size:20px;padding:0 20px;pointer-events:none;position:absolute;text-align:center;text-shadow:.5px .5px .5px rgba(0,0,0,.5);width:100%;z-index:20}.art-video-player .art-subtitle p{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;line-height:1.2;margin:5px 0 0;word-break:break-all}.art-video-player .art-bilingual p:nth-child(n+2){transform:scale(.6);transform-origin:center top}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30}.art-video-player .art-danmuku,.art-video-player .art-layers{bottom:0;height:100%;left:0;overflow:hidden;pointer-events:none;position:absolute;right:0;top:0;width:100%}.art-video-player .art-layers{display:none;z-index:40}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{align-items:center;bottom:0;display:none;height:100%;justify-content:center;left:0;overflow:hidden;pointer-events:none;position:absolute;right:0;top:0;width:100%;z-index:50}.art-video-player .art-mask .art-state{align-items:center;bottom:65px;display:flex;height:60px;justify-content:center;opacity:.6;position:absolute;right:30px;width:60px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player .art-loading{align-items:center;bottom:0;display:none;height:100%;justify-content:center;left:0;pointer-events:none;position:absolute;right:0;top:0;width:100%;z-index:70}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAADGCAYAAAAT+OqFAAAAdklEQVQoz42QQQ7AIAgEF/T/D+kbq/RWAlnQyyazA4aoAB4FsBSA/bFjuF1EOL7VbrIrBuusmrt4ZZORfb6ehbWdnRHEIiITaEUKa5EJqUakRSaEYBJSCY2dEstQY7AuxahwXFrvZmWl2rh4JZ07z9dLtesfNj5q0FU3A5ObbwAAAABJRU5ErkJggg==) repeat-x bottom;bottom:0;display:flex;flex-direction:column;height:100px;justify-content:space-between;left:0;opacity:0;padding:50px 10px 0;pointer-events:none;position:absolute;right:0;transition:all .2s ease-in-out;visibility:hidden;z-index:60}.art-video-player .art-bottom .art-progress{pointer-events:auto;position:relative;z-index:0}.art-video-player .art-bottom .art-progress .art-control-progress{align-items:center;cursor:pointer;display:flex;flex-direction:row;height:4px;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{align-items:center;background:hsla(0,0%,100%,.2);display:flex;height:50%;position:relative;width:100%}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{background:hsla(0,0%,100%,.4);bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:0;z-index:10}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:0;z-index:20}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{bottom:0;height:100%;left:0;pointer-events:none;position:absolute;right:0;top:0;z-index:30}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{background:#fff;display:inline-block;height:100%;left:0;pointer-events:auto;position:absolute;top:0;width:7px}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{align-items:center;border-radius:50%;justify-content:center;position:absolute;transform:scale(.1);transition:transform .1s ease-in-out;visibility:hidden;z-index:40}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{height:100%;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:100%}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{background:rgba(0,0,0,.7);border-radius:3px;color:#fff;display:none;font-size:12px;font-weight:700;height:20px;left:0;line-height:20px;padding:0 5px;position:absolute;text-align:center;top:-25px;white-space:nowrap;z-index:50}.art-video-player .art-bottom .art-progress .art-control-thumbnails{background-color:rgba(0,0,0,.7);bottom:8px;display:none;left:0;pointer-events:none;position:absolute}.art-video-player .art-bottom .art-progress .art-control-loop{bottom:0;display:none;height:100%;left:0;pointer-events:none;position:absolute;right:0;top:0;width:100%}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{background:hsla(0,0%,100%,.75);height:8px;left:0;position:absolute;top:-2px;width:2px}.art-video-player .art-bottom .art-controls{align-items:center;display:flex;height:45px;justify-content:space-between;pointer-events:auto;position:relative;z-index:1}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-control{align-items:center;cursor:pointer;display:flex;font-size:12px;line-height:1;min-height:36px;min-width:36px;opacity:.9;text-align:center;white-space:nowrap}.art-video-player .art-bottom .art-controls .art-control .art-icon{align-items:center;display:flex;float:left;height:36px;justify-content:center;width:36px}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-onlyText{padding:0 10px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;height:100%;overflow:hidden;position:relative;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);width:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{background:#fff;border-radius:12px;height:12px;left:0;margin-top:-6px;position:absolute;top:50%;width:12px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:hsla(0,0%,100%,.2);left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{content:"";display:block;height:3px;margin-top:-2px;position:absolute;top:50%;width:60px}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{position:relative;z-index:30}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{background:rgba(0,0,0,.8);border-radius:3px;bottom:35px;color:#fff;display:none;padding:5px 0;position:absolute;text-align:center;width:100px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;line-height:30px;overflow:hidden;text-overflow:ellipsis;text-shadow:0 0 2px rgba(0,0,0,.5);white-space:nowrap}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:hsla(0,0%,100%,.1)}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner{height:100%}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{transform:scale(1);visibility:visible}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-destroy .art-progress-tip,.art-video-player.art-error .art-progress-indicator,.art-video-player.art-error .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-progress-indicator{transform:scale(1)!important;visibility:visible!important}.art-video-player .art-notice{display:none;font-size:14px;left:0;padding:10px;pointer-events:none;position:absolute;top:0;width:100%;z-index:80}.art-video-player .art-notice .art-notice-inner{background-color:rgba(0,0,0,.6);border-radius:3px;color:#fff;display:inline-block;padding:5px 10px}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{background-color:rgba(0,0,0,.9);border-radius:3px;display:none;flex-direction:column;left:10px;min-width:200px;padding:5px 0;position:absolute;top:10px;z-index:120}.art-video-player .art-contextmenus .art-contextmenu{border-bottom:1px solid hsla(0,0%,100%,.1);color:#fff;cursor:pointer;display:block;font-size:12px;overflow:hidden;padding:10px 15px;text-overflow:ellipsis;text-shadow:0 0 2px rgba(0,0,0,.5);white-space:nowrap}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{display:inline-block;padding:0 7px}.art-video-player .art-contextmenus .art-contextmenu span.art-current,.art-video-player .art-contextmenus .art-contextmenu span:hover{color:#00c9ff}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:hsla(0,0%,100%,.1)}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{background-color:rgba(0,0,0,.9);border-radius:3px;bottom:50px;display:none;font-size:13px;max-height:300px;overflow:auto;position:absolute;right:10px;transition:all .2s ease;z-index:90}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{align-items:center;color:hsla(0,0%,100%,.8);cursor:pointer;display:flex;height:35px;justify-content:space-between;line-height:1;overflow:hidden;padding:0 5px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current,.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{background-color:hsla(0,0%,100%,.1);color:#fff}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{align-items:center;display:flex;height:30px;justify-content:center;width:30px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{height:15px;visibility:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{align-items:center;display:flex;white-space:nowrap}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{align-items:center;display:flex;height:24px;justify-content:center;margin-right:10px;width:24px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{color:hsla(0,0%,100%,.5);font-size:12px;white-space:nowrap}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{align-items:center;display:flex;height:24px;justify-content:center;width:24px}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid hsla(0,0%,100%,.1)}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player .art-info{-webkit-font-smoothing:antialiased;background-color:rgba(0,0,0,.9);color:#fff;display:none;flex-direction:column;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;left:10px;padding:10px;position:absolute;top:10px;width:350px;z-index:100}.art-video-player .art-info .art-info-item{display:flex;margin-bottom:5px}.art-video-player .art-info .art-info-item .art-info-title{text-align:right;width:100px}.art-video-player .art-info .art-info-item .art-info-content{flex:1;overflow:hidden;padding-left:5px;text-overflow:ellipsis;white-space:nowrap}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;right:5px;top:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;-o-object-fit:fill;object-fit:fill}.art-video-player.art-fullscreen-web{bottom:0;height:100%!important;left:0;position:fixed;right:0;top:0;width:100%!important;z-index:9999}.art-fullscreen-rotate{background-color:#000;bottom:0;height:100%;left:0;position:fixed;right:0;top:0;width:100%;z-index:9999}.art-video-player .art-mini-header{align-items:center;background-color:rgba(0,0,0,.5);color:#fff;display:none;height:35px;justify-content:space-between;left:0;line-height:35px;opacity:0;position:absolute;right:0;top:0;transition:all .2s ease-in-out;visibility:hidden;z-index:110}.art-video-player .art-mini-header .art-mini-title{cursor:move;flex:1;overflow:hidden;padding:0 10px;text-overflow:ellipsis;white-space:nowrap}.art-video-player .art-mini-header .art-mini-close{cursor:pointer;font-size:22px;text-align:center;width:35px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{box-shadow:0 2px 5px 0 rgba(0,0,0,.16),0 3px 6px 0 rgba(0,0,0,.2);height:225px;position:fixed;width:400px;z-index:9999}.art-video-player.art-mini .art-mini-header{display:flex;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-setting,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{align-items:center;display:flex;justify-content:center}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layers .art-layer-log{background-color:rgba(0,0,0,.5);border-radius:3px;bottom:10px;color:#fff;display:none;font-size:13px;left:10px;padding:5px;pointer-events:none;position:absolute;text-shadow:0 0 2px rgba(0,0,0,.5);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:120px}.art-video-player .art-layers .art-layer-log p{margin-bottom:0;word-break:break-all}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{background-color:rgba(0,0,0,.8);border-radius:3px;bottom:35px;color:#fff;display:none;max-height:200px;max-width:200px;min-width:100px;overflow:auto;padding:5px 0;position:absolute;text-align:center}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;line-height:30px;overflow:hidden;padding:0 5px;text-overflow:ellipsis;text-shadow:0 0 2px rgba(0,0,0,.5);white-space:nowrap}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:hsla(0,0%,100%,.1)}.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current,.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{color:#00c9ff}.art-video-player .art-control-selector:hover .art-selector-list{display:block}:root{--balloon-color:hsla(0,0%,6%,.95);--balloon-font-size:12px;--balloon-move:4px}button[aria-label][data-balloon-pos]{overflow:visible}[aria-label][data-balloon-pos]{cursor:pointer;position:relative}[aria-label][data-balloon-pos]:after{background:var(--balloon-color);border-radius:2px;color:#fff;content:attr(aria-label);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:var(--balloon-font-size);font-style:normal;font-weight:400;line-height:1.2;padding:.5em 1em;text-indent:0;text-shadow:none;white-space:nowrap}[aria-label][data-balloon-pos]:after,[aria-label][data-balloon-pos]:before{opacity:0;pointer-events:none;position:absolute;transition:all .18s ease-out .18s;z-index:10}[aria-label][data-balloon-pos]:before{border:5px solid transparent;border-top:5px solid var(--balloon-color);content:"";height:0;width:0}[aria-label][data-balloon-pos]:hover:after,[aria-label][data-balloon-pos]:hover:before{opacity:1;pointer-events:none}[aria-label][data-balloon-pos][data-balloon-pos=up]:after{margin-bottom:10px}[aria-label][data-balloon-pos][data-balloon-pos=up]:after,[aria-label][data-balloon-pos][data-balloon-pos=up]:before{bottom:100%;left:50%;transform:translate(-50%,var(--balloon-move));transform-origin:top}[aria-label][data-balloon-pos][data-balloon-pos=up]:hover:after,[aria-label][data-balloon-pos][data-balloon-pos=up]:hover:before{transform:translate(-50%)}');var d={exports:{}};(function(z,F){z.exports=function(){function I(se){return(I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ee){return typeof Ee}:function(Ee){return Ee&&typeof Symbol=="function"&&Ee.constructor===Symbol&&Ee!==Symbol.prototype?"symbol":typeof Ee})(se)}var k=Object.prototype.toString,j=function(se){if(se===void 0)return"undefined";if(se===null)return"null";var Ee=I(se);if(Ee==="boolean")return"boolean";if(Ee==="string")return"string";if(Ee==="number")return"number";if(Ee==="symbol")return"symbol";if(Ee==="function")return function(le){return Q(le)==="GeneratorFunction"}(se)?"generatorfunction":"function";if(function(le){return Array.isArray?Array.isArray(le):le instanceof Array}(se))return"array";if(function(le){return!(!le.constructor||typeof le.constructor.isBuffer!="function")&&le.constructor.isBuffer(le)}(se))return"buffer";if(function(le){try{if(typeof le.length=="number"&&typeof le.callee=="function")return!0}catch(Oe){if(Oe.message.indexOf("callee")!==-1)return!0}return!1}(se))return"arguments";if(function(le){return le instanceof Date||typeof le.toDateString=="function"&&typeof le.getDate=="function"&&typeof le.setDate=="function"}(se))return"date";if(function(le){return le instanceof Error||typeof le.message=="string"&&le.constructor&&typeof le.constructor.stackTraceLimit=="number"}(se))return"error";if(function(le){return le instanceof RegExp||typeof le.flags=="string"&&typeof le.ignoreCase=="boolean"&&typeof le.multiline=="boolean"&&typeof le.global=="boolean"}(se))return"regexp";switch(Q(se)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(le){return typeof le.throw=="function"&&typeof le.return=="function"&&typeof le.next=="function"}(se))return"generator";switch(Ee=k.call(se)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return Ee.slice(8,-1).toLowerCase().replace(/\s/g,"")};function Q(se){return se.constructor?se.constructor.name:null}function te(se,Ee){var le=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return de(se,Ee,le),ce(se,Ee,le),function(Oe,Fe,ze){var tt=j(Fe),Ne=j(Oe);if(tt==="object"){if(Ne!=="object")throw new Error("[Type Error]: '".concat(ze.join("."),"' require 'object' type, but got '").concat(Ne,"'"));Object.keys(Fe).forEach(function(qe){var ct=Oe[qe],mt=Fe[qe],Tt=ze.slice();Tt.push(qe),de(ct,mt,Tt),ce(ct,mt,Tt),te(ct,mt,Tt)})}if(tt==="array"){if(Ne!=="array")throw new Error("[Type Error]: '".concat(ze.join("."),"' require 'array' type, but got '").concat(Ne,"'"));Oe.forEach(function(qe,ct){var mt=Oe[ct],Tt=Fe[ct]||Fe[0],Mt=ze.slice();Mt.push(ct),de(mt,Tt,Mt),ce(mt,Tt,Mt),te(mt,Tt,Mt)})}}(se,Ee,le),se}function de(se,Ee,le){if(j(Ee)==="string"){var Oe=j(se);if(Ee[0]==="?"&&(Ee=Ee.slice(1)+"|undefined"),!(-1<Ee.indexOf("|")?Ee.split("|").map(function(Fe){return Fe.toLowerCase().trim()}).filter(Boolean).some(function(Fe){return Oe===Fe}):Ee.toLowerCase().trim()===Oe))throw new Error("[Type Error]: '".concat(le.join("."),"' require '").concat(Ee,"' type, but got '").concat(Oe,"'"))}}function ce(se,Ee,le){if(j(Ee)==="function"){var Oe=Ee(se,j(se),le);if(Oe!==!0){var Fe=j(Oe);throw Fe==="string"?new Error(Oe):Fe==="error"?Oe:new Error("[Validator Error]: The scheme for '".concat(le.join("."),"' validator require return true, but got '").concat(Oe,"'"))}}}return te.kindOf=j,te}()})(d);var h=d.exports,y=function(){function z(){r(this,z)}return t(z,[{key:"on",value:function(F,I,k){var j=this.e||(this.e={});return(j[F]||(j[F]=[])).push({fn:I,ctx:k}),this}},{key:"once",value:function(F,I,k){var j=this;function Q(){j.off(F,Q);for(var te=arguments.length,de=new Array(te),ce=0;ce<te;ce++)de[ce]=arguments[ce];I.apply(k,de)}return Q._=I,this.on(F,Q,k)}},{key:"emit",value:function(F){for(var I=((this.e||(this.e={}))[F]||[]).slice(),k=arguments.length,j=new Array(k>1?k-1:0),Q=1;Q<k;Q++)j[Q-1]=arguments[Q];for(var te=0;te<I.length;te+=1)I[te].fn.apply(I[te].ctx,j);return this}},{key:"off",value:function(F,I){var k=this.e||(this.e={}),j=k[F],Q=[];if(j&&I)for(var te=0,de=j.length;te<de;te+=1)j[te].fn!==I&&j[te].fn._!==I&&Q.push(j[te]);return Q.length?k[F]=Q:delete k[F],this}}]),z}(),b=typeof window!="undefined"?window.navigator.userAgent:"",T=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(b),_=/^((?!chrome|android).)*safari/i.test(b),c=/MicroMessenger/i.test(b),u=/MSIE|Trident/i.test(b);function f(z){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document;return F.querySelector(z)}function v(z){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document;return Array.from(F.querySelectorAll(z))}function l(z,F){return z.classList.add(F)}function m(z,F){return z.classList.remove(F)}function E(z,F){return z.classList.contains(F)}function S(z,F){return F instanceof Element?z.appendChild(F):z.insertAdjacentHTML("beforeend",String(F)),z.lastElementChild||z.lastChild}function O(z,F,I){return z.style[F]=I,z}function D(z,F){return Object.keys(F).forEach(function(I){O(z,I,F[I])}),z}function P(z,F){var I=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],k=window.getComputedStyle(z,null).getPropertyValue(F);return I?parseFloat(k):k}function A(z){return Array.from(z.parentElement.children).filter(function(F){return F!==z})}function w(z,F){A(z).forEach(function(I){return m(I,F)}),l(z,F)}function L(z,F){var I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"up";T||(z.setAttribute("aria-label",F),z.setAttribute("data-balloon-pos",I))}function R(z){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,I=z.getBoundingClientRect(),k=window.innerHeight||document.documentElement.clientHeight,j=window.innerWidth||document.documentElement.clientWidth,Q=I.top-F<=k&&I.top+I.height+F>=0,te=I.left-F<=j+F&&I.left+I.width+F>=0;return Q&&te}function C(z,F){return z.composedPath&&z.composedPath().indexOf(F)>-1}function M(z,F){return F.parentNode.replaceChild(z,F),z}function N(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}function U(z,F,I){return U=N()?Reflect.construct:function(k,j,Q){var te=[null];te.push.apply(te,j);var de=new(Function.bind.apply(k,te));return Q&&s(de,Q.prototype),de},U.apply(null,arguments)}function K(z){var F=typeof Map=="function"?new Map:void 0;return K=function(I){if(I===null||(k=I,Function.toString.call(k).indexOf("[native code]")===-1))return I;var k;if(typeof I!="function")throw new TypeError("Super expression must either be null or a function");if(F!==void 0){if(F.has(I))return F.get(I);F.set(I,j)}function j(){return U(I,arguments,g(this).constructor)}return j.prototype=Object.create(I.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),s(j,I)},K(z)}function V(z){var F=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}();return function(){var I,k=g(z);if(F){var j=g(this).constructor;I=Reflect.construct(k,arguments,j)}else I=k.apply(this,arguments);return x(this,I)}}var W=function(z){o(I,z);var F=V(I);function I(k,j){var Q;return r(this,I),Q=F.call(this,k),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(a(Q),j||Q.constructor),Q.name="ArtPlayerError",Q}return t(I)}(K(Error));function G(z,F){if(!z)throw new W(F);return z}function Y(z){return`WEBVTT \r
\r
`.concat(z.replace(/{[\s\S]*?}/g,"").replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").concat(`\r
\r
`))}function q(z){return URL.createObjectURL(new Blob([z],{type:"text/vtt"}))}function ee(z){var F=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function I(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return k.split(/[:.]/).map(function(j,Q,te){if(Q===te.length-1){if(j.length===1)return".".concat(j,"00");if(j.length===2)return".".concat(j,"0")}else if(j.length===1)return(Q===0?"0":":0")+j;return Q===0?j:Q===te.length-1?".".concat(j):":".concat(j)}).join("")}return`WEBVTT

`.concat(z.split(/\r?\n/).map(function(k){var j=k.match(F);return j?{start:I(j[1].trim()),end:I(j[2].trim()),text:j[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(function(Q){return Q.trim()}).join(`
`)}:null}).filter(function(k){return k}).map(function(k,j){return k?"".concat(j+1,`
`).concat(k.start," --> ").concat(k.end,`
`).concat(k.text):""}).filter(function(k){return k.trim()}).join(`

`))}function re(z){return z.includes("?")?re(z.split("?")[0]):z.includes("#")?re(z.split("#")[0]):z.trim().toLowerCase().split(".").pop()}function pe(z,F){var I=document.createElement("a");I.style.display="none",I.href=z,I.download=F,document.body.appendChild(I),I.click(),document.body.removeChild(I)}function Le(z,F){(F==null||F>z.length)&&(F=z.length);for(var I=0,k=new Array(F);I<F;I++)k[I]=z[I];return k}function Te(z){return function(F){if(Array.isArray(F))return Le(F)}(z)||function(F){if(typeof Symbol!="undefined"&&F[Symbol.iterator]!=null||F["@@iterator"]!=null)return Array.from(F)}(z)||function(F,I){if(F){if(typeof F=="string")return Le(F,I);var k=Object.prototype.toString.call(F).slice(8,-1);return k==="Object"&&F.constructor&&(k=F.constructor.name),k==="Map"||k==="Set"?Array.from(F):k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?Le(F,I):void 0}}(z)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}var be=Object.defineProperty,Re=Object.prototype.hasOwnProperty;function Se(z,F){return Re.call(z,F)}function Ge(z,F){return Object.getOwnPropertyDescriptor(z,F)}function $e(){for(var z=function(j){return j&&p(j)==="object"&&!Array.isArray(j)},F=arguments.length,I=new Array(F),k=0;k<F;k++)I[k]=arguments[k];return I.reduce(function(j,Q){return Object.keys(Q).forEach(function(te){var de=j[te],ce=Q[te];Array.isArray(de)&&Array.isArray(ce)?j[te]=de.concat.apply(de,Te(ce)):!z(de)||!z(ce)||ce instanceof Element?j[te]=ce:j[te]=$e(de,ce)}),j},{})}function st(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Promise(function(F){return setTimeout(F,z)})}function Ze(z,F){var I,k,j=!1;return function Q(){for(var te=arguments.length,de=new Array(te),ce=0;ce<te;ce++)de[ce]=arguments[ce];if(j)return I=de,void(k=this);j=!0,z.apply(this,de),setTimeout(function(){j=!1,I&&(Q.apply(k,I),I=null,k=null)},F)}}function et(z,F,I){return Math.max(Math.min(z,Math.max(F,I)),Math.min(F,I))}function ft(z){var F=Math.floor(z/3600),I=Math.floor((z-3600*F)/60),k=Math.floor(z-3600*F-60*I);return(F>0?[F,I,k]:[I,k]).map(function(j){return j<10?"0".concat(j):String(j)}).join(":")}function dt(z){return z.replace(/[&<>'"]/g,function(F){return{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[F]||F})}var ht=Object.freeze({__proto__:null,query:f,queryAll:v,addClass:l,removeClass:m,hasClass:E,append:S,remove:function(z){return z.parentNode.removeChild(z)},setStyle:O,setStyles:D,getStyle:P,sublings:A,inverseClass:w,tooltip:L,isInViewport:R,includeFromEvent:C,replaceElement:M,ArtPlayerError:W,errorHandle:G,srtToVtt:Y,vttToBlob:q,assToVtt:ee,getExt:re,download:pe,def:be,has:Se,get:Ge,mergeDeep:$e,sleep:st,debounce:function(z,F,I){var k;function j(){for(var Q=arguments.length,te=new Array(Q),de=0;de<Q;de++)te[de]=arguments[de];var ce=function(){k=null,z.apply(I,te)};clearTimeout(k),k=setTimeout(ce,F)}return j.clearTimeout=function(){clearTimeout(k)},j},throttle:Ze,clamp:et,secondToTime:ft,escape:dt,userAgent:b,isMobile:T,isSafari:_,isWechat:c,isIE:u});function He(z,F,I){return F in z?Object.defineProperty(z,F,{value:I,enumerable:!0,configurable:!0,writable:!0}):z[F]=I,z}function rt(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function xt(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?rt(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):rt(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}var pt="boolean",ot="string",Lt="number",wt="object",Pt="function";function ve(z,F,I){return G(F===ot||z instanceof Element,"".concat(I.join(".")," require '").concat(ot,"' or 'Element' type"))}var Ce={html:ve,disable:"?".concat(pt),name:"?".concat(ot),index:"?".concat(Lt),style:"?".concat(wt),click:"?".concat(Pt),mounted:"?".concat(Pt),tooltip:"?".concat(ot),width:"?".concat(Lt),selector:"?".concat("array"),onSelect:"?".concat(Pt)},ke={container:ve,url:ot,poster:ot,title:ot,type:ot,theme:ot,lang:ot,volume:Lt,isLive:pt,muted:pt,autoplay:pt,autoSize:pt,autoMini:pt,loop:pt,flip:pt,playbackRate:pt,aspectRatio:pt,screenshot:pt,setting:pt,hotkey:pt,pip:pt,mutex:pt,backdrop:pt,fullscreen:pt,fullscreenWeb:pt,subtitleOffset:pt,miniProgressBar:pt,useSSR:pt,ads:[{url:ot}],plugins:[Pt],whitelist:["".concat(ot,"|").concat(Pt,"|").concat("regexp")],layers:[Ce],contextmenu:[Ce],settings:[Ce],controls:[xt(xt({},Ce),{},{position:function(z,F,I){var k=["top","left","right"];return G(k.includes(z),"".concat(I.join(".")," only accept ").concat(k.toString()," as parameters"))}})],quality:[{default:"?".concat(pt),html:ot,url:ot}],highlight:[{time:Lt,text:ot}],thumbnails:{url:ot,number:Lt,column:Lt},subtitle:{url:ot,type:ot,style:wt,encoding:ot,bilingual:pt},moreVideoAttr:wt,icons:wt,customType:wt},Ue={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]},Je=function(){function z(F){r(this,z),this.art=F}return t(z,[{key:"state",get:function(){var F=this.art,I=F.option,k=F.constructor.kindOf;return!T||I.whitelist.some(function(j){switch(k(j)){case"string":return j==="*"||b.indexOf(j)>-1;case"function":return j(b);case"regexp":return j.test(b);default:return!1}})}}]),z}(),it=function(){function z(F){var I=this;r(this,z),this.art=F;var k=F.option,j=F.constructor,Q=F.whitelist;k.container instanceof Element?this.$container=k.container:(this.$container=f(k.container),G(this.$container,"No container element found by ".concat(k.container)));var te=this.$container.tagName.toLowerCase();G(te==="div","Unsupported container element type, only support 'div' but got '".concat(te,"'")),G(j.instances.every(function(de){return de.template.$container!==I.$container}),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=F.id,this.$original=this.$container.cloneNode(!0),Q.state?this.desktop():this.mobile()}return t(z,[{key:"query",value:function(F){return f(F,this.$container)}},{key:"desktop",value:function(){var F=this.art.option;F.useSSR||(this.$container.innerHTML=z.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),F.backdrop&&(l(this.$setting,"art-backdrop-filter"),l(this.$contextmenu,"art-backdrop-filter"),l(this.$info,"art-backdrop-filter")),T&&l(this.$player,"art-mobile")}},{key:"mobile",value:function(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video")}},{key:"destroy",value:function(F){F?M(this.$original,this.$container):l(this.$player,"art-destroy")}}],[{key:"html",get:function(){return'<div class="art-video-player art-subtitle-show art-layer-show"><video class="art-video"></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.3.1</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">xD7</div></div><div class="art-contextmenus"></div></div>'}}]),z}(),X={"Video Info":"\u7EDF\u8BA1\u4FE1\u606F",Close:"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25",Volume:"\u97F3\u91CF",Play:"\u64AD\u653E",Pause:"\u6682\u505C",Rate:"\u901F\u5EA6",Mute:"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C",Horizontal:"\u6C34\u5E73",Vertical:"\u5782\u76F4",Reconnect:"\u91CD\u65B0\u8FDE\u63A5","Hide Subtitle":"\u9690\u85CF\u5B57\u5E55","Show Subtitle":"\u663E\u793A\u5B57\u5E55","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E",Screenshot:"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B",Default:"\u9ED8\u8BA4",Normal:"\u6B63\u5E38",Open:"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55",Fullscreen:"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u753B\u4E2D\u753B\u6A21\u5F0F","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B\u6A21\u5F0F","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B\u6A21\u5F0F","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F\u6A21\u5F0F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB"},Ae={"Video Info":"\u7D71\u8A08\u8A0A\u606F",Close:"\u95DC\u9589","Video Load Failed":"\u8F09\u5165\u5931\u6557",Volume:"\u97F3\u91CF",Play:"\u64AD\u653E",Pause:"\u66AB\u505C",Rate:"\u901F\u5EA6",Mute:"\u975C\u97F3","Video Flip":"\u756B\u9762\u7FFB\u8F49",Horizontal:"\u6C34\u5E73",Vertical:"\u5782\u76F4",Reconnect:"\u91CD\u65B0\u9023\u63A5","Hide Subtitle":"\u96B1\u85CF\u5B57\u5E55","Show Subtitle":"\u986F\u793A\u5B57\u5E55","Show Setting":"\u986F\u793A\u8BBE\u7F6E","Hide Setting":"\u96B1\u85CF\u8BBE\u7F6E",Screenshot:"\u622A\u5716","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u756B\u9762\u6BD4\u4F8B",Default:"\u9ED8\u8A8D",Normal:"\u6B63\u5E38",Open:"\u6253\u958B","Switch Video":"\u5207\u63DB","Switch Subtitle":"\u5207\u63DB\u5B57\u5E55",Fullscreen:"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7DB2\u9801\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u756B\u4E2D\u756B\u6A21\u5F0F","Exit PIP Mode":"\u9000\u51FA\u756B\u4E2D\u756B\u6A21\u5F0F","PIP Not Supported":"\u4E0D\u652F\u6301\u756B\u4E2D\u756B\u6A21\u5F0F","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F\u6A21\u5F0F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB"},Me=function(){function z(F){r(this,z),this.art=F,this.languages={"zh-cn":X,"zh-tw":Ae},this.init()}return t(z,[{key:"init",value:function(){var F=this.art.option.lang.toLowerCase();this.language=this.languages[F]||{}}},{key:"get",value:function(F){return this.language[F]||F}},{key:"update",value:function(F){this.languages=$e(this.languages,F),this.init()}}]),z}(),Ke={exports:{}};(function(z){(function(){var F=typeof window!="undefined"&&window.document!==void 0?window.document:{},I=z.exports,k=function(){for(var te,de=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],ce=0,se=de.length,Ee={};ce<se;ce++)if((te=de[ce])&&te[1]in F){for(ce=0;ce<te.length;ce++)Ee[de[0][ce]]=te[ce];return Ee}return!1}(),j={change:k.fullscreenchange,error:k.fullscreenerror},Q={request:function(te,de){return new Promise(function(ce,se){var Ee=function(){this.off("change",Ee),ce()}.bind(this);this.on("change",Ee);var le=(te=te||F.documentElement)[k.requestFullscreen](de);le instanceof Promise&&le.then(Ee).catch(se)}.bind(this))},exit:function(){return new Promise(function(te,de){if(this.isFullscreen){var ce=function(){this.off("change",ce),te()}.bind(this);this.on("change",ce);var se=F[k.exitFullscreen]();se instanceof Promise&&se.then(ce).catch(de)}else te()}.bind(this))},toggle:function(te,de){return this.isFullscreen?this.exit():this.request(te,de)},onchange:function(te){this.on("change",te)},onerror:function(te){this.on("error",te)},on:function(te,de){var ce=j[te];ce&&F.addEventListener(ce,de,!1)},off:function(te,de){var ce=j[te];ce&&F.removeEventListener(ce,de,!1)},raw:k};k?(Object.defineProperties(Q,{isFullscreen:{get:function(){return Boolean(F[k.fullscreenElement])}},element:{enumerable:!0,get:function(){return F[k.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(F[k.fullscreenEnabled])}}}),I?z.exports=Q:window.screenfull=Q):I?z.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})()})(Ke);var ne=Ke.exports;function _e(z){var F=z.i18n,I=z.notice,k=z.template.$video;z.once("ready",function(){ne.isEnabled?function(j){var Q=j.notice,te=j.template.$player;ne.on("change",function(){return j.emit("fullscreen",ne.isFullscreen)}),be(j,"fullscreen",{get:function(){return ne.isFullscreen},set:function(de){de?ne.request(te).then(function(){l(te,"art-fullscreen"),j.aspectRatioReset=!0,j.autoSize=!1,j.emit("resize"),j.emit("fullscreen",!0),Q.show=""}):ne.exit().then(function(){m(te,"art-fullscreen"),j.aspectRatioReset=!0,j.autoSize=j.option.autoSize,j.emit("resize"),j.emit("fullscreen"),Q.show=""})}})}(z):document.fullscreenEnabled||k.webkitSupportsFullscreen?function(j){var Q=j.notice,te=j.template.$video;be(j,"fullscreen",{get:function(){return te.webkitDisplayingFullscreen},set:function(de){de?(te.webkitEnterFullscreen(),j.emit("fullscreen",!0),Q.show=""):(te.webkitExitFullscreen(),j.emit("fullscreen"),Q.show="")}})}(z):be(z,"fullscreen",{get:function(){return!1},set:function(){I.show=F.get("Fullscreen Not Supported")}}),be(z,"fullscreen",Ge(z,"fullscreen"))})}function H(z){var F=z.i18n,I=z.notice,k=z.template.$video;document.pictureInPictureEnabled?function(j){var Q=j.template.$video,te=j.events.proxy,de=j.notice;Q.disablePictureInPicture=!1,be(j,"pip",{get:function(){return document.pictureInPictureElement},set:function(ce){ce?Q.requestPictureInPicture().catch(function(se){throw de.show=se,se}):document.exitPictureInPicture().catch(function(se){throw de.show=se,se})}}),te(Q,"enterpictureinpicture",function(){j.emit("pip",!0)}),te(Q,"leavepictureinpicture",function(){j.emit("pip")})}(z):k.webkitSupportsPresentationMode?function(j){var Q=j.template.$video;Q.webkitSetPresentationMode("inline"),be(j,"pip",{get:function(){return Q.webkitPresentationMode==="picture-in-picture"},set:function(te){te?(Q.webkitSetPresentationMode("picture-in-picture"),j.emit("pip",!0)):(Q.webkitSetPresentationMode("inline"),j.emit("pip"))}})}(z):be(z,"pip",{get:function(){return!1},set:function(){I.show=F.get("PIP Not Supported")}})}var De=t(function z(F){r(this,z),function(I){var k=I.option,j=I.template.$video;be(I,"url",{get:function(){return j.currentSrc},set:function(Q){var te=k.type||re(Q),de=k.customType[te];te&&de?st().then(function(){I.loading.show=!0,de.call(I,j,Q,I)}):(I.url&&I.url!==Q&&I.once("video:canplay",function(){I.isReady&&I.emit("restart")}),j.src=Q,I.option.url=Q,I.emit("url",Q))}})}(F),function(I){var k=I.template.$video;be(I,"attr",{value:function(j,Q){if(Q===void 0)return k[j];k[j]=Q}})}(F),function(I){var k=I.i18n,j=I.notice,Q=I.option,te=I.constructor.instances,de=I.template.$video;be(I,"play",{value:function(){var ce=de.play();if(ce&&ce.then&&ce.then().catch(function(le){throw j.show=le,le}),Q.mutex)for(var se=0;se<te.length;se++){var Ee=te[se];Ee!==I&&Ee.pause()}return j.show=k.get("Play"),I.emit("play"),ce}})}(F),function(I){var k=I.template.$video,j=I.i18n,Q=I.notice;be(I,"pause",{value:function(){var te=k.pause();return Q.show=j.get("Pause"),I.emit("pause"),te}})}(F),function(I){be(I,"toggle",{value:function(){return I.playing?I.pause():I.play()}})}(F),function(I){var k=I.notice;be(I,"seek",{set:function(j){I.currentTime=j,I.emit("seek",I.currentTime),I.duration&&(k.show="".concat(ft(I.currentTime)," / ").concat(ft(I.duration)))}}),be(I,"forward",{set:function(j){I.seek=I.currentTime+j}}),be(I,"backward",{set:function(j){I.seek=I.currentTime-j}})}(F),function(I){var k=I.template.$video,j=I.i18n,Q=I.notice,te=I.storage;be(I,"volume",{get:function(){return k.volume||0},set:function(de){k.volume=et(de,0,1),Q.show="".concat(j.get("Volume"),": ").concat(parseInt(100*k.volume,10)),k.volume!==0&&te.set("volume",k.volume),I.emit("volume",k.volume)}}),be(I,"muted",{get:function(){return k.muted},set:function(de){k.muted=de,I.emit("volume",k.volume)}})}(F),function(I){var k=I.template.$video;be(I,"currentTime",{get:function(){return k.currentTime||0},set:function(j){j=parseFloat(j),Number.isNaN(j)||(k.currentTime=et(j,0,I.duration))}})}(F),function(I){be(I,"duration",{get:function(){var k=I.template.$video.duration;return k===1/0?0:k||0}})}(F),function(I){var k=I.i18n,j=I.option,Q=I.notice;function te(de,ce,se){return new Promise(function(Ee){if(de===I.url)return Ee(de);URL.revokeObjectURL(I.url),I.url=de,I.once("video:canplay",function(){I.playbackRate=!1,I.aspectRatio=!1,I.flip="normal",I.autoSize=j.autoSize,I.currentTime=se,I.notice.show="",I.playing&&I.play(),ce&&(Q.show="".concat(k.get("Switch Video"),": ").concat(ce)),I.emit("switch",de),Ee(de)})})}be(I,"switchQuality",{value:function(de,ce){return te(de,ce,I.currentTime)}}),be(I,"switchUrl",{value:function(de,ce){return te(de,ce,0)}})}(F),function(I){var k=I.template.$video,j=I.i18n,Q=I.notice;be(I,"playbackRate",{get:function(){return k.playbackRate},set:function(te){if(te){if(te===k.playbackRate)return;var de=[.25,.5,.75,1,1.25,1.5,1.75,2];G(de.includes(te),"'playbackRate' only accept ".concat(de.toString()," as parameters")),k.playbackRate=te,Q.show="".concat(j.get("Rate"),": ").concat(te===1?j.get("Normal"):"".concat(te,"x")),I.emit("playbackRate",te)}else I.playbackRate=1,I.emit("playbackRate")}})}(F),function(I){var k=I.template,j=k.$video,Q=k.$player,te=I.i18n,de=I.notice;be(I,"aspectRatio",{get:function(){return Q.dataset.aspectRatio||"default"},set:function(ce){ce||(ce="default");var se=["default","4:3","16:9"];if(G(se.includes(ce),"'aspectRatio' only accept ".concat(se.toString()," as parameters")),ce==="default")O(j,"width",null),O(j,"height",null),O(j,"padding",null),delete Q.dataset.aspectRatio;else{var Ee=ce.split(":").map(Number),le=j.videoWidth,Oe=j.videoHeight,Fe=Q.clientWidth,ze=Q.clientHeight,tt=le/Oe,Ne=Ee[0]/Ee[1];if(tt>Ne){var qe=Ne*Oe/le;O(j,"width","".concat(100*qe,"%")),O(j,"height","100%"),O(j,"padding","0 ".concat((Fe-Fe*qe)/2,"px"))}else{var ct=le/Ne/Oe;O(j,"width","100%"),O(j,"height","".concat(100*ct,"%")),O(j,"padding","".concat((ze-ze*ct)/2,"px 0"))}Q.dataset.aspectRatio=ce}de.show="".concat(te.get("Aspect Ratio"),": ").concat(ce==="default"?te.get("Default"):ce),I.emit("aspectRatio",ce)}}),be(I,"aspectRatioReset",{set:function(ce){if(ce){var se=I.aspectRatio;I.aspectRatio=se}}})}(F),function(I){var k=I.option,j=I.notice,Q=I.template.$video,te=document.createElement("canvas");be(I,"getDataURL",{value:function(){return new Promise(function(de,ce){try{te.width=Q.videoWidth,te.height=Q.videoHeight,te.getContext("2d").drawImage(Q,0,0),de(te.toDataURL("image/png"))}catch(se){j.show=se,ce(se)}})}}),be(I,"getBlobUrl",{value:function(){return new Promise(function(de,ce){try{te.width=Q.videoWidth,te.height=Q.videoHeight,te.getContext("2d").drawImage(Q,0,0),te.toBlob(function(se){de(URL.createObjectURL(se))})}catch(se){j.show=se,ce(se)}})}}),be(I,"screenshot",{value:function(){return I.getDataURL().then(function(de){return pe(de,"".concat(k.title||"artplayer","_").concat(ft(Q.currentTime),".png")),I.emit("screenshot",de),de})}})}(F),_e(F),function(I){var k=I.notice,j=I.template.$player;be(I,"fullscreenWeb",{get:function(){return E(j,"art-fullscreen-web")},set:function(Q){Q?(l(j,"art-fullscreen-web"),I.aspectRatioReset=!0,I.autoSize=!1,I.emit("resize"),I.emit("fullscreenWeb",!0),k.show=""):(m(j,"art-fullscreen-web"),I.aspectRatioReset=!0,I.autoSize=I.option.autoSize,I.emit("resize"),I.emit("fullscreenWeb"),k.show="")}})}(F),H(F),function(I){var k=I.template.$video;be(I,"loaded",{get:function(){return I.loadedTime/k.duration}}),be(I,"loadedTime",{get:function(){return k.buffered.length?k.buffered.end(k.buffered.length-1):0}})}(F),function(I){be(I,"played",{get:function(){return I.currentTime/I.duration}})}(F),function(I){var k=I.template.$video;be(I,"playing",{get:function(){return k.currentTime>0&&!k.paused&&!k.ended&&k.readyState>2}})}(F),function(I){var k=I.template,j=k.$container,Q=k.$player,te=k.$video;be(I,"autoSize",{get:function(){return E(j,"art-auto-size")},set:function(de){if(de){var ce=te.videoWidth,se=te.videoHeight,Ee=j.getBoundingClientRect(),le=Ee.width,Oe=Ee.height,Fe=ce/se,ze=le/Oe;if(l(j,"art-auto-size"),ze>Fe)O(Q,"width","".concat(Oe*Fe/le*100,"%")),O(Q,"height","100%");else{var tt=le/Fe/Oe*100;O(Q,"width","100%"),O(Q,"height","".concat(tt,"%"))}I.emit("autoSize",{width:I.width,height:I.height})}else m(j,"art-auto-size"),O(Q,"width",null),O(Q,"height",null),I.emit("autoSize")}})}(F),function(I){be(I,"rect",{get:function(){return I.template.$player.getBoundingClientRect()}});for(var k=["bottom","height","left","right","top","width"],j=function(te){var de=k[te];be(I,de,{get:function(){return I.rect[de]}})},Q=0;Q<k.length;Q++)j(Q);be(I,"x",{get:function(){return I.left+window.pageXOffset}}),be(I,"y",{get:function(){return I.top+window.pageYOffset}})}(F),function(I){var k=I.template.$player,j=I.i18n,Q=I.notice;be(I,"flip",{get:function(){return k.dataset.flip||"normal"},set:function(te){te||(te="normal");var de=["normal","horizontal","vertical"];G(de.includes(te),"'flip' only accept ".concat(de.toString()," as parameters")),te==="normal"?delete k.dataset.flip:(I.rotate=!1,k.dataset.flip=te);var ce=te.replace(te[0],te[0].toUpperCase());Q.show="".concat(j.get("Video Flip"),": ").concat(j.get(ce)),I.emit("flip",te)}})}(F),function(I){var k=I.i18n,j=I.option,Q=I.storage,te=I.events.proxy,de=I.template,ce=de.$player,se=de.$miniClose,Ee=de.$miniTitle,le=de.$miniHeader,Oe="",Fe=!1,ze=0,tt=0,Ne=0,qe=0;te(le,"mousedown",function(ct){Fe=!0,ze=ct.pageX,tt=ct.pageY,Ne=I.left,qe=I.top}),te(document,"mousemove",function(ct){if(Fe){l(ce,"art-is-dragging");var mt=qe+ct.pageY-tt,Tt=Ne+ct.pageX-ze;O(ce,"top","".concat(mt,"px")),O(ce,"left","".concat(Tt,"px")),Q.set("top",mt),Q.set("left",Tt)}}),te(document,"mouseup",function(){Fe=!1,m(ce,"art-is-dragging")}),te(se,"click",function(){I.mini=!1,Fe=!1,m(ce,"art-is-dragging")}),S(Ee,j.title||k.get("Mini Player")),be(I,"mini",{get:function(){return E(ce,"art-mini")},set:function(ct){if(ct){I.autoSize=!1,Oe=ce.style.cssText,l(ce,"art-mini");var mt=Q.get("top"),Tt=Q.get("left");if(mt&&Tt)O(ce,"top","".concat(mt,"px")),O(ce,"left","".concat(Tt,"px")),R(le)||(Q.del("top"),Q.del("left"),I.mini=!0);else{var Mt=document.body,ur=Mt.clientHeight-I.height-50,In=Mt.clientWidth-I.width-50;Q.set("top",ur),Q.set("left",In),O(ce,"top","".concat(ur,"px")),O(ce,"left","".concat(In,"px"))}I.aspectRatio=!1,I.playbackRate=!1,I.notice.show="",I.emit("mini",!0)}else ce.style.cssText=Oe,m(ce,"art-mini"),O(ce,"top",null),O(ce,"left",null),I.aspectRatio=!1,I.playbackRate=!1,I.autoSize=j.autoSize,I.notice.show="",I.emit("mini")}})}(F),function(I){var k=[];be(I,"loop",{get:function(){return k},set:function(j){if(Array.isArray(j)&&typeof j[0]=="number"&&typeof j[1]=="number"){var Q=et(j[0],0,Math.min(j[1],I.duration)),te=et(j[1],Q,I.duration);te-Q>=1?(k=[Q,te],I.emit("loop",k)):(k=[],I.emit("loop"))}else k=[],I.emit("loop")}}),I.on("video:timeupdate",function(){k.length&&(I.currentTime<k[0]||I.currentTime>k[1])&&(I.seek=k[0])})}(F),function(I){var k=I.option,j=I.template.$poster;be(I,"poster",{get:function(){return k.poster},set:function(Q){k.poster=Q,O(j,"backgroundImage","url(".concat(Q,")"))}})}(F),function(I){var k=I.option,j=I.template,Q=j.$container,te=j.$video,de=Q.style.height;be(I,"autoHeight",{get:function(){return E(Q,"art-auto-height")},set:function(ce){if(ce){var se=Q.clientWidth,Ee=te.videoHeight*(se/te.videoWidth);O(Q,"height",Ee+"px"),l(Q,"art-auto-height"),I.autoSize=k.autoSize,I.emit("autoHeight",Ee)}else O(Q,"height",de),m(Q,"art-auto-height"),I.autoSize=k.autoSize,I.emit("autoHeight")}})}(F),function(I){var k=I.option,j=I.template.$player;be(I,"theme",{get:function(){return getComputedStyle(j).getPropertyValue("--theme")},set:function(Q){k.theme=Q,j.style.setProperty("--theme",Q)}})}(F),function(I){be(I,"title",{get:function(){return I.option.title},set:function(k){I.option.title=k}})}(F),function(I){var k=["mini","pip","fullscreen","fullscreenWeb"];(function(j){for(var Q=function(de){var ce=j[de];I.on(ce,function(){I[ce]&&j.filter(function(se){return se!==ce}).forEach(function(se){I[se]&&(I[se]=!1)})})},te=0;te<j.length;te++)Q(te)})(k),be(I,"normalSize",{get:function(){return k.every(function(j){return!I[j]})}})}(F),function(I){var k=I.constructor.utils.clamp,j=I.notice,Q=I.template,te=I.i18n,de=0,ce=[];I.on("subtitle:switch",function(){ce=[]}),be(I,"subtitleOffset",{get:function(){return de},set:function(se){if(Q.$track&&Q.$track.track){var Ee=Array.from(Q.$track.track.cues);de=k(se,-5,5);for(var le=0;le<Ee.length;le++){var Oe=Ee[le];ce[le]||(ce[le]={startTime:Oe.startTime,endTime:Oe.endTime}),Oe.startTime=k(ce[le].startTime+de,0,I.duration),Oe.endTime=k(ce[le].endTime+de,0,I.duration)}I.subtitle.update(),j.show="".concat(te.get("Subtitle Offset"),": ").concat(se,"s"),I.emit("subtitleOffset",se)}else I.emit("subtitleOffset",0)}})}(F),function(I){var k=I.option,j=I.events.proxy,Q=I.template,te=Q.$player,de=Q.$video,ce=Q.$poster,se=I.i18n,Ee=I.notice,le=0;j(de,"click",function(){I.toggle()}),j(de,"dblclick",function(){I.fullscreen=!I.fullscreen});for(var Oe=0;Oe<Ue.events.length;Oe++)j(de,Ue.events[Oe],function(Fe){I.emit("video:".concat(Fe.type),Fe)});I.on("video:canplay",function(){le=0,I.loading.show=!1}),I.once("video:canplay",function(){I.loading.show=!1,I.controls.show=!0,I.mask.show=!0,I.isReady=!0,I.emit("ready")}),I.on("video:ended",function(){k.loop?(I.seek=0,I.play(),I.controls.show=!1,I.mask.show=!1):(I.controls.show=!0,I.mask.show=!0)}),I.on("video:error",function(){le<5?st(1e3).then(function(){le+=1,I.url=k.url,Ee.show="".concat(se.get("Reconnect"),": ").concat(le),I.emit("error",le)}):(I.loading.show=!1,I.controls.show=!1,l(te,"art-error"),st(1e3).then(function(){Ee.show=se.get("Video Load Failed"),I.destroy(!1)}))}),I.once("video:loadedmetadata",function(){I.autoSize=k.autoSize,T&&(I.loading.show=!1,I.controls.show=!0,I.mask.show=!0)}),I.on("video:loadstart",function(){I.loading.show=!0}),I.on("video:pause",function(){I.controls.show=!0,I.mask.show=!0}),I.on("video:play",function(){I.mask.show=!1,O(ce,"display","none")}),I.on("video:playing",function(){I.mask.show=!1}),I.on("video:seeked",function(){I.loading.show=!1}),I.on("video:seeking",function(){I.loading.show=!0}),I.on("video:timeupdate",function(){I.mask.show=!1}),I.on("video:waiting",function(){I.loading.show=!0})}(F),function(I){var k=I.option,j=I.storage,Q=I.template,te=Q.$video,de=Q.$poster;Object.keys(k.moreVideoAttr).forEach(function(se){I.attr(se,k.moreVideoAttr[se])}),k.muted&&(I.muted=k.muted),k.volume&&(te.volume=et(k.volume,0,1));var ce=j.get("volume");typeof ce=="number"&&(te.volume=et(ce,0,1)),k.poster&&O(de,"backgroundImage","url(".concat(k.poster,")")),k.autoplay&&(te.autoplay=k.autoplay),k.theme&&(I.theme=k.theme),k.ads.length===0&&(I.url=k.url)}(F)});function ut(z,F){for(;!Object.prototype.hasOwnProperty.call(z,F)&&(z=g(z))!==null;);return z}function B(){return B=typeof Reflect!="undefined"&&Reflect.get?Reflect.get:function(z,F,I){var k=ut(z,F);if(k){var j=Object.getOwnPropertyDescriptor(k,F);return j.get?j.get.call(arguments.length<3?z:I):j.value}},B.apply(this,arguments)}var ge=function(){function z(F){r(this,z),this.id=0,this.art=F,this.add=this.add.bind(this)}return t(z,[{key:"show",get:function(){return E(this.art.template.$player,"art-".concat(this.name,"-show"))},set:function(F){var I=this.art.template.$player,k="art-".concat(this.name,"-show");F?l(I,k):m(I,k),this.art.emit(this.name,F)}},{key:"toggle",set:function(F){F&&(this.show=!this.show)}},{key:"add",value:function(F){var I=this,k=typeof F=="function"?F(this.art):F;if(k.html=k.html||"",h(k,Ce),this.$parent&&this.name&&!k.disable){var j=k.name||"".concat(this.name).concat(this.id);G(!Se(this,j),"Cannot add an existing name [".concat(j,"] to the [").concat(this.name,"]")),this.id+=1;var Q=document.createElement("div");l(Q,"art-".concat(this.name)),l(Q,"art-".concat(this.name,"-").concat(j));var te=Array.from(this.$parent.children);Q.dataset.index=k.index||this.id;var de=te.find(function(ce){return Number(ce.dataset.index)>=Number(Q.dataset.index)});return de?de.insertAdjacentElement("beforebegin",Q):S(this.$parent,Q),k.html&&S(Q,k.html),k.style&&D(Q,k.style),k.tooltip&&L(Q,k.tooltip),k.click&&this.art.events.proxy(Q,"click",function(ce){ce.preventDefault(),k.click.call(I.art,I,ce)}),k.selector&&["left","right"].includes(k.position)&&this.selector(k,Q),k.mounted&&k.mounted.call(this.art,Q),Q.childNodes.length===1&&Q.childNodes[0].nodeType===3&&l(Q,"art-control-onlyText"),be(this,j,{value:Q}),Q}}},{key:"selector",value:function(F,I){var k=this,j=this.art.events,Q=j.hover,te=j.proxy;l(I,"art-control-selector");var de=document.createElement("div");l(de,"art-selector-value"),S(de,F.html),I.innerText="",S(I,de);var ce=F.selector.map(function(le,Oe){return'<div class="art-selector-item '.concat(le.default?"art-current":"",'" data-index="').concat(Oe,'">').concat(le.html,"</div>")}).join(""),se=document.createElement("div");l(se,"art-selector-list"),S(se,ce),S(I,se);var Ee=function(){var le=P(I,"width")/2-P(se,"width")/2;se.style.left="".concat(le,"px")};Q(I,Ee),te(se,"click",function(le){var Oe=(le.composedPath()||[]).find(function(Ne){return E(Ne,"art-selector-item")});if(Oe){w(Oe,"art-current");var Fe=Number(Oe.dataset.index),ze=F.selector[Fe]||{};if(de.innerText=Oe.innerText,F.onSelect){var tt=F.onSelect.call(k.art,ze,Oe,le);typeof tt!="string"&&typeof tt!="number"||(de.innerHTML=tt)}Ee(),k.art.emit("selector",ze,Oe)}})}}]),z}();function xe(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function $(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?xe(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):xe(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function ae(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function me(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?ae(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):ae(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function at(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function Xe(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?at(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):at(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function Qe(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function bt(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?Qe(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):Qe(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function lr(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function Nt(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?lr(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):lr(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function St(z,F){var I=z.template.$progress,k=I.getBoundingClientRect().left,j=et((typeof F.pageX=="number"?F.pageX:F.touches[0].clientX)-k,0,I.clientWidth),Q=j/I.clientWidth*z.duration;return{second:Q,time:ft(Q),width:j,percentage:et(j/I.clientWidth,0,1)}}function Wt(z){return function(F){var I=F.icons,k=F.option,j=F.events.proxy;return Nt(Nt({},z),{},{html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:function(Q){var te=!1,de=f(".art-progress-loaded",Q),ce=f(".art-progress-played",Q),se=f(".art-progress-highlight",Q),Ee=f(".art-progress-indicator",Q),le=f(".art-progress-tip",Q);O(ce,"backgroundColor","var(--theme)");var Oe=14;function Fe(qe,ct){qe==="loaded"&&O(de,"width","".concat(100*ct,"%")),qe==="played"&&(O(ce,"width","".concat(100*ct,"%")),O(Ee,"left","calc(".concat(100*ct,"% - ").concat(Oe/2,"px)")))}I.indicator?(Oe=16,S(Ee,I.indicator)):D(Ee,{backgroundColor:"var(--theme)"}),D(Ee,{left:"-".concat(Oe/2,"px"),width:"".concat(Oe,"px"),height:"".concat(Oe,"px")});for(var ze=0;ze<k.highlight.length;ze++){var tt=k.highlight[ze],Ne=et(tt.time,0,F.duration)/F.duration*100;S(se,'<span data-text="'.concat(tt.text,'" data-time="').concat(tt.time,'" style="left: ').concat(Ne,'%"></span>'))}Fe("loaded",F.loaded),F.on("video:progress",function(){Fe("loaded",F.loaded)}),F.on("video:timeupdate",function(){Fe("played",F.played)}),F.on("video:ended",function(){Fe("played",1)}),j(Q,"mousemove",function(qe){O(le,"display","block"),C(qe,se)?function(ct){var mt=St(F,ct).width,Tt=ct.target.dataset.text;le.innerHTML=Tt;var Mt=le.clientWidth;mt<=Mt/2?O(le,"left",0):mt>Q.clientWidth-Mt/2?O(le,"left","".concat(Q.clientWidth-Mt,"px")):O(le,"left","".concat(mt-Mt/2,"px"))}(qe):function(ct){var mt=St(F,ct),Tt=mt.width,Mt=mt.time;le.innerHTML=Mt;var ur=le.clientWidth;Tt<=ur/2?O(le,"left",0):Tt>Q.clientWidth-ur/2?O(le,"left","".concat(Q.clientWidth-ur,"px")):O(le,"left","".concat(Tt-ur/2,"px"))}(qe)}),j(Q,"mouseout",function(){O(le,"display","none")}),j(Q,"click",function(qe){if(qe.target!==Ee){var ct=St(F,qe),mt=ct.second;Fe("played",ct.percentage),F.seek=mt}}),j(Ee,"mousedown",function(){te=!0}),j(document,"mousemove",function(qe){if(te){var ct=St(F,qe),mt=ct.second;Fe("played",ct.percentage),F.seek=mt}}),j(document,"mouseup",function(){te&&(te=!1)}),j(Ee,"touchstart",function(qe){qe.touches.length===1&&(te=!0)}),j(document,"touchmove",function(qe){if(qe.touches.length===1&&te){var ct=St(F,qe),mt=ct.second;Fe("played",ct.percentage),F.seek=mt}}),j(document,"touchend",function(){te&&(te=!1)})}})}}function Zt(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function qt(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?Zt(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):Zt(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function _n(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function xn(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?_n(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):_n(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function Ft(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function ir(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?Ft(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):Ft(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function Gt(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function Sr(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?Gt(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):Gt(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function yr(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function Zn(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?yr(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):yr(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function $o(z){return function(F){return Zn(Zn({},z),{},{mounted:function(I){var k=F.option,j=F.template,Q=j.$progress,te=j.$video,de=F.events,ce=de.proxy,se=de.loadImg,Ee=null,le=!1,Oe=!1;ce(Q,"mousemove",function(Fe){le||(le=!0,se(k.thumbnails.url).then(function(ze){Ee=ze,Oe=!0})),Oe&&(O(I,"display","block"),function(ze){var tt=St(F,ze).width,Ne=k.thumbnails,qe=Ne.url,ct=Ne.number,mt=Ne.column,Tt=Ee.naturalWidth/mt,Mt=Tt/(te.videoWidth/te.videoHeight),ur=Q.clientWidth/ct,In=Math.floor(tt/ur),bp=Math.ceil(In/mt)-1,Sp=In%mt||mt-1;O(I,"backgroundImage","url(".concat(qe,")")),O(I,"height","".concat(Mt,"px")),O(I,"width","".concat(Tt,"px")),O(I,"backgroundPosition","-".concat(Sp*Tt,"px -").concat(bp*Mt,"px")),tt<=Tt/2?O(I,"left",0):tt>Q.clientWidth-Tt/2?O(I,"left","".concat(Q.clientWidth-Tt,"px")):O(I,"left","".concat(tt-Tt/2,"px"))}(Fe))}),ce(Q,"mouseout",function(){O(I,"display","none")})}})}}function ia(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function Cn(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?ia(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):ia(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function aa(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function bn(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?aa(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):aa(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function as(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function Qn(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?as(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):as(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function sa(z){var F=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}();return function(){var I,k=g(z);if(F){var j=g(this).constructor;I=Reflect.construct(k,arguments,j)}else I=k.apply(this,arguments);return x(this,I)}}var Yo=function(z){o(I,z);var F=sa(I);function I(k){var j;r(this,I),(j=F.call(this,k)).name="control";var Q=k.option,te=k.template.$player;return j.mouseMoveTime=Date.now(),k.on("mousemove",function(){j.show=!0,m(te,"art-hide-cursor"),l(te,"art-hover"),j.mouseMoveTime=Date.now()}),k.on("video:timeupdate",function(){k.playing&&j.show&&Date.now()-j.mouseMoveTime>=3e3&&(j.show=!1,l(te,"art-hide-cursor"),m(te,"art-hover"))}),k.once("ready",function(){j.add(Wt({name:"progress",disable:Q.isLive,position:"top",index:10})),j.add($o({name:"thumbnails",disable:!Q.thumbnails.url||Q.isLive,position:"top",index:20})),j.add(function(ce){return function(se){return Qn(Qn({},ce),{},{mounted:function(Ee){var le=S(Ee,'<span class="art-loop-point"></span>'),Oe=S(Ee,'<span class="art-loop-point"></span>');se.on("loop",function(Fe){Fe?(O(Ee,"display","block"),O(le,"left","calc(".concat(Fe[0]/se.duration*100,"% - ").concat(le.clientWidth,"px)")),O(Oe,"left","".concat(Fe[1]/se.duration*100,"%"))):O(Ee,"display","none")})}})}}({name:"loop",disable:!1,position:"top",index:30})),j.add(function(ce){return function(se){return bt(bt({},ce),{},{mounted:function(Ee){var le=se.events.proxy,Oe=se.icons,Fe=se.i18n,ze=S(Ee,Oe.play),tt=S(Ee,Oe.pause);function Ne(){O(ze,"display","flex"),O(tt,"display","none")}function qe(){O(ze,"display","none"),O(tt,"display","flex")}L(ze,Fe.get("Play")),L(tt,Fe.get("Pause")),le(ze,"click",function(){se.play()}),le(tt,"click",function(){se.pause()}),se.playing?qe():Ne(),se.on("video:playing",function(){qe()}),se.on("video:pause",function(){Ne()})}})}}({name:"playAndPause",disable:!1,position:"left",index:10})),j.add(function(ce){return function(se){return ir(ir({},ce),{},{mounted:function(Ee){var le=se.events.proxy,Oe=se.icons,Fe=se.i18n,ze=!1,tt=S(Ee,Oe.volume),Ne=S(Ee,Oe.volumeClose),qe=S(Ee,'<div class="art-volume-panel"></div>'),ct=S(qe,'<div class="art-volume-slider-handle"></div>');function mt(Mt){var ur=qe.getBoundingClientRect().left;return et(Mt.pageX-ur-6,0,54)/48}function Tt(){var Mt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.7;if(se.muted||Mt===0)O(tt,"display","none"),O(Ne,"display","flex"),O(ct,"left","0");else{var ur=48*Mt;O(tt,"display","flex"),O(Ne,"display","none"),O(ct,"left","".concat(ur,"px"))}}L(tt,Fe.get("Mute")),O(Ne,"display","none"),T&&O(qe,"display","none"),Tt(se.volume),se.on("video:volumechange",function(){Tt(se.volume)}),le(tt,"click",function(){se.muted=!0}),le(Ne,"click",function(){se.muted=!1}),le(qe,"click",function(Mt){se.muted=!1,se.volume=mt(Mt)}),le(ct,"mousedown",function(){ze=!0}),le(Ee,"mousemove",function(Mt){ze&&(se.muted=!1,se.volume=mt(Mt))}),le(document,"mouseup",function(){ze&&(ze=!1)})}})}}({name:"volume",disable:!1,position:"left",index:20})),j.add(function(ce){return function(se){return xn(xn({},ce),{},{mounted:function(Ee){function le(){var ze="".concat(ft(se.currentTime)," / ").concat(ft(se.duration));ze!==Ee.innerText&&(Ee.innerText=ze)}le();for(var Oe=["video:loadedmetadata","video:timeupdate","video:progress"],Fe=0;Fe<Oe.length;Fe++)se.on(Oe[Fe],le)}})}}({name:"time",disable:Q.isLive,position:"left",index:30})),j.add(function(ce){return function(se){var Ee=se.option.quality,le=Ee.find(function(Oe){return Oe.default})||Ee[0];return bn(bn({},ce),{},{html:le?le.html:"",selector:Ee,onSelect:function(Oe){se.switchQuality(Oe.url,Oe.html)}})}}({name:"quality",disable:Q.quality.length===0,position:"right",index:10})),j.add(function(ce){return function(se){return Cn(Cn({},ce),{},{tooltip:se.i18n.get("Screenshot"),mounted:function(Ee){var le=se.events.proxy;S(Ee,se.icons.screenshot),le(Ee,"click",function(){se.screenshot()})}})}}({name:"screenshot",disable:!Q.screenshot,position:"right",index:20})),j.add(function(ce){return function(se){return qt(qt({},ce),{},{tooltip:se.i18n.get("Hide Subtitle"),mounted:function(Ee){var le=se.events.proxy,Oe=se.icons,Fe=se.i18n,ze=se.subtitle;S(Ee,Oe.subtitle),le(Ee,"click",function(){ze.toggle=!0}),se.on("subtitle",function(tt){L(Ee,Fe.get(tt?"Hide Subtitle":"Show Subtitle"))})}})}}({name:"subtitle",disable:!Q.subtitle.url,position:"right",index:30})),j.add(function(ce){return function(se){return Sr(Sr({},ce),{},{tooltip:se.i18n.get("Show Setting"),mounted:function(Ee){var le=se.events.proxy,Oe=se.icons,Fe=se.i18n,ze=se.setting;S(Ee,Oe.setting),le(Ee,"click",function(){ze.toggle=!0}),se.on("setting",function(tt){L(Ee,Fe.get(tt?"Hide Setting":"Show Setting"))})}})}}({name:"setting",disable:!Q.setting,position:"right",index:40})),j.add(function(ce){return function(se){return Xe(Xe({},ce),{},{tooltip:se.i18n.get("PIP Mode"),mounted:function(Ee){var le=se.events.proxy,Oe=se.icons,Fe=se.i18n;S(Ee,Oe.pip),le(Ee,"click",function(){se.pip=!se.pip}),se.on("pip",function(ze){L(Ee,Fe.get(ze?"Exit PIP Mode":"PIP Mode"))})}})}}({name:"pip",disable:!Q.pip,position:"right",index:50})),j.add(function(ce){return function(se){return me(me({},ce),{},{tooltip:se.i18n.get("Web Fullscreen"),mounted:function(Ee){var le=se.events.proxy,Oe=se.icons,Fe=se.i18n;S(Ee,Oe.fullscreenWeb),le(Ee,"click",function(){se.fullscreenWeb=!se.fullscreenWeb}),se.on("fullscreenWeb",function(ze){L(Ee,Fe.get(ze?"Exit Web Fullscreen":"Web Fullscreen"))})}})}}({name:"fullscreenWeb",disable:!Q.fullscreenWeb,position:"right",index:60})),j.add(function(ce){return function(se){return $($({},ce),{},{tooltip:se.i18n.get("Fullscreen"),mounted:function(Ee){var le=se.events.proxy,Oe=se.icons,Fe=se.i18n;S(Ee,Oe.fullscreen),le(Ee,"click",function(){se.fullscreen=!se.fullscreen}),se.on("fullscreen",function(ze){L(Ee,Fe.get(ze?"Exit Fullscreen":"Fullscreen"))})}})}}({name:"fullscreen",disable:!Q.fullscreen,position:"right",index:70}));for(var de=0;de<Q.controls.length;de++)j.add(Q.controls[de])}),j}return t(I,[{key:"add",value:function(k){var j=typeof k=="function"?k(this.art):k,Q=this.art.template,te=Q.$progress,de=Q.$controlsLeft,ce=Q.$controlsRight;switch(j.position){case"top":this.$parent=te;break;case"left":this.$parent=de;break;case"right":this.$parent=ce;break;default:G(!1,"Control option.position must one of 'top', 'left', 'right'")}B(g(I.prototype),"add",this).call(this,j)}}]),I}(ge);function ss(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function xi(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?ss(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):ss(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function os(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function ls(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?os(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):os(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function Z(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function ie(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?Z(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):Z(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function J(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function fe(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?J(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):J(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function he(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function ue(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?he(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):he(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function we(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function Be(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?we(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):we(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function je(z){var F=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}();return function(){var I,k=g(z);if(F){var j=g(this).constructor;I=Reflect.construct(k,arguments,j)}else I=k.apply(this,arguments);return x(this,I)}}var We=function(z){o(I,z);var F=je(I);function I(k){var j;return r(this,I),(j=F.call(this,k)).art=k,j.name="contextmenu",j.$parent=k.template.$contextmenu,k.once("ready",function(){T||j.init()}),j}return t(I,[{key:"init",value:function(){var k=this,j=this.art,Q=j.option,te=j.template,de=te.$player,ce=te.$contextmenu,se=j.events.proxy;this.add(function(le){return function(Oe){var Fe=Oe.i18n;return xi(xi({},le),{},{html:"".concat(Fe.get("Play Speed"),':<span data-value="0.5">0.5</span><span data-value="0.75">0.75</span><span data-value="1.0" class="art-current">').concat(Fe.get("Normal"),'</span><span data-value="1.25">1.25</span><span data-value="1.5">1.5</span><span data-value="2.0">2.0</span>'),click:function(ze,tt){var Ne=tt.target.dataset.value;Ne&&(Oe.playbackRate=Number(Ne),ze.show=!1)},mounted:function(ze){Oe.on("playbackRate",function(tt){var Ne=v("span",ze).find(function(qe){return Number(qe.dataset.value)===tt});Ne&&w(Ne,"art-current")})}})}}({disable:!Q.playbackRate,name:"playbackRate",index:10})),this.add(function(le){return function(Oe){var Fe=Oe.i18n;return ls(ls({},le),{},{html:"".concat(Fe.get("Aspect Ratio"),':<span data-value="default" class="art-current">').concat(Fe.get("Default"),'</span><span data-value="4:3">4:3</span><span data-value="16:9">16:9</span>'),click:function(ze,tt){var Ne=tt.target.dataset.value;Ne&&(Oe.aspectRatio=Ne,ze.show=!1)},mounted:function(ze){Oe.on("aspectRatio",function(tt){var Ne=v("span",ze).find(function(qe){return qe.dataset.value===tt});Ne&&w(Ne,"art-current")})}})}}({disable:!Q.aspectRatio,name:"aspectRatio",index:20})),this.add(function(le){return function(Oe){var Fe=Oe.i18n;return ie(ie({},le),{},{html:"".concat(Fe.get("Video Flip"),':<span data-value="normal" class="art-current">').concat(Fe.get("Normal"),'</span><span data-value="horizontal">').concat(Fe.get("Horizontal"),'</span><span data-value="vertical">').concat(Fe.get("Vertical"),"</span>"),click:function(ze,tt){var Ne=tt.target.dataset.value;Ne&&(Oe.flip=Ne,ze.show=!1)},mounted:function(ze){Oe.on("flip",function(tt){var Ne=v("span",ze).find(function(qe){return qe.dataset.value===tt});Ne&&w(Ne,"art-current")})}})}}({disable:!Q.flip,name:"flip",index:30})),this.add(function(le){return function(Oe){return fe(fe({},le),{},{html:Oe.i18n.get("Video Info"),click:function(Fe){Oe.info.show=!0,Fe.show=!1}})}}({disable:!1,name:"info",index:40})),this.add(function(le){return ue(ue({},le),{},{html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.3.1</a>'})}({disable:!1,name:"version",index:50})),this.add(function(le){return function(Oe){return Be(Be({},le),{},{html:Oe.i18n.get("Close"),click:function(Fe){Fe.show=!1}})}}({disable:!1,name:"close",index:60}));for(var Ee=0;Ee<Q.contextmenu.length;Ee++)this.add(Q.contextmenu[Ee]);se(de,"contextmenu",function(le){le.preventDefault(),k.show=!0;var Oe=le.clientX,Fe=le.clientY,ze=de.getBoundingClientRect(),tt=ze.height,Ne=ze.width,qe=ze.left,ct=ze.top,mt=ce.getBoundingClientRect(),Tt=mt.height,Mt=mt.width,ur=Oe-qe,In=Fe-ct;Oe+Mt>qe+Ne&&(ur=Ne-Mt),Fe+Tt>ct+tt&&(In=tt-Tt),D(ce,{top:"".concat(In,"px"),left:"".concat(ur,"px")})}),se(de,"click",function(le){C(le,ce)||(k.show=!1)}),this.art.on("blur",function(){k.show=!1})}}]),I}(ge);function Ve(z){var F=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}();return function(){var I,k=g(z);if(F){var j=g(this).constructor;I=Reflect.construct(k,arguments,j)}else I=k.apply(this,arguments);return x(this,I)}}var lt=function(z){o(I,z);var F=Ve(I);function I(k){var j;return r(this,I),(j=F.call(this,k)).name="info",k.once("ready",function(){T||j.init()}),j}return t(I,[{key:"init",value:function(){var k=this,j=this.art,Q=j.events.proxy,te=j.template,de=te.$infoPanel,ce=te.$infoClose,se=te.$video;Q(ce,"click",function(){k.show=!1});var Ee=null,le=v("[data-video]",de)||[];this.art.on("destroy",function(){clearTimeout(Ee)}),function Oe(){for(var Fe=0;Fe<le.length;Fe++){var ze=le[Fe],tt=se[ze.dataset.video],Ne=typeof tt=="number"?tt.toFixed(2):tt;ze.innerText!==Ne&&(ze.innerText=Ne)}Ee=setTimeout(Oe,1e3)}()}}]),I}(ge);function At(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}function Dt(z){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?At(Object(I),!0).forEach(function(k){He(z,k,I[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(I)):At(Object(I)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(I,k))})}return z}function Ct(z){var F=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}();return function(){var I,k=g(z);if(F){var j=g(this).constructor;I=Reflect.construct(k,arguments,j)}else I=k.apply(this,arguments);return x(this,I)}}var Ht=function(z){o(I,z);var F=Ct(I);function I(k){var j;return r(this,I),(j=F.call(this,k)).name="subtitle",k.once("ready",function(){j.init(k.option.subtitle)}),j}return t(I,[{key:"url",get:function(){return this.art.template.$track.src},set:function(k){this.switch(k)}},{key:"textTrack",get:function(){return this.art.template.$video.textTracks[0]}},{key:"activeCue",get:function(){return this.textTrack.activeCues[0]}},{key:"bilingual",get:function(){return E(this.art.template.$subtitle,"art-bilingual")},set:function(k){var j=this.art.template.$subtitle;k?l(j,"art-bilingual"):m(j,"art-bilingual")}},{key:"style",value:function(k,j){var Q=this.art.template.$subtitle;return p(k)==="object"?D(Q,k):O(Q,k,j)}},{key:"update",value:function(){var k=this.art.template.$subtitle;k.innerHTML="",this.activeCue&&(k.innerHTML=this.activeCue.text.split(/\r?\n/).map(function(j){return"<p>".concat(dt(j),"</p>")}).join(""),this.art.emit("subtitleUpdate",this.activeCue.text))}},{key:"switch",value:function(k){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Q=this.art,te=Q.i18n,de=Q.notice,ce=Q.option,se=Dt(Dt(Dt({},ce.subtitle),j),{},{url:k});return this.init(se).then(function(Ee){return j.name&&(de.show="".concat(te.get("Switch Subtitle"),": ").concat(j.name)),Ee})}},{key:"init",value:function(k){var j=this;if(h(k,ke.subtitle),k.url){var Q=this.art,te=Q.notice,de=Q.events.proxy,ce=Q.template,se=ce.$subtitle,Ee=ce.$video;if(!ce.$track){var le=document.createElement("track");le.default=!0,le.kind="metadata",Ee.appendChild(le),this.art.template.$track=le,de(this.textTrack,"cuechange",this.update.bind(this))}return this.style(k.style),this.bilingual=k.bilingual,G(window.fetch,"fetch not support"),fetch(k.url).then(function(Oe){return Oe.arrayBuffer()}).then(function(Oe){G(window.TextDecoder,"TextDecoder not support");var Fe=new TextDecoder(k.encoding).decode(Oe);switch(j.art.emit("subtitleLoad",k.url),k.type||re(k.url)){case"srt":return q(Y(Fe));case"ass":return q(ee(Fe));case"vtt":return q(Fe);default:return k.url}}).then(function(Oe){return se.innerHTML="",j.url===Oe||(URL.revokeObjectURL(j.url),j.art.template.$track.src=Oe,j.art.emit("subtitleSwitch",Oe)),Oe}).catch(function(Oe){throw te.show=Oe,Oe})}}}]),I}(ge),zt=function(){function z(F){var I=this;r(this,z),this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),F.whitelist.state&&F.once("ready",function(){(function(k,j){var Q=k.template.$player;j.proxy(document,["click","contextmenu"],function(te){C(te,Q)?(k.isFocus=!0,k.emit("focus")):(k.isFocus=!1,k.emit("blur"))})})(F,I),function(k,j){var Q=k.template.$player;j.hover(Q,function(){l(Q,"art-hover"),k.emit("hover",!0)},function(){m(Q,"art-hover"),k.emit("hover")})}(F,I),function(k,j){var Q=k.template.$player;j.proxy(Q,"mousemove",function(te){k.emit("mousemove",te)})}(F,I),function(k,j){var Q=k.notice,te=k.option,de=Ze(function(){k.normalSize&&(k.autoSize=te.autoSize),k.aspectRatioReset=!0,Q.show="",k.emit("resize")},500);j.proxy(window,["orientationchange","resize"],function(){de()}),screen&&screen.orientation&&screen.orientation.onchange&&j.proxy(screen.orientation,"change",function(){de()})}(F,I),function(k,j){if(T&&!k.option.isLive){var Q=k.notice,te=k.template.$video,de=!1,ce=0,se=0;j.proxy(te,"touchstart",function(Ee){Ee.touches.length===1&&(de=!0,ce=Ee.touches[0].clientX)}),j.proxy(te,"touchmove",function(Ee){if(Ee.touches.length===1&&de){var le=et((Ee.touches[0].clientX-ce)/te.clientWidth,-1,1);se=et(k.currentTime+k.duration*le,0,k.duration),Q.show="".concat(ft(se)," / ").concat(ft(k.duration))}}),j.proxy(document,"touchend",function(){de&&se&&(k.seek=se),de=!1,ce=0,se=0})}}(F,I),function(k,j){var Q=k.option,te=k.template.$container,de=Ze(function(){k.emit("view",R(te,50))},200);j.proxy(window,"scroll",function(){de()}),k.on("view",function(ce){Q.autoMini&&(k.mini=!ce)})}(F,I)})}return t(z,[{key:"proxy",value:function(F,I,k){var j=this,Q=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(Array.isArray(I))return I.map(function(de){return j.proxy(F,de,k,Q)});F.addEventListener(I,k,Q);var te=function(){return F.removeEventListener(I,k,Q)};return this.destroyEvents.push(te),te}},{key:"hover",value:function(F,I,k){I&&this.proxy(F,"mouseenter",I),k&&this.proxy(F,"mouseleave",k)}},{key:"loadImg",value:function(F){var I=this;return new Promise(function(k,j){var Q;if(F instanceof HTMLImageElement)Q=F;else{if(typeof F!="string")return j(new W("Unable to get Image"));(Q=new Image).src=F}if(Q.complete)return k(Q);I.proxy(Q,"load",function(){return k(Q)}),I.proxy(Q,"error",function(){return j(new W("Failed to load Image: ".concat(Q.src)))})})}},{key:"destroy",value:function(){for(var F=0;F<this.destroyEvents.length;F++)this.destroyEvents[F]()}}]),z}(),Tr=function(){function z(F){var I=this;r(this,z),this.art=F,this.keys={},F.once("ready",function(){F.option.hotkey&&!T&&I.init()})}return t(z,[{key:"init",value:function(){var F=this,I=this.art.events.proxy;this.add(27,function(){F.art.fullscreenWeb&&(F.art.fullscreenWeb=!1)}),this.add(32,function(){F.art.toggle()}),this.add(37,function(){F.art.backward=5}),this.add(38,function(){F.art.volume+=.1}),this.add(39,function(){F.art.forward=5}),this.add(40,function(){F.art.volume-=.1}),I(window,"keydown",function(k){if(F.art.isFocus){var j=document.activeElement.tagName.toUpperCase(),Q=document.activeElement.getAttribute("contenteditable");if(j!=="INPUT"&&j!=="TEXTAREA"&&Q!==""&&Q!=="true"){var te=F.keys[k.keyCode];if(te){k.preventDefault();for(var de=0;de<te.length;de++)te[de].call(F.art,k);F.art.emit("hotkey",k)}}}})}},{key:"add",value:function(F,I){return this.keys[F]?this.keys[F].push(I):this.keys[F]=[I],this}},{key:"remove",value:function(F,I){if(this.keys[F]){var k=this.keys[F].indexOf(I);k!==-1&&this.keys[F].splice(k,1)}return this}}]),z}();function Jn(z){var F=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}();return function(){var I,k=g(z);if(F){var j=g(this).constructor;I=Reflect.construct(k,arguments,j)}else I=k.apply(this,arguments);return x(this,I)}}var oa=function(z){o(I,z);var F=Jn(I);function I(k){var j;r(this,I),j=F.call(this,k);var Q=k.option,te=k.template.$layer;return j.name="layer",j.$parent=te,k.once("ready",function(){for(var de=0;de<Q.layers.length;de++)j.add(Q.layers[de])}),j}return t(I)}(ge);function Xo(z){var F=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}();return function(){var I,k=g(z);if(F){var j=g(this).constructor;I=Reflect.construct(k,arguments,j)}else I=k.apply(this,arguments);return x(this,I)}}var la=function(z){o(I,z);var F=Xo(I);function I(k){var j;return r(this,I),(j=F.call(this,k)).name="loading",S(k.template.$loading,k.icons.loading),j}return t(I)}(ge),Wu=function(){function z(F){r(this,z),this.art=F,this.time=2e3,this.timer=null}return t(z,[{key:"show",set:function(F){var I=this.art.template,k=I.$player,j=I.$noticeInner;if(!F)return m(k,"art-notice-show");j.innerText=F instanceof Error?F.message.trim():F,l(k,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(function(){j.innerText="",m(k,"art-notice-show")},this.time)}}]),z}();function Zo(z){var F=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}();return function(){var I,k=g(z);if(F){var j=g(this).constructor;I=Reflect.construct(k,arguments,j)}else I=k.apply(this,arguments);return x(this,I)}}var Qo=function(z){o(I,z);var F=Zo(I);function I(k){var j;return r(this,I),(j=F.call(this,k)).name="mask",S(k.template.$state,k.icons.state),j}return t(I)}(ge);function ua(z,F){var I=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);F&&(k=k.filter(function(j){return Object.getOwnPropertyDescriptor(z,j).enumerable})),I.push.apply(I,k)}return I}var cp=t(function z(F){var I=this;r(this,z);var k=function(j){for(var Q=1;Q<arguments.length;Q++){var te=arguments[Q]!=null?arguments[Q]:{};Q%2?ua(Object(te),!0).forEach(function(de){He(j,de,te[de])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(te)):ua(Object(te)).forEach(function(de){Object.defineProperty(j,de,Object.getOwnPropertyDescriptor(te,de))})}return j}({loading:'<svg xmlns="http://www.w3.org/2000/svg" width="50px" height="50px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><rect x="0" y="0" width="100" height="100" fill="none" class="bk"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(0 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(30 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(60 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(90 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(120 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(150 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(180 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(210 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(240 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(270 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(300 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(330 50 50) translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>',state:'<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter: drop-shadow(0px 1px 1px black);" viewBox="0 0 24 24"><path d="M20,2H4C1.8,2,0,3.8,0,6v12c0,2.2,1.8,4,4,4h16c2.2,0,4-1.8,4-4V6C24,3.8,22.2,2,20,2z M15.6,12.8L10.5,16 C9.9,16.5,9,16,9,15.2V8.8C9,8,9.9,7.5,10.5,8l5.1,3.2C16.3,11.5,16.3,12.5,15.6,12.8z"/></svg>',play:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M17.982 9.275L8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"></path></svg>',pause:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zM15 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"></path></svg>',check:'<svg xmlns="http://www.w3.org/2000/svg" height="100%" version="1.1" viewBox="0 0 24 24" width="100%"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff" /></svg>',volume:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M10.188 4.65L6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zM14.446 3.778a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"></path><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"></path></svg>',volumeClose:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"></path><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zM18.778 18.778l-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"></path></svg>',subtitle:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"/></svg>',screenshot:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50">	<path d="M 19.402344 6 C 17.019531 6 14.96875 7.679688 14.5 10.011719 L 14.097656 12 L 9 12 C 6.238281 12 4 14.238281 4 17 L 4 38 C 4 40.761719 6.238281 43 9 43 L 41 43 C 43.761719 43 46 40.761719 46 38 L 46 17 C 46 14.238281 43.761719 12 41 12 L 35.902344 12 L 35.5 10.011719 C 35.03125 7.679688 32.980469 6 30.597656 6 Z M 25 17 C 30.519531 17 35 21.480469 35 27 C 35 32.519531 30.519531 37 25 37 C 19.480469 37 15 32.519531 15 27 C 15 21.480469 19.480469 17 25 17 Z M 25 19 C 20.589844 19 17 22.589844 17 27 C 17 31.410156 20.589844 35 25 35 C 29.410156 35 33 31.410156 33 27 C 33 22.589844 29.410156 19 25 19 Z "/></svg>',setting:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><circle cx="11" cy="11" r="2"></circle><path d="M19.164 8.861L17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"></path></svg>',fullscreen:'<svg xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36">	<path d="m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z"></path>	<path d="m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z"></path>	<path d="m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z"></path>	<path d="M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z"></path></svg>',fullscreenWeb:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="36" width="36">	<path d="m 28,11 0,14 -20,0 0,-14 z m -18,2 16,0 0,10 -16,0 0,-10 z" fill-rule="evenodd"></path></svg>',pip:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25,17 L17,17 L17,23 L25,23 L25,17 L25,17 Z M29,25 L29,10.98 C29,9.88 28.1,9 27,9 L9,9 C7.9,9 7,9.88 7,10.98 L7,25 C7,26.1 7.9,27 9,27 L27,27 C28.1,27 29,26.1 29,25 L29,25 Z M27,25.02 L9,25.02 L9,10.97 L27,10.97 L27,25.02 L27,25.02 Z"></path></svg>',arrowLeft:'<svg xmlns="http://www.w3.org/2000/svg" height="100%" version="1.1" viewBox="0 0 32 32" width="100%"><path d="M 19.41,20.09 14.83,15.5 19.41,10.91 18,9.5 l -6,6 6,6 z" fill="#fff" /></svg>',arrowRight:'<svg xmlns="http://www.w3.org/2000/svg" height="100%" version="1.1" viewBox="0 0 32 32" width="100%"><path d="m 12.59,20.34 4.58,-4.59 -4.58,-4.59 1.41,-1.41 6,6 -6,6 z" fill="#fff"/></svg>',playbackRate:'<svg height="24" viewBox="0 0 24 24" width="24"><path d="M10,8v8l6-4L10,8L10,8z M6.3,5L5.7,4.2C7.2,3,9,2.2,11,2l0.1,1C9.3,3.2,7.7,3.9,6.3,5z            M5,6.3L4.2,5.7C3,7.2,2.2,9,2,11 l1,.1C3.2,9.3,3.9,7.7,5,6.3z            M5,17.7c-1.1-1.4-1.8-3.1-2-4.8L2,13c0.2,2,1,3.8,2.2,5.4L5,17.7z            M11.1,21c-1.8-0.2-3.4-0.9-4.8-2 l-0.6,.8C7.2,21,9,21.8,11,22L11.1,21z            M22,12c0-5.2-3.9-9.4-9-10l-0.1,1c4.6,.5,8.1,4.3,8.1,9s-3.5,8.5-8.1,9l0.1,1 C18.2,21.5,22,17.2,22,12z" fill="white" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#a8a6a4;"></path></svg>',aspectRatio:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" width="88" height="88" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);"><defs><clipPath id="__lottie_element_216"><rect width="88" height="88" x="0" y="0"></rect></clipPath></defs><g clip-path="url(#__lottie_element_216)"><g transform="matrix(1,0,0,1,44,44)" opacity="1" style="display: block;"><g opacity="1" transform="matrix(1,0,0,1,0,0)"><path fill="rgb(255,255,255)" fill-opacity="1" d=" M12.437999725341797,-12.70199966430664 C12.437999725341797,-12.70199966430664 9.618000030517578,-9.881999969482422 9.618000030517578,-9.881999969482422 C8.82800006866455,-9.092000007629395 8.82800006866455,-7.831999778747559 9.618000030517578,-7.052000045776367 C9.618000030517578,-7.052000045776367 16.687999725341797,0.017999999225139618 16.687999725341797,0.017999999225139618 C16.687999725341797,0.017999999225139618 9.618000030517578,7.0879998207092285 9.618000030517578,7.0879998207092285 C8.82800006866455,7.877999782562256 8.82800006866455,9.137999534606934 9.618000030517578,9.918000221252441 C9.618000030517578,9.918000221252441 12.437999725341797,12.748000144958496 12.437999725341797,12.748000144958496 C13.227999687194824,13.527999877929688 14.48799991607666,13.527999877929688 15.267999649047852,12.748000144958496 C15.267999649047852,12.748000144958496 26.58799934387207,1.437999963760376 26.58799934387207,1.437999963760376 C27.368000030517578,0.6579999923706055 27.368000030517578,-0.6119999885559082 26.58799934387207,-1.3919999599456787 C26.58799934387207,-1.3919999599456787 15.267999649047852,-12.70199966430664 15.267999649047852,-12.70199966430664 C14.48799991607666,-13.491999626159668 13.227999687194824,-13.491999626159668 12.437999725341797,-12.70199966430664z M-12.442000389099121,-12.70199966430664 C-13.182000160217285,-13.442000389099121 -14.362000465393066,-13.482000350952148 -15.142000198364258,-12.821999549865723 C-15.142000198364258,-12.821999549865723 -15.272000312805176,-12.70199966430664 -15.272000312805176,-12.70199966430664 C-15.272000312805176,-12.70199966430664 -26.582000732421875,-1.3919999599456787 -26.582000732421875,-1.3919999599456787 C-27.32200050354004,-0.6520000100135803 -27.36199951171875,0.5180000066757202 -26.70199966430664,1.3079999685287476 C-26.70199966430664,1.3079999685287476 -26.582000732421875,1.437999963760376 -26.582000732421875,1.437999963760376 C-26.582000732421875,1.437999963760376 -15.272000312805176,12.748000144958496 -15.272000312805176,12.748000144958496 C-14.531999588012695,13.48799991607666 -13.362000465393066,13.527999877929688 -12.571999549865723,12.868000030517578 C-12.571999549865723,12.868000030517578 -12.442000389099121,12.748000144958496 -12.442000389099121,12.748000144958496 C-12.442000389099121,12.748000144958496 -9.612000465393066,9.918000221252441 -9.612000465393066,9.918000221252441 C-8.871999740600586,9.178000450134277 -8.831999778747559,8.008000373840332 -9.501999855041504,7.2179999351501465 C-9.501999855041504,7.2179999351501465 -9.612000465393066,7.0879998207092285 -9.612000465393066,7.0879998207092285 C-9.612000465393066,7.0879998207092285 -16.68199920654297,0.017999999225139618 -16.68199920654297,0.017999999225139618 C-16.68199920654297,0.017999999225139618 -9.612000465393066,-7.052000045776367 -9.612000465393066,-7.052000045776367 C-8.871999740600586,-7.791999816894531 -8.831999778747559,-8.961999893188477 -9.501999855041504,-9.751999855041504 C-9.501999855041504,-9.751999855041504 -9.612000465393066,-9.881999969482422 -9.612000465393066,-9.881999969482422 C-9.612000465393066,-9.881999969482422 -12.442000389099121,-12.70199966430664 -12.442000389099121,-12.70199966430664z M28,-28 C32.41999816894531,-28 36,-24.420000076293945 36,-20 C36,-20 36,20 36,20 C36,24.420000076293945 32.41999816894531,28 28,28 C28,28 -28,28 -28,28 C-32.41999816894531,28 -36,24.420000076293945 -36,20 C-36,20 -36,-20 -36,-20 C-36,-24.420000076293945 -32.41999816894531,-28 -28,-28 C-28,-28 28,-28 28,-28z" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#a8a6a4;"></path></g></g></g></svg>',config:'<svg height="24" viewBox="0 0 24 24" width="24"><path d="M15,17h6v1h-6V17z M11,17H3v1h8v2h1v-2v-1v-2h-1V17z M14,8h1V6V5V3h-1v2H3v1h11V8z            M18,5v1h3V5H18z M6,14h1v-2v-1V9H6v2H3v1 h3V14z M10,12h11v-1H10V12z" fill="white" data-darkreader-inline-fill="" style="--darkreader-inline-fill:#a8a6a4;"></path></svg>'},F.option.icons);Object.keys(k).forEach(function(j){be(I,j,{get:function(){var Q=document.createElement("i");return l(Q,"art-icon"),l(Q,"art-icon-".concat(j)),S(Q,k[j]),Q}})})});function dp(z){var F=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}();return function(){var I,k=g(z);if(F){var j=g(this).constructor;I=Reflect.construct(k,arguments,j)}else I=k.apply(this,arguments);return x(this,I)}}function Jo(z,F,I){for(var k=0;k<z.length;k++){var j=z[k];j._parentItem=F,j._parentList=I,j.selector&&Jo(j.selector,j,z)}return z}var hp=function(z){o(I,z);var F=dp(I);function I(k){var j;r(this,I),j=F.call(this,k);var Q=k.option,te=k.events.proxy,de=k.template,ce=de.$setting,se=de.$player;return j.art=k,j.name="setting",j.$parent=ce,j.width=250,j.option=[],j.cache=new Map,Q.setting&&(k.once("ready",function(){Q.playbackRate&&j.option.push(function(le){var Oe=le.i18n,Fe=le.icons;function ze(Ne){return Ne===1?Oe.get("Normal"):Ne}function tt(Ne,qe,ct){qe&&(qe.innerText=ze(ct));var mt=v(".art-setting-item",Ne).find(function(Tt){return Number(Tt.dataset.value)===ct});mt&&w(mt,"art-current")}return{width:200,html:Oe.get("Play Speed"),tooltip:ze(le.playbackRate),icon:Fe.playbackRate,selector:[.5,.75,1,1.25,1.5,2].map(function(Ne){return{value:Ne,default:Ne===le.playbackRate,html:ze(Ne)}}),onSelect:function(Ne){le.playbackRate=Ne.value},mounted:function(Ne,qe){tt(Ne,qe._$tooltip,le.playbackRate),le.on("playbackRate",function(){tt(Ne,qe._$tooltip,le.playbackRate)})}}}(k)),Q.aspectRatio&&j.option.push(function(le){var Oe=le.i18n,Fe=le.icons;function ze(Ne){return Ne==="default"?Oe.get("Default"):Ne}function tt(Ne,qe,ct){qe&&(qe.innerText=ze(ct));var mt=v(".art-setting-item",Ne).find(function(Tt){return Tt.dataset.value===ct});mt&&w(mt,"art-current")}return{width:200,html:Oe.get("Aspect Ratio"),icon:Fe.aspectRatio,tooltip:ze(le.aspectRatio),selector:["default","4:3","16:9"].map(function(Ne){return{value:Ne,default:Ne===le.aspectRatio,html:ze(Ne)}}),onSelect:function(Ne){le.aspectRatio=Ne.value},mounted:function(Ne,qe){tt(Ne,qe._$tooltip,le.aspectRatio),le.on("aspectRatio",function(){tt(Ne,qe._$tooltip,le.aspectRatio)})}}}(k)),Q.flip&&j.option.push(function(le){var Oe=le.i18n,Fe=le.icons,ze={normal:"Normal",horizontal:"Horizontal",vertical:"Vertical"};function tt(Ne,qe,ct){qe&&(qe.innerText=Oe.get(ze[ct]));var mt=v(".art-setting-item",Ne).find(function(Tt){return Tt.dataset.value===ct});mt&&w(mt,"art-current")}return{width:200,html:Oe.get("Video Flip"),tooltip:Oe.get(ze[le.flip]),icon:Fe.config,selector:Object.keys(ze).map(function(Ne){return{value:Ne,default:Ne===le.flip,html:Oe.get(ze[Ne])}}),onSelect:function(Ne){le.flip=Ne.value},mounted:function(Ne,qe){tt(Ne,qe._$tooltip,le.flip),le.on("flip",function(){tt(Ne,qe._$tooltip,le.flip)})}}}(k)),Q.subtitleOffset&&j.option.push(function(le){var Oe=le.i18n,Fe=le.icons;function ze(Ne){return Ne===0?Oe.get("Normal"):Ne}function tt(Ne,qe,ct){qe&&(qe.innerText=ze(ct));var mt=v(".art-setting-item",Ne).find(function(Tt){return Number(Tt.dataset.value)===ct});mt&&w(mt,"art-current")}return{width:200,html:Oe.get("Subtitle Offset"),tooltip:ze(le.subtitleOffset),icon:Fe.subtitle,selector:[-5,-4,-3,-2,-1,0,1,2,3,4,5].map(function(Ne){return{value:Ne,default:Ne===le.subtitleOffset,html:ze(Ne)}}),onSelect:function(Ne){le.subtitleOffset=Ne.value},mounted:function(Ne,qe){tt(Ne,qe._$tooltip,le.subtitleOffset),le.on("subtitleOffset",function(){tt(Ne,qe._$tooltip,le.subtitleOffset)})}}}(k));for(var Ee=0;Ee<Q.settings.length;Ee++)j.option.push(Q.settings[Ee]);j.option=Jo(j.option),j.init(j.option)}),k.on("blur",function(){j.show&&(j.show=!1,j.init(j.option))}),te(se,"click",function(Ee){!j.show||C(Ee,k.controls.setting)||C(Ee,j.$parent)||(j.show=!1,j.init(j.option))})),j}return t(I,[{key:"creatHeader",value:function(k){var j=this,Q=this.art,te=Q.icons,de=Q.events.proxy,ce=document.createElement("div");l(ce,"art-setting-item"),l(ce,"art-setting-item-back");var se=S(ce,'<div class="art-setting-item-left"></div>'),Ee=document.createElement("div");return l(Ee,"art-setting-item-left-icon"),S(Ee,te.arrowLeft),S(se,Ee),S(se,k._parentItem.html),de(ce,"click",function(){j.init(k._parentList)}),ce}},{key:"creatItem",value:function(k){var j=this,Q=this.art,te=Q.icons,de=Q.events.proxy,ce=k.selector&&k.selector.length,se=document.createElement("div");l(se,"art-setting-item"),k.default&&l(se,"art-current"),k.value!==void 0&&(se.dataset.value=k.value);var Ee=S(se,'<div class="art-setting-item-left"></div>'),le=S(se,'<div class="art-setting-item-right"></div>'),Oe=document.createElement("div");if(l(Oe,"art-setting-item-left-icon"),S(Oe,ce?k.icon||te.config:te.check),S(Ee,Oe),S(Ee,k.html),ce){var Fe=document.createElement("div");l(Fe,"art-setting-item-right-tooltip"),S(le,Fe),k._$tooltip=Fe,k.tooltip&&(Fe.innerHTML=k.tooltip);var ze=document.createElement("div");l(ze,"art-setting-item-right-icon"),S(ze,te.arrowRight),S(le,ze)}return de(se,"click",function(tt){if(ce)j.init(k.selector,k.width);else if(w(se,"art-current"),k._parentList&&j.init(k._parentList),k._parentItem&&k._parentItem.onSelect){var Ne=k._parentItem.onSelect.call(j.art,k,se,tt);k._parentItem._$tooltip&&(typeof Ne!="string"&&typeof Ne!="number"||(k._parentItem._$tooltip.innerHTML=Ne))}}),se}},{key:"add",value:function(k){typeof k=="function"?this.option.push(k(this.art)):this.option.push(k),this.option=Jo(this.option),this.init(this.option)}},{key:"init",value:function(k,j){if(this.cache.has(k)){var Q=this.cache.get(k);w(Q,"art-current"),O(this.$parent,"width","".concat(Q.dataset.width,"px"))}else{var te=document.createElement("div");l(te,"art-setting-panel"),k[0]&&k[0]._parentItem&&S(te,this.creatHeader(k[0]));for(var de=0;de<k.length;de++)S(te,this.creatItem(k[de]));te.dataset.width=j||this.width,S(this.$parent,te),this.cache.set(k,te),w(te,"art-current"),O(this.$parent,"width","".concat(te.dataset.width,"px")),k[0]&&k[0]._parentItem&&k[0]._parentItem.mounted&&k[0]._parentItem.mounted.call(this.art,te,k[0]._parentItem)}}}]),I}(ge),pp=function(){function z(){r(this,z),this.name="artplayer_settings",this.settings={}}return t(z,[{key:"get",value:function(F){try{var I=JSON.parse(window.localStorage.getItem(this.name))||{};return F?I[F]:I}catch(k){return F?this.settings[F]:this.settings}}},{key:"set",value:function(F,I){try{var k=Object.assign({},this.get(),He({},F,I));window.localStorage.setItem(this.name,JSON.stringify(k))}catch(j){this.settings[F]=I}}},{key:"del",value:function(F){try{var I=this.get();delete I[F],window.localStorage.setItem(this.name,JSON.stringify(I))}catch(k){delete this.settings[F]}}},{key:"clean",value:function(){try{window.localStorage.removeItem(this.name)}catch(F){this.settings={}}}}]),z}();function vp(z){return z.layers.add({name:"miniProgressBar",style:{display:"none",position:"absolute",left:0,right:0,bottom:0,height:"2px",backgroundColor:"var(--theme)"},mounted:function(F){z.on("control",function(I){F.style.display=I?"none":"block"}),z.on("destroy",function(){F.style.display="none"}),z.on("video:timeupdate",function(){F.style.width="".concat(100*z.played,"%")})}}),{name:"miniProgressBar"}}var gp=function(){function z(F){r(this,z),this.art=F,this.id=0;var I=F.option;!I.isLive&&I.miniProgressBar&&this.add(vp);for(var k=0;k<I.plugins.length;k++)this.add(I.plugins[k])}return t(z,[{key:"add",value:function(F){this.id+=1;var I=F.call(this,this.art),k=I&&I.name||F.name||"plugin".concat(this.id);return G(!Se(this,k),"Cannot add a plugin that already has the same name: ".concat(k)),be(this,k,{value:I}),this}}]),z}(),mp=function(){function z(F){r(this,z),this.art=F,this.init()}return t(z,[{key:"current",get:function(){return this.art.option.ads[this.index]}},{key:"prev",get:function(){return this.art.option.ads[this.index-1]}},{key:"next",get:function(){return this.art.option.ads[this.index+1]}},{key:"init",value:function(){this.index=0,this.isEnd=!1,this.playing=!1,this.urlCache=this.art.option.url,this.current&&(this.playing=!0,this.play(this.current))}},{key:"play",value:function(){var F=this,I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.isEnd||(this.art.switchUrl(I.url),this.art.once("video:timeupdate",function(){F.art.emit("ads:start",I)}),this.art.once("video:ended",function(){var k=F.next;k?(F.index+=1,F.play(k)):F.end()}))}},{key:"end",value:function(){this.isEnd||(this.isEnd=!0,this.playing=!1,this.art.option.url=this.urlCache,this.art.switchUrl(this.urlCache),this.art.emit("ads:end"))}}]),z}(),yp=t(function z(F){r(this,z);for(var I=F.option,k=F.events.proxy,j=F.template.$video,Q=0;Q<Ue.events.length;Q++)k(j,Ue.events[Q],function(ce){F.emit("video:".concat(ce.type),ce)});Object.keys(I.moreVideoAttr).forEach(function(ce){j[ce]=I.moreVideoAttr[ce]}),I.muted&&(j.muted=I.muted),I.volume&&(j.volume=et(I.volume,0,1)),I.poster&&(j.poster=I.poster),I.autoplay&&(j.autoplay=I.autoplay);var te=I.type||re(I.url),de=I.customType[te];te&&de?(de(j,I.url,F),F.emit("customType",te)):(j.src=I.url,F.emit("url",j.src))});function Ep(z){var F=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}();return function(){var I,k=g(z);if(F){var j=g(this).constructor;I=Reflect.construct(k,arguments,j)}else I=k.apply(this,arguments);return x(this,I)}}var _p=0,us=[],xp=function(z){o(I,z);var F=Ep(I);function I(k){var j;r(this,I),(j=F.call(this)).id=++_p;var Q=$e(I.option,k);return j.option=h(Q,ke),j.isReady=!1,j.isFocus=!1,j.isDestroy=!1,j.whitelist=new Je(a(j)),j.template=new it(a(j)),j.events=new zt(a(j)),j.whitelist.state?(j.storage=new pp(a(j)),j.icons=new cp(a(j)),j.i18n=new Me(a(j)),j.notice=new Wu(a(j)),j.player=new De(a(j)),j.layers=new oa(a(j)),j.controls=new Yo(a(j)),j.contextmenu=new We(a(j)),j.subtitle=new Ht(a(j)),j.ads=new mp(a(j)),j.info=new lt(a(j)),j.loading=new la(a(j)),j.hotkey=new Tr(a(j)),j.mask=new Qo(a(j)),j.setting=new hp(a(j)),j.plugins=new gp(a(j))):j.mobile=new yp(a(j)),us.push(a(j)),j}return t(I,[{key:"proxy",get:function(){return this.events.proxy}},{key:"query",get:function(){return this.template.query}},{key:"destroy",value:function(){var k=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];this.events.destroy(),this.template.destroy(k),us.splice(us.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}],[{key:"instances",get:function(){return us}},{key:"version",get:function(){return"4.3.1"}},{key:"env",get:function(){return"production"}},{key:"build",get:function(){return"1644803300119"}},{key:"config",get:function(){return Ue}},{key:"utils",get:function(){return ht}},{key:"scheme",get:function(){return ke}},{key:"Emitter",get:function(){return y}},{key:"validator",get:function(){return h}},{key:"kindOf",get:function(){return h.kindOf}},{key:"html",get:function(){return it.html}},{key:"option",get:function(){return{container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,ads:[],layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10},subtitle:{url:"",type:"",style:{},encoding:"utf-8",bilingual:!1},moreVideoAttr:{controls:!1,preload:_?"auto":"metadata"},icons:{},customType:{},lang:navigator.language.toLowerCase()}}}]),I}(y);return console.log("%c ArtPlayer %c 4.3.1 %c https://artplayer.org","color: #fff; background: #5f5f5f","color: #fff; background: #4bc729",""),xp})})(sp);var u1=sp.exports,op={exports:{}};(function(i,e){(function(n,t){i.exports=t()})(self,function(){return function(){var r={"./node_modules/es6-promise/dist/es6-promise.js":function(s,o,p){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(x,g){s.exports=g()})(this,function(){function x(ve){var Ce=typeof ve;return ve!==null&&(Ce==="object"||Ce==="function")}function g(ve){return typeof ve=="function"}var d=void 0;Array.isArray?d=Array.isArray:d=function(ve){return Object.prototype.toString.call(ve)==="[object Array]"};var h=d,y=0,b=void 0,T=void 0,_=function(Ce,ke){w[y]=Ce,w[y+1]=ke,y+=2,y===2&&(T?T(L):C())};function c(ve){T=ve}function u(ve){_=ve}var f=typeof window!="undefined"?window:void 0,v=f||{},l=v.MutationObserver||v.WebKitMutationObserver,m=typeof self=="undefined"&&typeof process!="undefined"&&{}.toString.call(process)==="[object process]",E=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined";function S(){return function(){return process.nextTick(L)}}function O(){return typeof b!="undefined"?function(){b(L)}:A()}function D(){var ve=0,Ce=new l(L),ke=document.createTextNode("");return Ce.observe(ke,{characterData:!0}),function(){ke.data=ve=++ve%2}}function P(){var ve=new MessageChannel;return ve.port1.onmessage=L,function(){return ve.port2.postMessage(0)}}function A(){var ve=setTimeout;return function(){return ve(L,1)}}var w=new Array(1e3);function L(){for(var ve=0;ve<y;ve+=2){var Ce=w[ve],ke=w[ve+1];Ce(ke),w[ve]=void 0,w[ve+1]=void 0}y=0}function R(){try{var ve=Function("return this")().require("vertx");return b=ve.runOnLoop||ve.runOnContext,O()}catch(Ce){return A()}}var C=void 0;m?C=S():l?C=D():E?C=P():f===void 0?C=R():C=A();function M(ve,Ce){var ke=this,Ue=new this.constructor(K);Ue[U]===void 0&&dt(Ue);var Je=ke._state;if(Je){var it=arguments[Je-1];_(function(){return st(Je,Ue,it,ke._result)})}else Ge(ke,Ue,ve,Ce);return Ue}function N(ve){var Ce=this;if(ve&&typeof ve=="object"&&ve.constructor===Ce)return ve;var ke=new Ce(K);return Te(ke,ve),ke}var U=Math.random().toString(36).substring(2);function K(){}var V=void 0,W=1,G=2;function Y(){return new TypeError("You cannot resolve a promise with itself")}function q(){return new TypeError("A promises callback cannot return that same promise.")}function ee(ve,Ce,ke,Ue){try{ve.call(Ce,ke,Ue)}catch(Je){return Je}}function re(ve,Ce,ke){_(function(Ue){var Je=!1,it=ee(ke,Ce,function(X){Je||(Je=!0,Ce!==X?Te(Ue,X):Re(Ue,X))},function(X){Je||(Je=!0,Se(Ue,X))},"Settle: "+(Ue._label||" unknown promise"));!Je&&it&&(Je=!0,Se(Ue,it))},ve)}function pe(ve,Ce){Ce._state===W?Re(ve,Ce._result):Ce._state===G?Se(ve,Ce._result):Ge(Ce,void 0,function(ke){return Te(ve,ke)},function(ke){return Se(ve,ke)})}function Le(ve,Ce,ke){Ce.constructor===ve.constructor&&ke===M&&Ce.constructor.resolve===N?pe(ve,Ce):ke===void 0?Re(ve,Ce):g(ke)?re(ve,Ce,ke):Re(ve,Ce)}function Te(ve,Ce){if(ve===Ce)Se(ve,Y());else if(x(Ce)){var ke=void 0;try{ke=Ce.then}catch(Ue){Se(ve,Ue);return}Le(ve,Ce,ke)}else Re(ve,Ce)}function be(ve){ve._onerror&&ve._onerror(ve._result),$e(ve)}function Re(ve,Ce){ve._state===V&&(ve._result=Ce,ve._state=W,ve._subscribers.length!==0&&_($e,ve))}function Se(ve,Ce){ve._state===V&&(ve._state=G,ve._result=Ce,_(be,ve))}function Ge(ve,Ce,ke,Ue){var Je=ve._subscribers,it=Je.length;ve._onerror=null,Je[it]=Ce,Je[it+W]=ke,Je[it+G]=Ue,it===0&&ve._state&&_($e,ve)}function $e(ve){var Ce=ve._subscribers,ke=ve._state;if(Ce.length!==0){for(var Ue=void 0,Je=void 0,it=ve._result,X=0;X<Ce.length;X+=3)Ue=Ce[X],Je=Ce[X+ke],Ue?st(ke,Ue,Je,it):Je(it);ve._subscribers.length=0}}function st(ve,Ce,ke,Ue){var Je=g(ke),it=void 0,X=void 0,Ae=!0;if(Je){try{it=ke(Ue)}catch(Me){Ae=!1,X=Me}if(Ce===it){Se(Ce,q());return}}else it=Ue;Ce._state!==V||(Je&&Ae?Te(Ce,it):Ae===!1?Se(Ce,X):ve===W?Re(Ce,it):ve===G&&Se(Ce,it))}function Ze(ve,Ce){try{Ce(function(Ue){Te(ve,Ue)},function(Ue){Se(ve,Ue)})}catch(ke){Se(ve,ke)}}var et=0;function ft(){return et++}function dt(ve){ve[U]=et++,ve._state=void 0,ve._result=void 0,ve._subscribers=[]}function ht(){return new Error("Array Methods must be provided an Array")}var He=function(){function ve(Ce,ke){this._instanceConstructor=Ce,this.promise=new Ce(K),this.promise[U]||dt(this.promise),h(ke)?(this.length=ke.length,this._remaining=ke.length,this._result=new Array(this.length),this.length===0?Re(this.promise,this._result):(this.length=this.length||0,this._enumerate(ke),this._remaining===0&&Re(this.promise,this._result))):Se(this.promise,ht())}return ve.prototype._enumerate=function(ke){for(var Ue=0;this._state===V&&Ue<ke.length;Ue++)this._eachEntry(ke[Ue],Ue)},ve.prototype._eachEntry=function(ke,Ue){var Je=this._instanceConstructor,it=Je.resolve;if(it===N){var X=void 0,Ae=void 0,Me=!1;try{X=ke.then}catch(ne){Me=!0,Ae=ne}if(X===M&&ke._state!==V)this._settledAt(ke._state,Ue,ke._result);else if(typeof X!="function")this._remaining--,this._result[Ue]=ke;else if(Je===wt){var Ke=new Je(K);Me?Se(Ke,Ae):Le(Ke,ke,X),this._willSettleAt(Ke,Ue)}else this._willSettleAt(new Je(function(ne){return ne(ke)}),Ue)}else this._willSettleAt(it(ke),Ue)},ve.prototype._settledAt=function(ke,Ue,Je){var it=this.promise;it._state===V&&(this._remaining--,ke===G?Se(it,Je):this._result[Ue]=Je),this._remaining===0&&Re(it,this._result)},ve.prototype._willSettleAt=function(ke,Ue){var Je=this;Ge(ke,void 0,function(it){return Je._settledAt(W,Ue,it)},function(it){return Je._settledAt(G,Ue,it)})},ve}();function rt(ve){return new He(this,ve).promise}function xt(ve){var Ce=this;return h(ve)?new Ce(function(ke,Ue){for(var Je=ve.length,it=0;it<Je;it++)Ce.resolve(ve[it]).then(ke,Ue)}):new Ce(function(ke,Ue){return Ue(new TypeError("You must pass an array to race."))})}function pt(ve){var Ce=this,ke=new Ce(K);return Se(ke,ve),ke}function ot(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Lt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var wt=function(){function ve(Ce){this[U]=ft(),this._result=this._state=void 0,this._subscribers=[],K!==Ce&&(typeof Ce!="function"&&ot(),this instanceof ve?Ze(this,Ce):Lt())}return ve.prototype.catch=function(ke){return this.then(null,ke)},ve.prototype.finally=function(ke){var Ue=this,Je=Ue.constructor;return g(ke)?Ue.then(function(it){return Je.resolve(ke()).then(function(){return it})},function(it){return Je.resolve(ke()).then(function(){throw it})}):Ue.then(ke,ke)},ve}();wt.prototype.then=M,wt.all=rt,wt.race=xt,wt.resolve=N,wt.reject=pt,wt._setScheduler=c,wt._setAsap=u,wt._asap=_;function Pt(){var ve=void 0;if(typeof p.g!="undefined")ve=p.g;else if(typeof self!="undefined")ve=self;else try{ve=Function("return this")()}catch(Ue){throw new Error("polyfill failed because global object is unavailable in this environment")}var Ce=ve.Promise;if(Ce){var ke=null;try{ke=Object.prototype.toString.call(Ce.resolve())}catch(Ue){}if(ke==="[object Promise]"&&!Ce.cast)return}ve.Promise=wt}return wt.polyfill=Pt,wt.Promise=wt,wt})},"./node_modules/events/events.js":function(s){var o=typeof Reflect=="object"?Reflect:null,p=o&&typeof o.apply=="function"?o.apply:function(A,w,L){return Function.prototype.apply.call(A,w,L)},x;o&&typeof o.ownKeys=="function"?x=o.ownKeys:Object.getOwnPropertySymbols?x=function(A){return Object.getOwnPropertyNames(A).concat(Object.getOwnPropertySymbols(A))}:x=function(A){return Object.getOwnPropertyNames(A)};function g(P){console&&console.warn&&console.warn(P)}var d=Number.isNaN||function(A){return A!==A};function h(){h.init.call(this)}s.exports=h,s.exports.once=S,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var y=10;function b(P){if(typeof P!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof P)}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return y},set:function(P){if(typeof P!="number"||P<0||d(P))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+P+".");y=P}}),h.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(A){if(typeof A!="number"||A<0||d(A))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+A+".");return this._maxListeners=A,this};function T(P){return P._maxListeners===void 0?h.defaultMaxListeners:P._maxListeners}h.prototype.getMaxListeners=function(){return T(this)},h.prototype.emit=function(A){for(var w=[],L=1;L<arguments.length;L++)w.push(arguments[L]);var R=A==="error",C=this._events;if(C!==void 0)R=R&&C.error===void 0;else if(!R)return!1;if(R){var M;if(w.length>0&&(M=w[0]),M instanceof Error)throw M;var N=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw N.context=M,N}var U=C[A];if(U===void 0)return!1;if(typeof U=="function")p(U,this,w);else for(var K=U.length,V=l(U,K),L=0;L<K;++L)p(V[L],this,w);return!0};function _(P,A,w,L){var R,C,M;if(b(w),C=P._events,C===void 0?(C=P._events=Object.create(null),P._eventsCount=0):(C.newListener!==void 0&&(P.emit("newListener",A,w.listener?w.listener:w),C=P._events),M=C[A]),M===void 0)M=C[A]=w,++P._eventsCount;else if(typeof M=="function"?M=C[A]=L?[w,M]:[M,w]:L?M.unshift(w):M.push(w),R=T(P),R>0&&M.length>R&&!M.warned){M.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(A)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=P,N.type=A,N.count=M.length,g(N)}return P}h.prototype.addListener=function(A,w){return _(this,A,w,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(A,w){return _(this,A,w,!0)};function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(P,A,w){var L={fired:!1,wrapFn:void 0,target:P,type:A,listener:w},R=c.bind(L);return R.listener=w,L.wrapFn=R,R}h.prototype.once=function(A,w){return b(w),this.on(A,u(this,A,w)),this},h.prototype.prependOnceListener=function(A,w){return b(w),this.prependListener(A,u(this,A,w)),this},h.prototype.removeListener=function(A,w){var L,R,C,M,N;if(b(w),R=this._events,R===void 0)return this;if(L=R[A],L===void 0)return this;if(L===w||L.listener===w)--this._eventsCount==0?this._events=Object.create(null):(delete R[A],R.removeListener&&this.emit("removeListener",A,L.listener||w));else if(typeof L!="function"){for(C=-1,M=L.length-1;M>=0;M--)if(L[M]===w||L[M].listener===w){N=L[M].listener,C=M;break}if(C<0)return this;C===0?L.shift():m(L,C),L.length===1&&(R[A]=L[0]),R.removeListener!==void 0&&this.emit("removeListener",A,N||w)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(A){var w,L,R;if(L=this._events,L===void 0)return this;if(L.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):L[A]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete L[A]),this;if(arguments.length===0){var C=Object.keys(L),M;for(R=0;R<C.length;++R)M=C[R],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=L[A],typeof w=="function")this.removeListener(A,w);else if(w!==void 0)for(R=w.length-1;R>=0;R--)this.removeListener(A,w[R]);return this};function f(P,A,w){var L=P._events;if(L===void 0)return[];var R=L[A];return R===void 0?[]:typeof R=="function"?w?[R.listener||R]:[R]:w?E(R):l(R,R.length)}h.prototype.listeners=function(A){return f(this,A,!0)},h.prototype.rawListeners=function(A){return f(this,A,!1)},h.listenerCount=function(P,A){return typeof P.listenerCount=="function"?P.listenerCount(A):v.call(P,A)},h.prototype.listenerCount=v;function v(P){var A=this._events;if(A!==void 0){var w=A[P];if(typeof w=="function")return 1;if(w!==void 0)return w.length}return 0}h.prototype.eventNames=function(){return this._eventsCount>0?x(this._events):[]};function l(P,A){for(var w=new Array(A),L=0;L<A;++L)w[L]=P[L];return w}function m(P,A){for(;A+1<P.length;A++)P[A]=P[A+1];P.pop()}function E(P){for(var A=new Array(P.length),w=0;w<A.length;++w)A[w]=P[w].listener||P[w];return A}function S(P,A){return new Promise(function(w,L){function R(M){P.removeListener(A,C),L(M)}function C(){typeof P.removeListener=="function"&&P.removeListener("error",R),w([].slice.call(arguments))}D(P,A,C,{once:!0}),A!=="error"&&O(P,R,{once:!0})})}function O(P,A,w){typeof P.on=="function"&&D(P,"error",A,w)}function D(P,A,w,L){if(typeof P.on=="function")L.once?P.once(A,w):P.on(A,w);else if(typeof P.addEventListener=="function")P.addEventListener(A,function R(C){L.once&&P.removeEventListener(A,R),w(C)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof P)}},"./node_modules/webworkify-webpack/index.js":function(s,o,p){function x(c){var u={};function f(l){if(u[l])return u[l].exports;var m=u[l]={i:l,l:!1,exports:{}};return c[l].call(m.exports,m,m.exports,f),m.l=!0,m.exports}f.m=c,f.c=u,f.i=function(l){return l},f.d=function(l,m,E){f.o(l,m)||Object.defineProperty(l,m,{configurable:!1,enumerable:!0,get:E})},f.r=function(l){Object.defineProperty(l,"__esModule",{value:!0})},f.n=function(l){var m=l&&l.__esModule?function(){return l.default}:function(){return l};return f.d(m,"a",m),m},f.o=function(l,m){return Object.prototype.hasOwnProperty.call(l,m)},f.p="/",f.oe=function(l){throw console.error(l),l};var v=f(f.s=ENTRY_MODULE);return v.default||v}var g="[\\.|\\-|\\+|\\w|/|@]+",d="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+g+").*?\\)";function h(c){return(c+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function y(c){return!isNaN(1*c)}function b(c,u,f){var v={};v[f]=[];var l=u.toString(),m=l.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!m)return v;for(var E=m[1],S=new RegExp("(\\\\n|\\W)"+h(E)+d,"g"),O;O=S.exec(l);)O[3]!=="dll-reference"&&v[f].push(O[3]);for(S=new RegExp("\\("+h(E)+'\\("(dll-reference\\s('+g+'))"\\)\\)'+d,"g");O=S.exec(l);)c[O[2]]||(v[f].push(O[1]),c[O[2]]=p(O[1]).m),v[O[2]]=v[O[2]]||[],v[O[2]].push(O[4]);for(var D=Object.keys(v),P=0;P<D.length;P++)for(var A=0;A<v[D[P]].length;A++)y(v[D[P]][A])&&(v[D[P]][A]=1*v[D[P]][A]);return v}function T(c){var u=Object.keys(c);return u.reduce(function(f,v){return f||c[v].length>0},!1)}function _(c,u){for(var f={main:[u]},v={main:[]},l={main:{}};T(f);)for(var m=Object.keys(f),E=0;E<m.length;E++){var S=m[E],O=f[S],D=O.pop();if(l[S]=l[S]||{},!(l[S][D]||!c[S][D])){l[S][D]=!0,v[S]=v[S]||[],v[S].push(D);for(var P=b(c,c[S][D],S),A=Object.keys(P),w=0;w<A.length;w++)f[A[w]]=f[A[w]]||[],f[A[w]]=f[A[w]].concat(P[A[w]])}}return v}s.exports=function(c,u){u=u||{};var f={main:p.m},v=u.all?{main:Object.keys(f.main)}:_(f,c),l="";Object.keys(v).filter(function(D){return D!=="main"}).forEach(function(D){for(var P=0;v[D][P];)P++;v[D].push(P),f[D][P]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",l=l+"var "+D+" = ("+x.toString().replace("ENTRY_MODULE",JSON.stringify(P))+")({"+v[D].map(function(A){return""+JSON.stringify(A)+": "+f[D][A].toString()}).join(",")+`});
`}),l=l+"new (("+x.toString().replace("ENTRY_MODULE",JSON.stringify(c))+")({"+v.main.map(function(D){return""+JSON.stringify(D)+": "+f.main[D].toString()}).join(",")+"}))(self);";var m=new window.Blob([l],{type:"text/javascript"});if(u.bare)return m;var E=window.URL||window.webkitURL||window.mozURL||window.msURL,S=E.createObjectURL(m),O=new window.Worker(S);return O.objectURL=S,O}},"./src/config.js":function(s,o,p){p.r(o),p.d(o,{defaultConfig:function(){return x},createDefaultConfig:function(){return g}});var x={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function g(){return Object.assign({},x)}},"./src/core/features.js":function(s,o,p){p.r(o);var x=p("./src/io/io-controller.js"),g=p("./src/config.js"),d=function(){function h(){}return h.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},h.supportNetworkStreamIO=function(){var y=new x.default({},(0,g.createDefaultConfig)()),b=y.loaderType;return y.destroy(),b=="fetch-stream-loader"||b=="xhr-moz-chunked-loader"},h.getNetworkLoaderTypeName=function(){var y=new x.default({},(0,g.createDefaultConfig)()),b=y.loaderType;return y.destroy(),b},h.supportNativeMediaPlayback=function(y){h.videoElement==null&&(h.videoElement=window.document.createElement("video"));var b=h.videoElement.canPlayType(y);return b==="probably"||b=="maybe"},h.getFeatureList=function(){var y={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return y.mseFlvPlayback=h.supportMSEH264Playback(),y.networkStreamIO=h.supportNetworkStreamIO(),y.networkLoaderName=h.getNetworkLoaderTypeName(),y.mseLiveFlvPlayback=y.mseFlvPlayback&&y.networkStreamIO,y.nativeMP4H264Playback=h.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),y.nativeWebmVP8Playback=h.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),y.nativeWebmVP9Playback=h.supportNativeMediaPlayback('video/webm; codecs="vp9"'),y},h}();o.default=d},"./src/core/media-info.js":function(s,o,p){p.r(o);var x=function(){function g(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return g.prototype.isComplete=function(){var d=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,h=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&d&&h},g.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},g.prototype.getNearestKeyframe=function(d){if(this.keyframesIndex==null)return null;var h=this.keyframesIndex,y=this._search(h.times,d);return{index:y,milliseconds:h.times[y],fileposition:h.filepositions[y]}},g.prototype._search=function(d,h){var y=0,b=d.length-1,T=0,_=0,c=b;for(h<d[0]&&(y=0,_=c+1);_<=c;)if(T=_+Math.floor((c-_)/2),T===b||h>=d[T]&&h<d[T+1]){y=T;break}else d[T]<h?_=T+1:c=T-1;return y},g}();o.default=x},"./src/core/media-segment-info.js":function(s,o,p){p.r(o),p.d(o,{SampleInfo:function(){return x},MediaSegmentInfo:function(){return g},IDRSampleList:function(){return d},MediaSegmentInfoList:function(){return h}});var x=function(){function y(b,T,_,c,u){this.dts=b,this.pts=T,this.duration=_,this.originalDts=c,this.isSyncPoint=u,this.fileposition=null}return y}(),g=function(){function y(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return y.prototype.appendSyncPoint=function(b){b.isSyncPoint=!0,this.syncPoints.push(b)},y}(),d=function(){function y(){this._list=[]}return y.prototype.clear=function(){this._list=[]},y.prototype.appendArray=function(b){var T=this._list;b.length!==0&&(T.length>0&&b[0].originalDts<T[T.length-1].originalDts&&this.clear(),Array.prototype.push.apply(T,b))},y.prototype.getLastSyncPointBeforeDts=function(b){if(this._list.length==0)return null;var T=this._list,_=0,c=T.length-1,u=0,f=0,v=c;for(b<T[0].dts&&(_=0,f=v+1);f<=v;)if(u=f+Math.floor((v-f)/2),u===c||b>=T[u].dts&&b<T[u+1].dts){_=u;break}else T[u].dts<b?f=u+1:v=u-1;return this._list[_]},y}(),h=function(){function y(b){this._type=b,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(y.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),y.prototype.isEmpty=function(){return this._list.length===0},y.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},y.prototype._searchNearestSegmentBefore=function(b){var T=this._list;if(T.length===0)return-2;var _=T.length-1,c=0,u=0,f=_,v=0;if(b<T[0].originalBeginDts)return v=-1,v;for(;u<=f;)if(c=u+Math.floor((f-u)/2),c===_||b>T[c].lastSample.originalDts&&b<T[c+1].originalBeginDts){v=c;break}else T[c].originalBeginDts<b?u=c+1:f=c-1;return v},y.prototype._searchNearestSegmentAfter=function(b){return this._searchNearestSegmentBefore(b)+1},y.prototype.append=function(b){var T=this._list,_=b,c=this._lastAppendLocation,u=0;c!==-1&&c<T.length&&_.originalBeginDts>=T[c].lastSample.originalDts&&(c===T.length-1||c<T.length-1&&_.originalBeginDts<T[c+1].originalBeginDts)?u=c+1:T.length>0&&(u=this._searchNearestSegmentBefore(_.originalBeginDts)+1),this._lastAppendLocation=u,this._list.splice(u,0,_)},y.prototype.getLastSegmentBefore=function(b){var T=this._searchNearestSegmentBefore(b);return T>=0?this._list[T]:null},y.prototype.getLastSampleBefore=function(b){var T=this.getLastSegmentBefore(b);return T!=null?T.lastSample:null},y.prototype.getLastSyncPointBefore=function(b){for(var T=this._searchNearestSegmentBefore(b),_=this._list[T].syncPoints;_.length===0&&T>0;)T--,_=this._list[T].syncPoints;return _.length>0?_[_.length-1]:null},y}()},"./src/core/mse-controller.js":function(s,o,p){p.r(o);var x=p("./node_modules/events/events.js"),g=p.n(x),d=p("./src/utils/logger.js"),h=p("./src/utils/browser.js"),y=p("./src/core/mse-events.js"),b=p("./src/core/media-segment-info.js"),T=p("./src/utils/exception.js"),_=function(){function c(u){this.TAG="MSEController",this._config=u,this._emitter=new(g()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new b.IDRSampleList}return c.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},c.prototype.on=function(u,f){this._emitter.addListener(u,f)},c.prototype.off=function(u,f){this._emitter.removeListener(u,f)},c.prototype.attachMediaElement=function(u){if(this._mediaSource)throw new T.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var f=this._mediaSource=new window.MediaSource;f.addEventListener("sourceopen",this.e.onSourceOpen),f.addEventListener("sourceended",this.e.onSourceEnded),f.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=u,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),u.src=this._mediaSourceObjectURL},c.prototype.detachMediaElement=function(){if(this._mediaSource){var u=this._mediaSource;for(var f in this._sourceBuffers){var v=this._pendingSegments[f];v.splice(0,v.length),this._pendingSegments[f]=null,this._pendingRemoveRanges[f]=null,this._lastInitSegments[f]=null;var l=this._sourceBuffers[f];if(l){if(u.readyState!=="closed"){try{u.removeSourceBuffer(l)}catch(m){d.default.e(this.TAG,m.message)}l.removeEventListener("error",this.e.onSourceBufferError),l.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[f]=null,this._sourceBuffers[f]=null}}if(u.readyState==="open")try{u.endOfStream()}catch(m){d.default.e(this.TAG,m.message)}u.removeEventListener("sourceopen",this.e.onSourceOpen),u.removeEventListener("sourceended",this.e.onSourceEnded),u.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},c.prototype.appendInitSegment=function(u,f){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(u),this._pendingSegments[u.type].push(u);return}var v=u,l=""+v.container;v.codec&&v.codec.length>0&&(l+=";codecs="+v.codec);var m=!1;if(d.default.v(this.TAG,"Received Initialization Segment, mimeType: "+l),this._lastInitSegments[v.type]=v,l!==this._mimeTypes[v.type]){if(this._mimeTypes[v.type])d.default.v(this.TAG,"Notice: "+v.type+" mimeType changed, origin: "+this._mimeTypes[v.type]+", target: "+l);else{m=!0;try{var E=this._sourceBuffers[v.type]=this._mediaSource.addSourceBuffer(l);E.addEventListener("error",this.e.onSourceBufferError),E.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(S){d.default.e(this.TAG,S.message),this._emitter.emit(y.default.ERROR,{code:S.code,msg:S.message});return}}this._mimeTypes[v.type]=l}f||this._pendingSegments[v.type].push(v),m||this._sourceBuffers[v.type]&&!this._sourceBuffers[v.type].updating&&this._doAppendSegments(),h.default.safari&&v.container==="audio/mpeg"&&v.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=v.mediaDuration/1e3,this._updateMediaSourceDuration())},c.prototype.appendMediaSegment=function(u){var f=u;this._pendingSegments[f.type].push(f),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var v=this._sourceBuffers[f.type];v&&!v.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},c.prototype.seek=function(u){for(var f in this._sourceBuffers)if(!!this._sourceBuffers[f]){var v=this._sourceBuffers[f];if(this._mediaSource.readyState==="open")try{v.abort()}catch(D){d.default.e(this.TAG,D.message)}this._idrList.clear();var l=this._pendingSegments[f];if(l.splice(0,l.length),this._mediaSource.readyState!=="closed"){for(var m=0;m<v.buffered.length;m++){var E=v.buffered.start(m),S=v.buffered.end(m);this._pendingRemoveRanges[f].push({start:E,end:S})}if(v.updating||this._doRemoveRanges(),h.default.safari){var O=this._lastInitSegments[f];O&&(this._pendingSegments[f].push(O),v.updating||this._doAppendSegments())}}}},c.prototype.endOfStream=function(){var u=this._mediaSource,f=this._sourceBuffers;if(!u||u.readyState!=="open"){u&&u.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}f.video&&f.video.updating||f.audio&&f.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,u.endOfStream())},c.prototype.getNearestKeyframe=function(u){return this._idrList.getLastSyncPointBeforeDts(u)},c.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var u=this._mediaElement.currentTime;for(var f in this._sourceBuffers){var v=this._sourceBuffers[f];if(v){var l=v.buffered;if(l.length>=1&&u-l.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},c.prototype._doCleanupSourceBuffer=function(){var u=this._mediaElement.currentTime;for(var f in this._sourceBuffers){var v=this._sourceBuffers[f];if(v){for(var l=v.buffered,m=!1,E=0;E<l.length;E++){var S=l.start(E),O=l.end(E);if(S<=u&&u<O+3){if(u-S>=this._config.autoCleanupMaxBackwardDuration){m=!0;var D=u-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[f].push({start:S,end:D})}}else O<u&&(m=!0,this._pendingRemoveRanges[f].push({start:S,end:O}))}m&&!v.updating&&this._doRemoveRanges()}}},c.prototype._updateMediaSourceDuration=function(){var u=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(u.video&&u.video.updating||u.audio&&u.audio.updating)){var f=this._mediaSource.duration,v=this._pendingMediaDuration;v>0&&(isNaN(f)||v>f)&&(d.default.v(this.TAG,"Update MediaSource duration from "+f+" to "+v),this._mediaSource.duration=v),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},c.prototype._doRemoveRanges=function(){for(var u in this._pendingRemoveRanges)if(!(!this._sourceBuffers[u]||this._sourceBuffers[u].updating))for(var f=this._sourceBuffers[u],v=this._pendingRemoveRanges[u];v.length&&!f.updating;){var l=v.shift();f.remove(l.start,l.end)}},c.prototype._doAppendSegments=function(){var u=this._pendingSegments;for(var f in u)if(!(!this._sourceBuffers[f]||this._sourceBuffers[f].updating)&&u[f].length>0){var v=u[f].shift();if(v.timestampOffset){var l=this._sourceBuffers[f].timestampOffset,m=v.timestampOffset/1e3,E=Math.abs(l-m);E>.1&&(d.default.v(this.TAG,"Update MPEG audio timestampOffset from "+l+" to "+m),this._sourceBuffers[f].timestampOffset=m),delete v.timestampOffset}if(!v.data||v.data.byteLength===0)continue;try{this._sourceBuffers[f].appendBuffer(v.data),this._isBufferFull=!1,f==="video"&&v.hasOwnProperty("info")&&this._idrList.appendArray(v.info.syncPoints)}catch(S){this._pendingSegments[f].unshift(v),S.code===22?(this._isBufferFull||this._emitter.emit(y.default.BUFFER_FULL),this._isBufferFull=!0):(d.default.e(this.TAG,S.message),this._emitter.emit(y.default.ERROR,{code:S.code,msg:S.message}))}}},c.prototype._onSourceOpen=function(){if(d.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var u=this._pendingSourceBufferInit;u.length;){var f=u.shift();this.appendInitSegment(f,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(y.default.SOURCE_OPEN)},c.prototype._onSourceEnded=function(){d.default.v(this.TAG,"MediaSource onSourceEnded")},c.prototype._onSourceClose=function(){d.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},c.prototype._hasPendingSegments=function(){var u=this._pendingSegments;return u.video.length>0||u.audio.length>0},c.prototype._hasPendingRemoveRanges=function(){var u=this._pendingRemoveRanges;return u.video.length>0||u.audio.length>0},c.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(y.default.UPDATE_END)},c.prototype._onSourceBufferError=function(u){d.default.e(this.TAG,"SourceBuffer Error: "+u)},c}();o.default=_},"./src/core/mse-events.js":function(s,o,p){p.r(o);var x={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};o.default=x},"./src/core/transmuxer.js":function(s,o,p){p.r(o);var x=p("./node_modules/events/events.js"),g=p.n(x),d=p("./node_modules/webworkify-webpack/index.js"),h=p.n(d),y=p("./src/utils/logger.js"),b=p("./src/utils/logging-control.js"),T=p("./src/core/transmuxing-controller.js"),_=p("./src/core/transmuxing-events.js"),c=p("./src/core/media-info.js"),u=function(){function f(v,l){if(this.TAG="Transmuxer",this._emitter=new(g()),l.enableWorker&&typeof Worker!="undefined")try{this._worker=h()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[v,l]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},b.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:b.default.getConfig()})}catch(E){y.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new T.default(v,l)}else this._controller=new T.default(v,l);if(this._controller){var m=this._controller;m.on(_.default.IO_ERROR,this._onIOError.bind(this)),m.on(_.default.DEMUX_ERROR,this._onDemuxError.bind(this)),m.on(_.default.INIT_SEGMENT,this._onInitSegment.bind(this)),m.on(_.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),m.on(_.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),m.on(_.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),m.on(_.default.MEDIA_INFO,this._onMediaInfo.bind(this)),m.on(_.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),m.on(_.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),m.on(_.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),m.on(_.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return f.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),b.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},f.prototype.on=function(v,l){this._emitter.addListener(v,l)},f.prototype.off=function(v,l){this._emitter.removeListener(v,l)},f.prototype.hasWorker=function(){return this._worker!=null},f.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},f.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},f.prototype.seek=function(v){this._worker?this._worker.postMessage({cmd:"seek",param:v}):this._controller.seek(v)},f.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},f.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},f.prototype._onInitSegment=function(v,l){var m=this;Promise.resolve().then(function(){m._emitter.emit(_.default.INIT_SEGMENT,v,l)})},f.prototype._onMediaSegment=function(v,l){var m=this;Promise.resolve().then(function(){m._emitter.emit(_.default.MEDIA_SEGMENT,v,l)})},f.prototype._onLoadingComplete=function(){var v=this;Promise.resolve().then(function(){v._emitter.emit(_.default.LOADING_COMPLETE)})},f.prototype._onRecoveredEarlyEof=function(){var v=this;Promise.resolve().then(function(){v._emitter.emit(_.default.RECOVERED_EARLY_EOF)})},f.prototype._onMediaInfo=function(v){var l=this;Promise.resolve().then(function(){l._emitter.emit(_.default.MEDIA_INFO,v)})},f.prototype._onMetaDataArrived=function(v){var l=this;Promise.resolve().then(function(){l._emitter.emit(_.default.METADATA_ARRIVED,v)})},f.prototype._onScriptDataArrived=function(v){var l=this;Promise.resolve().then(function(){l._emitter.emit(_.default.SCRIPTDATA_ARRIVED,v)})},f.prototype._onStatisticsInfo=function(v){var l=this;Promise.resolve().then(function(){l._emitter.emit(_.default.STATISTICS_INFO,v)})},f.prototype._onIOError=function(v,l){var m=this;Promise.resolve().then(function(){m._emitter.emit(_.default.IO_ERROR,v,l)})},f.prototype._onDemuxError=function(v,l){var m=this;Promise.resolve().then(function(){m._emitter.emit(_.default.DEMUX_ERROR,v,l)})},f.prototype._onRecommendSeekpoint=function(v){var l=this;Promise.resolve().then(function(){l._emitter.emit(_.default.RECOMMEND_SEEKPOINT,v)})},f.prototype._onLoggingConfigChanged=function(v){this._worker&&this._worker.postMessage({cmd:"logging_config",param:v})},f.prototype._onWorkerMessage=function(v){var l=v.data,m=l.data;if(l.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(l.msg){case _.default.INIT_SEGMENT:case _.default.MEDIA_SEGMENT:this._emitter.emit(l.msg,m.type,m.data);break;case _.default.LOADING_COMPLETE:case _.default.RECOVERED_EARLY_EOF:this._emitter.emit(l.msg);break;case _.default.MEDIA_INFO:Object.setPrototypeOf(m,c.default.prototype),this._emitter.emit(l.msg,m);break;case _.default.METADATA_ARRIVED:case _.default.SCRIPTDATA_ARRIVED:case _.default.STATISTICS_INFO:this._emitter.emit(l.msg,m);break;case _.default.IO_ERROR:case _.default.DEMUX_ERROR:this._emitter.emit(l.msg,m.type,m.info);break;case _.default.RECOMMEND_SEEKPOINT:this._emitter.emit(l.msg,m);break;case"logcat_callback":y.default.emitter.emit("log",m.type,m.logcat);break}},f}();o.default=u},"./src/core/transmuxing-controller.js":function(s,o,p){p.r(o);var x=p("./node_modules/events/events.js"),g=p.n(x),d=p("./src/utils/logger.js"),h=p("./src/utils/browser.js"),y=p("./src/core/media-info.js"),b=p("./src/demux/flv-demuxer.js"),T=p("./src/remux/mp4-remuxer.js"),_=p("./src/demux/demux-errors.js"),c=p("./src/io/io-controller.js"),u=p("./src/core/transmuxing-events.js"),f=function(){function v(l,m){this.TAG="TransmuxingController",this._emitter=new(g()),this._config=m,l.segments||(l.segments=[{duration:l.duration,filesize:l.filesize,url:l.url}]),typeof l.cors!="boolean"&&(l.cors=!0),typeof l.withCredentials!="boolean"&&(l.withCredentials=!1),this._mediaDataSource=l,this._currentSegmentIndex=0;var E=0;this._mediaDataSource.segments.forEach(function(S){S.timestampBase=E,E+=S.duration,S.cors=l.cors,S.withCredentials=l.withCredentials,m.referrerPolicy&&(S.referrerPolicy=m.referrerPolicy)}),!isNaN(E)&&this._mediaDataSource.duration!==E&&(this._mediaDataSource.duration=E),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return v.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},v.prototype.on=function(l,m){this._emitter.addListener(l,m)},v.prototype.off=function(l,m){this._emitter.removeListener(l,m)},v.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},v.prototype._loadSegment=function(l,m){this._currentSegmentIndex=l;var E=this._mediaDataSource.segments[l],S=this._ioctl=new c.default(E,this._config,l);S.onError=this._onIOException.bind(this),S.onSeeked=this._onIOSeeked.bind(this),S.onComplete=this._onIOComplete.bind(this),S.onRedirect=this._onIORedirect.bind(this),S.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),m?this._demuxer.bindDataSource(this._ioctl):S.onDataArrival=this._onInitChunkArrival.bind(this),S.open(m)},v.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},v.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},v.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},v.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},v.prototype.seek=function(l){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var m=this._searchSegmentIndexContains(l);if(m===this._currentSegmentIndex){var E=this._mediaInfo.segments[m];if(E==null)this._pendingSeekTime=l;else{var S=E.getNearestKeyframe(l);this._remuxer.seek(S.milliseconds),this._ioctl.seek(S.fileposition),this._pendingResolveSeekPoint=S.milliseconds}}else{var O=this._mediaInfo.segments[m];if(O==null)this._pendingSeekTime=l,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(m);else{var S=O.getNearestKeyframe(l);this._internalAbort(),this._remuxer.seek(l),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[m].timestampBase,this._loadSegment(m,S.fileposition),this._pendingResolveSeekPoint=S.milliseconds,this._reportSegmentMediaInfo(m)}}this._enableStatisticsReporter()}},v.prototype._searchSegmentIndexContains=function(l){for(var m=this._mediaDataSource.segments,E=m.length-1,S=0;S<m.length;S++)if(l<m[S].timestampBase){E=S-1;break}return E},v.prototype._onInitChunkArrival=function(l,m){var E=this,S=null,O=0;if(m>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,O=this._demuxer.parseChunks(l,m);else if((S=b.default.probe(l)).match){this._demuxer=new b.default(S,this._config),this._remuxer||(this._remuxer=new T.default(this._config));var D=this._mediaDataSource;D.duration!=null&&!isNaN(D.duration)&&(this._demuxer.overridedDuration=D.duration),typeof D.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=D.hasAudio),typeof D.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=D.hasVideo),this._demuxer.timestampBase=D.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),O=this._demuxer.parseChunks(l,m)}else S=null,d.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){E._internalAbort()}),this._emitter.emit(u.default.DEMUX_ERROR,_.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),O=0;return O},v.prototype._onMediaInfo=function(l){var m=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},l),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,y.default.prototype));var E=Object.assign({},l);Object.setPrototypeOf(E,y.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=E,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var S=m._pendingSeekTime;m._pendingSeekTime=null,m.seek(S)})},v.prototype._onMetaDataArrived=function(l){this._emitter.emit(u.default.METADATA_ARRIVED,l)},v.prototype._onScriptDataArrived=function(l){this._emitter.emit(u.default.SCRIPTDATA_ARRIVED,l)},v.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},v.prototype._onIOComplete=function(l){var m=l,E=m+1;E<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(E)):(this._remuxer.flushStashedSamples(),this._emitter.emit(u.default.LOADING_COMPLETE),this._disableStatisticsReporter())},v.prototype._onIORedirect=function(l){var m=this._ioctl.extraData;this._mediaDataSource.segments[m].redirectedURL=l},v.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(u.default.RECOVERED_EARLY_EOF)},v.prototype._onIOException=function(l,m){d.default.e(this.TAG,"IOException: type = "+l+", code = "+m.code+", msg = "+m.msg),this._emitter.emit(u.default.IO_ERROR,l,m),this._disableStatisticsReporter()},v.prototype._onDemuxException=function(l,m){d.default.e(this.TAG,"DemuxException: type = "+l+", info = "+m),this._emitter.emit(u.default.DEMUX_ERROR,l,m)},v.prototype._onRemuxerInitSegmentArrival=function(l,m){this._emitter.emit(u.default.INIT_SEGMENT,l,m)},v.prototype._onRemuxerMediaSegmentArrival=function(l,m){if(this._pendingSeekTime==null&&(this._emitter.emit(u.default.MEDIA_SEGMENT,l,m),this._pendingResolveSeekPoint!=null&&l==="video")){var E=m.info.syncPoints,S=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,h.default.safari&&E.length>0&&E[0].originalDts===S&&(S=E[0].pts),this._emitter.emit(u.default.RECOMMEND_SEEKPOINT,S)}},v.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},v.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},v.prototype._reportSegmentMediaInfo=function(l){var m=this._mediaInfo.segments[l],E=Object.assign({},m);E.duration=this._mediaInfo.duration,E.segmentCount=this._mediaInfo.segmentCount,delete E.segments,delete E.keyframesIndex,this._emitter.emit(u.default.MEDIA_INFO,E)},v.prototype._reportStatisticsInfo=function(){var l={};l.url=this._ioctl.currentURL,l.hasRedirect=this._ioctl.hasRedirect,l.hasRedirect&&(l.redirectedURL=this._ioctl.currentRedirectedURL),l.speed=this._ioctl.currentSpeed,l.loaderType=this._ioctl.loaderType,l.currentSegmentIndex=this._currentSegmentIndex,l.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(u.default.STATISTICS_INFO,l)},v}();o.default=f},"./src/core/transmuxing-events.js":function(s,o,p){p.r(o);var x={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};o.default=x},"./src/core/transmuxing-worker.js":function(s,o,p){p.r(o);var x=p("./src/utils/logging-control.js"),g=p("./src/utils/polyfill.js"),d=p("./src/core/transmuxing-controller.js"),h=p("./src/core/transmuxing-events.js"),y=function(b){var T=null,_=A.bind(this);g.default.install(),b.addEventListener("message",function(w){switch(w.data.cmd){case"init":T=new d.default(w.data.param[0],w.data.param[1]),T.on(h.default.IO_ERROR,O.bind(this)),T.on(h.default.DEMUX_ERROR,D.bind(this)),T.on(h.default.INIT_SEGMENT,c.bind(this)),T.on(h.default.MEDIA_SEGMENT,u.bind(this)),T.on(h.default.LOADING_COMPLETE,f.bind(this)),T.on(h.default.RECOVERED_EARLY_EOF,v.bind(this)),T.on(h.default.MEDIA_INFO,l.bind(this)),T.on(h.default.METADATA_ARRIVED,m.bind(this)),T.on(h.default.SCRIPTDATA_ARRIVED,E.bind(this)),T.on(h.default.STATISTICS_INFO,S.bind(this)),T.on(h.default.RECOMMEND_SEEKPOINT,P.bind(this));break;case"destroy":T&&(T.destroy(),T=null),b.postMessage({msg:"destroyed"});break;case"start":T.start();break;case"stop":T.stop();break;case"seek":T.seek(w.data.param);break;case"pause":T.pause();break;case"resume":T.resume();break;case"logging_config":{var L=w.data.param;x.default.applyConfig(L),L.enableCallback===!0?x.default.addLogListener(_):x.default.removeLogListener(_);break}}});function c(w,L){var R={msg:h.default.INIT_SEGMENT,data:{type:w,data:L}};b.postMessage(R,[L.data])}function u(w,L){var R={msg:h.default.MEDIA_SEGMENT,data:{type:w,data:L}};b.postMessage(R,[L.data])}function f(){var w={msg:h.default.LOADING_COMPLETE};b.postMessage(w)}function v(){var w={msg:h.default.RECOVERED_EARLY_EOF};b.postMessage(w)}function l(w){var L={msg:h.default.MEDIA_INFO,data:w};b.postMessage(L)}function m(w){var L={msg:h.default.METADATA_ARRIVED,data:w};b.postMessage(L)}function E(w){var L={msg:h.default.SCRIPTDATA_ARRIVED,data:w};b.postMessage(L)}function S(w){var L={msg:h.default.STATISTICS_INFO,data:w};b.postMessage(L)}function O(w,L){b.postMessage({msg:h.default.IO_ERROR,data:{type:w,info:L}})}function D(w,L){b.postMessage({msg:h.default.DEMUX_ERROR,data:{type:w,info:L}})}function P(w){b.postMessage({msg:h.default.RECOMMEND_SEEKPOINT,data:w})}function A(w,L){b.postMessage({msg:"logcat_callback",data:{type:w,logcat:L}})}};o.default=y},"./src/demux/amf-parser.js":function(s,o,p){p.r(o);var x=p("./src/utils/logger.js"),g=p("./src/utils/utf8-conv.js"),d=p("./src/utils/exception.js"),h=function(){var b=new ArrayBuffer(2);return new DataView(b).setInt16(0,256,!0),new Int16Array(b)[0]===256}(),y=function(){function b(){}return b.parseScriptData=function(T,_,c){var u={};try{var f=b.parseValue(T,_,c),v=b.parseValue(T,_+f.size,c-f.size);u[f.data]=v.data}catch(l){x.default.e("AMF",l.toString())}return u},b.parseObject=function(T,_,c){if(c<3)throw new d.IllegalStateException("Data not enough when parse ScriptDataObject");var u=b.parseString(T,_,c),f=b.parseValue(T,_+u.size,c-u.size),v=f.objectEnd;return{data:{name:u.data,value:f.data},size:u.size+f.size,objectEnd:v}},b.parseVariable=function(T,_,c){return b.parseObject(T,_,c)},b.parseString=function(T,_,c){if(c<2)throw new d.IllegalStateException("Data not enough when parse String");var u=new DataView(T,_,c),f=u.getUint16(0,!h),v;return f>0?v=(0,g.default)(new Uint8Array(T,_+2,f)):v="",{data:v,size:2+f}},b.parseLongString=function(T,_,c){if(c<4)throw new d.IllegalStateException("Data not enough when parse LongString");var u=new DataView(T,_,c),f=u.getUint32(0,!h),v;return f>0?v=(0,g.default)(new Uint8Array(T,_+4,f)):v="",{data:v,size:4+f}},b.parseDate=function(T,_,c){if(c<10)throw new d.IllegalStateException("Data size invalid when parse Date");var u=new DataView(T,_,c),f=u.getFloat64(0,!h),v=u.getInt16(8,!h);return f+=v*60*1e3,{data:new Date(f),size:8+2}},b.parseValue=function(T,_,c){if(c<1)throw new d.IllegalStateException("Data not enough when parse Value");var u=new DataView(T,_,c),f=1,v=u.getUint8(0),l,m=!1;try{switch(v){case 0:l=u.getFloat64(1,!h),f+=8;break;case 1:{var E=u.getUint8(1);l=!!E,f+=1;break}case 2:{var S=b.parseString(T,_+1,c-1);l=S.data,f+=S.size;break}case 3:{l={};var O=0;for((u.getUint32(c-4,!h)&16777215)==9&&(O=3);f<c-4;){var D=b.parseObject(T,_+f,c-f-O);if(D.objectEnd)break;l[D.data.name]=D.data.value,f+=D.size}if(f<=c-3){var P=u.getUint32(f-1,!h)&16777215;P===9&&(f+=3)}break}case 8:{l={},f+=4;var O=0;for((u.getUint32(c-4,!h)&16777215)==9&&(O=3);f<c-8;){var A=b.parseVariable(T,_+f,c-f-O);if(A.objectEnd)break;l[A.data.name]=A.data.value,f+=A.size}if(f<=c-3){var P=u.getUint32(f-1,!h)&16777215;P===9&&(f+=3)}break}case 9:l=void 0,f=1,m=!0;break;case 10:{l=[];var w=u.getUint32(1,!h);f+=4;for(var L=0;L<w;L++){var R=b.parseValue(T,_+f,c-f);l.push(R.data),f+=R.size}break}case 11:{var C=b.parseDate(T,_+1,c-1);l=C.data,f+=C.size;break}case 12:{var M=b.parseString(T,_+1,c-1);l=M.data,f+=M.size;break}default:f=c,x.default.w("AMF","Unsupported AMF value type "+v)}}catch(N){x.default.e("AMF",N.toString())}return{data:l,size:f,objectEnd:m}},b}();o.default=y},"./src/demux/demux-errors.js":function(s,o,p){p.r(o);var x={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};o.default=x},"./src/demux/exp-golomb.js":function(s,o,p){p.r(o);var x=p("./src/utils/exception.js"),g=function(){function d(h){this.TAG="ExpGolomb",this._buffer=h,this._buffer_index=0,this._total_bytes=h.byteLength,this._total_bits=h.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return d.prototype.destroy=function(){this._buffer=null},d.prototype._fillCurrentWord=function(){var h=this._total_bytes-this._buffer_index;if(h<=0)throw new x.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var y=Math.min(4,h),b=new Uint8Array(4);b.set(this._buffer.subarray(this._buffer_index,this._buffer_index+y)),this._current_word=new DataView(b.buffer).getUint32(0,!1),this._buffer_index+=y,this._current_word_bits_left=y*8},d.prototype.readBits=function(h){if(h>32)throw new x.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(h<=this._current_word_bits_left){var y=this._current_word>>>32-h;return this._current_word<<=h,this._current_word_bits_left-=h,y}var b=this._current_word_bits_left?this._current_word:0;b=b>>>32-this._current_word_bits_left;var T=h-this._current_word_bits_left;this._fillCurrentWord();var _=Math.min(T,this._current_word_bits_left),c=this._current_word>>>32-_;return this._current_word<<=_,this._current_word_bits_left-=_,b=b<<_|c,b},d.prototype.readBool=function(){return this.readBits(1)===1},d.prototype.readByte=function(){return this.readBits(8)},d.prototype._skipLeadingZero=function(){var h;for(h=0;h<this._current_word_bits_left;h++)if((this._current_word&2147483648>>>h)!=0)return this._current_word<<=h,this._current_word_bits_left-=h,h;return this._fillCurrentWord(),h+this._skipLeadingZero()},d.prototype.readUEG=function(){var h=this._skipLeadingZero();return this.readBits(h+1)-1},d.prototype.readSEG=function(){var h=this.readUEG();return h&1?h+1>>>1:-1*(h>>>1)},d}();o.default=g},"./src/demux/flv-demuxer.js":function(s,o,p){p.r(o);var x=p("./src/utils/logger.js"),g=p("./src/demux/amf-parser.js"),d=p("./src/demux/sps-parser.js"),h=p("./src/demux/demux-errors.js"),y=p("./src/core/media-info.js"),b=p("./src/utils/exception.js");function T(c,u){return c[u]<<24|c[u+1]<<16|c[u+2]<<8|c[u+3]}var _=function(){function c(u,f){this.TAG="FLVDemuxer",this._config=f,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=u.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=u.hasAudioTrack,this._hasVideo=u.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new y.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var v=new ArrayBuffer(2);return new DataView(v).setInt16(0,256,!0),new Int16Array(v)[0]===256}()}return c.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},c.probe=function(u){var f=new Uint8Array(u),v={match:!1};if(f[0]!==70||f[1]!==76||f[2]!==86||f[3]!==1)return v;var l=(f[4]&4)>>>2!=0,m=(f[4]&1)!=0,E=T(f,5);return E<9?v:{match:!0,consumed:E,dataOffset:E,hasAudioTrack:l,hasVideoTrack:m}},c.prototype.bindDataSource=function(u){return u.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(c.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(u){this._onTrackMetadata=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(u){this._onMediaInfo=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(u){this._onMetaDataArrived=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(u){this._onScriptDataArrived=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onError",{get:function(){return this._onError},set:function(u){this._onError=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(u){this._onDataAvailable=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(u){this._timestampBase=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"overridedDuration",{get:function(){return this._duration},set:function(u){this._durationOverrided=!0,this._duration=u,this._mediaInfo.duration=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"overridedHasAudio",{set:function(u){this._hasAudioFlagOverrided=!0,this._hasAudio=u,this._mediaInfo.hasAudio=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"overridedHasVideo",{set:function(u){this._hasVideoFlagOverrided=!0,this._hasVideo=u,this._mediaInfo.hasVideo=u},enumerable:!1,configurable:!0}),c.prototype.resetMediaInfo=function(){this._mediaInfo=new y.default},c.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},c.prototype.parseChunks=function(u,f){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new b.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var v=0,l=this._littleEndian;if(f===0)if(u.byteLength>13){var m=c.probe(u);v=m.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,f+v!==this._dataOffset&&x.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var E=new DataView(u,v),S=E.getUint32(0,!l);S!==0&&x.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),v+=4}for(;v<u.byteLength;){this._dispatch=!0;var E=new DataView(u,v);if(v+11+4>u.byteLength)break;var O=E.getUint8(0),D=E.getUint32(0,!l)&16777215;if(v+11+D+4>u.byteLength)break;if(O!==8&&O!==9&&O!==18){x.default.w(this.TAG,"Unsupported tag type "+O+", skipped"),v+=11+D+4;continue}var P=E.getUint8(4),A=E.getUint8(5),w=E.getUint8(6),L=E.getUint8(7),R=w|A<<8|P<<16|L<<24,C=E.getUint32(7,!l)&16777215;C!==0&&x.default.w(this.TAG,"Meet tag which has StreamID != 0!");var M=v+11;switch(O){case 8:this._parseAudioData(u,M,D,R);break;case 9:this._parseVideoData(u,M,D,R,f+v);break;case 18:this._parseScriptData(u,M,D);break}var N=E.getUint32(11+D,!l);N!==11+D&&x.default.w(this.TAG,"Invalid PrevTagSize "+N),v+=11+D+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),v},c.prototype._parseScriptData=function(u,f,v){var l=g.default.parseScriptData(u,f,v);if(l.hasOwnProperty("onMetaData")){if(l.onMetaData==null||typeof l.onMetaData!="object"){x.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&x.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=l;var m=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},m)),typeof m.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=m.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof m.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=m.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof m.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=m.audiodatarate),typeof m.videodatarate=="number"&&(this._mediaInfo.videoDataRate=m.videodatarate),typeof m.width=="number"&&(this._mediaInfo.width=m.width),typeof m.height=="number"&&(this._mediaInfo.height=m.height),typeof m.duration=="number"){if(!this._durationOverrided){var E=Math.floor(m.duration*this._timescale);this._duration=E,this._mediaInfo.duration=E}}else this._mediaInfo.duration=0;if(typeof m.framerate=="number"){var S=Math.floor(m.framerate*1e3);if(S>0){var O=S/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=O,this._referenceFrameRate.fps_num=S,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=O}}if(typeof m.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var D=m.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(D),m.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=m,x.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(l).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},l))},c.prototype._parseKeyframesIndex=function(u){for(var f=[],v=[],l=1;l<u.times.length;l++){var m=this._timestampBase+Math.floor(u.times[l]*1e3);f.push(m),v.push(u.filepositions[l])}return{times:f,filepositions:v}},c.prototype._parseAudioData=function(u,f,v,l){if(v<=1){x.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var m=new DataView(u,f,v),E=m.getUint8(0),S=E>>>4;if(S!==2&&S!==10){this._onError(h.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+S);return}var O=0,D=(E&12)>>>2;if(D>=0&&D<=4)O=this._flvSoundRateTable[D];else{this._onError(h.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+D);return}var P=E&1,A=this._audioMetadata,w=this._audioTrack;if(A||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),A=this._audioMetadata={},A.type="audio",A.id=w.id,A.timescale=this._timescale,A.duration=this._duration,A.audioSampleRate=O,A.channelCount=P===0?1:2),S===10){var L=this._parseAACAudioData(u,f+1,v-1);if(L==null)return;if(L.packetType===0){A.config&&x.default.w(this.TAG,"Found another AudioSpecificConfig!");var R=L.data;A.audioSampleRate=R.samplingRate,A.channelCount=R.channelCount,A.codec=R.codec,A.originalCodec=R.originalCodec,A.config=R.config,A.refSampleDuration=1024/A.audioSampleRate*A.timescale,x.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",A);var C=this._mediaInfo;C.audioCodec=A.originalCodec,C.audioSampleRate=A.audioSampleRate,C.audioChannelCount=A.channelCount,C.hasVideo?C.videoCodec!=null&&(C.mimeType='video/x-flv; codecs="'+C.videoCodec+","+C.audioCodec+'"'):C.mimeType='video/x-flv; codecs="'+C.audioCodec+'"',C.isComplete()&&this._onMediaInfo(C)}else if(L.packetType===1){var M=this._timestampBase+l,N={unit:L.data,length:L.data.byteLength,dts:M,pts:M};w.samples.push(N),w.length+=L.data.length}else x.default.e(this.TAG,"Flv: Unsupported AAC data type "+L.packetType)}else if(S===2){if(!A.codec){var R=this._parseMP3AudioData(u,f+1,v-1,!0);if(R==null)return;A.audioSampleRate=R.samplingRate,A.channelCount=R.channelCount,A.codec=R.codec,A.originalCodec=R.originalCodec,A.refSampleDuration=1152/A.audioSampleRate*A.timescale,x.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",A);var C=this._mediaInfo;C.audioCodec=A.codec,C.audioSampleRate=A.audioSampleRate,C.audioChannelCount=A.channelCount,C.audioDataRate=R.bitRate,C.hasVideo?C.videoCodec!=null&&(C.mimeType='video/x-flv; codecs="'+C.videoCodec+","+C.audioCodec+'"'):C.mimeType='video/x-flv; codecs="'+C.audioCodec+'"',C.isComplete()&&this._onMediaInfo(C)}var U=this._parseMP3AudioData(u,f+1,v-1,!1);if(U==null)return;var M=this._timestampBase+l,K={unit:U,length:U.byteLength,dts:M,pts:M};w.samples.push(K),w.length+=U.length}}},c.prototype._parseAACAudioData=function(u,f,v){if(v<=1){x.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var l={},m=new Uint8Array(u,f,v);return l.packetType=m[0],m[0]===0?l.data=this._parseAACAudioSpecificConfig(u,f+1,v-1):l.data=m.subarray(1),l},c.prototype._parseAACAudioSpecificConfig=function(u,f,v){var l=new Uint8Array(u,f,v),m=null,E=0,S=0,O=0,D=null;if(E=S=l[0]>>>3,O=(l[0]&7)<<1|l[1]>>>7,O<0||O>=this._mpegSamplingRates.length){this._onError(h.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var P=this._mpegSamplingRates[O],A=(l[1]&120)>>>3;if(A<0||A>=8){this._onError(h.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}E===5&&(D=(l[1]&7)<<1|l[2]>>>7,(l[2]&124)>>>2);var w=self.navigator.userAgent.toLowerCase();return w.indexOf("firefox")!==-1?O>=6?(E=5,m=new Array(4),D=O-3):(E=2,m=new Array(2),D=O):w.indexOf("android")!==-1?(E=2,m=new Array(2),D=O):(E=5,D=O,m=new Array(4),O>=6?D=O-3:A===1&&(E=2,m=new Array(2),D=O)),m[0]=E<<3,m[0]|=(O&15)>>>1,m[1]=(O&15)<<7,m[1]|=(A&15)<<3,E===5&&(m[1]|=(D&15)>>>1,m[2]=(D&1)<<7,m[2]|=2<<2,m[3]=0),{config:m,samplingRate:P,channelCount:A,codec:"mp4a.40."+E,originalCodec:"mp4a.40."+S}},c.prototype._parseMP3AudioData=function(u,f,v,l){if(v<4){x.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var m=new Uint8Array(u,f,v),E=null;if(l){if(m[0]!==255)return;var S=m[1]>>>3&3,O=(m[1]&6)>>1,D=(m[2]&240)>>>4,P=(m[2]&12)>>>2,A=m[3]>>>6&3,w=A!==3?2:1,L=0,R=0,C="mp3";switch(S){case 0:L=this._mpegAudioV25SampleRateTable[P];break;case 2:L=this._mpegAudioV20SampleRateTable[P];break;case 3:L=this._mpegAudioV10SampleRateTable[P];break}switch(O){case 1:D<this._mpegAudioL3BitRateTable.length&&(R=this._mpegAudioL3BitRateTable[D]);break;case 2:D<this._mpegAudioL2BitRateTable.length&&(R=this._mpegAudioL2BitRateTable[D]);break;case 3:D<this._mpegAudioL1BitRateTable.length&&(R=this._mpegAudioL1BitRateTable[D]);break}E={bitRate:R,samplingRate:L,channelCount:w,codec:C,originalCodec:C}}else E=m;return E},c.prototype._parseVideoData=function(u,f,v,l,m){if(v<=1){x.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var E=new Uint8Array(u,f,v)[0],S=(E&240)>>>4,O=E&15;if(O!==7){this._onError(h.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+O);return}this._parseAVCVideoPacket(u,f+1,v-1,l,m,S)}},c.prototype._parseAVCVideoPacket=function(u,f,v,l,m,E){if(v<4){x.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var S=this._littleEndian,O=new DataView(u,f,v),D=O.getUint8(0),P=O.getUint32(0,!S)&16777215,A=P<<8>>8;if(D===0)this._parseAVCDecoderConfigurationRecord(u,f+4,v-4);else if(D===1)this._parseAVCVideoData(u,f+4,v-4,l,m,E,A);else if(D!==2){this._onError(h.default.FORMAT_ERROR,"Flv: Invalid video packet type "+D);return}},c.prototype._parseAVCDecoderConfigurationRecord=function(u,f,v){if(v<7){x.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var l=this._videoMetadata,m=this._videoTrack,E=this._littleEndian,S=new DataView(u,f,v);l?typeof l.avcc!="undefined"&&x.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),l=this._videoMetadata={},l.type="video",l.id=m.id,l.timescale=this._timescale,l.duration=this._duration);var O=S.getUint8(0),D=S.getUint8(1);if(S.getUint8(2),S.getUint8(3),O!==1||D===0){this._onError(h.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(S.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(h.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var P=S.getUint8(5)&31;if(P===0){this._onError(h.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else P>1&&x.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+P);for(var A=6,w=0;w<P;w++){var L=S.getUint16(A,!E);if(A+=2,L!==0){var R=new Uint8Array(u,f+A,L);A+=L;var C=d.default.parseSPS(R);if(w===0){l.codecWidth=C.codec_size.width,l.codecHeight=C.codec_size.height,l.presentWidth=C.present_size.width,l.presentHeight=C.present_size.height,l.profile=C.profile_string,l.level=C.level_string,l.bitDepth=C.bit_depth,l.chromaFormat=C.chroma_format,l.sarRatio=C.sar_ratio,l.frameRate=C.frame_rate,(C.frame_rate.fixed===!1||C.frame_rate.fps_num===0||C.frame_rate.fps_den===0)&&(l.frameRate=this._referenceFrameRate);var M=l.frameRate.fps_den,N=l.frameRate.fps_num;l.refSampleDuration=l.timescale*(M/N);for(var U=R.subarray(1,4),K="avc1.",V=0;V<3;V++){var W=U[V].toString(16);W.length<2&&(W="0"+W),K+=W}l.codec=K;var G=this._mediaInfo;G.width=l.codecWidth,G.height=l.codecHeight,G.fps=l.frameRate.fps,G.profile=l.profile,G.level=l.level,G.refFrames=C.ref_frames,G.chromaFormat=C.chroma_format_string,G.sarNum=l.sarRatio.width,G.sarDen=l.sarRatio.height,G.videoCodec=K,G.hasAudio?G.audioCodec!=null&&(G.mimeType='video/x-flv; codecs="'+G.videoCodec+","+G.audioCodec+'"'):G.mimeType='video/x-flv; codecs="'+G.videoCodec+'"',G.isComplete()&&this._onMediaInfo(G)}}}var Y=S.getUint8(A);if(Y===0){this._onError(h.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else Y>1&&x.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+Y);A++;for(var w=0;w<Y;w++){var L=S.getUint16(A,!E);A+=2,L!==0&&(A+=L)}l.avcc=new Uint8Array(v),l.avcc.set(new Uint8Array(u,f,v),0),x.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",l)},c.prototype._parseAVCVideoData=function(u,f,v,l,m,E,S){for(var O=this._littleEndian,D=new DataView(u,f,v),P=[],A=0,w=0,L=this._naluLengthSize,R=this._timestampBase+l,C=E===1;w<v;){if(w+4>=v){x.default.w(this.TAG,"Malformed Nalu near timestamp "+R+", offset = "+w+", dataSize = "+v);break}var M=D.getUint32(w,!O);if(L===3&&(M>>>=8),M>v-L){x.default.w(this.TAG,"Malformed Nalus near timestamp "+R+", NaluSize > DataSize!");return}var N=D.getUint8(w+L)&31;N===5&&(C=!0);var U=new Uint8Array(u,f+w,L+M),K={type:N,data:U};P.push(K),A+=U.byteLength,w+=L+M}if(P.length){var V=this._videoTrack,W={units:P,length:A,isKeyframe:C,dts:R,cts:S,pts:R+S};C&&(W.fileposition=m),V.samples.push(W),V.length+=A}},c}();o.default=_},"./src/demux/sps-parser.js":function(s,o,p){p.r(o);var x=p("./src/demux/exp-golomb.js"),g=function(){function d(){}return d._ebsp2rbsp=function(h){for(var y=h,b=y.byteLength,T=new Uint8Array(b),_=0,c=0;c<b;c++)c>=2&&y[c]===3&&y[c-1]===0&&y[c-2]===0||(T[_]=y[c],_++);return new Uint8Array(T.buffer,0,_)},d.parseSPS=function(h){var y=d._ebsp2rbsp(h),b=new x.default(y);b.readByte();var T=b.readByte();b.readByte();var _=b.readByte();b.readUEG();var c=d.getProfileString(T),u=d.getLevelString(_),f=1,v=420,l=[0,420,422,444],m=8;if((T===100||T===110||T===122||T===244||T===44||T===83||T===86||T===118||T===128||T===138||T===144)&&(f=b.readUEG(),f===3&&b.readBits(1),f<=3&&(v=l[f]),m=b.readUEG()+8,b.readUEG(),b.readBits(1),b.readBool()))for(var E=f!==3?8:12,S=0;S<E;S++)b.readBool()&&(S<6?d._skipScalingList(b,16):d._skipScalingList(b,64));b.readUEG();var O=b.readUEG();if(O===0)b.readUEG();else if(O===1){b.readBits(1),b.readSEG(),b.readSEG();for(var D=b.readUEG(),S=0;S<D;S++)b.readSEG()}var P=b.readUEG();b.readBits(1);var A=b.readUEG(),w=b.readUEG(),L=b.readBits(1);L===0&&b.readBits(1),b.readBits(1);var R=0,C=0,M=0,N=0,U=b.readBool();U&&(R=b.readUEG(),C=b.readUEG(),M=b.readUEG(),N=b.readUEG());var K=1,V=1,W=0,G=!0,Y=0,q=0,ee=b.readBool();if(ee){if(b.readBool()){var re=b.readByte(),pe=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Le=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];re>0&&re<16?(K=pe[re-1],V=Le[re-1]):re===255&&(K=b.readByte()<<8|b.readByte(),V=b.readByte()<<8|b.readByte())}if(b.readBool()&&b.readBool(),b.readBool()&&(b.readBits(4),b.readBool()&&b.readBits(24)),b.readBool()&&(b.readUEG(),b.readUEG()),b.readBool()){var Te=b.readBits(32),be=b.readBits(32);G=b.readBool(),Y=be,q=Te*2,W=Y/q}}var Re=1;(K!==1||V!==1)&&(Re=K/V);var Se=0,Ge=0;if(f===0)Se=1,Ge=2-L;else{var $e=f===3?1:2,st=f===1?2:1;Se=$e,Ge=st*(2-L)}var Ze=(A+1)*16,et=(2-L)*((w+1)*16);Ze-=(R+C)*Se,et-=(M+N)*Ge;var ft=Math.ceil(Ze*Re);return b.destroy(),b=null,{profile_string:c,level_string:u,bit_depth:m,ref_frames:P,chroma_format:v,chroma_format_string:d.getChromaFormatString(v),frame_rate:{fixed:G,fps:W,fps_den:q,fps_num:Y},sar_ratio:{width:K,height:V},codec_size:{width:Ze,height:et},present_size:{width:ft,height:et}}},d._skipScalingList=function(h,y){for(var b=8,T=8,_=0,c=0;c<y;c++)T!==0&&(_=h.readSEG(),T=(b+_+256)%256),b=T===0?b:T},d.getProfileString=function(h){switch(h){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},d.getLevelString=function(h){return(h/10).toFixed(1)},d.getChromaFormatString=function(h){switch(h){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},d}();o.default=g},"./src/flv.js":function(s,o,p){p.r(o);var x=p("./src/utils/polyfill.js"),g=p("./src/core/features.js"),d=p("./src/io/loader.js"),h=p("./src/player/flv-player.js"),y=p("./src/player/native-player.js"),b=p("./src/player/player-events.js"),T=p("./src/player/player-errors.js"),_=p("./src/utils/logging-control.js"),c=p("./src/utils/exception.js");x.default.install();function u(m,E){var S=m;if(S==null||typeof S!="object")throw new c.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!S.hasOwnProperty("type"))throw new c.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(S.type){case"flv":return new h.default(S,E);default:return new y.default(S,E)}}function f(){return g.default.supportMSEH264Playback()}function v(){return g.default.getFeatureList()}var l={};l.createPlayer=u,l.isSupported=f,l.getFeatureList=v,l.BaseLoader=d.BaseLoader,l.LoaderStatus=d.LoaderStatus,l.LoaderErrors=d.LoaderErrors,l.Events=b.default,l.ErrorTypes=T.ErrorTypes,l.ErrorDetails=T.ErrorDetails,l.FlvPlayer=h.default,l.NativePlayer=y.default,l.LoggingControl=_.default,Object.defineProperty(l,"version",{enumerable:!0,get:function(){return"1.6.2"}}),o.default=l},"./src/index.js":function(s,o,p){s.exports=p("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(s,o,p){p.r(o);var x=p("./src/utils/browser.js"),g=p("./src/io/loader.js"),d=p("./src/utils/exception.js"),h=function(){var b=function(T,_){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,u){c.__proto__=u}||function(c,u){for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(c[f]=u[f])},b(T,_)};return function(T,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");b(T,_);function c(){this.constructor=T}T.prototype=_===null?Object.create(_):(c.prototype=_.prototype,new c)}}(),y=function(b){h(T,b);function T(_,c){var u=b.call(this,"fetch-stream-loader")||this;return u.TAG="FetchStreamLoader",u._seekHandler=_,u._config=c,u._needStash=!0,u._requestAbort=!1,u._contentLength=null,u._receivedLength=0,u}return T.isSupported=function(){try{var _=x.default.msedge&&x.default.version.minor>=15048,c=x.default.msedge?_:!0;return self.fetch&&self.ReadableStream&&c}catch(u){return!1}},T.prototype.destroy=function(){this.isWorking()&&this.abort(),b.prototype.destroy.call(this)},T.prototype.open=function(_,c){var u=this;this._dataSource=_,this._range=c;var f=_.url;this._config.reuseRedirectedURL&&_.redirectedURL!=null&&(f=_.redirectedURL);var v=this._seekHandler.getConfig(f,c),l=new self.Headers;if(typeof v.headers=="object"){var m=v.headers;for(var E in m)m.hasOwnProperty(E)&&l.append(E,m[E])}var S={method:"GET",headers:l,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var E in this._config.headers)l.append(E,this._config.headers[E]);_.cors===!1&&(S.mode="same-origin"),_.withCredentials&&(S.credentials="include"),_.referrerPolicy&&(S.referrerPolicy=_.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,S.signal=this._abortController.signal),this._status=g.LoaderStatus.kConnecting,self.fetch(v.url,S).then(function(O){if(u._requestAbort){u._status=g.LoaderStatus.kIdle,O.body.cancel();return}if(O.ok&&O.status>=200&&O.status<=299){if(O.url!==v.url&&u._onURLRedirect){var D=u._seekHandler.removeURLParameters(O.url);u._onURLRedirect(D)}var P=O.headers.get("Content-Length");return P!=null&&(u._contentLength=parseInt(P),u._contentLength!==0&&u._onContentLengthKnown&&u._onContentLengthKnown(u._contentLength)),u._pump.call(u,O.body.getReader())}else if(u._status=g.LoaderStatus.kError,u._onError)u._onError(g.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:O.status,msg:O.statusText});else throw new d.RuntimeException("FetchStreamLoader: Http code invalid, "+O.status+" "+O.statusText)}).catch(function(O){if(!(u._abortController&&u._abortController.signal.aborted))if(u._status=g.LoaderStatus.kError,u._onError)u._onError(g.LoaderErrors.EXCEPTION,{code:-1,msg:O.message});else throw O})},T.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==g.LoaderStatus.kBuffering||!x.default.chrome)&&this._abortController)try{this._abortController.abort()}catch(_){}},T.prototype._pump=function(_){var c=this;return _.read().then(function(u){if(u.done)if(c._contentLength!==null&&c._receivedLength<c._contentLength){c._status=g.LoaderStatus.kError;var f=g.LoaderErrors.EARLY_EOF,v={code:-1,msg:"Fetch stream meet Early-EOF"};if(c._onError)c._onError(f,v);else throw new d.RuntimeException(v.msg)}else c._status=g.LoaderStatus.kComplete,c._onComplete&&c._onComplete(c._range.from,c._range.from+c._receivedLength-1);else{if(c._abortController&&c._abortController.signal.aborted){c._status=g.LoaderStatus.kComplete;return}else if(c._requestAbort===!0)return c._status=g.LoaderStatus.kComplete,_.cancel();c._status=g.LoaderStatus.kBuffering;var l=u.value.buffer,m=c._range.from+c._receivedLength;c._receivedLength+=l.byteLength,c._onDataArrival&&c._onDataArrival(l,m,c._receivedLength),c._pump(_)}}).catch(function(u){if(c._abortController&&c._abortController.signal.aborted){c._status=g.LoaderStatus.kComplete;return}if(!(u.code===11&&x.default.msedge)){c._status=g.LoaderStatus.kError;var f=0,v=null;if((u.code===19||u.message==="network error")&&(c._contentLength===null||c._contentLength!==null&&c._receivedLength<c._contentLength)?(f=g.LoaderErrors.EARLY_EOF,v={code:u.code,msg:"Fetch stream meet Early-EOF"}):(f=g.LoaderErrors.EXCEPTION,v={code:u.code,msg:u.message}),c._onError)c._onError(f,v);else throw new d.RuntimeException(v.msg)}})},T}(g.BaseLoader);o.default=y},"./src/io/io-controller.js":function(s,o,p){p.r(o);var x=p("./src/utils/logger.js"),g=p("./src/io/speed-sampler.js"),d=p("./src/io/loader.js"),h=p("./src/io/fetch-stream-loader.js"),y=p("./src/io/xhr-moz-chunked-loader.js"),b=p("./src/io/xhr-range-loader.js"),T=p("./src/io/websocket-loader.js"),_=p("./src/io/range-seek-handler.js"),c=p("./src/io/param-seek-handler.js"),u=p("./src/utils/exception.js"),f=function(){function v(l,m,E){this.TAG="IOController",this._config=m,this._extraData=E,this._stashInitialSize=1024*384,m.stashInitialSize!=null&&m.stashInitialSize>0&&(this._stashInitialSize=m.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,m.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=l,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(l.url),this._refTotalLength=l.filesize?l.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new g.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return v.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},v.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},v.prototype.isPaused=function(){return this._paused},Object.defineProperty(v.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"extraData",{get:function(){return this._extraData},set:function(l){this._extraData=l},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(l){this._onDataArrival=l},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(l){this._onSeeked=l},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onError",{get:function(){return this._onError},set:function(l){this._onError=l},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onComplete",{get:function(){return this._onComplete},set:function(l){this._onComplete=l},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(l){this._onRedirect=l},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(l){this._onRecoveredEarlyEof=l},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"currentSpeed",{get:function(){return this._loaderClass===b.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),v.prototype._selectSeekHandler=function(){var l=this._config;if(l.seekType==="range")this._seekHandler=new _.default(this._config.rangeLoadZeroStart);else if(l.seekType==="param"){var m=l.seekParamStart||"bstart",E=l.seekParamEnd||"bend";this._seekHandler=new c.default(m,E)}else if(l.seekType==="custom"){if(typeof l.customSeekHandler!="function")throw new u.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new l.customSeekHandler}else throw new u.InvalidArgumentException("Invalid seekType in config: "+l.seekType)},v.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=T.default;else if(h.default.isSupported())this._loaderClass=h.default;else if(y.default.isSupported())this._loaderClass=y.default;else if(b.default.isSupported())this._loaderClass=b.default;else throw new u.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},v.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},v.prototype.open=function(l){this._currentRange={from:0,to:-1},l&&(this._currentRange.from=l),this._speedSampler.reset(),l||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},v.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},v.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},v.prototype.resume=function(){if(this._paused){this._paused=!1;var l=this._resumeFrom;this._resumeFrom=0,this._internalSeek(l,!0)}},v.prototype.seek=function(l){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(l,!0)},v.prototype._internalSeek=function(l,m){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(m),this._loader.destroy(),this._loader=null;var E={from:l,to:-1};this._currentRange={from:E.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,E),this._onSeeked&&this._onSeeked()},v.prototype.updateUrl=function(l){if(!l||typeof l!="string"||l.length===0)throw new u.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=l},v.prototype._expandBuffer=function(l){for(var m=this._stashSize;m+1024*1024*1<l;)m*=2;if(m+=1024*1024*1,m!==this._bufferSize){var E=new ArrayBuffer(m);if(this._stashUsed>0){var S=new Uint8Array(this._stashBuffer,0,this._stashUsed),O=new Uint8Array(E,0,m);O.set(S,0)}this._stashBuffer=E,this._bufferSize=m}},v.prototype._normalizeSpeed=function(l){var m=this._speedNormalizeList,E=m.length-1,S=0,O=0,D=E;if(l<m[0])return m[0];for(;O<=D;){if(S=O+Math.floor((D-O)/2),S===E||l>=m[S]&&l<m[S+1])return m[S];m[S]<l?O=S+1:D=S-1}},v.prototype._adjustStashSize=function(l){var m=0;this._config.isLive||l<512?m=l:l>=512&&l<=1024?m=Math.floor(l*1.5):m=l*2,m>8192&&(m=8192);var E=m*1024+1024*1024*1;this._bufferSize<E&&this._expandBuffer(E),this._stashSize=m*1024},v.prototype._dispatchChunks=function(l,m){return this._currentRange.to=m+l.byteLength-1,this._onDataArrival(l,m)},v.prototype._onURLRedirect=function(l){this._redirectedURL=l,this._onRedirect&&this._onRedirect(l)},v.prototype._onContentLengthKnown=function(l){l&&this._fullRequestFlag&&(this._totalLength=l,this._fullRequestFlag=!1)},v.prototype._onLoaderChunkArrival=function(l,m,E){if(!this._onDataArrival)throw new u.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(l.byteLength);var S=this._speedSampler.lastSecondKBps;if(S!==0){var O=this._normalizeSpeed(S);this._speedNormalized!==O&&(this._speedNormalized=O,this._adjustStashSize(O))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=m),this._stashUsed+l.byteLength<=this._stashSize){var A=new Uint8Array(this._stashBuffer,0,this._stashSize);A.set(new Uint8Array(l),this._stashUsed),this._stashUsed+=l.byteLength}else{var A=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var L=this._stashBuffer.slice(0,this._stashUsed),D=this._dispatchChunks(L,this._stashByteStart);if(D<L.byteLength){if(D>0){var w=new Uint8Array(L,D);A.set(w,0),this._stashUsed=w.byteLength,this._stashByteStart+=D}}else this._stashUsed=0,this._stashByteStart+=D;this._stashUsed+l.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+l.byteLength),A=new Uint8Array(this._stashBuffer,0,this._bufferSize)),A.set(new Uint8Array(l),this._stashUsed),this._stashUsed+=l.byteLength}else{var D=this._dispatchChunks(l,m);if(D<l.byteLength){var P=l.byteLength-D;P>this._bufferSize&&(this._expandBuffer(P),A=new Uint8Array(this._stashBuffer,0,this._bufferSize)),A.set(new Uint8Array(l,D),0),this._stashUsed+=P,this._stashByteStart=m+D}}}else if(this._stashUsed===0){var D=this._dispatchChunks(l,m);if(D<l.byteLength){var P=l.byteLength-D;P>this._bufferSize&&this._expandBuffer(P);var A=new Uint8Array(this._stashBuffer,0,this._bufferSize);A.set(new Uint8Array(l,D),0),this._stashUsed+=P,this._stashByteStart=m+D}}else{this._stashUsed+l.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+l.byteLength);var A=new Uint8Array(this._stashBuffer,0,this._bufferSize);A.set(new Uint8Array(l),this._stashUsed),this._stashUsed+=l.byteLength;var D=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(D<this._stashUsed&&D>0){var w=new Uint8Array(this._stashBuffer,D);A.set(w,0)}this._stashUsed-=D,this._stashByteStart+=D}}},v.prototype._flushStashBuffer=function(l){if(this._stashUsed>0){var m=this._stashBuffer.slice(0,this._stashUsed),E=this._dispatchChunks(m,this._stashByteStart),S=m.byteLength-E;if(E<m.byteLength)if(l)x.default.w(this.TAG,S+" bytes unconsumed data remain when flush buffer, dropped");else{if(E>0){var O=new Uint8Array(this._stashBuffer,0,this._bufferSize),D=new Uint8Array(m,E);O.set(D,0),this._stashUsed=D.byteLength,this._stashByteStart+=E}return 0}return this._stashUsed=0,this._stashByteStart=0,S}return 0},v.prototype._onLoaderComplete=function(l,m){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},v.prototype._onLoaderError=function(l,m){switch(x.default.e(this.TAG,"Loader error, code = "+m.code+", msg = "+m.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,l=d.LoaderErrors.UNRECOVERABLE_EARLY_EOF),l){case d.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var E=this._currentRange.to+1;E<this._totalLength&&(x.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(E,!1));return}l=d.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case d.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case d.LoaderErrors.CONNECTING_TIMEOUT:case d.LoaderErrors.HTTP_STATUS_CODE_INVALID:case d.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(l,m);else throw new u.RuntimeException("IOException: "+m.msg)},v}();o.default=f},"./src/io/loader.js":function(s,o,p){p.r(o),p.d(o,{LoaderStatus:function(){return g},LoaderErrors:function(){return d},BaseLoader:function(){return h}});var x=p("./src/utils/exception.js"),g={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},d={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},h=function(){function y(b){this._type=b||"undefined",this._status=g.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return y.prototype.destroy=function(){this._status=g.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},y.prototype.isWorking=function(){return this._status===g.kConnecting||this._status===g.kBuffering},Object.defineProperty(y.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(b){this._onContentLengthKnown=b},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(b){this._onURLRedirect=b},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(b){this._onDataArrival=b},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onError",{get:function(){return this._onError},set:function(b){this._onError=b},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"onComplete",{get:function(){return this._onComplete},set:function(b){this._onComplete=b},enumerable:!1,configurable:!0}),y.prototype.open=function(b,T){throw new x.NotImplementedException("Unimplemented abstract function!")},y.prototype.abort=function(){throw new x.NotImplementedException("Unimplemented abstract function!")},y}()},"./src/io/param-seek-handler.js":function(s,o,p){p.r(o);var x=function(){function g(d,h){this._startName=d,this._endName=h}return g.prototype.getConfig=function(d,h){var y=d;if(h.from!==0||h.to!==-1){var b=!0;y.indexOf("?")===-1&&(y+="?",b=!1),b&&(y+="&"),y+=this._startName+"="+h.from.toString(),h.to!==-1&&(y+="&"+this._endName+"="+h.to.toString())}return{url:y,headers:{}}},g.prototype.removeURLParameters=function(d){var h=d.split("?")[0],y=void 0,b=d.indexOf("?");b!==-1&&(y=d.substring(b+1));var T="";if(y!=null&&y.length>0)for(var _=y.split("&"),c=0;c<_.length;c++){var u=_[c].split("="),f=c>0;u[0]!==this._startName&&u[0]!==this._endName&&(f&&(T+="&"),T+=_[c])}return T.length===0?h:h+"?"+T},g}();o.default=x},"./src/io/range-seek-handler.js":function(s,o,p){p.r(o);var x=function(){function g(d){this._zeroStart=d||!1}return g.prototype.getConfig=function(d,h){var y={};if(h.from!==0||h.to!==-1){var b=void 0;h.to!==-1?b="bytes="+h.from.toString()+"-"+h.to.toString():b="bytes="+h.from.toString()+"-",y.Range=b}else this._zeroStart&&(y.Range="bytes=0-");return{url:d,headers:y}},g.prototype.removeURLParameters=function(d){return d},g}();o.default=x},"./src/io/speed-sampler.js":function(s,o,p){p.r(o);var x=function(){function g(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return g.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},g.prototype.addBytes=function(d){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=d,this._totalBytes+=d):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=d,this._totalBytes+=d):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=d,this._totalBytes+=d,this._lastCheckpoint=this._now())},Object.defineProperty(g.prototype,"currentKBps",{get:function(){this.addBytes(0);var d=(this._now()-this._lastCheckpoint)/1e3;return d==0&&(d=1),this._intervalBytes/d/1024},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"averageKBps",{get:function(){var d=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/d/1024},enumerable:!1,configurable:!0}),g}();o.default=x},"./src/io/websocket-loader.js":function(s,o,p){p.r(o);var x=p("./src/io/loader.js"),g=p("./src/utils/exception.js"),d=function(){var y=function(b,T){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,c){_.__proto__=c}||function(_,c){for(var u in c)Object.prototype.hasOwnProperty.call(c,u)&&(_[u]=c[u])},y(b,T)};return function(b,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");y(b,T);function _(){this.constructor=b}b.prototype=T===null?Object.create(T):(_.prototype=T.prototype,new _)}}(),h=function(y){d(b,y);function b(){var T=y.call(this,"websocket-loader")||this;return T.TAG="WebSocketLoader",T._needStash=!0,T._ws=null,T._requestAbort=!1,T._receivedLength=0,T}return b.isSupported=function(){try{return typeof self.WebSocket!="undefined"}catch(T){return!1}},b.prototype.destroy=function(){this._ws&&this.abort(),y.prototype.destroy.call(this)},b.prototype.open=function(T){try{var _=this._ws=new self.WebSocket(T.url);_.binaryType="arraybuffer",_.onopen=this._onWebSocketOpen.bind(this),_.onclose=this._onWebSocketClose.bind(this),_.onmessage=this._onWebSocketMessage.bind(this),_.onerror=this._onWebSocketError.bind(this),this._status=x.LoaderStatus.kConnecting}catch(u){this._status=x.LoaderStatus.kError;var c={code:u.code,msg:u.message};if(this._onError)this._onError(x.LoaderErrors.EXCEPTION,c);else throw new g.RuntimeException(c.msg)}},b.prototype.abort=function(){var T=this._ws;T&&(T.readyState===0||T.readyState===1)&&(this._requestAbort=!0,T.close()),this._ws=null,this._status=x.LoaderStatus.kComplete},b.prototype._onWebSocketOpen=function(T){this._status=x.LoaderStatus.kBuffering},b.prototype._onWebSocketClose=function(T){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=x.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},b.prototype._onWebSocketMessage=function(T){var _=this;if(T.data instanceof ArrayBuffer)this._dispatchArrayBuffer(T.data);else if(T.data instanceof Blob){var c=new FileReader;c.onload=function(){_._dispatchArrayBuffer(c.result)},c.readAsArrayBuffer(T.data)}else{this._status=x.LoaderStatus.kError;var u={code:-1,msg:"Unsupported WebSocket message type: "+T.data.constructor.name};if(this._onError)this._onError(x.LoaderErrors.EXCEPTION,u);else throw new g.RuntimeException(u.msg)}},b.prototype._dispatchArrayBuffer=function(T){var _=T,c=this._receivedLength;this._receivedLength+=_.byteLength,this._onDataArrival&&this._onDataArrival(_,c,this._receivedLength)},b.prototype._onWebSocketError=function(T){this._status=x.LoaderStatus.kError;var _={code:T.code,msg:T.message};if(this._onError)this._onError(x.LoaderErrors.EXCEPTION,_);else throw new g.RuntimeException(_.msg)},b}(x.BaseLoader);o.default=h},"./src/io/xhr-moz-chunked-loader.js":function(s,o,p){p.r(o);var x=p("./src/utils/logger.js"),g=p("./src/io/loader.js"),d=p("./src/utils/exception.js"),h=function(){var b=function(T,_){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,u){c.__proto__=u}||function(c,u){for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(c[f]=u[f])},b(T,_)};return function(T,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");b(T,_);function c(){this.constructor=T}T.prototype=_===null?Object.create(_):(c.prototype=_.prototype,new c)}}(),y=function(b){h(T,b);function T(_,c){var u=b.call(this,"xhr-moz-chunked-loader")||this;return u.TAG="MozChunkedLoader",u._seekHandler=_,u._config=c,u._needStash=!0,u._xhr=null,u._requestAbort=!1,u._contentLength=null,u._receivedLength=0,u}return T.isSupported=function(){try{var _=new XMLHttpRequest;return _.open("GET","https://example.com",!0),_.responseType="moz-chunked-arraybuffer",_.responseType==="moz-chunked-arraybuffer"}catch(c){return x.default.w("MozChunkedLoader",c.message),!1}},T.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),b.prototype.destroy.call(this)},T.prototype.open=function(_,c){this._dataSource=_,this._range=c;var u=_.url;this._config.reuseRedirectedURL&&_.redirectedURL!=null&&(u=_.redirectedURL);var f=this._seekHandler.getConfig(u,c);this._requestURL=f.url;var v=this._xhr=new XMLHttpRequest;if(v.open("GET",f.url,!0),v.responseType="moz-chunked-arraybuffer",v.onreadystatechange=this._onReadyStateChange.bind(this),v.onprogress=this._onProgress.bind(this),v.onloadend=this._onLoadEnd.bind(this),v.onerror=this._onXhrError.bind(this),_.withCredentials&&(v.withCredentials=!0),typeof f.headers=="object"){var l=f.headers;for(var m in l)l.hasOwnProperty(m)&&v.setRequestHeader(m,l[m])}if(typeof this._config.headers=="object"){var l=this._config.headers;for(var m in l)l.hasOwnProperty(m)&&v.setRequestHeader(m,l[m])}this._status=g.LoaderStatus.kConnecting,v.send()},T.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=g.LoaderStatus.kComplete},T.prototype._onReadyStateChange=function(_){var c=_.target;if(c.readyState===2){if(c.responseURL!=null&&c.responseURL!==this._requestURL&&this._onURLRedirect){var u=this._seekHandler.removeURLParameters(c.responseURL);this._onURLRedirect(u)}if(c.status!==0&&(c.status<200||c.status>299))if(this._status=g.LoaderStatus.kError,this._onError)this._onError(g.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:c.status,msg:c.statusText});else throw new d.RuntimeException("MozChunkedLoader: Http code invalid, "+c.status+" "+c.statusText);else this._status=g.LoaderStatus.kBuffering}},T.prototype._onProgress=function(_){if(this._status!==g.LoaderStatus.kError){this._contentLength===null&&_.total!==null&&_.total!==0&&(this._contentLength=_.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var c=_.target.response,u=this._range.from+this._receivedLength;this._receivedLength+=c.byteLength,this._onDataArrival&&this._onDataArrival(c,u,this._receivedLength)}},T.prototype._onLoadEnd=function(_){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===g.LoaderStatus.kError)return;this._status=g.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},T.prototype._onXhrError=function(_){this._status=g.LoaderStatus.kError;var c=0,u=null;if(this._contentLength&&_.loaded<this._contentLength?(c=g.LoaderErrors.EARLY_EOF,u={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(c=g.LoaderErrors.EXCEPTION,u={code:-1,msg:_.constructor.name+" "+_.type}),this._onError)this._onError(c,u);else throw new d.RuntimeException(u.msg)},T}(g.BaseLoader);o.default=y},"./src/io/xhr-range-loader.js":function(s,o,p){p.r(o);var x=p("./src/utils/logger.js"),g=p("./src/io/speed-sampler.js"),d=p("./src/io/loader.js"),h=p("./src/utils/exception.js"),y=function(){var T=function(_,c){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var v in f)Object.prototype.hasOwnProperty.call(f,v)&&(u[v]=f[v])},T(_,c)};return function(_,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");T(_,c);function u(){this.constructor=_}_.prototype=c===null?Object.create(c):(u.prototype=c.prototype,new u)}}(),b=function(T){y(_,T);function _(c,u){var f=T.call(this,"xhr-range-loader")||this;return f.TAG="RangeLoader",f._seekHandler=c,f._config=u,f._needStash=!1,f._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],f._currentChunkSizeKB=384,f._currentSpeedNormalized=0,f._zeroSpeedChunkCount=0,f._xhr=null,f._speedSampler=new g.default,f._requestAbort=!1,f._waitForTotalLength=!1,f._totalLengthReceived=!1,f._currentRequestURL=null,f._currentRedirectedURL=null,f._currentRequestRange=null,f._totalLength=null,f._contentLength=null,f._receivedLength=0,f._lastTimeLoaded=0,f}return _.isSupported=function(){try{var c=new XMLHttpRequest;return c.open("GET","https://example.com",!0),c.responseType="arraybuffer",c.responseType==="arraybuffer"}catch(u){return x.default.w("RangeLoader",u.message),!1}},_.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),T.prototype.destroy.call(this)},Object.defineProperty(_.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),_.prototype.open=function(c,u){this._dataSource=c,this._range=u,this._status=d.LoaderStatus.kConnecting;var f=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(f=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!f?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},_.prototype._openSubRange=function(){var c=this._currentChunkSizeKB*1024,u=this._range.from+this._receivedLength,f=u+c;this._contentLength!=null&&f-this._range.from>=this._contentLength&&(f=this._range.from+this._contentLength-1),this._currentRequestRange={from:u,to:f},this._internalOpen(this._dataSource,this._currentRequestRange)},_.prototype._internalOpen=function(c,u){this._lastTimeLoaded=0;var f=c.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?f=this._currentRedirectedURL:c.redirectedURL!=null&&(f=c.redirectedURL));var v=this._seekHandler.getConfig(f,u);this._currentRequestURL=v.url;var l=this._xhr=new XMLHttpRequest;if(l.open("GET",v.url,!0),l.responseType="arraybuffer",l.onreadystatechange=this._onReadyStateChange.bind(this),l.onprogress=this._onProgress.bind(this),l.onload=this._onLoad.bind(this),l.onerror=this._onXhrError.bind(this),c.withCredentials&&(l.withCredentials=!0),typeof v.headers=="object"){var m=v.headers;for(var E in m)m.hasOwnProperty(E)&&l.setRequestHeader(E,m[E])}if(typeof this._config.headers=="object"){var m=this._config.headers;for(var E in m)m.hasOwnProperty(E)&&l.setRequestHeader(E,m[E])}l.send()},_.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=d.LoaderStatus.kComplete},_.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},_.prototype._onReadyStateChange=function(c){var u=c.target;if(u.readyState===2){if(u.responseURL!=null){var f=this._seekHandler.removeURLParameters(u.responseURL);u.responseURL!==this._currentRequestURL&&f!==this._currentRedirectedURL&&(this._currentRedirectedURL=f,this._onURLRedirect&&this._onURLRedirect(f))}if(u.status>=200&&u.status<=299){if(this._waitForTotalLength)return;this._status=d.LoaderStatus.kBuffering}else if(this._status=d.LoaderStatus.kError,this._onError)this._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:u.status,msg:u.statusText});else throw new h.RuntimeException("RangeLoader: Http code invalid, "+u.status+" "+u.statusText)}},_.prototype._onProgress=function(c){if(this._status!==d.LoaderStatus.kError){if(this._contentLength===null){var u=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,u=!0;var f=c.total;this._internalAbort(),f!=null&f!==0&&(this._totalLength=f)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,u){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var v=c.loaded-this._lastTimeLoaded;this._lastTimeLoaded=c.loaded,this._speedSampler.addBytes(v)}},_.prototype._normalizeSpeed=function(c){var u=this._chunkSizeKBList,f=u.length-1,v=0,l=0,m=f;if(c<u[0])return u[0];for(;l<=m;){if(v=l+Math.floor((m-l)/2),v===f||c>=u[v]&&c<u[v+1])return u[v];u[v]<c?l=v+1:m=v-1}},_.prototype._onLoad=function(c){if(this._status!==d.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var u=this._speedSampler.lastSecondKBps;if(u===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(u=this._speedSampler.currentKBps)),u!==0){var f=this._normalizeSpeed(u);this._currentSpeedNormalized!==f&&(this._currentSpeedNormalized=f,this._currentChunkSizeKB=f)}var v=c.target.response,l=this._range.from+this._receivedLength;this._receivedLength+=v.byteLength;var m=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():m=!0,this._onDataArrival&&this._onDataArrival(v,l,this._receivedLength),m&&(this._status=d.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},_.prototype._onXhrError=function(c){this._status=d.LoaderStatus.kError;var u=0,f=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(u=d.LoaderErrors.EARLY_EOF,f={code:-1,msg:"RangeLoader meet Early-Eof"}):(u=d.LoaderErrors.EXCEPTION,f={code:-1,msg:c.constructor.name+" "+c.type}),this._onError)this._onError(u,f);else throw new h.RuntimeException(f.msg)},_}(d.BaseLoader);o.default=b},"./src/player/flv-player.js":function(s,o,p){p.r(o);var x=p("./node_modules/events/events.js"),g=p.n(x),d=p("./src/utils/logger.js"),h=p("./src/utils/browser.js"),y=p("./src/player/player-events.js"),b=p("./src/core/transmuxer.js"),T=p("./src/core/transmuxing-events.js"),_=p("./src/core/mse-controller.js"),c=p("./src/core/mse-events.js"),u=p("./src/player/player-errors.js"),f=p("./src/config.js"),v=p("./src/utils/exception.js"),l=function(){function m(E,S){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(g()),this._config=(0,f.createDefaultConfig)(),typeof S=="object"&&Object.assign(this._config,S),E.type.toLowerCase()!=="flv")throw new v.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");E.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=E,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var O=h.default.chrome&&(h.default.version.major<50||h.default.version.major===50&&h.default.version.build<2661);this._alwaysSeekKeyframe=!!(O||h.default.msedge||h.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return m.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},m.prototype.on=function(E,S){var O=this;E===y.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){O._emitter.emit(y.default.MEDIA_INFO,O.mediaInfo)}):E===y.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){O._emitter.emit(y.default.STATISTICS_INFO,O.statisticsInfo)}),this._emitter.addListener(E,S)},m.prototype.off=function(E,S){this._emitter.removeListener(E,S)},m.prototype.attachMediaElement=function(E){var S=this;if(this._mediaElement=E,E.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),E.addEventListener("seeking",this.e.onvSeeking),E.addEventListener("canplay",this.e.onvCanPlay),E.addEventListener("stalled",this.e.onvStalled),E.addEventListener("progress",this.e.onvProgress),this._msectl=new _.default(this._config),this._msectl.on(c.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(c.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(c.default.SOURCE_OPEN,function(){S._mseSourceOpened=!0,S._hasPendingLoad&&(S._hasPendingLoad=!1,S.load())}),this._msectl.on(c.default.ERROR,function(O){S._emitter.emit(y.default.ERROR,u.ErrorTypes.MEDIA_ERROR,u.ErrorDetails.MEDIA_MSE_ERROR,O)}),this._msectl.attachMediaElement(E),this._pendingSeekTime!=null)try{E.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(O){}},m.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},m.prototype.load=function(){var E=this;if(!this._mediaElement)throw new v.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new v.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new b.default(this._mediaDataSource,this._config),this._transmuxer.on(T.default.INIT_SEGMENT,function(S,O){E._msectl.appendInitSegment(O)}),this._transmuxer.on(T.default.MEDIA_SEGMENT,function(S,O){if(E._msectl.appendMediaSegment(O),E._config.lazyLoad&&!E._config.isLive){var D=E._mediaElement.currentTime;O.info.endDts>=(D+E._config.lazyLoadMaxDuration)*1e3&&E._progressChecker==null&&(d.default.v(E.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),E._suspendTransmuxer())}}),this._transmuxer.on(T.default.LOADING_COMPLETE,function(){E._msectl.endOfStream(),E._emitter.emit(y.default.LOADING_COMPLETE)}),this._transmuxer.on(T.default.RECOVERED_EARLY_EOF,function(){E._emitter.emit(y.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(T.default.IO_ERROR,function(S,O){E._emitter.emit(y.default.ERROR,u.ErrorTypes.NETWORK_ERROR,S,O)}),this._transmuxer.on(T.default.DEMUX_ERROR,function(S,O){E._emitter.emit(y.default.ERROR,u.ErrorTypes.MEDIA_ERROR,S,{code:-1,msg:O})}),this._transmuxer.on(T.default.MEDIA_INFO,function(S){E._mediaInfo=S,E._emitter.emit(y.default.MEDIA_INFO,Object.assign({},S))}),this._transmuxer.on(T.default.METADATA_ARRIVED,function(S){E._emitter.emit(y.default.METADATA_ARRIVED,S)}),this._transmuxer.on(T.default.SCRIPTDATA_ARRIVED,function(S){E._emitter.emit(y.default.SCRIPTDATA_ARRIVED,S)}),this._transmuxer.on(T.default.STATISTICS_INFO,function(S){E._statisticsInfo=E._fillStatisticsInfo(S),E._emitter.emit(y.default.STATISTICS_INFO,Object.assign({},E._statisticsInfo))}),this._transmuxer.on(T.default.RECOMMEND_SEEKPOINT,function(S){E._mediaElement&&!E._config.accurateSeek&&(E._requestSetTime=!0,E._mediaElement.currentTime=S/1e3)}),this._transmuxer.open()}},m.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},m.prototype.play=function(){return this._mediaElement.play()},m.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(m.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(E){this._mediaElement.volume=E},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(E){this._mediaElement.muted=E},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(E){this._mediaElement?this._internalSeek(E):this._pendingSeekTime=E},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),m.prototype._fillStatisticsInfo=function(E){if(E.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return E;var S=!0,O=0,D=0;if(this._mediaElement.getVideoPlaybackQuality){var P=this._mediaElement.getVideoPlaybackQuality();O=P.totalVideoFrames,D=P.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(O=this._mediaElement.webkitDecodedFrameCount,D=this._mediaElement.webkitDroppedFrameCount):S=!1;return S&&(E.decodedFrames=O,E.droppedFrames=D),E},m.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var E=this._mediaElement.buffered,S=this._mediaElement.currentTime,O=0,D=0;D<E.length;D++){var P=E.start(D),A=E.end(D);if(P<=S&&S<A){O=A;break}}O>=S+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(d.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},m.prototype._onmseBufferFull=function(){d.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},m.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},m.prototype._checkProgressAndResume=function(){for(var E=this._mediaElement.currentTime,S=this._mediaElement.buffered,O=!1,D=0;D<S.length;D++){var P=S.start(D),A=S.end(D);if(E>=P&&E<A){E>=A-this._config.lazyLoadRecoverDuration&&(O=!0);break}}O&&(window.clearInterval(this._progressChecker),this._progressChecker=null,O&&(d.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},m.prototype._isTimepointBuffered=function(E){for(var S=this._mediaElement.buffered,O=0;O<S.length;O++){var D=S.start(O),P=S.end(O);if(E>=D&&E<P)return!0}return!1},m.prototype._internalSeek=function(E){var S=this._isTimepointBuffered(E),O=!1,D=0;if(E<1&&this._mediaElement.buffered.length>0){var P=this._mediaElement.buffered.start(0);(P<1&&E<P||h.default.safari)&&(O=!0,D=h.default.safari?.1:P)}if(O)this._requestSetTime=!0,this._mediaElement.currentTime=D;else if(S){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=E;else{var A=this._msectl.getNearestKeyframe(Math.floor(E*1e3));this._requestSetTime=!0,A!=null?this._mediaElement.currentTime=A.dts/1e3:this._mediaElement.currentTime=E}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(E),this._transmuxer.seek(Math.floor(E*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=E)},m.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var E=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(E)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(E),this._transmuxer.seek(Math.floor(E*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=E))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},m.prototype._checkAndResumeStuckPlayback=function(E){var S=this._mediaElement;if(E||!this._receivedCanPlay||S.readyState<2){var O=S.buffered;O.length>0&&S.currentTime<O.start(0)&&(d.default.w(this.TAG,"Playback seems stuck at "+S.currentTime+", seek to "+O.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=O.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},m.prototype._onvLoadedMetadata=function(E){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},m.prototype._onvSeeking=function(E){var S=this._mediaElement.currentTime,O=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(S<1&&O.length>0){var D=O.start(0);if(D<1&&S<D||h.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=h.default.safari?.1:D;return}}if(this._isTimepointBuffered(S)){if(this._alwaysSeekKeyframe){var P=this._msectl.getNearestKeyframe(Math.floor(S*1e3));P!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=P.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:S,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},m.prototype._onvCanPlay=function(E){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},m.prototype._onvStalled=function(E){this._checkAndResumeStuckPlayback(!0)},m.prototype._onvProgress=function(E){this._checkAndResumeStuckPlayback()},m}();o.default=l},"./src/player/native-player.js":function(s,o,p){p.r(o);var x=p("./node_modules/events/events.js"),g=p.n(x),d=p("./src/player/player-events.js"),h=p("./src/config.js"),y=p("./src/utils/exception.js"),b=function(){function T(_,c){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(g()),this._config=(0,h.createDefaultConfig)(),typeof c=="object"&&Object.assign(this._config,c),_.type.toLowerCase()==="flv")throw new y.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(_.hasOwnProperty("segments"))throw new y.InvalidArgumentException("NativePlayer("+_.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=_,this._mediaElement=null}return T.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},T.prototype.on=function(_,c){var u=this;_===d.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){u._emitter.emit(d.default.MEDIA_INFO,u.mediaInfo)}):_===d.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){u._emitter.emit(d.default.STATISTICS_INFO,u.statisticsInfo)}),this._emitter.addListener(_,c)},T.prototype.off=function(_,c){this._emitter.removeListener(_,c)},T.prototype.attachMediaElement=function(_){if(this._mediaElement=_,_.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{_.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(c){}},T.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},T.prototype.load=function(){if(!this._mediaElement)throw new y.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},T.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},T.prototype.play=function(){return this._mediaElement.play()},T.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(T.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(_){this._mediaElement.volume=_},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(_){this._mediaElement.muted=_},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(_){this._mediaElement?this._mediaElement.currentTime=_:this._pendingSeekTime=_},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"mediaInfo",{get:function(){var _=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",c={mimeType:_+this._mediaDataSource.type};return this._mediaElement&&(c.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(c.width=this._mediaElement.videoWidth,c.height=this._mediaElement.videoHeight)),c},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"statisticsInfo",{get:function(){var _={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return _;var c=!0,u=0,f=0;if(this._mediaElement.getVideoPlaybackQuality){var v=this._mediaElement.getVideoPlaybackQuality();u=v.totalVideoFrames,f=v.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(u=this._mediaElement.webkitDecodedFrameCount,f=this._mediaElement.webkitDroppedFrameCount):c=!1;return c&&(_.decodedFrames=u,_.droppedFrames=f),_},enumerable:!1,configurable:!0}),T.prototype._onvLoadedMetadata=function(_){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(d.default.MEDIA_INFO,this.mediaInfo)},T.prototype._reportStatisticsInfo=function(){this._emitter.emit(d.default.STATISTICS_INFO,this.statisticsInfo)},T}();o.default=b},"./src/player/player-errors.js":function(s,o,p){p.r(o),p.d(o,{ErrorTypes:function(){return d},ErrorDetails:function(){return h}});var x=p("./src/io/loader.js"),g=p("./src/demux/demux-errors.js"),d={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},h={NETWORK_EXCEPTION:x.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:x.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:x.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:x.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:g.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:g.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:g.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(s,o,p){p.r(o);var x={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};o.default=x},"./src/remux/aac-silent.js":function(s,o,p){p.r(o);var x=function(){function g(){}return g.getSilentFrame=function(d,h){if(d==="mp4a.40.2"){if(h===1)return new Uint8Array([0,200,0,128,35,128]);if(h===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(h===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(h===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(h===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(h===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(h===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(h===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(h===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},g}();o.default=x},"./src/remux/mp4-generator.js":function(s,o,p){p.r(o);var x=function(){function g(){}return g.init=function(){g.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var d in g.types)g.types.hasOwnProperty(d)&&(g.types[d]=[d.charCodeAt(0),d.charCodeAt(1),d.charCodeAt(2),d.charCodeAt(3)]);var h=g.constants={};h.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),h.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),h.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),h.STSC=h.STCO=h.STTS,h.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),h.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),h.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),h.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),h.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),h.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},g.box=function(d){for(var h=8,y=null,b=Array.prototype.slice.call(arguments,1),T=b.length,_=0;_<T;_++)h+=b[_].byteLength;y=new Uint8Array(h),y[0]=h>>>24&255,y[1]=h>>>16&255,y[2]=h>>>8&255,y[3]=h&255,y.set(d,4);for(var c=8,_=0;_<T;_++)y.set(b[_],c),c+=b[_].byteLength;return y},g.generateInitSegment=function(d){var h=g.box(g.types.ftyp,g.constants.FTYP),y=g.moov(d),b=new Uint8Array(h.byteLength+y.byteLength);return b.set(h,0),b.set(y,h.byteLength),b},g.moov=function(d){var h=g.mvhd(d.timescale,d.duration),y=g.trak(d),b=g.mvex(d);return g.box(g.types.moov,h,y,b)},g.mvhd=function(d,h){return g.box(g.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},g.trak=function(d){return g.box(g.types.trak,g.tkhd(d),g.mdia(d))},g.tkhd=function(d){var h=d.id,y=d.duration,b=d.presentWidth,T=d.presentHeight;return g.box(g.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,h>>>24&255,h>>>16&255,h>>>8&255,h&255,0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,y&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,b>>>8&255,b&255,0,0,T>>>8&255,T&255,0,0]))},g.mdia=function(d){return g.box(g.types.mdia,g.mdhd(d),g.hdlr(d),g.minf(d))},g.mdhd=function(d){var h=d.timescale,y=d.duration;return g.box(g.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,h>>>24&255,h>>>16&255,h>>>8&255,h&255,y>>>24&255,y>>>16&255,y>>>8&255,y&255,85,196,0,0]))},g.hdlr=function(d){var h=null;return d.type==="audio"?h=g.constants.HDLR_AUDIO:h=g.constants.HDLR_VIDEO,g.box(g.types.hdlr,h)},g.minf=function(d){var h=null;return d.type==="audio"?h=g.box(g.types.smhd,g.constants.SMHD):h=g.box(g.types.vmhd,g.constants.VMHD),g.box(g.types.minf,h,g.dinf(),g.stbl(d))},g.dinf=function(){var d=g.box(g.types.dinf,g.box(g.types.dref,g.constants.DREF));return d},g.stbl=function(d){var h=g.box(g.types.stbl,g.stsd(d),g.box(g.types.stts,g.constants.STTS),g.box(g.types.stsc,g.constants.STSC),g.box(g.types.stsz,g.constants.STSZ),g.box(g.types.stco,g.constants.STCO));return h},g.stsd=function(d){return d.type==="audio"?d.codec==="mp3"?g.box(g.types.stsd,g.constants.STSD_PREFIX,g.mp3(d)):g.box(g.types.stsd,g.constants.STSD_PREFIX,g.mp4a(d)):g.box(g.types.stsd,g.constants.STSD_PREFIX,g.avc1(d))},g.mp3=function(d){var h=d.channelCount,y=d.audioSampleRate,b=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,h,0,16,0,0,0,0,y>>>8&255,y&255,0,0]);return g.box(g.types[".mp3"],b)},g.mp4a=function(d){var h=d.channelCount,y=d.audioSampleRate,b=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,h,0,16,0,0,0,0,y>>>8&255,y&255,0,0]);return g.box(g.types.mp4a,b,g.esds(d))},g.esds=function(d){var h=d.config||[],y=h.length,b=new Uint8Array([0,0,0,0,3,23+y,0,1,0,4,15+y,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([y]).concat(h).concat([6,1,2]));return g.box(g.types.esds,b)},g.avc1=function(d){var h=d.avcc,y=d.codecWidth,b=d.codecHeight,T=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,y>>>8&255,y&255,b>>>8&255,b&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return g.box(g.types.avc1,T,g.box(g.types.avcC,h))},g.mvex=function(d){return g.box(g.types.mvex,g.trex(d))},g.trex=function(d){var h=d.id,y=new Uint8Array([0,0,0,0,h>>>24&255,h>>>16&255,h>>>8&255,h&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return g.box(g.types.trex,y)},g.moof=function(d,h){return g.box(g.types.moof,g.mfhd(d.sequenceNumber),g.traf(d,h))},g.mfhd=function(d){var h=new Uint8Array([0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255]);return g.box(g.types.mfhd,h)},g.traf=function(d,h){var y=d.id,b=g.box(g.types.tfhd,new Uint8Array([0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,y&255])),T=g.box(g.types.tfdt,new Uint8Array([0,0,0,0,h>>>24&255,h>>>16&255,h>>>8&255,h&255])),_=g.sdtp(d),c=g.trun(d,_.byteLength+16+16+8+16+8+8);return g.box(g.types.traf,b,T,c,_)},g.sdtp=function(d){for(var h=d.samples||[],y=h.length,b=new Uint8Array(4+y),T=0;T<y;T++){var _=h[T].flags;b[T+4]=_.isLeading<<6|_.dependsOn<<4|_.isDependedOn<<2|_.hasRedundancy}return g.box(g.types.sdtp,b)},g.trun=function(d,h){var y=d.samples||[],b=y.length,T=12+16*b,_=new Uint8Array(T);h+=8+T,_.set([0,0,15,1,b>>>24&255,b>>>16&255,b>>>8&255,b&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255],0);for(var c=0;c<b;c++){var u=y[c].duration,f=y[c].size,v=y[c].flags,l=y[c].cts;_.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,v.isLeading<<2|v.dependsOn,v.isDependedOn<<6|v.hasRedundancy<<4|v.isNonSync,0,0,l>>>24&255,l>>>16&255,l>>>8&255,l&255],12+16*c)}return g.box(g.types.trun,_)},g.mdat=function(d){return g.box(g.types.mdat,d)},g}();x.init(),o.default=x},"./src/remux/mp4-remuxer.js":function(s,o,p){p.r(o);var x=p("./src/utils/logger.js"),g=p("./src/remux/mp4-generator.js"),d=p("./src/remux/aac-silent.js"),h=p("./src/utils/browser.js"),y=p("./src/core/media-segment-info.js"),b=p("./src/utils/exception.js"),T=function(){function _(c){this.TAG="MP4Remuxer",this._config=c,this._isLive=c.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new y.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new y.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(h.default.chrome&&(h.default.version.major<50||h.default.version.major===50&&h.default.version.build<2661)),this._fillSilentAfterSeek=h.default.msedge||h.default.msie,this._mp3UseMpegAudio=!h.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return _.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},_.prototype.bindDataSource=function(c){return c.onDataAvailable=this.remux.bind(this),c.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(_.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(c){this._onInitSegment=c},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(c){this._onMediaSegment=c},enumerable:!1,configurable:!0}),_.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},_.prototype.seek=function(c){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},_.prototype.remux=function(c,u){if(!this._onMediaSegment)throw new b.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(c,u),this._remuxVideo(u),this._remuxAudio(c)},_.prototype._onTrackMetadataReceived=function(c,u){var f=null,v="mp4",l=u.codec;if(c==="audio")this._audioMeta=u,u.codec==="mp3"&&this._mp3UseMpegAudio?(v="mpeg",l="",f=new Uint8Array):f=g.default.generateInitSegment(u);else if(c==="video")this._videoMeta=u,f=g.default.generateInitSegment(u);else return;if(!this._onInitSegment)throw new b.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(c,{type:c,data:f.buffer,codec:l,container:c+"/"+v,mediaDuration:u.duration})},_.prototype._calculateDtsBase=function(c,u){this._dtsBaseInited||(c.samples&&c.samples.length&&(this._audioDtsBase=c.samples[0].dts),u.samples&&u.samples.length&&(this._videoDtsBase=u.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},_.prototype.flushStashedSamples=function(){var c=this._videoStashedLastSample,u=this._audioStashedLastSample,f={type:"video",id:1,sequenceNumber:0,samples:[],length:0};c!=null&&(f.samples.push(c),f.length=c.length);var v={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};u!=null&&(v.samples.push(u),v.length=u.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(f,!0),this._remuxAudio(v,!0)},_.prototype._remuxAudio=function(c,u){if(this._audioMeta!=null){var f=c,v=f.samples,l=void 0,m=-1,E=-1,S=this._audioMeta.refSampleDuration,O=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,D=this._dtsBaseInited&&this._audioNextDts===void 0,P=!1;if(!(!v||v.length===0)&&!(v.length===1&&!u)){var A=0,w=null,L=0;O?(A=0,L=f.length):(A=8,L=8+f.length);var R=null;if(v.length>1&&(R=v.pop(),L-=R.length),this._audioStashedLastSample!=null){var C=this._audioStashedLastSample;this._audioStashedLastSample=null,v.unshift(C),L+=C.length}R!=null&&(this._audioStashedLastSample=R);var M=v[0].dts-this._dtsBase;if(this._audioNextDts)l=M-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())l=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(P=!0);else{var N=this._audioSegmentInfoList.getLastSampleBefore(M);if(N!=null){var U=M-(N.originalDts+N.duration);U<=3&&(U=0);var K=N.dts+N.duration+U;l=M-K}else l=0}if(P){var V=M-l,W=this._videoSegmentInfoList.getLastSegmentBefore(M);if(W!=null&&W.beginDts<V){var G=d.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(G){var Y=W.beginDts,q=V-W.beginDts;x.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+Y+", duration: "+q),v.unshift({unit:G,dts:Y,pts:Y}),L+=G.byteLength}}else P=!1}for(var ee=[],re=0;re<v.length;re++){var C=v[re],pe=C.unit,Le=C.dts-this._dtsBase,Y=Le,Te=!1,be=null,Re=0;if(!(Le<-.001)){if(this._audioMeta.codec!=="mp3"){var Se=Le,Ge=3;if(this._audioNextDts&&(Se=this._audioNextDts),l=Le-Se,l<=-Ge*S){x.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+Le+" ms ,curRefDts: "+Se+" ms)  due to dtsCorrection: "+l+" ms overlap.");continue}else if(l>=Ge*S&&this._fillAudioTimestampGap&&!h.default.safari){Te=!0;var $e=Math.floor(l/S);x.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+Le+" ms, curRefDts: "+Se+" ms, ")+("dtsCorrection: "+Math.round(l)+" ms, generate: "+$e+" frames")),Y=Math.floor(Se),Re=Math.floor(Se+S)-Y;var G=d.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);G==null&&(x.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),G=pe),be=[];for(var st=0;st<$e;st++){Se=Se+S;var Ze=Math.floor(Se),et=Math.floor(Se+S)-Ze,ft={dts:Ze,pts:Ze,cts:0,unit:G,size:G.byteLength,duration:et,originalDts:Le,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};be.push(ft),L+=ft.size}this._audioNextDts=Se+S}else Y=Math.floor(Se),Re=Math.floor(Se+S)-Y,this._audioNextDts=Se+S}else{if(Y=Le-l,re!==v.length-1){var dt=v[re+1].dts-this._dtsBase-l;Re=dt-Y}else if(R!=null){var dt=R.dts-this._dtsBase-l;Re=dt-Y}else ee.length>=1?Re=ee[ee.length-1].duration:Re=Math.floor(S);this._audioNextDts=Y+Re}m===-1&&(m=Y),ee.push({dts:Y,pts:Y,cts:0,unit:C.unit,size:C.unit.byteLength,duration:Re,originalDts:Le,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Te&&ee.push.apply(ee,be)}}if(ee.length===0){f.samples=[],f.length=0;return}O?w=new Uint8Array(L):(w=new Uint8Array(L),w[0]=L>>>24&255,w[1]=L>>>16&255,w[2]=L>>>8&255,w[3]=L&255,w.set(g.default.types.mdat,4));for(var re=0;re<ee.length;re++){var pe=ee[re].unit;w.set(pe,A),A+=pe.byteLength}var ht=ee[ee.length-1];E=ht.dts+ht.duration;var He=new y.MediaSegmentInfo;He.beginDts=m,He.endDts=E,He.beginPts=m,He.endPts=E,He.originalBeginDts=ee[0].originalDts,He.originalEndDts=ht.originalDts+ht.duration,He.firstSample=new y.SampleInfo(ee[0].dts,ee[0].pts,ee[0].duration,ee[0].originalDts,!1),He.lastSample=new y.SampleInfo(ht.dts,ht.pts,ht.duration,ht.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(He),f.samples=ee,f.sequenceNumber++;var rt=null;O?rt=new Uint8Array:rt=g.default.moof(f,m),f.samples=[],f.length=0;var xt={type:"audio",data:this._mergeBoxes(rt,w).buffer,sampleCount:ee.length,info:He};O&&D&&(xt.timestampOffset=m),this._onMediaSegment("audio",xt)}}},_.prototype._remuxVideo=function(c,u){if(this._videoMeta!=null){var f=c,v=f.samples,l=void 0,m=-1,E=-1,S=-1,O=-1;if(!(!v||v.length===0)&&!(v.length===1&&!u)){var D=8,P=null,A=8+c.length,w=null;if(v.length>1&&(w=v.pop(),A-=w.length),this._videoStashedLastSample!=null){var L=this._videoStashedLastSample;this._videoStashedLastSample=null,v.unshift(L),A+=L.length}w!=null&&(this._videoStashedLastSample=w);var R=v[0].dts-this._dtsBase;if(this._videoNextDts)l=R-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())l=0;else{var C=this._videoSegmentInfoList.getLastSampleBefore(R);if(C!=null){var M=R-(C.originalDts+C.duration);M<=3&&(M=0);var N=C.dts+C.duration+M;l=R-N}else l=0}for(var U=new y.MediaSegmentInfo,K=[],V=0;V<v.length;V++){var L=v[V],W=L.dts-this._dtsBase,G=L.isKeyframe,Y=W-l,q=L.cts,ee=Y+q;m===-1&&(m=Y,S=ee);var re=0;if(V!==v.length-1){var pe=v[V+1].dts-this._dtsBase-l;re=pe-Y}else if(w!=null){var pe=w.dts-this._dtsBase-l;re=pe-Y}else K.length>=1?re=K[K.length-1].duration:re=Math.floor(this._videoMeta.refSampleDuration);if(G){var Le=new y.SampleInfo(Y,ee,re,L.dts,!0);Le.fileposition=L.fileposition,U.appendSyncPoint(Le)}K.push({dts:Y,pts:ee,cts:q,units:L.units,size:L.length,isKeyframe:G,duration:re,originalDts:W,flags:{isLeading:0,dependsOn:G?2:1,isDependedOn:G?1:0,hasRedundancy:0,isNonSync:G?0:1}})}P=new Uint8Array(A),P[0]=A>>>24&255,P[1]=A>>>16&255,P[2]=A>>>8&255,P[3]=A&255,P.set(g.default.types.mdat,4);for(var V=0;V<K.length;V++)for(var Te=K[V].units;Te.length;){var be=Te.shift(),Re=be.data;P.set(Re,D),D+=Re.byteLength}var Se=K[K.length-1];if(E=Se.dts+Se.duration,O=Se.pts+Se.duration,this._videoNextDts=E,U.beginDts=m,U.endDts=E,U.beginPts=S,U.endPts=O,U.originalBeginDts=K[0].originalDts,U.originalEndDts=Se.originalDts+Se.duration,U.firstSample=new y.SampleInfo(K[0].dts,K[0].pts,K[0].duration,K[0].originalDts,K[0].isKeyframe),U.lastSample=new y.SampleInfo(Se.dts,Se.pts,Se.duration,Se.originalDts,Se.isKeyframe),this._isLive||this._videoSegmentInfoList.append(U),f.samples=K,f.sequenceNumber++,this._forceFirstIDR){var Ge=K[0].flags;Ge.dependsOn=2,Ge.isNonSync=0}var $e=g.default.moof(f,m);f.samples=[],f.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes($e,P).buffer,sampleCount:K.length,info:U})}}},_.prototype._mergeBoxes=function(c,u){var f=new Uint8Array(c.byteLength+u.byteLength);return f.set(c,0),f.set(u,c.byteLength),f},_}();o.default=T},"./src/utils/browser.js":function(s,o,p){p.r(o);var x={};function g(){var d=self.navigator.userAgent.toLowerCase(),h=/(edge)\/([\w.]+)/.exec(d)||/(opr)[\/]([\w.]+)/.exec(d)||/(chrome)[ \/]([\w.]+)/.exec(d)||/(iemobile)[\/]([\w.]+)/.exec(d)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+)/.exec(d)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(d)||/(msie) ([\w.]+)/.exec(d)||d.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(d)||d.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(d)||[],y=/(ipad)/.exec(d)||/(ipod)/.exec(d)||/(windows phone)/.exec(d)||/(iphone)/.exec(d)||/(kindle)/.exec(d)||/(android)/.exec(d)||/(windows)/.exec(d)||/(mac)/.exec(d)||/(linux)/.exec(d)||/(cros)/.exec(d)||[],b={browser:h[5]||h[3]||h[1]||"",version:h[2]||h[4]||"0",majorVersion:h[4]||h[2]||"0",platform:y[0]||""},T={};if(b.browser){T[b.browser]=!0;var _=b.majorVersion.split(".");T.version={major:parseInt(b.majorVersion,10),string:b.version},_.length>1&&(T.version.minor=parseInt(_[1],10)),_.length>2&&(T.version.build=parseInt(_[2],10))}if(b.platform&&(T[b.platform]=!0),(T.chrome||T.opr||T.safari)&&(T.webkit=!0),T.rv||T.iemobile){T.rv&&delete T.rv;var c="msie";b.browser=c,T[c]=!0}if(T.edge){delete T.edge;var u="msedge";b.browser=u,T[u]=!0}if(T.opr){var f="opera";b.browser=f,T[f]=!0}if(T.safari&&T.android){var v="android";b.browser=v,T[v]=!0}T.name=b.browser,T.platform=b.platform;for(var l in x)x.hasOwnProperty(l)&&delete x[l];Object.assign(x,T)}g(),o.default=x},"./src/utils/exception.js":function(s,o,p){p.r(o),p.d(o,{RuntimeException:function(){return g},IllegalStateException:function(){return d},InvalidArgumentException:function(){return h},NotImplementedException:function(){return y}});var x=function(){var b=function(T,_){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,u){c.__proto__=u}||function(c,u){for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(c[f]=u[f])},b(T,_)};return function(T,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");b(T,_);function c(){this.constructor=T}T.prototype=_===null?Object.create(_):(c.prototype=_.prototype,new c)}}(),g=function(){function b(T){this._message=T}return Object.defineProperty(b.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),b.prototype.toString=function(){return this.name+": "+this.message},b}(),d=function(b){x(T,b);function T(_){return b.call(this,_)||this}return Object.defineProperty(T.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),T}(g),h=function(b){x(T,b);function T(_){return b.call(this,_)||this}return Object.defineProperty(T.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),T}(g),y=function(b){x(T,b);function T(_){return b.call(this,_)||this}return Object.defineProperty(T.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),T}(g)},"./src/utils/logger.js":function(s,o,p){p.r(o);var x=p("./node_modules/events/events.js"),g=p.n(x),d=function(){function h(){}return h.e=function(y,b){(!y||h.FORCE_GLOBAL_TAG)&&(y=h.GLOBAL_TAG);var T="["+y+"] > "+b;h.ENABLE_CALLBACK&&h.emitter.emit("log","error",T),!!h.ENABLE_ERROR&&(console.error?console.error(T):console.warn?console.warn(T):console.log(T))},h.i=function(y,b){(!y||h.FORCE_GLOBAL_TAG)&&(y=h.GLOBAL_TAG);var T="["+y+"] > "+b;h.ENABLE_CALLBACK&&h.emitter.emit("log","info",T),!!h.ENABLE_INFO&&(console.info?console.info(T):console.log(T))},h.w=function(y,b){(!y||h.FORCE_GLOBAL_TAG)&&(y=h.GLOBAL_TAG);var T="["+y+"] > "+b;h.ENABLE_CALLBACK&&h.emitter.emit("log","warn",T),!!h.ENABLE_WARN&&(console.warn?console.warn(T):console.log(T))},h.d=function(y,b){(!y||h.FORCE_GLOBAL_TAG)&&(y=h.GLOBAL_TAG);var T="["+y+"] > "+b;h.ENABLE_CALLBACK&&h.emitter.emit("log","debug",T),!!h.ENABLE_DEBUG&&(console.debug?console.debug(T):console.log(T))},h.v=function(y,b){(!y||h.FORCE_GLOBAL_TAG)&&(y=h.GLOBAL_TAG);var T="["+y+"] > "+b;h.ENABLE_CALLBACK&&h.emitter.emit("log","verbose",T),!!h.ENABLE_VERBOSE&&console.log(T)},h}();d.GLOBAL_TAG="flv.js",d.FORCE_GLOBAL_TAG=!1,d.ENABLE_ERROR=!0,d.ENABLE_INFO=!0,d.ENABLE_WARN=!0,d.ENABLE_DEBUG=!0,d.ENABLE_VERBOSE=!0,d.ENABLE_CALLBACK=!1,d.emitter=new(g()),o.default=d},"./src/utils/logging-control.js":function(s,o,p){p.r(o);var x=p("./node_modules/events/events.js"),g=p.n(x),d=p("./src/utils/logger.js"),h=function(){function y(){}return Object.defineProperty(y,"forceGlobalTag",{get:function(){return d.default.FORCE_GLOBAL_TAG},set:function(b){d.default.FORCE_GLOBAL_TAG=b,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"globalTag",{get:function(){return d.default.GLOBAL_TAG},set:function(b){d.default.GLOBAL_TAG=b,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableAll",{get:function(){return d.default.ENABLE_VERBOSE&&d.default.ENABLE_DEBUG&&d.default.ENABLE_INFO&&d.default.ENABLE_WARN&&d.default.ENABLE_ERROR},set:function(b){d.default.ENABLE_VERBOSE=b,d.default.ENABLE_DEBUG=b,d.default.ENABLE_INFO=b,d.default.ENABLE_WARN=b,d.default.ENABLE_ERROR=b,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableDebug",{get:function(){return d.default.ENABLE_DEBUG},set:function(b){d.default.ENABLE_DEBUG=b,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableVerbose",{get:function(){return d.default.ENABLE_VERBOSE},set:function(b){d.default.ENABLE_VERBOSE=b,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableInfo",{get:function(){return d.default.ENABLE_INFO},set:function(b){d.default.ENABLE_INFO=b,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableWarn",{get:function(){return d.default.ENABLE_WARN},set:function(b){d.default.ENABLE_WARN=b,y._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(y,"enableError",{get:function(){return d.default.ENABLE_ERROR},set:function(b){d.default.ENABLE_ERROR=b,y._notifyChange()},enumerable:!1,configurable:!0}),y.getConfig=function(){return{globalTag:d.default.GLOBAL_TAG,forceGlobalTag:d.default.FORCE_GLOBAL_TAG,enableVerbose:d.default.ENABLE_VERBOSE,enableDebug:d.default.ENABLE_DEBUG,enableInfo:d.default.ENABLE_INFO,enableWarn:d.default.ENABLE_WARN,enableError:d.default.ENABLE_ERROR,enableCallback:d.default.ENABLE_CALLBACK}},y.applyConfig=function(b){d.default.GLOBAL_TAG=b.globalTag,d.default.FORCE_GLOBAL_TAG=b.forceGlobalTag,d.default.ENABLE_VERBOSE=b.enableVerbose,d.default.ENABLE_DEBUG=b.enableDebug,d.default.ENABLE_INFO=b.enableInfo,d.default.ENABLE_WARN=b.enableWarn,d.default.ENABLE_ERROR=b.enableError,d.default.ENABLE_CALLBACK=b.enableCallback},y._notifyChange=function(){var b=y.emitter;if(b.listenerCount("change")>0){var T=y.getConfig();b.emit("change",T)}},y.registerListener=function(b){y.emitter.addListener("change",b)},y.removeListener=function(b){y.emitter.removeListener("change",b)},y.addLogListener=function(b){d.default.emitter.addListener("log",b),d.default.emitter.listenerCount("log")>0&&(d.default.ENABLE_CALLBACK=!0,y._notifyChange())},y.removeLogListener=function(b){d.default.emitter.removeListener("log",b),d.default.emitter.listenerCount("log")===0&&(d.default.ENABLE_CALLBACK=!1,y._notifyChange())},y}();h.emitter=new(g()),o.default=h},"./src/utils/polyfill.js":function(s,o,p){p.r(o);var x=function(){function g(){}return g.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(d,h){return d.__proto__=h,d},Object.assign=Object.assign||function(d){if(d==null)throw new TypeError("Cannot convert undefined or null to object");for(var h=Object(d),y=1;y<arguments.length;y++){var b=arguments[y];if(b!=null)for(var T in b)b.hasOwnProperty(T)&&(h[T]=b[T])}return h},typeof self.Promise!="function"&&p("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},g}();x.install(),o.default=x},"./src/utils/utf8-conv.js":function(s,o,p){p.r(o);function x(d,h,y){var b=d;if(h+y<b.length){for(;y--;)if((b[++h]&192)!=128)return!1;return!0}else return!1}function g(d){for(var h=[],y=d,b=0,T=d.length;b<T;){if(y[b]<128){h.push(String.fromCharCode(y[b])),++b;continue}else if(!(y[b]<192)){if(y[b]<224){if(x(y,b,1)){var _=(y[b]&31)<<6|y[b+1]&63;if(_>=128){h.push(String.fromCharCode(_&65535)),b+=2;continue}}}else if(y[b]<240){if(x(y,b,2)){var _=(y[b]&15)<<12|(y[b+1]&63)<<6|y[b+2]&63;if(_>=2048&&(_&63488)!=55296){h.push(String.fromCharCode(_&65535)),b+=3;continue}}}else if(y[b]<248&&x(y,b,3)){var _=(y[b]&7)<<18|(y[b+1]&63)<<12|(y[b+2]&63)<<6|y[b+3]&63;if(_>65536&&_<1114112){_-=65536,h.push(String.fromCharCode(_>>>10|55296)),h.push(String.fromCharCode(_&1023|56320)),b+=4;continue}}}h.push(String.fromCharCode(65533)),++b}return h.join("")}o.default=g}},n={};function t(s){var o=n[s];if(o!==void 0)return o.exports;var p=n[s]={exports:{}};return r[s].call(p.exports,p,p.exports,t),p.exports}t.m=r,function(){t.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return t.d(o,{a:o}),o}}(),function(){t.d=function(s,o){for(var p in o)t.o(o,p)&&!t.o(s,p)&&Object.defineProperty(s,p,{enumerable:!0,get:o[p]})}}(),function(){t.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(s){if(typeof window=="object")return window}}()}(),function(){t.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)}}(),function(){t.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})}}();var a=t("./src/index.js");return a}()})})(op);var f1=Gu(op.exports);const is=typeof window!="undefined"?window.navigator.userAgent:"",c1=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(is);/^((?!chrome|android).)*safari/i.test(is);/MicroMessenger/i.test(is);/MSIE|Trident/i.test(is);var lp={exports:{}};(function(i,e){typeof window!="undefined"&&function(n,t){i.exports=t()}(Er,function(){return function(r){var n={};function t(a){if(n[a])return n[a].exports;var s=n[a]={i:a,l:!1,exports:{}};return r[a].call(s.exports,s,s.exports,t),s.l=!0,s.exports}return t.m=r,t.c=n,t.d=function(a,s,o){t.o(a,s)||Object.defineProperty(a,s,{enumerable:!0,get:o})},t.r=function(a){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},t.t=function(a,s){if(s&1&&(a=t(a)),s&8||s&4&&typeof a=="object"&&a&&a.__esModule)return a;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:a}),s&2&&typeof a!="string")for(var p in a)t.d(o,p,function(x){return a[x]}.bind(null,p));return o},t.n=function(a){var s=a&&a.__esModule?function(){return a.default}:function(){return a};return t.d(s,"a",s),s},t.o=function(a,s){return Object.prototype.hasOwnProperty.call(a,s)},t.p="/dist/",t(t.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(r,n,t){var a=Object.prototype.hasOwnProperty,s="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(s=!1));function p(h,y,b){this.fn=h,this.context=y,this.once=b||!1}function x(h,y,b,T,_){if(typeof b!="function")throw new TypeError("The listener must be a function");var c=new p(b,T||h,_),u=s?s+y:y;return h._events[u]?h._events[u].fn?h._events[u]=[h._events[u],c]:h._events[u].push(c):(h._events[u]=c,h._eventsCount++),h}function g(h,y){--h._eventsCount==0?h._events=new o:delete h._events[y]}function d(){this._events=new o,this._eventsCount=0}d.prototype.eventNames=function(){var y=[],b,T;if(this._eventsCount===0)return y;for(T in b=this._events)a.call(b,T)&&y.push(s?T.slice(1):T);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(b)):y},d.prototype.listeners=function(y){var b=s?s+y:y,T=this._events[b];if(!T)return[];if(T.fn)return[T.fn];for(var _=0,c=T.length,u=new Array(c);_<c;_++)u[_]=T[_].fn;return u},d.prototype.listenerCount=function(y){var b=s?s+y:y,T=this._events[b];return T?T.fn?1:T.length:0},d.prototype.emit=function(y,b,T,_,c,u){var f=s?s+y:y;if(!this._events[f])return!1;var v=this._events[f],l=arguments.length,m,E;if(v.fn){switch(v.once&&this.removeListener(y,v.fn,void 0,!0),l){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,b),!0;case 3:return v.fn.call(v.context,b,T),!0;case 4:return v.fn.call(v.context,b,T,_),!0;case 5:return v.fn.call(v.context,b,T,_,c),!0;case 6:return v.fn.call(v.context,b,T,_,c,u),!0}for(E=1,m=new Array(l-1);E<l;E++)m[E-1]=arguments[E];v.fn.apply(v.context,m)}else{var S=v.length,O;for(E=0;E<S;E++)switch(v[E].once&&this.removeListener(y,v[E].fn,void 0,!0),l){case 1:v[E].fn.call(v[E].context);break;case 2:v[E].fn.call(v[E].context,b);break;case 3:v[E].fn.call(v[E].context,b,T);break;case 4:v[E].fn.call(v[E].context,b,T,_);break;default:if(!m)for(O=1,m=new Array(l-1);O<l;O++)m[O-1]=arguments[O];v[E].fn.apply(v[E].context,m)}}return!0},d.prototype.on=function(y,b,T){return x(this,y,b,T,!1)},d.prototype.once=function(y,b,T){return x(this,y,b,T,!0)},d.prototype.removeListener=function(y,b,T,_){var c=s?s+y:y;if(!this._events[c])return this;if(!b)return g(this,c),this;var u=this._events[c];if(u.fn)u.fn===b&&(!_||u.once)&&(!T||u.context===T)&&g(this,c);else{for(var f=0,v=[],l=u.length;f<l;f++)(u[f].fn!==b||_&&!u[f].once||T&&u[f].context!==T)&&v.push(u[f]);v.length?this._events[c]=v.length===1?v[0]:v:g(this,c)}return this},d.prototype.removeAllListeners=function(y){var b;return y?(b=s?s+y:y,this._events[b]&&g(this,b)):(this._events=new o,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=s,d.EventEmitter=d,r.exports=d},"./node_modules/url-toolkit/src/url-toolkit.js":function(r,n,t){(function(a){var s=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,o=/^([^\/?#]*)([^]*)$/,p=/(?:\/|^)\.(?=\/)/g,x=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,g={buildAbsoluteURL:function(d,h,y){if(y=y||{},d=d.trim(),h=h.trim(),!h){if(!y.alwaysNormalize)return d;var b=g.parseURL(d);if(!b)throw new Error("Error trying to parse base URL.");return b.path=g.normalizePath(b.path),g.buildURLFromParts(b)}var T=g.parseURL(h);if(!T)throw new Error("Error trying to parse relative URL.");if(T.scheme)return y.alwaysNormalize?(T.path=g.normalizePath(T.path),g.buildURLFromParts(T)):h;var _=g.parseURL(d);if(!_)throw new Error("Error trying to parse base URL.");if(!_.netLoc&&_.path&&_.path[0]!=="/"){var c=o.exec(_.path);_.netLoc=c[1],_.path=c[2]}_.netLoc&&!_.path&&(_.path="/");var u={scheme:_.scheme,netLoc:T.netLoc,path:null,params:T.params,query:T.query,fragment:T.fragment};if(!T.netLoc&&(u.netLoc=_.netLoc,T.path[0]!=="/"))if(!T.path)u.path=_.path,T.params||(u.params=_.params,T.query||(u.query=_.query));else{var f=_.path,v=f.substring(0,f.lastIndexOf("/")+1)+T.path;u.path=g.normalizePath(v)}return u.path===null&&(u.path=y.alwaysNormalize?g.normalizePath(T.path):T.path),g.buildURLFromParts(u)},parseURL:function(d){var h=s.exec(d);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(p,"");d.length!==(d=d.replace(x,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};r.exports=g})()},"./node_modules/webworkify-webpack/index.js":function(r,n,t){function a(y){var b={};function T(c){if(b[c])return b[c].exports;var u=b[c]={i:c,l:!1,exports:{}};return y[c].call(u.exports,u,u.exports,T),u.l=!0,u.exports}T.m=y,T.c=b,T.i=function(c){return c},T.d=function(c,u,f){T.o(c,u)||Object.defineProperty(c,u,{configurable:!1,enumerable:!0,get:f})},T.r=function(c){Object.defineProperty(c,"__esModule",{value:!0})},T.n=function(c){var u=c&&c.__esModule?function(){return c.default}:function(){return c};return T.d(u,"a",u),u},T.o=function(c,u){return Object.prototype.hasOwnProperty.call(c,u)},T.p="/",T.oe=function(c){throw console.error(c),c};var _=T(T.s=ENTRY_MODULE);return _.default||_}var s="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+s+").*?\\)";function p(y){return(y+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function x(y){return!isNaN(1*y)}function g(y,b,T){var _={};_[T]=[];var c=b.toString(),u=c.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return _;for(var f=u[1],v=new RegExp("(\\\\n|\\W)"+p(f)+o,"g"),l;l=v.exec(c);)l[3]!=="dll-reference"&&_[T].push(l[3]);for(v=new RegExp("\\("+p(f)+'\\("(dll-reference\\s('+s+'))"\\)\\)'+o,"g");l=v.exec(c);)y[l[2]]||(_[T].push(l[1]),y[l[2]]=t(l[1]).m),_[l[2]]=_[l[2]]||[],_[l[2]].push(l[4]);for(var m=Object.keys(_),E=0;E<m.length;E++)for(var S=0;S<_[m[E]].length;S++)x(_[m[E]][S])&&(_[m[E]][S]=1*_[m[E]][S]);return _}function d(y){var b=Object.keys(y);return b.reduce(function(T,_){return T||y[_].length>0},!1)}function h(y,b){for(var T={main:[b]},_={main:[]},c={main:{}};d(T);)for(var u=Object.keys(T),f=0;f<u.length;f++){var v=u[f],l=T[v],m=l.pop();if(c[v]=c[v]||{},!(c[v][m]||!y[v][m])){c[v][m]=!0,_[v]=_[v]||[],_[v].push(m);for(var E=g(y,y[v][m],v),S=Object.keys(E),O=0;O<S.length;O++)T[S[O]]=T[S[O]]||[],T[S[O]]=T[S[O]].concat(E[S[O]])}}return _}r.exports=function(y,b){b=b||{};var T={main:t.m},_=b.all?{main:Object.keys(T.main)}:h(T,y),c="";Object.keys(_).filter(function(m){return m!=="main"}).forEach(function(m){for(var E=0;_[m][E];)E++;_[m].push(E),T[m][E]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",c=c+"var "+m+" = ("+a.toString().replace("ENTRY_MODULE",JSON.stringify(E))+")({"+_[m].map(function(S){return""+JSON.stringify(S)+": "+T[m][S].toString()}).join(",")+`});
`}),c=c+"new (("+a.toString().replace("ENTRY_MODULE",JSON.stringify(y))+")({"+_.main.map(function(m){return""+JSON.stringify(m)+": "+T.main[m].toString()}).join(",")+"}))(self);";var u=new window.Blob([c],{type:"text/javascript"});if(b.bare)return u;var f=window.URL||window.webkitURL||window.mozURL||window.msURL,v=f.createObjectURL(u),l=new window.Worker(v);return l.objectURL=v,l}},"./src/config.ts":function(r,n,t){t.r(n),t.d(n,"hlsDefaultConfig",function(){return O}),t.d(n,"mergeConfig",function(){return P}),t.d(n,"enableStreamingMode",function(){return A});var a=t("./src/controller/abr-controller.ts"),s=t("./src/controller/audio-stream-controller.ts"),o=t("./src/controller/audio-track-controller.ts"),p=t("./src/controller/subtitle-stream-controller.ts"),x=t("./src/controller/subtitle-track-controller.ts"),g=t("./src/controller/buffer-controller.ts"),d=t("./src/controller/timeline-controller.ts"),h=t("./src/controller/cap-level-controller.ts"),y=t("./src/controller/fps-controller.ts"),b=t("./src/controller/eme-controller.ts"),T=t("./src/controller/cmcd-controller.ts"),_=t("./src/utils/xhr-loader.ts"),c=t("./src/utils/fetch-loader.ts"),u=t("./src/utils/cues.ts"),f=t("./src/utils/mediakeys-helper.ts"),v=t("./src/utils/logger.ts");function l(){return l=Object.assign||function(w){for(var L=1;L<arguments.length;L++){var R=arguments[L];for(var C in R)Object.prototype.hasOwnProperty.call(R,C)&&(w[C]=R[C])}return w},l.apply(this,arguments)}function m(w,L){var R=Object.keys(w);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(w);L&&(C=C.filter(function(M){return Object.getOwnPropertyDescriptor(w,M).enumerable})),R.push.apply(R,C)}return R}function E(w){for(var L=1;L<arguments.length;L++){var R=arguments[L]!=null?arguments[L]:{};L%2?m(Object(R),!0).forEach(function(C){S(w,C,R[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(R)):m(Object(R)).forEach(function(C){Object.defineProperty(w,C,Object.getOwnPropertyDescriptor(R,C))})}return w}function S(w,L,R){return L in w?Object.defineProperty(w,L,{value:R,enumerable:!0,configurable:!0,writable:!0}):w[L]=R,w}var O=E(E({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:_.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:a.default,bufferController:g.default,capLevelController:h.default,fpsController:y.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:f.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},D()),{},{subtitleStreamController:p.SubtitleStreamController,subtitleTrackController:x.default,timelineController:d.TimelineController,audioStreamController:s.default,audioTrackController:o.default,emeController:b.default,cmcdController:T.default});function D(){return{cueHandler:u.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function P(w,L){if((L.liveSyncDurationCount||L.liveMaxLatencyDurationCount)&&(L.liveSyncDuration||L.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(L.liveMaxLatencyDurationCount!==void 0&&(L.liveSyncDurationCount===void 0||L.liveMaxLatencyDurationCount<=L.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(L.liveMaxLatencyDuration!==void 0&&(L.liveSyncDuration===void 0||L.liveMaxLatencyDuration<=L.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return l({},w,L)}function A(w){var L=w.loader;if(L!==c.default&&L!==_.default)v.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),w.progressive=!1;else{var R=Object(c.fetchSupported)();R&&(w.loader=c.default,w.progressive=!0,w.enableSoftwareAES=!0,v.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(r,n,t){t.r(n);var a=t("./src/polyfills/number.ts"),s=t("./src/utils/ewma-bandwidth-estimator.ts"),o=t("./src/events.ts"),p=t("./src/utils/buffer-helper.ts"),x=t("./src/errors.ts"),g=t("./src/types/loader.ts"),d=t("./src/utils/logger.ts");function h(T,_){for(var c=0;c<_.length;c++){var u=_[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(T,u.key,u)}}function y(T,_,c){return _&&h(T.prototype,_),c&&h(T,c),T}var b=function(){function T(c){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=c;var u=c.config;this.bwEstimator=new s.default(u.abrEwmaSlowVoD,u.abrEwmaFastVoD,u.abrEwmaDefaultEstimate),this.registerListeners()}var _=T.prototype;return _.registerListeners=function(){var u=this.hls;u.on(o.Events.FRAG_LOADING,this.onFragLoading,this),u.on(o.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(o.Events.FRAG_BUFFERED,this.onFragBuffered,this),u.on(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(o.Events.ERROR,this.onError,this)},_.unregisterListeners=function(){var u=this.hls;u.off(o.Events.FRAG_LOADING,this.onFragLoading,this),u.off(o.Events.FRAG_LOADED,this.onFragLoaded,this),u.off(o.Events.FRAG_BUFFERED,this.onFragBuffered,this),u.off(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(o.Events.ERROR,this.onError,this)},_.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},_.onFragLoading=function(u,f){var v=f.frag;if(v.type===g.PlaylistLevelType.MAIN&&!this.timer){var l;this.fragCurrent=v,this.partCurrent=(l=f.part)!=null?l:null,this.timer=self.setInterval(this.onCheck,100)}},_.onLevelLoaded=function(u,f){var v=this.hls.config;f.details.live?this.bwEstimator.update(v.abrEwmaSlowLive,v.abrEwmaFastLive):this.bwEstimator.update(v.abrEwmaSlowVoD,v.abrEwmaFastVoD)},_._abandonRulesCheck=function(){var u=this.fragCurrent,f=this.partCurrent,v=this.hls,l=v.autoLevelEnabled,m=v.config,E=v.media;if(!(!u||!E)){var S=f?f.stats:u.stats,O=f?f.duration:u.duration;if(S.aborted){d.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!l||E.paused||!E.playbackRate||!E.readyState)){var D=performance.now()-S.loading.start,P=Math.abs(E.playbackRate);if(!(D<=500*O/P)){var A=v.levels,w=v.minAutoLevel,L=A[u.level],R=S.total||Math.max(S.loaded,Math.round(O*L.maxBitrate/8)),C=Math.max(1,S.bwEstimate?S.bwEstimate/8:S.loaded*1e3/D),M=(R-S.loaded)/C,N=E.currentTime,U=(p.BufferHelper.bufferInfo(E,N,m.maxBufferHole).end-N)/P;if(!(U>=2*O/P||M<=U)){var K=Number.POSITIVE_INFINITY,V;for(V=u.level-1;V>w;V--){var W=A[V].maxBitrate;if(K=O*W/(8*.8*C),K<U)break}if(!(K>=M)){var G=this.bwEstimator.getEstimate();d.logger.warn("Fragment "+u.sn+(f?" part "+f.index:"")+" of level "+u.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+V+`
      Current BW estimate: `+(Object(a.isFiniteNumber)(G)?(G/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+M.toFixed(3)+` s
      Estimated load time for the next fragment: `+K.toFixed(3)+` s
      Time to underbuffer: `+U.toFixed(3)+" s"),v.nextLoadLevel=V,this.bwEstimator.sample(D,S.loaded),this.clearTimer(),u.loader&&(this.fragCurrent=this.partCurrent=null,u.loader.abort()),v.trigger(o.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:u,part:f,stats:S})}}}}}},_.onFragLoaded=function(u,f){var v=f.frag,l=f.part;if(v.type===g.PlaylistLevelType.MAIN&&Object(a.isFiniteNumber)(v.sn)){var m=l?l.stats:v.stats,E=l?l.duration:v.duration;if(this.clearTimer(),this.lastLoadedFragLevel=v.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var S=this.hls.levels[v.level],O=(S.loaded?S.loaded.bytes:0)+m.loaded,D=(S.loaded?S.loaded.duration:0)+E;S.loaded={bytes:O,duration:D},S.realBitrate=Math.round(8*O/D)}if(v.bitrateTest){var P={stats:m,frag:v,part:l,id:v.type};this.onFragBuffered(o.Events.FRAG_BUFFERED,P),v.bitrateTest=!1}}},_.onFragBuffered=function(u,f){var v=f.frag,l=f.part,m=l?l.stats:v.stats;if(!m.aborted&&!(v.type!==g.PlaylistLevelType.MAIN||v.sn==="initSegment")){var E=m.parsing.end-m.loading.start;this.bwEstimator.sample(E,m.loaded),m.bwEstimate=this.bwEstimator.getEstimate(),v.bitrateTest?this.bitrateTestDelay=E/1e3:this.bitrateTestDelay=0}},_.onError=function(u,f){switch(f.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},_.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},_.getNextABRAutoLevel=function(){var u=this.fragCurrent,f=this.partCurrent,v=this.hls,l=v.maxAutoLevel,m=v.config,E=v.minAutoLevel,S=v.media,O=f?f.duration:u?u.duration:0,D=S?S.currentTime:0,P=S&&S.playbackRate!==0?Math.abs(S.playbackRate):1,A=this.bwEstimator?this.bwEstimator.getEstimate():m.abrEwmaDefaultEstimate,w=(p.BufferHelper.bufferInfo(S,D,m.maxBufferHole).end-D)/P,L=this.findBestLevel(A,E,l,w,m.abrBandWidthFactor,m.abrBandWidthUpFactor);if(L>=0)return L;d.logger.trace((w?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var R=O?Math.min(O,m.maxStarvationDelay):m.maxStarvationDelay,C=m.abrBandWidthFactor,M=m.abrBandWidthUpFactor;if(!w){var N=this.bitrateTestDelay;if(N){var U=O?Math.min(O,m.maxLoadingDelay):m.maxLoadingDelay;R=U-N,d.logger.trace("bitrate test took "+Math.round(1e3*N)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*R)+" ms"),C=M=1}}return L=this.findBestLevel(A,E,l,w+R,C,M),Math.max(L,0)},_.findBestLevel=function(u,f,v,l,m,E){for(var S,O=this.fragCurrent,D=this.partCurrent,P=this.lastLoadedFragLevel,A=this.hls.levels,w=A[P],L=!!(w!=null&&(S=w.details)!==null&&S!==void 0&&S.live),R=w==null?void 0:w.codecSet,C=D?D.duration:O?O.duration:0,M=v;M>=f;M--){var N=A[M];if(!(!N||R&&N.codecSet!==R)){var U=N.details,K=(D?U==null?void 0:U.partTarget:U==null?void 0:U.averagetargetduration)||C,V=void 0;M<=P?V=m*u:V=E*u;var W=A[M].maxBitrate,G=W*K/V;if(d.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+M+"/"+Math.round(V)+"/"+W+"/"+K+"/"+l+"/"+G),V>W&&(!G||L&&!this.bitrateTestDelay||G<l))return M}}return-1},y(T,[{key:"nextAutoLevel",get:function(){var u=this._nextAutoLevel,f=this.bwEstimator;if(u!==-1&&(!f||!f.canEstimate()))return u;var v=this.getNextABRAutoLevel();return u!==-1&&(v=Math.min(u,v)),v},set:function(u){this._nextAutoLevel=u}}]),T}();n.default=b},"./src/controller/audio-stream-controller.ts":function(r,n,t){t.r(n);var a=t("./src/polyfills/number.ts"),s=t("./src/controller/base-stream-controller.ts"),o=t("./src/events.ts"),p=t("./src/utils/buffer-helper.ts"),x=t("./src/controller/fragment-tracker.ts"),g=t("./src/types/level.ts"),d=t("./src/types/loader.ts"),h=t("./src/loader/fragment.ts"),y=t("./src/demux/chunk-cache.ts"),b=t("./src/demux/transmuxer-interface.ts"),T=t("./src/types/transmuxer.ts"),_=t("./src/controller/fragment-finders.ts"),c=t("./src/utils/discontinuities.ts"),u=t("./src/errors.ts"),f=t("./src/utils/logger.ts");function v(){return v=Object.assign||function(O){for(var D=1;D<arguments.length;D++){var P=arguments[D];for(var A in P)Object.prototype.hasOwnProperty.call(P,A)&&(O[A]=P[A])}return O},v.apply(this,arguments)}function l(O,D){O.prototype=Object.create(D.prototype),O.prototype.constructor=O,m(O,D)}function m(O,D){return m=Object.setPrototypeOf||function(A,w){return A.__proto__=w,A},m(O,D)}var E=100,S=function(O){l(D,O);function D(A,w){var L;return L=O.call(this,A,w,"[audio-stream-controller]")||this,L.videoBuffer=null,L.videoTrackCC=-1,L.waitingVideoCC=-1,L.audioSwitch=!1,L.trackId=-1,L.waitingData=null,L.mainDetails=null,L.bufferFlushed=!1,L._registerListeners(),L}var P=D.prototype;return P.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},P._registerListeners=function(){var w=this.hls;w.on(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),w.on(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),w.on(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),w.on(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),w.on(o.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),w.on(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),w.on(o.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),w.on(o.Events.ERROR,this.onError,this),w.on(o.Events.BUFFER_RESET,this.onBufferReset,this),w.on(o.Events.BUFFER_CREATED,this.onBufferCreated,this),w.on(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),w.on(o.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),w.on(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},P._unregisterListeners=function(){var w=this.hls;w.off(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),w.off(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),w.off(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),w.off(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),w.off(o.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),w.off(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),w.off(o.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),w.off(o.Events.ERROR,this.onError,this),w.off(o.Events.BUFFER_RESET,this.onBufferReset,this),w.off(o.Events.BUFFER_CREATED,this.onBufferCreated,this),w.off(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),w.off(o.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),w.off(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},P.onInitPtsFound=function(w,L){var R=L.frag,C=L.id,M=L.initPTS;if(C==="main"){var N=R.cc;this.initPTS[R.cc]=M,this.log("InitPTS for cc: "+N+" found from main: "+M),this.videoTrackCC=N,this.state===s.State.WAITING_INIT_PTS&&this.tick()}},P.startLoad=function(w){if(!this.levels){this.startPosition=w,this.state=s.State.STOPPED;return}var L=this.lastCurrentTime;this.stopLoad(),this.setInterval(E),this.fragLoadError=0,L>0&&w===-1?(this.log("Override startPosition with lastCurrentTime @"+L.toFixed(3)),this.state=s.State.IDLE):(this.loadedmetadata=!1,this.state=s.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=w,this.tick()},P.doTick=function(){switch(this.state){case s.State.IDLE:this.doTickIdle();break;case s.State.WAITING_TRACK:{var w,L=this.levels,R=this.trackId,C=L==null||(w=L[R])===null||w===void 0?void 0:w.details;if(C){if(this.waitForCdnTuneIn(C))break;this.state=s.State.WAITING_INIT_PTS}break}case s.State.FRAG_LOADING_WAITING_RETRY:{var M,N=performance.now(),U=this.retryDate;(!U||N>=U||(M=this.media)!==null&&M!==void 0&&M.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=s.State.IDLE);break}case s.State.WAITING_INIT_PTS:{var K=this.waitingData;if(K){var V=K.frag,W=K.part,G=K.cache,Y=K.complete;if(this.initPTS[V.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=s.State.FRAG_LOADING;var q=G.flush(),ee={frag:V,part:W,payload:q,networkDetails:null};this._handleFragmentLoadProgress(ee),Y&&O.prototype._handleFragmentLoadComplete.call(this,ee)}else if(this.videoTrackCC!==this.waitingVideoCC)f.logger.log("Waiting fragment cc ("+V.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var re=this.getLoadPosition(),pe=p.BufferHelper.bufferInfo(this.mediaBuffer,re,this.config.maxBufferHole),Le=Object(_.fragmentWithinToleranceTest)(pe.end,this.config.maxFragLookUpTolerance,V);Le<0&&(f.logger.log("Waiting fragment cc ("+V.cc+") @ "+V.start+" cancelled because another fragment at "+pe.end+" is needed"),this.clearWaitingFragment())}}else this.state=s.State.IDLE}}this.onTickEnd()},P.clearWaitingFragment=function(){var w=this.waitingData;w&&(this.fragmentTracker.removeFragment(w.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=s.State.IDLE)},P.onTickEnd=function(){var w=this.media;if(!(!w||!w.readyState)){var L=this.mediaBuffer?this.mediaBuffer:w,R=L.buffered;!this.loadedmetadata&&R.length&&(this.loadedmetadata=!0),this.lastCurrentTime=w.currentTime}},P.doTickIdle=function(){var w,L,R=this.hls,C=this.levels,M=this.media,N=this.trackId,U=R.config;if(!(!C||!C[N])&&!(!M&&(this.startFragRequested||!U.startFragPrefetch))){var K=C[N],V=K.details;if(!V||V.live&&this.levelLastLoaded!==N||this.waitForCdnTuneIn(V)){this.state=s.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,h.ElementaryStreamTypes.AUDIO,d.PlaylistLevelType.AUDIO));var W=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,d.PlaylistLevelType.AUDIO);if(W!==null){var G=W.len,Y=this.getMaxBufferLength(),q=this.audioSwitch;if(!(G>=Y&&!q)){if(!q&&this._streamEnded(W,V)){R.trigger(o.Events.BUFFER_EOS,{type:"audio"}),this.state=s.State.ENDED;return}var ee=V.fragments,re=ee[0].start,pe=W.end;if(q){var Le=this.getLoadPosition();pe=Le,V.PTSKnown&&Le<re&&(W.end>re||W.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),M.currentTime=re+.05)}var Te=this.getNextFragment(pe,V);if(!Te){this.bufferFlushed=!0;return}((w=Te.decryptdata)===null||w===void 0?void 0:w.keyFormat)==="identity"&&!((L=Te.decryptdata)!==null&&L!==void 0&&L.key)?this.loadKey(Te,V):this.loadFragment(Te,V,pe)}}}},P.getMaxBufferLength=function(){var w=O.prototype.getMaxBufferLength.call(this),L=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,d.PlaylistLevelType.MAIN);return L===null?w:Math.max(w,L.len)},P.onMediaDetaching=function(){this.videoBuffer=null,O.prototype.onMediaDetaching.call(this)},P.onAudioTracksUpdated=function(w,L){var R=L.audioTracks;this.resetTransmuxer(),this.levels=R.map(function(C){return new g.Level(C)})},P.onAudioTrackSwitching=function(w,L){var R=!!L.url;this.trackId=L.id;var C=this.fragCurrent;C!=null&&C.loader&&C.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),R?this.setInterval(E):this.resetTransmuxer(),R?(this.audioSwitch=!0,this.state=s.State.IDLE):this.state=s.State.STOPPED,this.tick()},P.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},P.onLevelLoaded=function(w,L){this.mainDetails=L.details},P.onAudioTrackLoaded=function(w,L){var R,C=this.levels,M=L.details,N=L.id;if(!C){this.warn("Audio tracks were reset while loading level "+N);return}this.log("Track "+N+" loaded ["+M.startSN+","+M.endSN+"],duration:"+M.totalduration);var U=C[N],K=0;if(M.live||(R=U.details)!==null&&R!==void 0&&R.live){var V=this.mainDetails;if(M.fragments[0]||(M.deltaUpdateFailed=!0),M.deltaUpdateFailed||!V)return;!U.details&&M.hasProgramDateTime&&V.hasProgramDateTime?(Object(c.alignMediaPlaylistByPDT)(M,V),K=M.fragments[0].start):K=this.alignPlaylists(M,U.details)}U.details=M,this.levelLastLoaded=N,!this.startFragRequested&&(this.mainDetails||!M.live)&&this.setStartPosition(U.details,K),this.state===s.State.WAITING_TRACK&&!this.waitForCdnTuneIn(M)&&(this.state=s.State.IDLE),this.tick()},P._handleFragmentLoadProgress=function(w){var L,R=w.frag,C=w.part,M=w.payload,N=this.config,U=this.trackId,K=this.levels;if(!K){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+R.sn+" of level "+R.level+" will not be buffered");return}var V=K[U];console.assert(V,"Audio track is defined on fragment load progress");var W=V.details;console.assert(W,"Audio track details are defined on fragment load progress");var G=N.defaultAudioCodec||V.audioCodec||"mp4a.40.2",Y=this.transmuxer;Y||(Y=this.transmuxer=new b.default(this.hls,d.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var q=this.initPTS[R.cc],ee=(L=R.initSegment)===null||L===void 0?void 0:L.data;if(q!==void 0){var re=!1,pe=C?C.index:-1,Le=pe!==-1,Te=new T.ChunkMetadata(R.level,R.sn,R.stats.chunkCount,M.byteLength,pe,Le);Y.push(M,ee,G,"",R,C,W.totalduration,re,Te,q)}else{f.logger.log("Unknown video PTS for cc "+R.cc+", waiting for video PTS before demuxing audio frag "+R.sn+" of ["+W.startSN+" ,"+W.endSN+"],track "+U);var be=this.waitingData=this.waitingData||{frag:R,part:C,cache:new y.default,complete:!1},Re=be.cache;Re.push(new Uint8Array(M)),this.waitingVideoCC=this.videoTrackCC,this.state=s.State.WAITING_INIT_PTS}},P._handleFragmentLoadComplete=function(w){if(this.waitingData){this.waitingData.complete=!0;return}O.prototype._handleFragmentLoadComplete.call(this,w)},P.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},P.onBufferCreated=function(w,L){var R=L.tracks.audio;R&&(this.mediaBuffer=R.buffer),L.tracks.video&&(this.videoBuffer=L.tracks.video.buffer)},P.onFragBuffered=function(w,L){var R=L.frag,C=L.part;if(R.type===d.PlaylistLevelType.AUDIO){if(this.fragContextChanged(R)){this.warn("Fragment "+R.sn+(C?" p: "+C.index:"")+" of level "+R.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}R.sn!=="initSegment"&&(this.fragPrevious=R,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(o.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(R,C)}},P.onError=function(w,L){switch(L.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.AUDIO,L);break;case u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case u.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==s.State.ERROR&&this.state!==s.State.STOPPED&&(this.state=L.fatal?s.State.ERROR:s.State.IDLE,this.warn(L.details+" while loading frag, switching to "+this.state+" state"));break;case u.ErrorDetails.BUFFER_FULL_ERROR:if(L.parent==="audio"&&(this.state===s.State.PARSING||this.state===s.State.PARSED)){var R=!0,C=this.getFwdBufferInfo(this.mediaBuffer,d.PlaylistLevelType.AUDIO);C&&C.len>.5&&(R=!this.reduceMaxBufferLength(C.len)),R&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,O.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},P.onBufferFlushed=function(w,L){var R=L.type;R===h.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},P._handleTransmuxComplete=function(w){var L,R="audio",C=this.hls,M=w.remuxResult,N=w.chunkMeta,U=this.getCurrentContext(N);if(!U){this.warn("The loading context changed while buffering fragment "+N.sn+" of level "+N.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(N.level);return}var K=U.frag,V=U.part,W=M.audio,G=M.text,Y=M.id3,q=M.initSegment;if(!this.fragContextChanged(K)){if(this.state=s.State.PARSING,this.audioSwitch&&W&&this.completeAudioSwitch(),q!=null&&q.tracks&&(this._bufferInitSegment(q.tracks,K,N),C.trigger(o.Events.FRAG_PARSING_INIT_SEGMENT,{frag:K,id:R,tracks:q.tracks})),W){var ee=W.startPTS,re=W.endPTS,pe=W.startDTS,Le=W.endDTS;V&&(V.elementaryStreams[h.ElementaryStreamTypes.AUDIO]={startPTS:ee,endPTS:re,startDTS:pe,endDTS:Le}),K.setElementaryStreamInfo(h.ElementaryStreamTypes.AUDIO,ee,re,pe,Le),this.bufferFragmentData(W,K,V,N)}if(Y!=null&&(L=Y.samples)!==null&&L!==void 0&&L.length){var Te=v({frag:K,id:R},Y);C.trigger(o.Events.FRAG_PARSING_METADATA,Te)}if(G){var be=v({frag:K,id:R},G);C.trigger(o.Events.FRAG_PARSING_USERDATA,be)}}},P._bufferInitSegment=function(w,L,R){if(this.state===s.State.PARSING){w.video&&delete w.video;var C=w.audio;if(!!C){C.levelCodec=C.codec,C.id="audio",this.log("Init audio buffer, container:"+C.container+", codecs[parsed]=["+C.codec+"]"),this.hls.trigger(o.Events.BUFFER_CODECS,w);var M=C.initSegment;if(M!=null&&M.byteLength){var N={type:"audio",frag:L,part:null,chunkMeta:R,parent:L.type,data:M};this.hls.trigger(o.Events.BUFFER_APPENDING,N)}this.tick()}}},P.loadFragment=function(w,L,R){var C=this.fragmentTracker.getState(w);this.fragCurrent=w,(this.audioSwitch||C===x.FragmentState.NOT_LOADED||C===x.FragmentState.PARTIAL)&&(w.sn==="initSegment"?this._loadInitSegment(w):L.live&&!Object(a.isFiniteNumber)(this.initPTS[w.cc])?(this.log("Waiting for video PTS in continuity counter "+w.cc+" of live stream before loading audio fragment "+w.sn+" of level "+this.trackId),this.state=s.State.WAITING_INIT_PTS):(this.startFragRequested=!0,O.prototype.loadFragment.call(this,w,L,R)))},P.completeAudioSwitch=function(){var w=this.hls,L=this.media,R=this.trackId;L&&(this.log("Switching audio track : flushing all audio"),O.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,w.trigger(o.Events.AUDIO_TRACK_SWITCHED,{id:R})},D}(s.default);n.default=S},"./src/controller/audio-track-controller.ts":function(r,n,t){t.r(n);var a=t("./src/events.ts"),s=t("./src/errors.ts"),o=t("./src/controller/base-playlist-controller.ts"),p=t("./src/types/loader.ts");function x(b,T){for(var _=0;_<T.length;_++){var c=T[_];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(b,c.key,c)}}function g(b,T,_){return T&&x(b.prototype,T),_&&x(b,_),b}function d(b,T){b.prototype=Object.create(T.prototype),b.prototype.constructor=b,h(b,T)}function h(b,T){return h=Object.setPrototypeOf||function(c,u){return c.__proto__=u,c},h(b,T)}var y=function(b){d(T,b);function T(c){var u;return u=b.call(this,c,"[audio-track-controller]")||this,u.tracks=[],u.groupId=null,u.tracksInGroup=[],u.trackId=-1,u.trackName="",u.selectDefaultTrack=!0,u.registerListeners(),u}var _=T.prototype;return _.registerListeners=function(){var u=this.hls;u.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),u.on(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.on(a.Events.ERROR,this.onError,this)},_.unregisterListeners=function(){var u=this.hls;u.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(a.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),u.off(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.off(a.Events.ERROR,this.onError,this)},_.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,b.prototype.destroy.call(this)},_.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},_.onManifestParsed=function(u,f){this.tracks=f.audioTracks||[]},_.onAudioTrackLoaded=function(u,f){var v=f.id,l=f.details,m=this.tracksInGroup[v];if(!m){this.warn("Invalid audio track id "+v);return}var E=m.details;m.details=f.details,this.log("audioTrack "+v+" loaded ["+l.startSN+"-"+l.endSN+"]"),v===this.trackId&&(this.retryCount=0,this.playlistLoaded(v,f,E))},_.onLevelLoading=function(u,f){this.switchLevel(f.level)},_.onLevelSwitching=function(u,f){this.switchLevel(f.level)},_.switchLevel=function(u){var f=this.hls.levels[u];if(!!(f!=null&&f.audioGroupIds)){var v=f.audioGroupIds[f.urlId];if(this.groupId!==v){this.groupId=v;var l=this.tracks.filter(function(E){return!v||E.groupId===v});this.selectDefaultTrack&&!l.some(function(E){return E.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=l;var m={audioTracks:l};this.log("Updating audio tracks, "+l.length+' track(s) found in "'+v+'" group-id'),this.hls.trigger(a.Events.AUDIO_TRACKS_UPDATED,m),this.selectInitialTrack()}}},_.onError=function(u,f){b.prototype.onError.call(this,u,f),!(f.fatal||!f.context)&&f.context.type===p.PlaylistContextType.AUDIO_TRACK&&f.context.id===this.trackId&&f.context.groupId===this.groupId&&this.retryLoadingOrFail(f)},_.setAudioTrack=function(u){var f=this.tracksInGroup;if(u<0||u>=f.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var v=f[this.trackId];this.log("Now switching to audio-track index "+u);var l=f[u],m=l.id,E=l.groupId,S=E===void 0?"":E,O=l.name,D=l.type,P=l.url;if(this.trackId=u,this.trackName=O,this.selectDefaultTrack=!1,this.hls.trigger(a.Events.AUDIO_TRACK_SWITCHING,{id:m,groupId:S,name:O,type:D,url:P}),!(l.details&&!l.details.live)){var A=this.switchParams(l.url,v==null?void 0:v.details);this.loadPlaylist(A)}},_.selectInitialTrack=function(){var u=this.tracksInGroup;console.assert(u.length,"Initial audio track should be selected when tracks are known");var f=this.trackName,v=this.findTrackId(f)||this.findTrackId();v!==-1?this.setAudioTrack(v):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},_.findTrackId=function(u){for(var f=this.tracksInGroup,v=0;v<f.length;v++){var l=f[v];if((!this.selectDefaultTrack||l.default)&&(!u||u===l.name))return l.id}return-1},_.loadPlaylist=function(u){var f=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(f)){var v=f.id,l=f.groupId,m=f.url;if(u)try{m=u.addDirectives(m)}catch(E){this.warn("Could not construct new URL with HLS Delivery Directives: "+E)}this.log("loading audio-track playlist for id: "+v),this.clearTimer(),this.hls.trigger(a.Events.AUDIO_TRACK_LOADING,{url:m,id:v,groupId:l,deliveryDirectives:u||null})}},g(T,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(u){this.selectDefaultTrack=!1,this.setAudioTrack(u)}}]),T}(o.default);n.default=y},"./src/controller/base-playlist-controller.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return g});var a=t("./src/polyfills/number.ts"),s=t("./src/types/level.ts"),o=t("./src/controller/level-helper.ts"),p=t("./src/utils/logger.ts"),x=t("./src/errors.ts"),g=function(){function d(y,b){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=p.logger.log.bind(p.logger,b+":"),this.warn=p.logger.warn.bind(p.logger,b+":"),this.hls=y}var h=d.prototype;return h.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},h.onError=function(b,T){T.fatal&&T.type===x.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},h.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},h.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},h.stopLoad=function(){this.canLoad=!1,this.clearTimer()},h.switchParams=function(b,T){var _=T==null?void 0:T.renditionReports;if(_)for(var c=0;c<_.length;c++){var u=_[c],f=""+u.URI;if(f===b.substr(-f.length)){var v=parseInt(u["LAST-MSN"]),l=parseInt(u["LAST-PART"]);if(T&&this.hls.config.lowLatencyMode){var m=Math.min(T.age-T.partTarget,T.targetduration);l!==void 0&&m>T.partTarget&&(l+=1)}if(Object(a.isFiniteNumber)(v))return new s.HlsUrlParameters(v,Object(a.isFiniteNumber)(l)?l:void 0,s.HlsSkip.No)}}},h.loadPlaylist=function(b){},h.shouldLoadTrack=function(b){return this.canLoad&&b&&!!b.url&&(!b.details||b.details.live)},h.playlistLoaded=function(b,T,_){var c=this,u=T.details,f=T.stats,v=f.loading.end?Math.max(0,self.performance.now()-f.loading.end):0;if(u.advancedDateTime=Date.now()-v,u.live||_!=null&&_.live){if(u.reloaded(_),_&&this.log("live playlist "+b+" "+(u.advanced?"REFRESHED "+u.lastPartSn+"-"+u.lastPartIndex:"MISSED")),_&&u.fragments.length>0&&Object(o.mergeDetails)(_,u),!this.canLoad||!u.live)return;var l,m=void 0,E=void 0;if(u.canBlockReload&&u.endSN&&u.advanced){var S=this.hls.config.lowLatencyMode,O=u.lastPartSn,D=u.endSN,P=u.lastPartIndex,A=P!==-1,w=O===D,L=S?0:P;A?(m=w?D+1:O,E=w?L:P+1):m=D+1;var R=u.age,C=R+u.ageHeader,M=Math.min(C-u.partTarget,u.targetduration*1.5);if(M>0){if(_&&M>_.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+_.tuneInGoal+" to: "+M+" with playlist age: "+u.age),M=0;else{var N=Math.floor(M/u.targetduration);if(m+=N,E!==void 0){var U=Math.round(M%u.targetduration/u.partTarget);E+=U}this.log("CDN Tune-in age: "+u.ageHeader+"s last advanced "+R.toFixed(2)+"s goal: "+M+" skip sn "+N+" to part "+E)}u.tuneInGoal=M}if(l=this.getDeliveryDirectives(u,T.deliveryDirectives,m,E),S||!w){this.loadPlaylist(l);return}}else l=this.getDeliveryDirectives(u,T.deliveryDirectives,m,E);var K=Object(o.computeReloadInterval)(u,f);m!==void 0&&u.canBlockReload&&(K-=u.partTarget||1),this.log("reload live playlist "+b+" in "+Math.round(K)+" ms"),this.timer=self.setTimeout(function(){return c.loadPlaylist(l)},K)}else this.clearTimer()},h.getDeliveryDirectives=function(b,T,_,c){var u=Object(s.getSkipValue)(b,_);return T!=null&&T.skip&&b.deltaUpdateFailed&&(_=T.msn,c=T.part,u=s.HlsSkip.No),new s.HlsUrlParameters(_,c,u)},h.retryLoadingOrFail=function(b){var T=this,_=this.hls.config,c=this.retryCount<_.levelLoadingMaxRetry;if(c){var u;if(this.retryCount++,b.details.indexOf("LoadTimeOut")>-1&&(u=b.context)!==null&&u!==void 0&&u.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+b.details+'"'),this.loadPlaylist();else{var f=Math.min(Math.pow(2,this.retryCount)*_.levelLoadingRetryDelay,_.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},f),this.warn("retry playlist loading #"+this.retryCount+" in "+f+' ms after "'+b.details+'"')}}else this.warn('cannot recover from error "'+b.details+'"'),this.clearTimer(),b.fatal=!0;return c},d}()},"./src/controller/base-stream-controller.ts":function(r,n,t){t.r(n),t.d(n,"State",function(){return D}),t.d(n,"default",function(){return P});var a=t("./src/polyfills/number.ts"),s=t("./src/task-loop.ts"),o=t("./src/controller/fragment-tracker.ts"),p=t("./src/utils/buffer-helper.ts"),x=t("./src/utils/logger.ts"),g=t("./src/events.ts"),d=t("./src/errors.ts"),h=t("./src/types/transmuxer.ts"),y=t("./src/utils/mp4-tools.ts"),b=t("./src/utils/discontinuities.ts"),T=t("./src/controller/fragment-finders.ts"),_=t("./src/controller/level-helper.ts"),c=t("./src/loader/fragment-loader.ts"),u=t("./src/crypt/decrypter.ts"),f=t("./src/utils/time-ranges.ts"),v=t("./src/types/loader.ts");function l(A,w){for(var L=0;L<w.length;L++){var R=w[L];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(A,R.key,R)}}function m(A,w,L){return w&&l(A.prototype,w),L&&l(A,L),A}function E(A){if(A===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A}function S(A,w){A.prototype=Object.create(w.prototype),A.prototype.constructor=A,O(A,w)}function O(A,w){return O=Object.setPrototypeOf||function(R,C){return R.__proto__=C,R},O(A,w)}var D={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},P=function(A){S(w,A);function w(R,C,M){var N;return N=A.call(this)||this,N.hls=void 0,N.fragPrevious=null,N.fragCurrent=null,N.fragmentTracker=void 0,N.transmuxer=null,N._state=D.STOPPED,N.media=void 0,N.mediaBuffer=void 0,N.config=void 0,N.bitrateTest=!1,N.lastCurrentTime=0,N.nextLoadPosition=0,N.startPosition=0,N.loadedmetadata=!1,N.fragLoadError=0,N.retryDate=0,N.levels=null,N.fragmentLoader=void 0,N.levelLastLoaded=null,N.startFragRequested=!1,N.decrypter=void 0,N.initPTS=[],N.onvseeking=null,N.onvended=null,N.logPrefix="",N.log=void 0,N.warn=void 0,N.logPrefix=M,N.log=x.logger.log.bind(x.logger,M+":"),N.warn=x.logger.warn.bind(x.logger,M+":"),N.hls=R,N.fragmentLoader=new c.default(R.config),N.fragmentTracker=C,N.config=R.config,N.decrypter=new u.default(R,R.config),R.on(g.Events.KEY_LOADED,N.onKeyLoaded,E(N)),N}var L=w.prototype;return L.doTick=function(){this.onTickEnd()},L.onTickEnd=function(){},L.startLoad=function(C){},L.stopLoad=function(){this.fragmentLoader.abort();var C=this.fragCurrent;C&&this.fragmentTracker.removeFragment(C),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=D.STOPPED},L._streamEnded=function(C,M){var N=this.fragCurrent,U=this.fragmentTracker;if(!M.live&&N&&N.sn>=M.endSN&&!C.nextStart){var K=M.partList;if(K!=null&&K.length){var V=K[K.length-1],W=p.BufferHelper.isBuffered(this.media,V.start+V.duration/2);return W}var G=U.getState(N);return G===o.FragmentState.PARTIAL||G===o.FragmentState.OK}return!1},L.onMediaAttached=function(C,M){var N=this.media=this.mediaBuffer=M.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),N.addEventListener("seeking",this.onvseeking),N.addEventListener("ended",this.onvended);var U=this.config;this.levels&&U.autoStartLoad&&this.state===D.STOPPED&&this.startLoad(U.startPosition)},L.onMediaDetaching=function(){var C=this.media;C!=null&&C.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),C&&(C.removeEventListener("seeking",this.onvseeking),C.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},L.onMediaSeeking=function(){var C=this.config,M=this.fragCurrent,N=this.media,U=this.mediaBuffer,K=this.state,V=N?N.currentTime:0,W=p.BufferHelper.bufferInfo(U||N,V,C.maxBufferHole);if(this.log("media seeking to "+(Object(a.isFiniteNumber)(V)?V.toFixed(3):V)+", state: "+K),K===D.ENDED)this.resetLoadingState();else if(M&&!W.len){var G=C.maxFragLookUpTolerance,Y=M.start-G,q=M.start+M.duration+G,ee=V>q;(V<Y||ee)&&(ee&&M.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),M.loader.abort()),this.resetLoadingState())}N&&(this.lastCurrentTime=V),!this.loadedmetadata&&!W.len&&(this.nextLoadPosition=this.startPosition=V),this.tickImmediate()},L.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},L.onKeyLoaded=function(C,M){if(!(this.state!==D.KEY_LOADING||M.frag!==this.fragCurrent||!this.levels)){this.state=D.IDLE;var N=this.levels[M.frag.level].details;N&&this.loadFragment(M.frag,N,M.frag.start)}},L.onHandlerDestroying=function(){this.stopLoad(),A.prototype.onHandlerDestroying.call(this)},L.onHandlerDestroyed=function(){this.state=D.STOPPED,this.hls.off(g.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,A.prototype.onHandlerDestroyed.call(this)},L.loadKey=function(C,M){this.log("Loading key for "+C.sn+" of ["+M.startSN+"-"+M.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+C.level),this.state=D.KEY_LOADING,this.fragCurrent=C,this.hls.trigger(g.Events.KEY_LOADING,{frag:C})},L.loadFragment=function(C,M,N){this._loadFragForPlayback(C,M,N)},L._loadFragForPlayback=function(C,M,N){var U=this,K=function(W){if(U.fragContextChanged(C)){U.warn("Fragment "+C.sn+(W.part?" p: "+W.part.index:"")+" of level "+C.level+" was dropped during download."),U.fragmentTracker.removeFragment(C);return}C.stats.chunkCount++,U._handleFragmentLoadProgress(W)};this._doFragLoad(C,M,N,K).then(function(V){if(!!V){U.fragLoadError=0;var W=U.state;if(U.fragContextChanged(C)){(W===D.FRAG_LOADING||W===D.BACKTRACKING||!U.fragCurrent&&W===D.PARSING)&&(U.fragmentTracker.removeFragment(C),U.state=D.IDLE);return}if("payload"in V&&(U.log("Loaded fragment "+C.sn+" of level "+C.level),U.hls.trigger(g.Events.FRAG_LOADED,V),U.state===D.BACKTRACKING)){U.fragmentTracker.backtrack(C,V),U.resetFragmentLoading(C);return}U._handleFragmentLoadComplete(V)}}).catch(function(V){U.warn(V),U.resetFragmentLoading(C)})},L.flushMainBuffer=function(C,M,N){if(N===void 0&&(N=null),!!(C-M)){var U={startOffset:C,endOffset:M,type:N};this.fragLoadError=0,this.hls.trigger(g.Events.BUFFER_FLUSHING,U)}},L._loadInitSegment=function(C){var M=this;this._doFragLoad(C).then(function(N){if(!N||M.fragContextChanged(C)||!M.levels)throw new Error("init load aborted");return N}).then(function(N){var U=M.hls,K=N.payload,V=C.decryptdata;if(K&&K.byteLength>0&&V&&V.key&&V.iv&&V.method==="AES-128"){var W=self.performance.now();return M.decrypter.webCryptoDecrypt(new Uint8Array(K),V.key.buffer,V.iv.buffer).then(function(G){var Y=self.performance.now();return U.trigger(g.Events.FRAG_DECRYPTED,{frag:C,payload:G,stats:{tstart:W,tdecrypt:Y}}),N.payload=G,N})}return N}).then(function(N){var U=M.fragCurrent,K=M.hls,V=M.levels;if(!V)throw new Error("init load aborted, missing levels");var W=V[C.level].details;console.assert(W,"Level details are defined when init segment is loaded");var G=C.stats;M.state=D.IDLE,M.fragLoadError=0,C.data=new Uint8Array(N.payload),G.parsing.start=G.buffering.start=self.performance.now(),G.parsing.end=G.buffering.end=self.performance.now(),N.frag===U&&K.trigger(g.Events.FRAG_BUFFERED,{stats:G,frag:U,part:null,id:C.type}),M.tick()}).catch(function(N){M.warn(N),M.resetFragmentLoading(C)})},L.fragContextChanged=function(C){var M=this.fragCurrent;return!C||!M||C.level!==M.level||C.sn!==M.sn||C.urlId!==M.urlId},L.fragBufferedComplete=function(C,M){var N=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+C.type+" sn: "+C.sn+(M?" part: "+M.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+C.level+" "+f.default.toString(p.BufferHelper.getBuffered(N))),this.state=D.IDLE,this.tick()},L._handleFragmentLoadComplete=function(C){var M=this.transmuxer;if(!!M){var N=C.frag,U=C.part,K=C.partsLoaded,V=!K||K.length===0||K.some(function(G){return!G}),W=new h.ChunkMetadata(N.level,N.sn,N.stats.chunkCount+1,0,U?U.index:-1,!V);M.flush(W)}},L._handleFragmentLoadProgress=function(C){},L._doFragLoad=function(C,M,N,U){var K=this;if(N===void 0&&(N=null),!this.levels)throw new Error("frag load aborted, missing levels");if(N=Math.max(C.start,N||0),this.config.lowLatencyMode&&M){var V=M.partList;if(V&&U){N>C.end&&M.fragmentHint&&(C=M.fragmentHint);var W=this.getNextPart(V,C,N);if(W>-1){var G=V[W];return this.log("Loading part sn: "+C.sn+" p: "+G.index+" cc: "+C.cc+" of playlist ["+M.startSN+"-"+M.endSN+"] parts [0-"+W+"-"+(V.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+C.level+", target: "+parseFloat(N.toFixed(3))),this.nextLoadPosition=G.start+G.duration,this.state=D.FRAG_LOADING,this.hls.trigger(g.Events.FRAG_LOADING,{frag:C,part:V[W],targetBufferTime:N}),this.doFragPartsLoad(C,V,W,U).catch(function(Y){return K.handleFragLoadError(Y)})}else if(!C.url||this.loadedEndOfParts(V,N))return Promise.resolve(null)}}return this.log("Loading fragment "+C.sn+" cc: "+C.cc+" "+(M?"of ["+M.startSN+"-"+M.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+C.level+", target: "+parseFloat(N.toFixed(3))),Object(a.isFiniteNumber)(C.sn)&&!this.bitrateTest&&(this.nextLoadPosition=C.start+C.duration),this.state=D.FRAG_LOADING,this.hls.trigger(g.Events.FRAG_LOADING,{frag:C,targetBufferTime:N}),this.fragmentLoader.load(C,U).catch(function(Y){return K.handleFragLoadError(Y)})},L.doFragPartsLoad=function(C,M,N,U){var K=this;return new Promise(function(V,W){var G=[],Y=function q(ee){var re=M[ee];K.fragmentLoader.loadPart(C,re,U).then(function(pe){G[re.index]=pe;var Le=pe.part;K.hls.trigger(g.Events.FRAG_LOADED,pe);var Te=M[ee+1];if(Te&&Te.fragment===C)q(ee+1);else return V({frag:C,part:Le,partsLoaded:G})}).catch(W)};Y(N)})},L.handleFragLoadError=function(C){var M=C.data;return M&&M.details===d.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(M.frag,M.part):this.hls.trigger(g.Events.ERROR,M),null},L._handleTransmuxerFlush=function(C){var M=this.getCurrentContext(C);if(!M||this.state!==D.PARSING){this.fragCurrent||(this.state=D.IDLE);return}var N=M.frag,U=M.part,K=M.level,V=self.performance.now();N.stats.parsing.end=V,U&&(U.stats.parsing.end=V),this.updateLevelTiming(N,U,K,C.partial)},L.getCurrentContext=function(C){var M=this.levels,N=C.level,U=C.sn,K=C.part;if(!M||!M[N])return this.warn("Levels object was unset while buffering fragment "+U+" of level "+N+". The current chunk will not be buffered."),null;var V=M[N],W=K>-1?Object(_.getPartWith)(V,U,K):null,G=W?W.fragment:Object(_.getFragmentWithSN)(V,U,this.fragCurrent);return G?{frag:G,part:W,level:V}:null},L.bufferFragmentData=function(C,M,N,U){if(!(!C||this.state!==D.PARSING)){var K=C.data1,V=C.data2,W=K;if(K&&V&&(W=Object(y.appendUint8Array)(K,V)),!(!W||!W.length)){var G={type:C.type,frag:M,part:N,chunkMeta:U,parent:M.type,data:W};this.hls.trigger(g.Events.BUFFER_APPENDING,G),C.dropped&&C.independent&&!N&&this.flushBufferGap(M)}}},L.flushBufferGap=function(C){var M=this.media;if(!!M){if(!p.BufferHelper.isBuffered(M,M.currentTime)){this.flushMainBuffer(0,C.start);return}var N=M.currentTime,U=p.BufferHelper.bufferInfo(M,N,0),K=C.duration,V=Math.min(this.config.maxFragLookUpTolerance*2,K*.25),W=Math.max(Math.min(C.start-V,U.end-V),N+V);C.start-W>V&&this.flushMainBuffer(W,C.start)}},L.getFwdBufferInfo=function(C,M){var N=this.config,U=this.getLoadPosition();if(!Object(a.isFiniteNumber)(U))return null;var K=p.BufferHelper.bufferInfo(C,U,N.maxBufferHole);if(K.len===0&&K.nextStart!==void 0){var V=this.fragmentTracker.getBufferedFrag(U,M);if(V&&K.nextStart<V.end)return p.BufferHelper.bufferInfo(C,U,Math.max(K.nextStart,N.maxBufferHole))}return K},L.getMaxBufferLength=function(C){var M=this.config,N;return C?N=Math.max(8*M.maxBufferSize/C,M.maxBufferLength):N=M.maxBufferLength,Math.min(N,M.maxMaxBufferLength)},L.reduceMaxBufferLength=function(C){var M=this.config,N=C||M.maxBufferLength;return M.maxMaxBufferLength>=N?(M.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+M.maxMaxBufferLength+"s"),!0):!1},L.getNextFragment=function(C,M){var N,U,K=M.fragments,V=K.length;if(!V)return null;var W=this.config,G=K[0].start,Y;if(M.live){var q=W.initialLiveManifestSize;if(V<q)return this.warn("Not enough fragments to start playback (have: "+V+", need: "+q+")"),null;!M.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(Y=this.getInitialLiveFragment(M,K),this.startPosition=Y?this.hls.liveSyncPosition||Y.start:C)}else C<=G&&(Y=K[0]);if(!Y){var ee=W.lowLatencyMode?M.partEnd:M.fragmentEnd;Y=this.getFragmentAtPosition(C,ee,M)}return(N=Y)!==null&&N!==void 0&&N.initSegment&&!((U=Y)!==null&&U!==void 0&&U.initSegment.data)&&!this.bitrateTest&&(Y=Y.initSegment),Y},L.getNextPart=function(C,M,N){for(var U=-1,K=!1,V=!0,W=0,G=C.length;W<G;W++){var Y=C[W];if(V=V&&!Y.independent,U>-1&&N<Y.start)break;var q=Y.loaded;!q&&(K||Y.independent||V)&&Y.fragment===M&&(U=W),K=q}return U},L.loadedEndOfParts=function(C,M){var N=C[C.length-1];return N&&M>N.start&&N.loaded},L.getInitialLiveFragment=function(C,M){var N=this.fragPrevious,U=null;if(N){if(C.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+N.programDateTime),U=Object(T.findFragmentByPDT)(M,N.endProgramDateTime,this.config.maxFragLookUpTolerance)),!U){var K=N.sn+1;if(K>=C.startSN&&K<=C.endSN){var V=M[K-C.startSN];N.cc===V.cc&&(U=V,this.log("Live playlist, switching playlist, load frag with next SN: "+U.sn))}U||(U=Object(T.findFragWithCC)(M,N.cc),U&&this.log("Live playlist, switching playlist, load frag with same CC: "+U.sn))}}else{var W=this.hls.liveSyncPosition;W!==null&&(U=this.getFragmentAtPosition(W,this.bitrateTest?C.fragmentEnd:C.edge,C))}return U},L.getFragmentAtPosition=function(C,M,N){var U=this.config,K=this.fragPrevious,V=N.fragments,W=N.endSN,G=N.fragmentHint,Y=U.maxFragLookUpTolerance,q=!!(U.lowLatencyMode&&N.partList&&G);q&&G&&!this.bitrateTest&&(V=V.concat(G),W=G.sn);var ee;if(C<M){var re=C>M-Y?0:Y;ee=Object(T.findFragmentByPTS)(K,V,C,re)}else ee=V[V.length-1];if(ee){var pe=ee.sn-N.startSN,Le=K&&ee.level===K.level,Te=V[pe+1],be=this.fragmentTracker.getState(ee);if(be===o.FragmentState.BACKTRACKED){ee=null;for(var Re=pe;V[Re]&&this.fragmentTracker.getState(V[Re])===o.FragmentState.BACKTRACKED;)K?ee=V[Re--]:ee=V[--Re];ee||(ee=Te)}else K&&ee.sn===K.sn&&!q&&Le&&(ee.sn<W&&this.fragmentTracker.getState(Te)!==o.FragmentState.OK?(this.log("SN "+ee.sn+" just loaded, load next one: "+Te.sn),ee=Te):ee=null)}return ee},L.synchronizeToLiveEdge=function(C){var M=this.config,N=this.media;if(!!N){var U=this.hls.liveSyncPosition,K=N.currentTime,V=C.fragments[0].start,W=C.edge,G=K>=V-M.maxFragLookUpTolerance&&K<=W;if(U!==null&&N.duration>U&&(K<U||!G)){var Y=M.liveMaxLatencyDuration!==void 0?M.liveMaxLatencyDuration:M.liveMaxLatencyDurationCount*C.targetduration;(!G&&N.readyState<4||K<W-Y)&&(this.loadedmetadata||(this.nextLoadPosition=U),N.readyState&&(this.warn("Playback: "+K.toFixed(3)+" is located too far from the end of live sliding playlist: "+W+", reset currentTime to : "+U.toFixed(3)),N.currentTime=U))}}},L.alignPlaylists=function(C,M){var N=this.levels,U=this.levelLastLoaded,K=this.fragPrevious,V=U!==null?N[U]:null,W=C.fragments.length;if(!W)return this.warn("No fragments in live playlist"),0;var G=C.fragments[0].start,Y=!M,q=C.alignedSliding&&Object(a.isFiniteNumber)(G);if(Y||!q&&!G){Object(b.alignStream)(K,V,C);var ee=C.fragments[0].start;return this.log("Live playlist sliding: "+ee.toFixed(2)+" start-sn: "+(M?M.startSN:"na")+"->"+C.startSN+" prev-sn: "+(K?K.sn:"na")+" fragments: "+W),ee}return G},L.waitForCdnTuneIn=function(C){var M=3;return C.live&&C.canBlockReload&&C.tuneInGoal>Math.max(C.partHoldBack,C.partTarget*M)},L.setStartPosition=function(C,M){var N=this.startPosition;if(N<M&&(N=-1),N===-1||this.lastCurrentTime===-1){var U=C.startTimeOffset;Object(a.isFiniteNumber)(U)?(N=M+U,U<0&&(N+=C.totalduration),N=Math.min(Math.max(M,N),M+C.totalduration),this.log("Start time offset "+U+" found in playlist, adjust startPosition to "+N),this.startPosition=N):C.live?N=this.hls.liveSyncPosition||M:this.startPosition=N=0,this.lastCurrentTime=N}this.nextLoadPosition=N},L.getLoadPosition=function(){var C=this.media,M=0;return this.loadedmetadata&&C?M=C.currentTime:this.nextLoadPosition&&(M=this.nextLoadPosition),M},L.handleFragLoadAborted=function(C,M){this.transmuxer&&C.sn!=="initSegment"&&C.stats.aborted&&(this.warn("Fragment "+C.sn+(M?" part"+M.index:"")+" of level "+C.level+" was aborted"),this.resetFragmentLoading(C))},L.resetFragmentLoading=function(C){(!this.fragCurrent||!this.fragContextChanged(C))&&(this.state=D.IDLE)},L.onFragmentOrKeyLoadError=function(C,M){if(!M.fatal){var N=M.frag;if(!(!N||N.type!==C)){var U=this.fragCurrent;console.assert(U&&N.sn===U.sn&&N.level===U.level&&N.urlId===U.urlId,"Frag load error must match current frag to retry");var K=this.config;if(this.fragLoadError+1<=K.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(N.level))return;var V=Math.min(Math.pow(2,this.fragLoadError)*K.fragLoadingRetryDelay,K.fragLoadingMaxRetryTimeout);this.warn("Fragment "+N.sn+" of "+C+" "+N.level+" failed to load, retrying in "+V+"ms"),this.retryDate=self.performance.now()+V,this.fragLoadError++,this.state=D.FRAG_LOADING_WAITING_RETRY}else M.levelRetry?(C===v.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=D.IDLE):(x.logger.error(M.details+" reaches max retry, redispatch as fatal ..."),M.fatal=!0,this.hls.stopLoad(),this.state=D.ERROR)}}},L.afterBufferFlushed=function(C,M,N){if(!!C){var U=p.BufferHelper.getBuffered(C);this.fragmentTracker.detectEvictedFragments(M,U,N),this.state===D.ENDED&&this.resetLoadingState()}},L.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=D.IDLE},L.resetLiveStartWhenNotLoaded=function(C){if(!this.loadedmetadata){this.startFragRequested=!1;var M=this.levels?this.levels[C].details:null;if(M!=null&&M.live)return this.startPosition=-1,this.setStartPosition(M,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},L.updateLevelTiming=function(C,M,N,U){var K=this,V=N.details;console.assert(!!V,"level.details must be defined");var W=Object.keys(C.elementaryStreams).reduce(function(G,Y){var q=C.elementaryStreams[Y];if(q){var ee=q.endPTS-q.startPTS;if(ee<=0)return K.warn("Could not parse fragment "+C.sn+" "+Y+" duration reliably ("+ee+") resetting transmuxer to fallback to playlist timing"),K.resetTransmuxer(),G||!1;var re=U?0:Object(_.updateFragPTSDTS)(V,C,q.startPTS,q.endPTS,q.startDTS,q.endDTS);return K.hls.trigger(g.Events.LEVEL_PTS_UPDATED,{details:V,level:N,drift:re,type:Y,frag:C,start:q.startPTS,end:q.endPTS}),!0}return G},!1);W?(this.state=D.PARSED,this.hls.trigger(g.Events.FRAG_PARSED,{frag:C,part:M})):this.resetLoadingState()},L.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},m(w,[{key:"state",get:function(){return this._state},set:function(C){var M=this._state;M!==C&&(this._state=C,this.log(M+"->"+C))}}]),w}(s.default)},"./src/controller/buffer-controller.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return T});var a=t("./src/polyfills/number.ts"),s=t("./src/events.ts"),o=t("./src/utils/logger.ts"),p=t("./src/errors.ts"),x=t("./src/utils/buffer-helper.ts"),g=t("./src/utils/mediasource-helper.ts"),d=t("./src/loader/fragment.ts"),h=t("./src/controller/buffer-operation-queue.ts"),y=Object(g.getMediaSource)(),b=/([ha]vc.)(?:\.[^.,]+)+/,T=function(){function _(u){var f=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var v=f.hls,l=f.media,m=f.mediaSource;o.logger.log("[buffer-controller]: Media source opened"),l&&(f.updateMediaElementDuration(),v.trigger(s.Events.MEDIA_ATTACHED,{media:l})),m&&m.removeEventListener("sourceopen",f._onMediaSourceOpen),f.checkPendingTracks()},this._onMediaSourceClose=function(){o.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){o.logger.log("[buffer-controller]: Media source ended")},this.hls=u,this._initSourceBuffer(),this.registerListeners()}var c=_.prototype;return c.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},c.destroy=function(){this.unregisterListeners(),this.details=null},c.registerListeners=function(){var f=this.hls;f.on(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(s.Events.BUFFER_RESET,this.onBufferReset,this),f.on(s.Events.BUFFER_APPENDING,this.onBufferAppending,this),f.on(s.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.on(s.Events.BUFFER_EOS,this.onBufferEos,this),f.on(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.on(s.Events.LEVEL_UPDATED,this.onLevelUpdated,this),f.on(s.Events.FRAG_PARSED,this.onFragParsed,this),f.on(s.Events.FRAG_CHANGED,this.onFragChanged,this)},c.unregisterListeners=function(){var f=this.hls;f.off(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(s.Events.BUFFER_RESET,this.onBufferReset,this),f.off(s.Events.BUFFER_APPENDING,this.onBufferAppending,this),f.off(s.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.off(s.Events.BUFFER_EOS,this.onBufferEos,this),f.off(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.off(s.Events.LEVEL_UPDATED,this.onLevelUpdated,this),f.off(s.Events.FRAG_PARSED,this.onFragParsed,this),f.off(s.Events.FRAG_CHANGED,this.onFragChanged,this)},c._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new h.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},c.onManifestParsed=function(f,v){var l=2;(v.audio&&!v.video||!v.altAudio)&&(l=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=l,this.details=null,o.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},c.onMediaAttaching=function(f,v){var l=this.media=v.media;if(l&&y){var m=this.mediaSource=new y;m.addEventListener("sourceopen",this._onMediaSourceOpen),m.addEventListener("sourceended",this._onMediaSourceEnded),m.addEventListener("sourceclose",this._onMediaSourceClose),l.src=self.URL.createObjectURL(m),this._objectUrl=l.src}},c.onMediaDetaching=function(){var f=this.media,v=this.mediaSource,l=this._objectUrl;if(v){if(o.logger.log("[buffer-controller]: media source detaching"),v.readyState==="open")try{v.endOfStream()}catch(m){o.logger.warn("[buffer-controller]: onMediaDetaching: "+m.message+" while calling endOfStream")}this.onBufferReset(),v.removeEventListener("sourceopen",this._onMediaSourceOpen),v.removeEventListener("sourceended",this._onMediaSourceEnded),v.removeEventListener("sourceclose",this._onMediaSourceClose),f&&(l&&self.URL.revokeObjectURL(l),f.src===l?(f.removeAttribute("src"),f.load()):o.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(s.Events.MEDIA_DETACHED,void 0)},c.onBufferReset=function(){var f=this;this.getSourceBufferTypes().forEach(function(v){var l=f.sourceBuffer[v];try{l&&(f.removeBufferListeners(v),f.mediaSource&&f.mediaSource.removeSourceBuffer(l),f.sourceBuffer[v]=void 0)}catch(m){o.logger.warn("[buffer-controller]: Failed to reset the "+v+" buffer",m)}}),this._initSourceBuffer()},c.onBufferCodecs=function(f,v){var l=this,m=this.getSourceBufferTypes().length;Object.keys(v).forEach(function(E){if(m){var S=l.tracks[E];if(S&&typeof S.buffer.changeType=="function"){var O=v[E],D=O.codec,P=O.levelCodec,A=O.container,w=(S.levelCodec||S.codec).replace(b,"$1"),L=(P||D).replace(b,"$1");if(w!==L){var R=A+";codecs="+(P||D);l.appendChangeType(E,R)}}}else l.pendingTracks[E]=v[E]}),!m&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},c.appendChangeType=function(f,v){var l=this,m=this.operationQueue,E={execute:function(){var O=l.sourceBuffer[f];O&&(o.logger.log("[buffer-controller]: changing "+f+" sourceBuffer type to "+v),O.changeType(v)),m.shiftAndExecuteNext(f)},onStart:function(){},onComplete:function(){},onError:function(O){o.logger.warn("[buffer-controller]: Failed to change "+f+" SourceBuffer type",O)}};m.append(E,f)},c.onBufferAppending=function(f,v){var l=this,m=this.hls,E=this.operationQueue,S=this.tracks,O=v.data,D=v.type,P=v.frag,A=v.part,w=v.chunkMeta,L=w.buffering[D],R=self.performance.now();L.start=R;var C=P.stats.buffering,M=A?A.stats.buffering:null;C.start===0&&(C.start=R),M&&M.start===0&&(M.start=R);var N=S.audio,U=D==="audio"&&w.id===1&&(N==null?void 0:N.container)==="audio/mpeg",K={execute:function(){if(L.executeStart=self.performance.now(),U){var W=l.sourceBuffer[D];if(W){var G=P.start-W.timestampOffset;Math.abs(G)>=.1&&(o.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+P.start+" (delta: "+G+") sn: "+P.sn+")"),W.timestampOffset=P.start)}}l.appendExecutor(O,D)},onStart:function(){},onComplete:function(){var W=self.performance.now();L.executeEnd=L.end=W,C.first===0&&(C.first=W),M&&M.first===0&&(M.first=W);var G=l.sourceBuffer,Y={};for(var q in G)Y[q]=x.BufferHelper.getBuffered(G[q]);l.appendError=0,l.hls.trigger(s.Events.BUFFER_APPENDED,{type:D,frag:P,part:A,chunkMeta:w,parent:P.type,timeRanges:Y})},onError:function(W){o.logger.error("[buffer-controller]: Error encountered while trying to append to the "+D+" SourceBuffer",W);var G={type:p.ErrorTypes.MEDIA_ERROR,parent:P.type,details:p.ErrorDetails.BUFFER_APPEND_ERROR,err:W,fatal:!1};W.code===DOMException.QUOTA_EXCEEDED_ERR?G.details=p.ErrorDetails.BUFFER_FULL_ERROR:(l.appendError++,G.details=p.ErrorDetails.BUFFER_APPEND_ERROR,l.appendError>m.config.appendErrorMaxRetry&&(o.logger.error("[buffer-controller]: Failed "+m.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),G.fatal=!0)),m.trigger(s.Events.ERROR,G)}};E.append(K,D)},c.onBufferFlushing=function(f,v){var l=this,m=this.operationQueue,E=function(O){return{execute:l.removeExecutor.bind(l,O,v.startOffset,v.endOffset),onStart:function(){},onComplete:function(){l.hls.trigger(s.Events.BUFFER_FLUSHED,{type:O})},onError:function(P){o.logger.warn("[buffer-controller]: Failed to remove from "+O+" SourceBuffer",P)}}};v.type?m.append(E(v.type),v.type):this.getSourceBufferTypes().forEach(function(S){m.append(E(S),S)})},c.onFragParsed=function(f,v){var l=this,m=v.frag,E=v.part,S=[],O=E?E.elementaryStreams:m.elementaryStreams;O[d.ElementaryStreamTypes.AUDIOVIDEO]?S.push("audiovideo"):(O[d.ElementaryStreamTypes.AUDIO]&&S.push("audio"),O[d.ElementaryStreamTypes.VIDEO]&&S.push("video"));var D=function(){var A=self.performance.now();m.stats.buffering.end=A,E&&(E.stats.buffering.end=A);var w=E?E.stats:m.stats;l.hls.trigger(s.Events.FRAG_BUFFERED,{frag:m,part:E,stats:w,id:m.type})};S.length===0&&o.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+m.type+" level: "+m.level+" sn: "+m.sn),this.blockBuffers(D,S)},c.onFragChanged=function(f,v){this.flushBackBuffer()},c.onBufferEos=function(f,v){var l=this,m=this.getSourceBufferTypes().reduce(function(E,S){var O=l.sourceBuffer[S];return(!v.type||v.type===S)&&O&&!O.ended&&(O.ended=!0,o.logger.log("[buffer-controller]: "+S+" sourceBuffer now EOS")),E&&!!(!O||O.ended)},!0);m&&this.blockBuffers(function(){var E=l.mediaSource;!E||E.readyState!=="open"||E.endOfStream()})},c.onLevelUpdated=function(f,v){var l=v.details;!l.fragments.length||(this.details=l,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},c.flushBackBuffer=function(){var f=this.hls,v=this.details,l=this.media,m=this.sourceBuffer;if(!(!l||v===null)){var E=this.getSourceBufferTypes();if(!!E.length){var S=v.live&&f.config.liveBackBufferLength!==null?f.config.liveBackBufferLength:f.config.backBufferLength;if(!(!Object(a.isFiniteNumber)(S)||S<0)){var O=l.currentTime,D=v.levelTargetDuration,P=Math.max(S,D),A=Math.floor(O/D)*D-P;E.forEach(function(w){var L=m[w];if(L){var R=x.BufferHelper.getBuffered(L);R.length>0&&A>R.start(0)&&(f.trigger(s.Events.BACK_BUFFER_REACHED,{bufferEnd:A}),v.live&&f.trigger(s.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:A}),f.trigger(s.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:A,type:w}))}})}}}},c.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var f=this.details,v=this.hls,l=this.media,m=this.mediaSource,E=f.fragments[0].start+f.totalduration,S=l.duration,O=Object(a.isFiniteNumber)(m.duration)?m.duration:0;f.live&&v.config.liveDurationInfinity?(o.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),m.duration=1/0,this.updateSeekableRange(f)):(E>O&&E>S||!Object(a.isFiniteNumber)(S))&&(o.logger.log("[buffer-controller]: Updating Media Source duration to "+E.toFixed(3)),m.duration=E)}},c.updateSeekableRange=function(f){var v=this.mediaSource,l=f.fragments,m=l.length;if(m&&f.live&&v!==null&&v!==void 0&&v.setLiveSeekableRange){var E=Math.max(0,l[0].start),S=Math.max(E,E+f.totalduration);v.setLiveSeekableRange(E,S)}},c.checkPendingTracks=function(){var f=this.bufferCodecEventsExpected,v=this.operationQueue,l=this.pendingTracks,m=Object.keys(l).length;if(m&&!f||m===2){this.createSourceBuffers(l),this.pendingTracks={};var E=this.getSourceBufferTypes();if(E.length===0){this.hls.trigger(s.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}E.forEach(function(S){v.executeNext(S)})}},c.createSourceBuffers=function(f){var v=this.sourceBuffer,l=this.mediaSource;if(!l)throw Error("createSourceBuffers called when mediaSource was null");var m=0;for(var E in f)if(!v[E]){var S=f[E];if(!S)throw Error("source buffer exists for track "+E+", however track does not");var O=S.levelCodec||S.codec,D=S.container+";codecs="+O;o.logger.log("[buffer-controller]: creating sourceBuffer("+D+")");try{var P=v[E]=l.addSourceBuffer(D),A=E;this.addBufferListener(A,"updatestart",this._onSBUpdateStart),this.addBufferListener(A,"updateend",this._onSBUpdateEnd),this.addBufferListener(A,"error",this._onSBUpdateError),this.tracks[E]={buffer:P,codec:O,container:S.container,levelCodec:S.levelCodec,id:S.id},m++}catch(w){o.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+w.message),this.hls.trigger(s.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:w,mimeType:D})}}m&&this.hls.trigger(s.Events.BUFFER_CREATED,{tracks:this.tracks})},c._onSBUpdateStart=function(f){var v=this.operationQueue,l=v.current(f);l.onStart()},c._onSBUpdateEnd=function(f){var v=this.operationQueue,l=v.current(f);l.onComplete(),v.shiftAndExecuteNext(f)},c._onSBUpdateError=function(f,v){o.logger.error("[buffer-controller]: "+f+" SourceBuffer error",v),this.hls.trigger(s.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var l=this.operationQueue.current(f);l&&l.onError(v)},c.removeExecutor=function(f,v,l){var m=this.media,E=this.mediaSource,S=this.operationQueue,O=this.sourceBuffer,D=O[f];if(!m||!E||!D){o.logger.warn("[buffer-controller]: Attempting to remove from the "+f+" SourceBuffer, but it does not exist"),S.shiftAndExecuteNext(f);return}var P=Object(a.isFiniteNumber)(m.duration)?m.duration:1/0,A=Object(a.isFiniteNumber)(E.duration)?E.duration:1/0,w=Math.max(0,v),L=Math.min(l,P,A);L>w?(o.logger.log("[buffer-controller]: Removing ["+w+","+L+"] from the "+f+" SourceBuffer"),console.assert(!D.updating,f+" sourceBuffer must not be updating"),D.remove(w,L)):S.shiftAndExecuteNext(f)},c.appendExecutor=function(f,v){var l=this.operationQueue,m=this.sourceBuffer,E=m[v];if(!E){o.logger.warn("[buffer-controller]: Attempting to append to the "+v+" SourceBuffer, but it does not exist"),l.shiftAndExecuteNext(v);return}E.ended=!1,console.assert(!E.updating,v+" sourceBuffer must not be updating"),E.appendBuffer(f)},c.blockBuffers=function(f,v){var l=this;if(v===void 0&&(v=this.getSourceBufferTypes()),!v.length){o.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(f);return}var m=this.operationQueue,E=v.map(function(S){return m.appendBlocker(S)});Promise.all(E).then(function(){f(),v.forEach(function(S){var O=l.sourceBuffer[S];(!O||!O.updating)&&m.shiftAndExecuteNext(S)})})},c.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},c.addBufferListener=function(f,v,l){var m=this.sourceBuffer[f];if(!!m){var E=l.bind(this,f);this.listeners[f].push({event:v,listener:E}),m.addEventListener(v,E)}},c.removeBufferListeners=function(f){var v=this.sourceBuffer[f];!v||this.listeners[f].forEach(function(l){v.removeEventListener(l.event,l.listener)})},_}()},"./src/controller/buffer-operation-queue.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return s});var a=t("./src/utils/logger.ts"),s=function(){function o(x){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=x}var p=o.prototype;return p.append=function(g,d){var h=this.queues[d];h.push(g),h.length===1&&this.buffers[d]&&this.executeNext(d)},p.insertAbort=function(g,d){var h=this.queues[d];h.unshift(g),this.executeNext(d)},p.appendBlocker=function(g){var d,h=new Promise(function(b){d=b}),y={execute:d,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(y,g),h},p.executeNext=function(g){var d=this.buffers,h=this.queues,y=d[g],b=h[g];if(b.length){var T=b[0];try{T.execute()}catch(_){a.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),T.onError(_),(!y||!y.updating)&&(b.shift(),this.executeNext(g))}}},p.shiftAndExecuteNext=function(g){this.queues[g].shift(),this.executeNext(g)},p.current=function(g){return this.queues[g][0]},o}()},"./src/controller/cap-level-controller.ts":function(r,n,t){t.r(n);var a=t("./src/events.ts");function s(x,g){for(var d=0;d<g.length;d++){var h=g[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(x,h.key,h)}}function o(x,g,d){return g&&s(x.prototype,g),d&&s(x,d),x}var p=function(){function x(d){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=d,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var g=x.prototype;return g.setStreamController=function(h){this.streamController=h},g.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},g.registerListeners=function(){var h=this.hls;h.on(a.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),h.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.on(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),h.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},g.unregisterListener=function(){var h=this.hls;h.off(a.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),h.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.off(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),h.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},g.onFpsDropLevelCapping=function(h,y){x.isLevelAllowed(y.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(y.droppedLevel)},g.onMediaAttaching=function(h,y){this.media=y.media instanceof HTMLVideoElement?y.media:null},g.onManifestParsed=function(h,y){var b=this.hls;this.restrictedLevels=[],this.firstLevel=y.firstLevel,b.config.capLevelToPlayerSize&&y.video&&this.startCapping()},g.onBufferCodecs=function(h,y){var b=this.hls;b.config.capLevelToPlayerSize&&y.video&&this.startCapping()},g.onMediaDetaching=function(){this.stopCapping()},g.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var h=this.hls.levels;if(h.length){var y=this.hls;y.autoLevelCapping=this.getMaxLevel(h.length-1),y.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=y.autoLevelCapping}}},g.getMaxLevel=function(h){var y=this,b=this.hls.levels;if(!b.length)return-1;var T=b.filter(function(_,c){return x.isLevelAllowed(c,y.restrictedLevels)&&c<=h});return this.clientRect=null,x.getMaxLevelByMediaSize(T,this.mediaWidth,this.mediaHeight)},g.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},g.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},g.getDimensions=function(){if(this.clientRect)return this.clientRect;var h=this.media,y={width:0,height:0};if(h){var b=h.getBoundingClientRect();y.width=b.width,y.height=b.height,!y.width&&!y.height&&(y.width=b.right-b.left||h.width||0,y.height=b.bottom-b.top||h.height||0)}return this.clientRect=y,y},x.isLevelAllowed=function(h,y){return y===void 0&&(y=[]),y.indexOf(h)===-1},x.getMaxLevelByMediaSize=function(h,y,b){if(!h||!h.length)return-1;for(var T=function(v,l){return l?v.width!==l.width||v.height!==l.height:!0},_=h.length-1,c=0;c<h.length;c+=1){var u=h[c];if((u.width>=y||u.height>=b)&&T(u,h[c+1])){_=c;break}}return _},o(x,[{key:"mediaWidth",get:function(){return this.getDimensions().width*x.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*x.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var h=1;try{h=self.devicePixelRatio}catch(y){}return h}}]),x}();n.default=p},"./src/controller/cmcd-controller.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return T});var a=t("./src/events.ts"),s=t("./src/types/cmcd.ts"),o=t("./src/utils/buffer-helper.ts"),p=t("./src/utils/logger.ts");function x(_,c){for(var u=0;u<c.length;u++){var f=c[u];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(_,f.key,f)}}function g(_,c,u){return c&&x(_.prototype,c),u&&x(_,u),_}function d(_,c){var u=typeof Symbol!="undefined"&&_[Symbol.iterator]||_["@@iterator"];if(u)return(u=u.call(_)).next.bind(u);if(Array.isArray(_)||(u=h(_))||c&&_&&typeof _.length=="number"){u&&(_=u);var f=0;return function(){return f>=_.length?{done:!0}:{done:!1,value:_[f++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function h(_,c){if(!!_){if(typeof _=="string")return y(_,c);var u=Object.prototype.toString.call(_).slice(8,-1);if(u==="Object"&&_.constructor&&(u=_.constructor.name),u==="Map"||u==="Set")return Array.from(_);if(u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return y(_,c)}}function y(_,c){(c==null||c>_.length)&&(c=_.length);for(var u=0,f=new Array(c);u<c;u++)f[u]=_[u];return f}function b(){return b=Object.assign||function(_){for(var c=1;c<arguments.length;c++){var u=arguments[c];for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(_[f]=u[f])}return _},b.apply(this,arguments)}var T=function(){function _(u){var f=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){f.initialized&&(f.starved=!0),f.buffering=!0},this.onPlaying=function(){f.initialized||(f.initialized=!0),f.buffering=!1},this.applyPlaylistData=function(m){try{f.apply(m,{ot:s.CMCDObjectType.MANIFEST,su:!f.initialized})}catch(E){p.logger.warn("Could not generate manifest CMCD data.",E)}},this.applyFragmentData=function(m){try{var E=m.frag,S=f.hls.levels[E.level],O=f.getObjectType(E),D={d:E.duration*1e3,ot:O};(O===s.CMCDObjectType.VIDEO||O===s.CMCDObjectType.AUDIO||O==s.CMCDObjectType.MUXED)&&(D.br=S.bitrate/1e3,D.tb=f.getTopBandwidth(O)/1e3,D.bl=f.getBufferLength(O)),f.apply(m,D)}catch(P){p.logger.warn("Could not generate segment CMCD data.",P)}},this.hls=u;var v=this.config=u.config,l=v.cmcd;l!=null&&(v.pLoader=this.createPlaylistLoader(),v.fLoader=this.createFragmentLoader(),this.sid=l.sessionId||_.uuid(),this.cid=l.contentId,this.useHeaders=l.useHeaders===!0,this.registerListeners())}var c=_.prototype;return c.registerListeners=function(){var f=this.hls;f.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),f.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this)},c.unregisterListeners=function(){var f=this.hls;f.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),f.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},c.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},c.onMediaAttached=function(f,v){this.media=v.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},c.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},c.onBufferCreated=function(f,v){var l,m;this.audioBuffer=(l=v.tracks.audio)===null||l===void 0?void 0:l.buffer,this.videoBuffer=(m=v.tracks.video)===null||m===void 0?void 0:m.buffer},c.createData=function(){var f;return{v:s.CMCDVersion,sf:s.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(f=this.media)===null||f===void 0?void 0:f.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},c.apply=function(f,v){v===void 0&&(v={}),b(v,this.createData());var l=v.ot===s.CMCDObjectType.INIT||v.ot===s.CMCDObjectType.VIDEO||v.ot===s.CMCDObjectType.MUXED;if(this.starved&&l&&(v.bs=!0,v.su=!0,this.starved=!1),v.su==null&&(v.su=this.buffering),this.useHeaders){var m=_.toHeaders(v);if(!Object.keys(m).length)return;f.headers||(f.headers={}),b(f.headers,m)}else{var E=_.toQuery(v);if(!E)return;f.url=_.appendQueryToUri(f.url,E)}},c.getObjectType=function(f){var v=f.type;if(v==="subtitle")return s.CMCDObjectType.TIMED_TEXT;if(f.sn==="initSegment")return s.CMCDObjectType.INIT;if(v==="audio")return s.CMCDObjectType.AUDIO;if(v==="main")return this.hls.audioTracks.length?s.CMCDObjectType.VIDEO:s.CMCDObjectType.MUXED},c.getTopBandwidth=function(f){var v=0,l,m=this.hls;if(f===s.CMCDObjectType.AUDIO)l=m.audioTracks;else{var E=m.maxAutoLevel,S=E>-1?E+1:m.levels.length;l=m.levels.slice(0,S)}for(var O=d(l),D;!(D=O()).done;){var P=D.value;P.bitrate>v&&(v=P.bitrate)}return v>0?v:NaN},c.getBufferLength=function(f){var v=this.hls.media,l=f===s.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!l||!v)return NaN;var m=o.BufferHelper.bufferInfo(l,v.currentTime,this.config.maxBufferHole);return m.len*1e3},c.createPlaylistLoader=function(){var f=this.config.pLoader,v=this.applyPlaylistData,l=f||this.config.loader;return function(){function m(S){this.loader=void 0,this.loader=new l(S)}var E=m.prototype;return E.destroy=function(){this.loader.destroy()},E.abort=function(){this.loader.abort()},E.load=function(O,D,P){v(O),this.loader.load(O,D,P)},g(m,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),m}()},c.createFragmentLoader=function(){var f=this.config.fLoader,v=this.applyFragmentData,l=f||this.config.loader;return function(){function m(S){this.loader=void 0,this.loader=new l(S)}var E=m.prototype;return E.destroy=function(){this.loader.destroy()},E.abort=function(){this.loader.abort()},E.load=function(O,D,P){v(O),this.loader.load(O,D,P)},g(m,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),m}()},_.uuid=function(){var f=URL.createObjectURL(new Blob),v=f.toString();return URL.revokeObjectURL(f),v.substr(v.lastIndexOf("/")+1)},_.serialize=function(f){for(var v=[],l=function(U){return!Number.isNaN(U)&&U!=null&&U!==""&&U!==!1},m=function(U){return Math.round(U)},E=function(U){return m(U/100)*100},S=function(U){return encodeURIComponent(U)},O={br:m,d:m,bl:E,dl:E,mtp:E,nor:S,rtp:E,tb:m},D=Object.keys(f||{}).sort(),P=d(D),A;!(A=P()).done;){var w=A.value,L=f[w];if(!!l(L)&&!(w==="v"&&L===1)&&!(w=="pr"&&L===1)){var R=O[w];R&&(L=R(L));var C=typeof L,M=void 0;w==="ot"||w==="sf"||w==="st"?M=w+"="+L:C==="boolean"?M=w:C==="number"?M=w+"="+L:M=w+"="+JSON.stringify(L),v.push(M)}}return v.join(",")},_.toHeaders=function(f){for(var v=Object.keys(f),l={},m=["Object","Request","Session","Status"],E=[{},{},{},{}],S={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},O=0,D=v;O<D.length;O++){var P=D[O],A=S[P]!=null?S[P]:1;E[A][P]=f[P]}for(var w=0;w<E.length;w++){var L=_.serialize(E[w]);L&&(l["CMCD-"+m[w]]=L)}return l},_.toQuery=function(f){return"CMCD="+encodeURIComponent(_.serialize(f))},_.appendQueryToUri=function(f,v){if(!v)return f;var l=f.includes("?")?"&":"?";return""+f+l+v},_}()},"./src/controller/eme-controller.ts":function(r,n,t){t.r(n);var a=t("./src/events.ts"),s=t("./src/errors.ts"),o=t("./src/utils/logger.ts"),p=t("./src/utils/mediakeys-helper.ts");function x(T,_){for(var c=0;c<_.length;c++){var u=_[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(T,u.key,u)}}function g(T,_,c){return _&&x(T.prototype,_),c&&x(T,c),T}var d=3,h=function(_,c,u){var f={audioCapabilities:[],videoCapabilities:[]};return _.forEach(function(v){f.audioCapabilities.push({contentType:'audio/mp4; codecs="'+v+'"',robustness:u.audioRobustness||""})}),c.forEach(function(v){f.videoCapabilities.push({contentType:'video/mp4; codecs="'+v+'"',robustness:u.videoRobustness||""})}),[f]},y=function(_,c,u,f){switch(_){case p.KeySystems.WIDEVINE:return h(c,u,f);default:throw new Error("Unknown key-system: "+_)}},b=function(){function T(c){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=c,this._config=c.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var _=T.prototype;return _.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},_._registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this)},_._unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this)},_.getLicenseServerUrl=function(u){switch(u){case p.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+u+'"')},_._attemptKeySystemAccess=function(u,f,v){var l=this,m=y(u,f,v,this._drmSystemOptions);o.logger.log("Requesting encrypted media key-system access");var E=this.requestMediaKeySystemAccess(u,m);this.mediaKeysPromise=E.then(function(S){return l._onMediaKeySystemAccessObtained(u,S)}),E.catch(function(S){o.logger.error('Failed to obtain key-system "'+u+'" access:',S)})},_._onMediaKeySystemAccessObtained=function(u,f){var v=this;o.logger.log('Access for key-system "'+u+'" obtained');var l={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:f,mediaKeySystemDomain:u};this._mediaKeysList.push(l);var m=Promise.resolve().then(function(){return f.createMediaKeys()}).then(function(E){return l.mediaKeys=E,o.logger.log('Media-keys created for key-system "'+u+'"'),v._onMediaKeysCreated(),E});return m.catch(function(E){o.logger.error("Failed to create media-keys:",E)}),m},_._onMediaKeysCreated=function(){var u=this;this._mediaKeysList.forEach(function(f){f.mediaKeysSession||(f.mediaKeysSession=f.mediaKeys.createSession(),u._onNewMediaKeySession(f.mediaKeysSession))})},_._onNewMediaKeySession=function(u){var f=this;o.logger.log("New key-system session "+u.sessionId),u.addEventListener("message",function(v){f._onKeySessionMessage(u,v.message)},!1)},_._onKeySessionMessage=function(u,f){o.logger.log("Got EME message event, creating license request"),this._requestLicense(f,function(v){o.logger.log("Received license data (length: "+(v&&v.byteLength)+"), updating key-session"),u.update(v)})},_.onMediaEncrypted=function(u){var f=this;if(o.logger.log('Media is encrypted using "'+u.initDataType+'" init data type'),!this.mediaKeysPromise){o.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var v=function(m){!f._media||(f._attemptSetMediaKeys(m),f._generateRequestWithPreferredKeySession(u.initDataType,u.initData))};this.mediaKeysPromise.then(v).catch(v)},_._attemptSetMediaKeys=function(u){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var f=this._mediaKeysList[0];if(!f||!f.mediaKeys){o.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}o.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(f.mediaKeys),this._hasSetMediaKeys=!0}},_._generateRequestWithPreferredKeySession=function(u,f){var v=this,l=this._mediaKeysList[0];if(!l){o.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(l.mediaKeysSessionInitialized){o.logger.warn("Key-Session already initialized but requested again");return}var m=l.mediaKeysSession;if(!m){o.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!f){o.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}o.logger.log('Generating key-session request for "'+u+'" init data type'),l.mediaKeysSessionInitialized=!0,m.generateRequest(u,f).then(function(){o.logger.debug("Key-session generation succeeded")}).catch(function(E){o.logger.error("Error generating key-session request:",E),v.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},_._createLicenseXhr=function(u,f,v){var l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,l,u,f,v);var m=this._licenseXhrSetup;if(m)try{m.call(this.hls,l,u),m=void 0}catch(E){o.logger.error(E)}try{l.readyState||l.open("POST",u,!0),m&&m.call(this.hls,l,u)}catch(E){throw new Error("issue setting up KeySystem license XHR "+E)}return l},_._onLicenseRequestReadyStageChange=function(u,f,v,l){switch(u.readyState){case 4:if(u.status===200){this._requestLicenseFailureCount=0,o.logger.log("License request succeeded");var m=u.response,E=this._licenseResponseCallback;if(E)try{m=E.call(this.hls,u,f)}catch(O){o.logger.error(O)}l(m)}else{if(o.logger.error("License Request XHR failed ("+f+"). Status: "+u.status+" ("+u.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d){this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var S=d-this._requestLicenseFailureCount+1;o.logger.warn("Retrying license request, "+S+" attempts left"),this._requestLicense(v,l)}break}},_._generateLicenseRequestChallenge=function(u,f){switch(u.mediaKeySystemDomain){case p.KeySystems.WIDEVINE:return f}throw new Error("unsupported key-system: "+u.mediaKeySystemDomain)},_._requestLicense=function(u,f){o.logger.log("Requesting content license for key-system");var v=this._mediaKeysList[0];if(!v){o.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var l=this.getLicenseServerUrl(v.mediaKeySystemDomain),m=this._createLicenseXhr(l,u,f);o.logger.log("Sending license request to URL: "+l);var E=this._generateLicenseRequestChallenge(v,u);m.send(E)}catch(S){o.logger.error("Failure requesting DRM license: "+S),this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},_.onMediaAttached=function(u,f){if(!!this._emeEnabled){var v=f.media;this._media=v,v.addEventListener("encrypted",this._onMediaEncrypted)}},_.onMediaDetached=function(){var u=this._media,f=this._mediaKeysList;!u||(u.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(f.map(function(v){if(v.mediaKeysSession)return v.mediaKeysSession.close().catch(function(){})})).then(function(){return u.setMediaKeys(null)}).catch(function(){}))},_.onManifestParsed=function(u,f){if(!!this._emeEnabled){var v=f.levels.map(function(m){return m.audioCodec}).filter(function(m){return!!m}),l=f.levels.map(function(m){return m.videoCodec}).filter(function(m){return!!m});this._attemptKeySystemAccess(p.KeySystems.WIDEVINE,v,l)}},g(T,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),T}();n.default=b},"./src/controller/fps-controller.ts":function(r,n,t){t.r(n);var a=t("./src/events.ts"),s=t("./src/utils/logger.ts"),o=function(){function p(g){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=g,this.registerListeners()}var x=p.prototype;return x.setStreamController=function(d){this.streamController=d},x.registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},x.unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching)},x.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},x.onMediaAttaching=function(d,h){var y=this.hls.config;if(y.capLevelOnFPSDrop){var b=h.media instanceof self.HTMLVideoElement?h.media:null;this.media=b,b&&typeof b.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),y.fpsDroppedMonitoringPeriod)}},x.checkFPS=function(d,h,y){var b=performance.now();if(h){if(this.lastTime){var T=b-this.lastTime,_=y-this.lastDroppedFrames,c=h-this.lastDecodedFrames,u=1e3*_/T,f=this.hls;if(f.trigger(a.Events.FPS_DROP,{currentDropped:_,currentDecoded:c,totalDroppedFrames:y}),u>0&&_>f.config.fpsDroppedMonitoringThreshold*c){var v=f.currentLevel;s.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+v),v>0&&(f.autoLevelCapping===-1||f.autoLevelCapping>=v)&&(v=v-1,f.trigger(a.Events.FPS_DROP_LEVEL_CAPPING,{level:v,droppedLevel:f.currentLevel}),f.autoLevelCapping=v,this.streamController.nextLevelSwitch())}}this.lastTime=b,this.lastDroppedFrames=y,this.lastDecodedFrames=h}},x.checkFPSInterval=function(){var d=this.media;if(d)if(this.isVideoPlaybackQualityAvailable){var h=d.getVideoPlaybackQuality();this.checkFPS(d,h.totalVideoFrames,h.droppedVideoFrames)}else this.checkFPS(d,d.webkitDecodedFrameCount,d.webkitDroppedFrameCount)},p}();n.default=o},"./src/controller/fragment-finders.ts":function(r,n,t){t.r(n),t.d(n,"findFragmentByPDT",function(){return o}),t.d(n,"findFragmentByPTS",function(){return p}),t.d(n,"fragmentWithinToleranceTest",function(){return x}),t.d(n,"pdtWithinToleranceTest",function(){return g}),t.d(n,"findFragWithCC",function(){return d});var a=t("./src/polyfills/number.ts"),s=t("./src/utils/binary-search.ts");function o(h,y,b){if(y===null||!Array.isArray(h)||!h.length||!Object(a.isFiniteNumber)(y))return null;var T=h[0].programDateTime;if(y<(T||0))return null;var _=h[h.length-1].endProgramDateTime;if(y>=(_||0))return null;b=b||0;for(var c=0;c<h.length;++c){var u=h[c];if(g(y,b,u))return u}return null}function p(h,y,b,T){b===void 0&&(b=0),T===void 0&&(T=0);var _=null;if(h?_=y[h.sn-y[0].sn+1]||null:b===0&&y[0].start===0&&(_=y[0]),_&&x(b,T,_)===0)return _;var c=s.default.search(y,x.bind(null,b,T));return c||_}function x(h,y,b){h===void 0&&(h=0),y===void 0&&(y=0);var T=Math.min(y,b.duration+(b.deltaPTS?b.deltaPTS:0));return b.start+b.duration-T<=h?1:b.start-T>h&&b.start?-1:0}function g(h,y,b){var T=Math.min(y,b.duration+(b.deltaPTS?b.deltaPTS:0))*1e3,_=b.endProgramDateTime||0;return _-T>h}function d(h,y){return s.default.search(h,function(b){return b.cc<y?1:b.cc>y?-1:0})}},"./src/controller/fragment-tracker.ts":function(r,n,t){t.r(n),t.d(n,"FragmentState",function(){return o}),t.d(n,"FragmentTracker",function(){return p});var a=t("./src/events.ts"),s=t("./src/types/loader.ts"),o;(function(d){d.NOT_LOADED="NOT_LOADED",d.BACKTRACKED="BACKTRACKED",d.APPENDING="APPENDING",d.PARTIAL="PARTIAL",d.OK="OK"})(o||(o={}));var p=function(){function d(y){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=y,this._registerListeners()}var h=d.prototype;return h._registerListeners=function(){var b=this.hls;b.on(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),b.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),b.on(a.Events.FRAG_LOADED,this.onFragLoaded,this)},h._unregisterListeners=function(){var b=this.hls;b.off(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),b.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),b.off(a.Events.FRAG_LOADED,this.onFragLoaded,this)},h.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},h.getAppendedFrag=function(b,T){if(T===s.PlaylistLevelType.MAIN){var _=this.activeFragment,c=this.activeParts;if(!_)return null;if(c)for(var u=c.length;u--;){var f=c[u],v=f?f.end:_.appendedPTS;if(f.start<=b&&v!==void 0&&b<=v)return u>9&&(this.activeParts=c.slice(u-9)),f}else if(_.start<=b&&_.appendedPTS!==void 0&&b<=_.appendedPTS)return _}return this.getBufferedFrag(b,T)},h.getBufferedFrag=function(b,T){for(var _=this.fragments,c=Object.keys(_),u=c.length;u--;){var f=_[c[u]];if((f==null?void 0:f.body.type)===T&&f.buffered){var v=f.body;if(v.start<=b&&b<=v.end)return v}}return null},h.detectEvictedFragments=function(b,T,_){var c=this;Object.keys(this.fragments).forEach(function(u){var f=c.fragments[u];if(!!f){if(!f.buffered){f.body.type===_&&c.removeFragment(f.body);return}var v=f.range[b];!v||v.time.some(function(l){var m=!c.isTimeBuffered(l.startPTS,l.endPTS,T);return m&&c.removeFragment(f.body),m})}})},h.detectPartialFragments=function(b){var T=this,_=this.timeRanges,c=b.frag,u=b.part;if(!(!_||c.sn==="initSegment")){var f=g(c),v=this.fragments[f];!v||(Object.keys(_).forEach(function(l){var m=c.elementaryStreams[l];if(!!m){var E=_[l],S=u!==null||m.partial===!0;v.range[l]=T.getBufferedTimes(c,u,S,E)}}),v.backtrack=v.loaded=null,Object.keys(v.range).length?v.buffered=!0:this.removeFragment(v.body))}},h.fragBuffered=function(b){var T=g(b),_=this.fragments[T];_&&(_.backtrack=_.loaded=null,_.buffered=!0)},h.getBufferedTimes=function(b,T,_,c){for(var u={time:[],partial:_},f=T?T.start:b.start,v=T?T.end:b.end,l=b.minEndPTS||v,m=b.maxStartPTS||f,E=0;E<c.length;E++){var S=c.start(E)-this.bufferPadding,O=c.end(E)+this.bufferPadding;if(m>=S&&l<=O){u.time.push({startPTS:Math.max(f,c.start(E)),endPTS:Math.min(v,c.end(E))});break}else if(f<O&&v>S)u.partial=!0,u.time.push({startPTS:Math.max(f,c.start(E)),endPTS:Math.min(v,c.end(E))});else if(v<=S)break}return u},h.getPartialFragment=function(b){var T=null,_,c,u,f=0,v=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach(function(m){var E=l[m];!E||x(E)&&(c=E.body.start-v,u=E.body.end+v,b>=c&&b<=u&&(_=Math.min(b-c,u-b),f<=_&&(T=E.body,f=_)))}),T},h.getState=function(b){var T=g(b),_=this.fragments[T];return _?_.buffered?x(_)?o.PARTIAL:o.OK:_.backtrack?o.BACKTRACKED:o.APPENDING:o.NOT_LOADED},h.backtrack=function(b,T){var _=g(b),c=this.fragments[_];if(!c||c.backtrack)return null;var u=c.backtrack=T||c.loaded;return c.loaded=null,u},h.getBacktrackData=function(b){var T=g(b),_=this.fragments[T];if(_){var c,u=_.backtrack;if(u!=null&&(c=u.payload)!==null&&c!==void 0&&c.byteLength)return u;this.removeFragment(b)}return null},h.isTimeBuffered=function(b,T,_){for(var c,u,f=0;f<_.length;f++){if(c=_.start(f)-this.bufferPadding,u=_.end(f)+this.bufferPadding,b>=c&&T<=u)return!0;if(T<=c)return!1}return!1},h.onFragLoaded=function(b,T){var _=T.frag,c=T.part;if(!(_.sn==="initSegment"||_.bitrateTest||c)){var u=g(_);this.fragments[u]={body:_,loaded:T,backtrack:null,buffered:!1,range:Object.create(null)}}},h.onBufferAppended=function(b,T){var _=this,c=T.frag,u=T.part,f=T.timeRanges;if(c.type===s.PlaylistLevelType.MAIN)if(this.activeFragment=c,u){var v=this.activeParts;v||(this.activeParts=v=[]),v.push(u)}else this.activeParts=null;this.timeRanges=f,Object.keys(f).forEach(function(l){var m=f[l];if(_.detectEvictedFragments(l,m),!u)for(var E=0;E<m.length;E++)c.appendedPTS=Math.max(m.end(E),c.appendedPTS||0)})},h.onFragBuffered=function(b,T){this.detectPartialFragments(T)},h.hasFragment=function(b){var T=g(b);return!!this.fragments[T]},h.removeFragmentsInRange=function(b,T,_){var c=this;Object.keys(this.fragments).forEach(function(u){var f=c.fragments[u];if(!!f&&f.buffered){var v=f.body;v.type===_&&v.start<T&&v.end>b&&c.removeFragment(v)}})},h.removeFragment=function(b){var T=g(b);b.stats.loaded=0,b.clearElementaryStreamInfo(),delete this.fragments[T]},h.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},d}();function x(d){var h,y;return d.buffered&&(((h=d.range.video)===null||h===void 0?void 0:h.partial)||((y=d.range.audio)===null||y===void 0?void 0:y.partial))}function g(d){return d.type+"_"+d.level+"_"+d.urlId+"_"+d.sn}},"./src/controller/gap-controller.ts":function(r,n,t){t.r(n),t.d(n,"STALL_MINIMUM_DURATION_MS",function(){return x}),t.d(n,"MAX_START_GAP_JUMP",function(){return g}),t.d(n,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return d}),t.d(n,"SKIP_BUFFER_RANGE_START",function(){return h}),t.d(n,"default",function(){return y});var a=t("./src/utils/buffer-helper.ts"),s=t("./src/errors.ts"),o=t("./src/events.ts"),p=t("./src/utils/logger.ts"),x=250,g=2,d=.1,h=.05,y=function(){function b(_,c,u,f){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=_,this.media=c,this.fragmentTracker=u,this.hls=f}var T=b.prototype;return T.destroy=function(){this.hls=this.fragmentTracker=this.media=null},T.poll=function(c){var u=this.config,f=this.media,v=this.stalled,l=f.currentTime,m=f.seeking,E=this.seeking&&!m,S=!this.seeking&&m;if(this.seeking=m,l!==c){if(this.moved=!0,v!==null){if(this.stallReported){var O=self.performance.now()-v;p.logger.warn("playback not stuck anymore @"+l+", after "+Math.round(O)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((S||E)&&(this.stalled=null),!(f.paused||f.ended||f.playbackRate===0||!a.BufferHelper.getBuffered(f).length)){var D=a.BufferHelper.bufferInfo(f,l,0),P=D.len>0,A=D.nextStart||0;if(!(!P&&!A)){if(m){var w=D.len>g,L=!A||A-l>g&&!this.fragmentTracker.getPartialFragment(l);if(w||L)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var R,C=Math.max(A,D.start||0)-l,M=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,N=M==null||(R=M.details)===null||R===void 0?void 0:R.live,U=N?M.details.targetduration*2:g;if(C>0&&C<=U){this._trySkipBufferHole(null);return}}var K=self.performance.now();if(v===null){this.stalled=K;return}var V=K-v;!m&&V>=x&&this._reportStall(D.len);var W=a.BufferHelper.bufferInfo(f,l,u.maxBufferHole);this._tryFixBufferStall(W,V)}}},T._tryFixBufferStall=function(c,u){var f=this.config,v=this.fragmentTracker,l=this.media,m=l.currentTime,E=v.getPartialFragment(m);if(E){var S=this._trySkipBufferHole(E);if(S)return}c.len>f.maxBufferHole&&u>f.highBufferWatchdogPeriod*1e3&&(p.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},T._reportStall=function(c){var u=this.hls,f=this.media,v=this.stallReported;v||(this.stallReported=!0,p.logger.warn("Playback stalling at @"+f.currentTime+" due to low buffer (buffer="+c+")"),u.trigger(o.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:c}))},T._trySkipBufferHole=function(c){for(var u=this.config,f=this.hls,v=this.media,l=v.currentTime,m=0,E=a.BufferHelper.getBuffered(v),S=0;S<E.length;S++){var O=E.start(S);if(l+u.maxBufferHole>=m&&l<O){var D=Math.max(O+h,v.currentTime+d);return p.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+D),this.moved=!0,this.stalled=null,v.currentTime=D,c&&f.trigger(o.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+D,frag:c}),D}m=E.end(S)}return 0},T._tryNudgeBuffer=function(){var c=this.config,u=this.hls,f=this.media,v=f.currentTime,l=(this.nudgeRetry||0)+1;if(this.nudgeRetry=l,l<c.nudgeMaxRetry){var m=v+l*c.nudgeOffset;p.logger.warn("Nudging 'currentTime' from "+v+" to "+m),f.currentTime=m,u.trigger(o.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else p.logger.error("Playhead still not moving while enough data buffered @"+v+" after "+c.nudgeMaxRetry+" nudges"),u.trigger(o.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},b}()},"./src/controller/id3-track-controller.ts":function(r,n,t){t.r(n);var a=t("./src/events.ts"),s=t("./src/utils/texttrack-utils.ts"),o=t("./src/demux/id3.ts"),p=.25,x=function(){function g(h){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=h,this._registerListeners()}var d=g.prototype;return d.destroy=function(){this._unregisterListeners()},d._registerListeners=function(){var y=this.hls;y.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),y.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.on(a.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),y.on(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},d._unregisterListeners=function(){var y=this.hls;y.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),y.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.off(a.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),y.off(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},d.onMediaAttached=function(y,b){this.media=b.media},d.onMediaDetaching=function(){!this.id3Track||(Object(s.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},d.getID3Track=function(y){if(!!this.media){for(var b=0;b<y.length;b++){var T=y[b];if(T.kind==="metadata"&&T.label==="id3")return Object(s.sendAddTrackEvent)(T,this.media),T}return this.media.addTextTrack("metadata","id3")}},d.onFragParsingMetadata=function(y,b){if(!!this.media){var T=b.frag,_=b.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var c=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,u=0;u<_.length;u++){var f=o.getID3Frames(_[u].data);if(f){var v=_[u].pts,l=u<_.length-1?_[u+1].pts:T.end,m=l-v;m<=0&&(l=v+p);for(var E=0;E<f.length;E++){var S=f[E];if(!o.isTimeStampFrame(S)){var O=new c(v,l,"");O.value=S,this.id3Track.addCue(O)}}}}}},d.onBufferFlushing=function(y,b){var T=b.startOffset,_=b.endOffset,c=b.type;if(!c||c==="audio"){var u=this.id3Track;u&&Object(s.removeCuesInRange)(u,T,_)}},g}();n.default=x},"./src/controller/latency-controller.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return g});var a=t("./src/errors.ts"),s=t("./src/events.ts"),o=t("./src/utils/logger.ts");function p(d,h){for(var y=0;y<h.length;y++){var b=h[y];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(d,b.key,b)}}function x(d,h,y){return h&&p(d.prototype,h),y&&p(d,y),d}var g=function(){function d(y){var b=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return b.timeupdate()},this.hls=y,this.config=y.config,this.registerListeners()}var h=d.prototype;return h.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},h.registerListeners=function(){this.hls.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(s.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(s.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){this.hls.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(s.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(s.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(s.Events.ERROR,this.onError)},h.onMediaAttached=function(b,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},h.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},h.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},h.onLevelUpdated=function(b,T){var _=T.details;this.levelDetails=_,_.advanced&&this.timeupdate(),!_.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},h.onError=function(b,T){T.details===a.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,o.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},h.timeupdate=function(){var b=this.media,T=this.levelDetails;if(!(!b||!T)){this.currentTime=b.currentTime;var _=this.computeLatency();if(_!==null){this._latency=_;var c=this.config,u=c.lowLatencyMode,f=c.maxLiveSyncPlaybackRate;if(!(!u||f===1)){var v=this.targetLatency;if(v!==null){var l=_-v,m=Math.min(this.maxLatency,v+T.targetduration),E=l<m;if(T.live&&E&&l>.05&&this.forwardBufferLength>1){var S=Math.min(2,Math.max(1,f)),O=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20;b.playbackRate=Math.min(S,Math.max(1,O))}else b.playbackRate!==1&&b.playbackRate!==0&&(b.playbackRate=1)}}}}},h.estimateLiveEdge=function(){var b=this.levelDetails;return b===null?null:b.edge+b.age},h.computeLatency=function(){var b=this.estimateLiveEdge();return b===null?null:b-this.currentTime},x(d,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var b=this.config,T=this.levelDetails;return b.liveMaxLatencyDuration!==void 0?b.liveMaxLatencyDuration:T?b.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var b=this.levelDetails;if(b===null)return null;var T=b.holdBack,_=b.partHoldBack,c=b.targetduration,u=this.config,f=u.liveSyncDuration,v=u.liveSyncDurationCount,l=u.lowLatencyMode,m=this.hls.userConfig,E=l&&_||T;(m.liveSyncDuration||m.liveSyncDurationCount||E===0)&&(E=f!==void 0?f:v*c);var S=c,O=1;return E+Math.min(this.stallCount*O,S)}},{key:"liveSyncPosition",get:function(){var b=this.estimateLiveEdge(),T=this.targetLatency,_=this.levelDetails;if(b===null||T===null||_===null)return null;var c=_.edge,u=b-T-this.edgeStalled,f=c-_.totalduration,v=c-(this.config.lowLatencyMode&&_.partTarget||_.targetduration);return Math.min(Math.max(f,u),v)}},{key:"drift",get:function(){var b=this.levelDetails;return b===null?1:b.drift}},{key:"edgeStalled",get:function(){var b=this.levelDetails;if(b===null)return 0;var T=(this.config.lowLatencyMode&&b.partTarget||b.targetduration)*3;return Math.max(b.age-T,0)}},{key:"forwardBufferLength",get:function(){var b=this.media,T=this.levelDetails;if(!b||!T)return 0;var _=b.buffered.length;return _?b.buffered.end(_-1):T.edge-this.currentTime}}]),d}()},"./src/controller/level-controller.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return u});var a=t("./src/types/level.ts"),s=t("./src/events.ts"),o=t("./src/errors.ts"),p=t("./src/utils/codecs.ts"),x=t("./src/controller/level-helper.ts"),g=t("./src/controller/base-playlist-controller.ts"),d=t("./src/types/loader.ts");function h(){return h=Object.assign||function(f){for(var v=1;v<arguments.length;v++){var l=arguments[v];for(var m in l)Object.prototype.hasOwnProperty.call(l,m)&&(f[m]=l[m])}return f},h.apply(this,arguments)}function y(f,v){for(var l=0;l<v.length;l++){var m=v[l];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(f,m.key,m)}}function b(f,v,l){return v&&y(f.prototype,v),l&&y(f,l),f}function T(f,v){f.prototype=Object.create(v.prototype),f.prototype.constructor=f,_(f,v)}function _(f,v){return _=Object.setPrototypeOf||function(m,E){return m.__proto__=E,m},_(f,v)}var c=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),u=function(f){T(v,f);function v(m){var E;return E=f.call(this,m,"[level-controller]")||this,E._levels=[],E._firstLevel=-1,E._startLevel=void 0,E.currentLevelIndex=-1,E.manualLevelIndex=-1,E.onParsedComplete=void 0,E._registerListeners(),E}var l=v.prototype;return l._registerListeners=function(){var E=this.hls;E.on(s.Events.MANIFEST_LOADED,this.onManifestLoaded,this),E.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.on(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),E.on(s.Events.FRAG_LOADED,this.onFragLoaded,this),E.on(s.Events.ERROR,this.onError,this)},l._unregisterListeners=function(){var E=this.hls;E.off(s.Events.MANIFEST_LOADED,this.onManifestLoaded,this),E.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.off(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),E.off(s.Events.FRAG_LOADED,this.onFragLoaded,this),E.off(s.Events.ERROR,this.onError,this)},l.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,f.prototype.destroy.call(this)},l.startLoad=function(){var E=this._levels;E.forEach(function(S){S.loadError=0}),f.prototype.startLoad.call(this)},l.onManifestLoaded=function(E,S){var O=[],D=[],P=[],A,w={},L,R=!1,C=!1,M=!1;if(S.levels.forEach(function(V){var W=V.attrs;R=R||!!(V.width&&V.height),C=C||!!V.videoCodec,M=M||!!V.audioCodec,c&&V.audioCodec&&V.audioCodec.indexOf("mp4a.40.34")!==-1&&(V.audioCodec=void 0);var G=V.bitrate+"-"+V.attrs.RESOLUTION+"-"+V.attrs.CODECS;L=w[G],L?L.url.push(V.url):(L=new a.Level(V),w[G]=L,O.push(L)),W&&(W.AUDIO&&Object(x.addGroupId)(L,"audio",W.AUDIO),W.SUBTITLES&&Object(x.addGroupId)(L,"text",W.SUBTITLES))}),(R||C)&&M&&(O=O.filter(function(V){var W=V.videoCodec,G=V.width,Y=V.height;return!!W||!!(G&&Y)})),O=O.filter(function(V){var W=V.audioCodec,G=V.videoCodec;return(!W||Object(p.isCodecSupportedInMp4)(W,"audio"))&&(!G||Object(p.isCodecSupportedInMp4)(G,"video"))}),S.audioTracks&&(D=S.audioTracks.filter(function(V){return!V.audioCodec||Object(p.isCodecSupportedInMp4)(V.audioCodec,"audio")}),Object(x.assignTrackIdsByGroup)(D)),S.subtitles&&(P=S.subtitles,Object(x.assignTrackIdsByGroup)(P)),O.length>0){A=O[0].bitrate,O.sort(function(V,W){return V.bitrate-W.bitrate}),this._levels=O;for(var N=0;N<O.length;N++)if(O[N].bitrate===A){this._firstLevel=N,this.log("manifest loaded, "+O.length+" level(s) found, first bitrate: "+A);break}var U=M&&!C,K={levels:O,audioTracks:D,subtitleTracks:P,firstLevel:this._firstLevel,stats:S.stats,audio:M,video:C,altAudio:!U&&D.some(function(V){return!!V.url})};this.hls.trigger(s.Events.MANIFEST_PARSED,K),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(s.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:S.url,reason:"no level with compatible codecs found in manifest"})},l.onError=function(E,S){if(f.prototype.onError.call(this,E,S),!S.fatal){var O=S.context,D=this._levels[this.currentLevelIndex];if(O&&(O.type===d.PlaylistContextType.AUDIO_TRACK&&D.audioGroupIds&&O.groupId===D.audioGroupIds[D.urlId]||O.type===d.PlaylistContextType.SUBTITLE_TRACK&&D.textGroupIds&&O.groupId===D.textGroupIds[D.urlId])){this.redundantFailover(this.currentLevelIndex);return}var P=!1,A=!0,w;switch(S.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:if(S.frag){var L=this._levels[S.frag.level];L?(L.fragmentError++,L.fragmentError>this.hls.config.fragLoadingMaxRetry&&(w=S.frag.level)):w=S.frag.level}break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:O&&(O.deliveryDirectives&&(A=!1),w=O.level),P=!0;break;case o.ErrorDetails.REMUX_ALLOC_ERROR:w=S.level,P=!0;break}w!==void 0&&this.recoverLevel(S,w,P,A)}},l.recoverLevel=function(E,S,O,D){var P=E.details,A=this._levels[S];if(A.loadError++,O){var w=this.retryLoadingOrFail(E);if(w)E.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(D){var L=A.url.length;if(L>1&&A.loadError<L)E.levelRetry=!0,this.redundantFailover(S);else if(this.manualLevelIndex===-1){var R=S===0?this._levels.length-1:S-1;this.currentLevelIndex!==R&&this._levels[R].loadError===0&&(this.warn(P+": switch to "+R),E.levelRetry=!0,this.hls.nextAutoLevel=R)}}},l.redundantFailover=function(E){var S=this._levels[E],O=S.url.length;if(O>1){var D=(S.urlId+1)%O;this.warn("Switching to redundant URL-id "+D),this._levels.forEach(function(P){P.urlId=D}),this.level=E}},l.onFragLoaded=function(E,S){var O=S.frag;if(O!==void 0&&O.type===d.PlaylistLevelType.MAIN){var D=this._levels[O.level];D!==void 0&&(D.fragmentError=0,D.loadError=0)}},l.onLevelLoaded=function(E,S){var O,D=S.level,P=S.details,A=this._levels[D];if(!A){var w;this.warn("Invalid level index "+D),(w=S.deliveryDirectives)!==null&&w!==void 0&&w.skip&&(P.deltaUpdateFailed=!0);return}D===this.currentLevelIndex?(A.fragmentError===0&&(A.loadError=0,this.retryCount=0),this.playlistLoaded(D,S,A.details)):(O=S.deliveryDirectives)!==null&&O!==void 0&&O.skip&&(P.deltaUpdateFailed=!0)},l.onAudioTrackSwitched=function(E,S){var O=this.hls.levels[this.currentLevelIndex];if(!!O&&O.audioGroupIds){for(var D=-1,P=this.hls.audioTracks[S.id].groupId,A=0;A<O.audioGroupIds.length;A++)if(O.audioGroupIds[A]===P){D=A;break}D!==O.urlId&&(O.urlId=D,this.startLoad())}},l.loadPlaylist=function(E){var S=this.currentLevelIndex,O=this._levels[S];if(this.canLoad&&O&&O.url.length>0){var D=O.urlId,P=O.url[D];if(E)try{P=E.addDirectives(P)}catch(A){this.warn("Could not construct new URL with HLS Delivery Directives: "+A)}this.log("Attempt loading level index "+S+(E?" at sn "+E.msn+" part "+E.part:"")+" with URL-id "+D+" "+P),this.clearTimer(),this.hls.trigger(s.Events.LEVEL_LOADING,{url:P,level:S,id:D,deliveryDirectives:E||null})}},l.removeLevel=function(E,S){var O=function(A,w){return w!==S},D=this._levels.filter(function(P,A){return A!==E?!0:P.url.length>1&&S!==void 0?(P.url=P.url.filter(O),P.audioGroupIds&&(P.audioGroupIds=P.audioGroupIds.filter(O)),P.textGroupIds&&(P.textGroupIds=P.textGroupIds.filter(O)),P.urlId=0,!0):!1}).map(function(P,A){var w=P.details;return w!=null&&w.fragments&&w.fragments.forEach(function(L){L.level=A}),P});this._levels=D,this.hls.trigger(s.Events.LEVELS_UPDATED,{levels:D})},b(v,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(E){var S,O=this._levels;if(O.length!==0&&!(this.currentLevelIndex===E&&(S=O[E])!==null&&S!==void 0&&S.details)){if(E<0||E>=O.length){var D=E<0;if(this.hls.trigger(s.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.LEVEL_SWITCH_ERROR,level:E,fatal:D,reason:"invalid level idx"}),D)return;E=Math.min(E,O.length-1)}this.clearTimer();var P=this.currentLevelIndex,A=O[P],w=O[E];this.log("switching to level "+E+" from "+P),this.currentLevelIndex=E;var L=h({},w,{level:E,maxBitrate:w.maxBitrate,uri:w.uri,urlId:w.urlId});delete L._urlId,this.hls.trigger(s.Events.LEVEL_SWITCHING,L);var R=w.details;if(!R||R.live){var C=this.switchParams(w.uri,A==null?void 0:A.details);this.loadPlaylist(C)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(E){this.manualLevelIndex=E,this._startLevel===void 0&&(this._startLevel=E),E!==-1&&(this.level=E)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(E){this._firstLevel=E}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var E=this.hls.config.startLevel;return E!==void 0?E:this._firstLevel}else return this._startLevel},set:function(E){this._startLevel=E}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(E){this.level=E,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=E)}}]),v}(g.default)},"./src/controller/level-helper.ts":function(r,n,t){t.r(n),t.d(n,"addGroupId",function(){return o}),t.d(n,"assignTrackIdsByGroup",function(){return p}),t.d(n,"updatePTS",function(){return x}),t.d(n,"updateFragPTSDTS",function(){return d}),t.d(n,"mergeDetails",function(){return h}),t.d(n,"mapPartIntersection",function(){return y}),t.d(n,"mapFragmentIntersection",function(){return b}),t.d(n,"adjustSliding",function(){return T}),t.d(n,"addSliding",function(){return _}),t.d(n,"computeReloadInterval",function(){return c}),t.d(n,"getFragmentWithSN",function(){return u}),t.d(n,"getPartWith",function(){return f});var a=t("./src/polyfills/number.ts"),s=t("./src/utils/logger.ts");function o(v,l,m){switch(l){case"audio":v.audioGroupIds||(v.audioGroupIds=[]),v.audioGroupIds.push(m);break;case"text":v.textGroupIds||(v.textGroupIds=[]),v.textGroupIds.push(m);break}}function p(v){var l={};v.forEach(function(m){var E=m.groupId||"";m.id=l[E]=l[E]||0,l[E]++})}function x(v,l,m){var E=v[l],S=v[m];g(E,S)}function g(v,l){var m=l.startPTS;if(Object(a.isFiniteNumber)(m)){var E=0,S;l.sn>v.sn?(E=m-v.start,S=v):(E=v.start-m,S=l),S.duration!==E&&(S.duration=E)}else if(l.sn>v.sn){var O=v.cc===l.cc;O&&v.minEndPTS?l.start=v.start+(v.minEndPTS-v.start):l.start=v.start+v.duration}else l.start=Math.max(v.start-l.duration,0)}function d(v,l,m,E,S,O){var D=E-m;D<=0&&(s.logger.warn("Fragment should have a positive duration",l),E=m+l.duration,O=S+l.duration);var P=m,A=E,w=l.startPTS,L=l.endPTS;if(Object(a.isFiniteNumber)(w)){var R=Math.abs(w-m);Object(a.isFiniteNumber)(l.deltaPTS)?l.deltaPTS=Math.max(R,l.deltaPTS):l.deltaPTS=R,P=Math.max(m,w),m=Math.min(m,w),S=Math.min(S,l.startDTS),A=Math.min(E,L),E=Math.max(E,L),O=Math.max(O,l.endDTS)}l.duration=E-m;var C=m-l.start;l.appendedPTS=E,l.start=l.startPTS=m,l.maxStartPTS=P,l.startDTS=S,l.endPTS=E,l.minEndPTS=A,l.endDTS=O;var M=l.sn;if(!v||M<v.startSN||M>v.endSN)return 0;var N,U=M-v.startSN,K=v.fragments;for(K[U]=l,N=U;N>0;N--)g(K[N],K[N-1]);for(N=U;N<K.length-1;N++)g(K[N],K[N+1]);return v.fragmentHint&&g(K[K.length-1],v.fragmentHint),v.PTSKnown=v.alignedSliding=!0,C}function h(v,l){for(var m=null,E=v.fragments,S=E.length-1;S>=0;S--){var O=E[S].initSegment;if(O){m=O;break}}v.fragmentHint&&delete v.fragmentHint.endPTS;var D=0,P;if(b(v,l,function(N,U){N.relurl&&(D=N.cc-U.cc),Object(a.isFiniteNumber)(N.startPTS)&&Object(a.isFiniteNumber)(N.endPTS)&&(U.start=U.startPTS=N.startPTS,U.startDTS=N.startDTS,U.appendedPTS=N.appendedPTS,U.maxStartPTS=N.maxStartPTS,U.endPTS=N.endPTS,U.endDTS=N.endDTS,U.minEndPTS=N.minEndPTS,U.duration=N.endPTS-N.startPTS,U.duration&&(P=U),l.PTSKnown=l.alignedSliding=!0),U.elementaryStreams=N.elementaryStreams,U.loader=N.loader,U.stats=N.stats,U.urlId=N.urlId,N.initSegment&&(U.initSegment=N.initSegment,m=N.initSegment)}),m){var A=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments;A.forEach(function(N){var U;(!N.initSegment||N.initSegment.relurl===((U=m)===null||U===void 0?void 0:U.relurl))&&(N.initSegment=m)})}if(l.skippedSegments&&(l.deltaUpdateFailed=l.fragments.some(function(N){return!N}),l.deltaUpdateFailed)){s.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var w=l.skippedSegments;w--;)l.fragments.shift();l.startSN=l.fragments[0].sn,l.startCC=l.fragments[0].cc}var L=l.fragments;if(D){s.logger.warn("discontinuity sliding from playlist, take drift into account");for(var R=0;R<L.length;R++)L[R].cc+=D}l.skippedSegments&&(l.startCC=l.fragments[0].cc),y(v.partList,l.partList,function(N,U){U.elementaryStreams=N.elementaryStreams,U.stats=N.stats}),P?d(l,P,P.startPTS,P.endPTS,P.startDTS,P.endDTS):T(v,l),L.length&&(l.totalduration=l.edge-L[0].start),l.driftStartTime=v.driftStartTime,l.driftStart=v.driftStart;var C=l.advancedDateTime;if(l.advanced&&C){var M=l.edge;l.driftStart||(l.driftStartTime=C,l.driftStart=M),l.driftEndTime=C,l.driftEnd=M}else l.driftEndTime=v.driftEndTime,l.driftEnd=v.driftEnd,l.advancedDateTime=v.advancedDateTime}function y(v,l,m){if(v&&l)for(var E=0,S=0,O=v.length;S<=O;S++){var D=v[S],P=l[S+E];D&&P&&D.index===P.index&&D.fragment.sn===P.fragment.sn?m(D,P):E--}}function b(v,l,m){for(var E=l.skippedSegments,S=Math.max(v.startSN,l.startSN)-l.startSN,O=(v.fragmentHint?1:0)+(E?l.endSN:Math.min(v.endSN,l.endSN))-l.startSN,D=l.startSN-v.startSN,P=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments,A=v.fragmentHint?v.fragments.concat(v.fragmentHint):v.fragments,w=S;w<=O;w++){var L=A[D+w],R=P[w];E&&!R&&w<E&&(R=l.fragments[w]=L),L&&R&&m(L,R)}}function T(v,l){var m=l.startSN+l.skippedSegments-v.startSN,E=v.fragments;m<0||m>=E.length||_(l,E[m].start)}function _(v,l){if(l){for(var m=v.fragments,E=v.skippedSegments;E<m.length;E++)m[E].start+=l;v.fragmentHint&&(v.fragmentHint.start+=l)}}function c(v,l){var m=1e3*v.levelTargetDuration,E=m/2,S=v.age,O=S>0&&S<m*3,D=l.loading.end-l.loading.start,P,A=v.availabilityDelay;if(v.updated===!1)if(O){var w=333*v.misses;P=Math.max(Math.min(E,D*2),w),v.availabilityDelay=(v.availabilityDelay||0)+P}else P=E;else O?(A=Math.min(A||m/2,S),v.availabilityDelay=A,P=A+m-S):P=m-D;return Math.round(P)}function u(v,l,m){if(!v||!v.details)return null;var E=v.details,S=E.fragments[l-E.startSN];return S||(S=E.fragmentHint,S&&S.sn===l)?S:l<E.startSN&&m&&m.sn===l?m:null}function f(v,l,m){if(!v||!v.details)return null;var E=v.details.partList;if(E)for(var S=E.length;S--;){var O=E[S];if(O.index===m&&O.fragment.sn===l)return O}return null}},"./src/controller/stream-controller.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return E});var a=t("./src/polyfills/number.ts"),s=t("./src/controller/base-stream-controller.ts"),o=t("./src/is-supported.ts"),p=t("./src/events.ts"),x=t("./src/utils/buffer-helper.ts"),g=t("./src/controller/fragment-tracker.ts"),d=t("./src/types/loader.ts"),h=t("./src/loader/fragment.ts"),y=t("./src/demux/transmuxer-interface.ts"),b=t("./src/types/transmuxer.ts"),T=t("./src/controller/gap-controller.ts"),_=t("./src/errors.ts"),c=t("./src/utils/logger.ts");function u(S,O){for(var D=0;D<O.length;D++){var P=O[D];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(S,P.key,P)}}function f(S,O,D){return O&&u(S.prototype,O),D&&u(S,D),S}function v(S,O){S.prototype=Object.create(O.prototype),S.prototype.constructor=S,l(S,O)}function l(S,O){return l=Object.setPrototypeOf||function(P,A){return P.__proto__=A,P},l(S,O)}var m=100,E=function(S){v(O,S);function O(P,A){var w;return w=S.call(this,P,A,"[stream-controller]")||this,w.audioCodecSwap=!1,w.gapController=null,w.level=-1,w._forceStartLoad=!1,w.altAudio=!1,w.audioOnly=!1,w.fragPlaying=null,w.onvplaying=null,w.onvseeked=null,w.fragLastKbps=0,w.stalled=!1,w.couldBacktrack=!1,w.audioCodecSwitch=!1,w.videoBuffer=null,w._registerListeners(),w}var D=O.prototype;return D._registerListeners=function(){var A=this.hls;A.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),A.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),A.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),A.on(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),A.on(p.Events.LEVEL_LOADING,this.onLevelLoading,this),A.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),A.on(p.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),A.on(p.Events.ERROR,this.onError,this),A.on(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),A.on(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),A.on(p.Events.BUFFER_CREATED,this.onBufferCreated,this),A.on(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),A.on(p.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),A.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},D._unregisterListeners=function(){var A=this.hls;A.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),A.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),A.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),A.off(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),A.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),A.off(p.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),A.off(p.Events.ERROR,this.onError,this),A.off(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),A.off(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),A.off(p.Events.BUFFER_CREATED,this.onBufferCreated,this),A.off(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),A.off(p.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),A.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},D.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},D.startLoad=function(A){if(this.levels){var w=this.lastCurrentTime,L=this.hls;if(this.stopLoad(),this.setInterval(m),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var R=L.startLevel;R===-1&&(L.config.testBandwidth?(R=0,this.bitrateTest=!0):R=L.nextAutoLevel),this.level=L.nextLoadLevel=R,this.loadedmetadata=!1}w>0&&A===-1&&(this.log("Override startPosition with lastCurrentTime @"+w.toFixed(3)),A=w),this.state=s.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=A,this.tick()}else this._forceStartLoad=!0,this.state=s.State.STOPPED},D.stopLoad=function(){this._forceStartLoad=!1,S.prototype.stopLoad.call(this)},D.doTick=function(){switch(this.state){case s.State.IDLE:this.doTickIdle();break;case s.State.WAITING_LEVEL:{var A,w=this.levels,L=this.level,R=w==null||(A=w[L])===null||A===void 0?void 0:A.details;if(R&&(!R.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(R))break;this.state=s.State.IDLE;break}break}case s.State.FRAG_LOADING_WAITING_RETRY:{var C,M=self.performance.now(),N=this.retryDate;(!N||M>=N||(C=this.media)!==null&&C!==void 0&&C.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=s.State.IDLE)}break}this.onTickEnd()},D.onTickEnd=function(){S.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},D.doTickIdle=function(){var A,w,L=this.hls,R=this.levelLastLoaded,C=this.levels,M=this.media,N=L.config,U=L.nextLoadLevel;if(!(R===null||!M&&(this.startFragRequested||!N.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!C||!C[U])){var K=C[U];this.level=L.nextLoadLevel=U;var V=K.details;if(!V||this.state===s.State.WAITING_LEVEL||V.live&&this.levelLastLoaded!==U){this.state=s.State.WAITING_LEVEL;return}var W=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:M,d.PlaylistLevelType.MAIN);if(W!==null){var G=W.len,Y=this.getMaxBufferLength(K.maxBitrate);if(!(G>=Y)){if(this._streamEnded(W,V)){var q={};this.altAudio&&(q.type="video"),this.hls.trigger(p.Events.BUFFER_EOS,q),this.state=s.State.ENDED;return}var ee=W.end,re=this.getNextFragment(ee,V);if(this.couldBacktrack&&!this.fragPrevious&&re&&re.sn!=="initSegment"){var pe=re.sn-V.startSN;pe>1&&(re=V.fragments[pe-1],this.fragmentTracker.removeFragment(re))}if(re&&this.fragmentTracker.getState(re)===g.FragmentState.OK&&this.nextLoadPosition>ee){var Le=this.audioOnly&&!this.altAudio?h.ElementaryStreamTypes.AUDIO:h.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(M,Le,d.PlaylistLevelType.MAIN),re=this.getNextFragment(this.nextLoadPosition,V)}!re||(re.initSegment&&!re.initSegment.data&&!this.bitrateTest&&(re=re.initSegment),((A=re.decryptdata)===null||A===void 0?void 0:A.keyFormat)==="identity"&&!((w=re.decryptdata)!==null&&w!==void 0&&w.key)?this.loadKey(re,V):this.loadFragment(re,V,ee))}}}},D.loadFragment=function(A,w,L){var R,C=this.fragmentTracker.getState(A);if(this.fragCurrent=A,C===g.FragmentState.BACKTRACKED){var M=this.fragmentTracker.getBacktrackData(A);if(M){this._handleFragmentLoadProgress(M),this._handleFragmentLoadComplete(M);return}else C=g.FragmentState.NOT_LOADED}C===g.FragmentState.NOT_LOADED||C===g.FragmentState.PARTIAL?A.sn==="initSegment"?this._loadInitSegment(A):this.bitrateTest?(A.bitrateTest=!0,this.log("Fragment "+A.sn+" of level "+A.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(A)):(this.startFragRequested=!0,S.prototype.loadFragment.call(this,A,w,L)):C===g.FragmentState.APPENDING?this.reduceMaxBufferLength(A.duration)&&this.fragmentTracker.removeFragment(A):((R=this.media)===null||R===void 0?void 0:R.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},D.getAppendedFrag=function(A){var w=this.fragmentTracker.getAppendedFrag(A,d.PlaylistLevelType.MAIN);return w&&"fragment"in w?w.fragment:w},D.getBufferedFrag=function(A){return this.fragmentTracker.getBufferedFrag(A,d.PlaylistLevelType.MAIN)},D.followingBufferedFrag=function(A){return A?this.getBufferedFrag(A.end+.5):null},D.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},D.nextLevelSwitch=function(){var A=this.levels,w=this.media;if(w!=null&&w.readyState){var L,R=this.getAppendedFrag(w.currentTime);if(R&&R.start>1&&this.flushMainBuffer(0,R.start-1),!w.paused&&A){var C=this.hls.nextLoadLevel,M=A[C],N=this.fragLastKbps;N&&this.fragCurrent?L=this.fragCurrent.duration*M.maxBitrate/(1e3*N)+1:L=0}else L=0;var U=this.getBufferedFrag(w.currentTime+L);if(U){var K=this.followingBufferedFrag(U);if(K){this.abortCurrentFrag();var V=K.maxStartPTS?K.maxStartPTS:K.start,W=K.duration,G=Math.max(U.end,V+Math.min(Math.max(W-this.config.maxFragLookUpTolerance,W*.5),W*.75));this.flushMainBuffer(G,Number.POSITIVE_INFINITY)}}}},D.abortCurrentFrag=function(){var A=this.fragCurrent;this.fragCurrent=null,A!=null&&A.loader&&A.loader.abort(),this.state===s.State.KEY_LOADING&&(this.state=s.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},D.flushMainBuffer=function(A,w){S.prototype.flushMainBuffer.call(this,A,w,this.altAudio?"video":null)},D.onMediaAttached=function(A,w){S.prototype.onMediaAttached.call(this,A,w);var L=w.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),L.addEventListener("playing",this.onvplaying),L.addEventListener("seeked",this.onvseeked),this.gapController=new T.default(this.config,L,this.fragmentTracker,this.hls)},D.onMediaDetaching=function(){var A=this.media;A&&(A.removeEventListener("playing",this.onvplaying),A.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),S.prototype.onMediaDetaching.call(this)},D.onMediaPlaying=function(){this.tick()},D.onMediaSeeked=function(){var A=this.media,w=A?A.currentTime:null;Object(a.isFiniteNumber)(w)&&this.log("Media seeked to "+w.toFixed(3)),this.tick()},D.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(p.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},D.onManifestParsed=function(A,w){var L=!1,R=!1,C;w.levels.forEach(function(M){C=M.audioCodec,C&&(C.indexOf("mp4a.40.2")!==-1&&(L=!0),C.indexOf("mp4a.40.5")!==-1&&(R=!0))}),this.audioCodecSwitch=L&&R&&!Object(o.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=w.levels,this.startFragRequested=!1},D.onLevelLoading=function(A,w){var L=this.levels;if(!(!L||this.state!==s.State.IDLE)){var R=L[w.level];(!R.details||R.details.live&&this.levelLastLoaded!==w.level||this.waitForCdnTuneIn(R.details))&&(this.state=s.State.WAITING_LEVEL)}},D.onLevelLoaded=function(A,w){var L,R=this.levels,C=w.level,M=w.details,N=M.totalduration;if(!R){this.warn("Levels were reset while loading level "+C);return}this.log("Level "+C+" loaded ["+M.startSN+","+M.endSN+"], cc ["+M.startCC+", "+M.endCC+"] duration:"+N);var U=this.fragCurrent;U&&(this.state===s.State.FRAG_LOADING||this.state===s.State.FRAG_LOADING_WAITING_RETRY)&&U.level!==w.level&&U.loader&&(this.state=s.State.IDLE,U.loader.abort());var K=R[C],V=0;if(M.live||(L=K.details)!==null&&L!==void 0&&L.live){if(M.fragments[0]||(M.deltaUpdateFailed=!0),M.deltaUpdateFailed)return;V=this.alignPlaylists(M,K.details)}if(K.details=M,this.levelLastLoaded=C,this.hls.trigger(p.Events.LEVEL_UPDATED,{details:M,level:C}),this.state===s.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(M))return;this.state=s.State.IDLE}this.startFragRequested?M.live&&this.synchronizeToLiveEdge(M):this.setStartPosition(M,V),this.tick()},D._handleFragmentLoadProgress=function(A){var w,L=A.frag,R=A.part,C=A.payload,M=this.levels;if(!M){this.warn("Levels were reset while fragment load was in progress. Fragment "+L.sn+" of level "+L.level+" will not be buffered");return}var N=M[L.level],U=N.details;if(!U){this.warn("Dropping fragment "+L.sn+" of level "+L.level+" after level details were reset");return}var K=N.videoCodec,V=U.PTSKnown||!U.live,W=(w=L.initSegment)===null||w===void 0?void 0:w.data,G=this._getAudioCodec(N),Y=this.transmuxer=this.transmuxer||new y.default(this.hls,d.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),q=R?R.index:-1,ee=q!==-1,re=new b.ChunkMetadata(L.level,L.sn,L.stats.chunkCount,C.byteLength,q,ee),pe=this.initPTS[L.cc];Y.push(C,W,G,K,L,R,U.totalduration,V,re,pe)},D.onAudioTrackSwitching=function(A,w){var L=this.altAudio,R=!!w.url,C=w.id;if(!R){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var M=this.fragCurrent;M!=null&&M.loader&&(this.log("Switching to main audio track, cancel main fragment load"),M.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var N=this.hls;L&&N.trigger(p.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),N.trigger(p.Events.AUDIO_TRACK_SWITCHED,{id:C})}},D.onAudioTrackSwitched=function(A,w){var L=w.id,R=!!this.hls.audioTracks[L].url;if(R){var C=this.videoBuffer;C&&this.mediaBuffer!==C&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=C)}this.altAudio=R,this.tick()},D.onBufferCreated=function(A,w){var L=w.tracks,R,C,M=!1;for(var N in L){var U=L[N];if(U.id==="main"){if(C=N,R=U,N==="video"){var K=L[N];K&&(this.videoBuffer=K.buffer)}}else M=!0}M&&R?(this.log("Alternate track found, use "+C+".buffered to schedule main fragment loading"),this.mediaBuffer=R.buffer):this.mediaBuffer=this.media},D.onFragBuffered=function(A,w){var L=w.frag,R=w.part;if(!(L&&L.type!==d.PlaylistLevelType.MAIN)){if(this.fragContextChanged(L)){this.warn("Fragment "+L.sn+(R?" p: "+R.index:"")+" of level "+L.level+" finished buffering, but was aborted. state: "+this.state),this.state===s.State.PARSED&&(this.state=s.State.IDLE);return}var C=R?R.stats:L.stats;this.fragLastKbps=Math.round(8*C.total/(C.buffering.end-C.loading.first)),L.sn!=="initSegment"&&(this.fragPrevious=L),this.fragBufferedComplete(L,R)}},D.onError=function(A,w){switch(w.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:case _.ErrorDetails.KEY_LOAD_ERROR:case _.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.MAIN,w);break;case _.ErrorDetails.LEVEL_LOAD_ERROR:case _.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==s.State.ERROR&&(w.fatal?(this.warn(""+w.details),this.state=s.State.ERROR):!w.levelRetry&&this.state===s.State.WAITING_LEVEL&&(this.state=s.State.IDLE));break;case _.ErrorDetails.BUFFER_FULL_ERROR:if(w.parent==="main"&&(this.state===s.State.PARSING||this.state===s.State.PARSED)){var L=!0,R=this.getFwdBufferInfo(this.media,d.PlaylistLevelType.MAIN);R&&R.len>.5&&(L=!this.reduceMaxBufferLength(R.len)),L&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},D.checkBuffer=function(){var A=this.media,w=this.gapController;if(!(!A||!w||!A.readyState)){var L=x.BufferHelper.getBuffered(A);!this.loadedmetadata&&L.length?(this.loadedmetadata=!0,this.seekToStartPos()):w.poll(this.lastCurrentTime),this.lastCurrentTime=A.currentTime}},D.onFragLoadEmergencyAborted=function(){this.state=s.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},D.onBufferFlushed=function(A,w){var L=w.type;if(L!==h.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var R=(L===h.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(R,L,d.PlaylistLevelType.MAIN)}},D.onLevelsUpdated=function(A,w){this.levels=w.levels},D.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},D.seekToStartPos=function(){var A=this.media,w=A.currentTime,L=this.startPosition;if(L>=0&&w<L){if(A.seeking){c.logger.log("could not seek to "+L+", already seeking at "+w);return}var R=x.BufferHelper.getBuffered(A),C=R.length?R.start(0):0,M=C-L;M>0&&(M<this.config.maxBufferHole||M<this.config.maxFragLookUpTolerance)&&(c.logger.log("adjusting start position by "+M+" to match buffer start"),L+=M,this.startPosition=L),this.log("seek to target start position "+L+" from current time "+w),A.currentTime=L}},D._getAudioCodec=function(A){var w=this.config.defaultAudioCodec||A.audioCodec;return this.audioCodecSwap&&w&&(this.log("Swapping audio codec"),w.indexOf("mp4a.40.5")!==-1?w="mp4a.40.2":w="mp4a.40.5"),w},D._loadBitrateTestFrag=function(A){var w=this;this._doFragLoad(A).then(function(L){var R=w.hls;if(!(!L||R.nextLoadLevel||w.fragContextChanged(A))){w.fragLoadError=0,w.state=s.State.IDLE,w.startFragRequested=!1,w.bitrateTest=!1;var C=A.stats;C.parsing.start=C.parsing.end=C.buffering.start=C.buffering.end=self.performance.now(),R.trigger(p.Events.FRAG_LOADED,L)}})},D._handleTransmuxComplete=function(A){var w,L="main",R=this.hls,C=A.remuxResult,M=A.chunkMeta,N=this.getCurrentContext(M);if(!N){this.warn("The loading context changed while buffering fragment "+M.sn+" of level "+M.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(M.level);return}var U=N.frag,K=N.part,V=N.level,W=C.video,G=C.text,Y=C.id3,q=C.initSegment,ee=this.altAudio?void 0:C.audio;if(!this.fragContextChanged(U)){if(this.state=s.State.PARSING,q){q.tracks&&(this._bufferInitSegment(V,q.tracks,U,M),R.trigger(p.Events.FRAG_PARSING_INIT_SEGMENT,{frag:U,id:L,tracks:q.tracks}));var re=q.initPTS,pe=q.timescale;Object(a.isFiniteNumber)(re)&&(this.initPTS[U.cc]=re,R.trigger(p.Events.INIT_PTS_FOUND,{frag:U,id:L,initPTS:re,timescale:pe}))}if(W&&C.independent!==!1){if(V.details){var Le=W.startPTS,Te=W.endPTS,be=W.startDTS,Re=W.endDTS;if(K)K.elementaryStreams[W.type]={startPTS:Le,endPTS:Te,startDTS:be,endDTS:Re};else if(W.firstKeyFrame&&W.independent&&(this.couldBacktrack=!0),W.dropped&&W.independent){var Se=this.getLoadPosition()+this.config.maxBufferHole;if(Se<Le){this.backtrack(U);return}U.setElementaryStreamInfo(W.type,U.start,Te,U.start,Re,!0)}U.setElementaryStreamInfo(W.type,Le,Te,be,Re),this.bufferFragmentData(W,U,K,M)}}else if(C.independent===!1){this.backtrack(U);return}if(ee){var Ge=ee.startPTS,$e=ee.endPTS,st=ee.startDTS,Ze=ee.endDTS;K&&(K.elementaryStreams[h.ElementaryStreamTypes.AUDIO]={startPTS:Ge,endPTS:$e,startDTS:st,endDTS:Ze}),U.setElementaryStreamInfo(h.ElementaryStreamTypes.AUDIO,Ge,$e,st,Ze),this.bufferFragmentData(ee,U,K,M)}if(Y!=null&&(w=Y.samples)!==null&&w!==void 0&&w.length){var et={frag:U,id:L,samples:Y.samples};R.trigger(p.Events.FRAG_PARSING_METADATA,et)}if(G){var ft={frag:U,id:L,samples:G.samples};R.trigger(p.Events.FRAG_PARSING_USERDATA,ft)}}},D._bufferInitSegment=function(A,w,L,R){var C=this;if(this.state===s.State.PARSING){this.audioOnly=!!w.audio&&!w.video,this.altAudio&&!this.audioOnly&&delete w.audio;var M=w.audio,N=w.video,U=w.audiovideo;if(M){var K=A.audioCodec,V=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(K&&(K.indexOf("mp4a.40.5")!==-1?K="mp4a.40.2":K="mp4a.40.5"),M.metadata.channelCount!==1&&V.indexOf("firefox")===-1&&(K="mp4a.40.5")),V.indexOf("android")!==-1&&M.container!=="audio/mpeg"&&(K="mp4a.40.2",this.log("Android: force audio codec to "+K)),A.audioCodec&&A.audioCodec!==K&&this.log('Swapping manifest audio codec "'+A.audioCodec+'" for "'+K+'"'),M.levelCodec=K,M.id="main",this.log("Init audio buffer, container:"+M.container+", codecs[selected/level/parsed]=["+(K||"")+"/"+(A.audioCodec||"")+"/"+M.codec+"]")}N&&(N.levelCodec=A.videoCodec,N.id="main",this.log("Init video buffer, container:"+N.container+", codecs[level/parsed]=["+(A.videoCodec||"")+"/"+N.codec+"]")),U&&this.log("Init audiovideo buffer, container:"+U.container+", codecs[level/parsed]=["+(A.attrs.CODECS||"")+"/"+U.codec+"]"),this.hls.trigger(p.Events.BUFFER_CODECS,w),Object.keys(w).forEach(function(W){var G=w[W],Y=G.initSegment;Y!=null&&Y.byteLength&&C.hls.trigger(p.Events.BUFFER_APPENDING,{type:W,data:Y,frag:L,part:null,chunkMeta:R,parent:L.type})}),this.tick()}},D.backtrack=function(A){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(A);var w=this.fragmentTracker.backtrack(A);this.fragPrevious=null,this.nextLoadPosition=A.start,w?this.resetFragmentLoading(A):this.state=s.State.BACKTRACKING},D.checkFragmentChanged=function(){var A=this.media,w=null;if(A&&A.readyState>1&&A.seeking===!1){var L=A.currentTime;if(x.BufferHelper.isBuffered(A,L)?w=this.getAppendedFrag(L):x.BufferHelper.isBuffered(A,L+.1)&&(w=this.getAppendedFrag(L+.1)),w){var R=this.fragPlaying,C=w.level;(!R||w.sn!==R.sn||R.level!==C||w.urlId!==R.urlId)&&(this.hls.trigger(p.Events.FRAG_CHANGED,{frag:w}),(!R||R.level!==C)&&this.hls.trigger(p.Events.LEVEL_SWITCHED,{level:C}),this.fragPlaying=w)}}},f(O,[{key:"nextLevel",get:function(){var A=this.nextBufferedFrag;return A?A.level:-1}},{key:"currentLevel",get:function(){var A=this.media;if(A){var w=this.getAppendedFrag(A.currentTime);if(w)return w.level}return-1}},{key:"nextBufferedFrag",get:function(){var A=this.media;if(A){var w=this.getAppendedFrag(A.currentTime);return this.followingBufferedFrag(w)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),O}(s.default)},"./src/controller/subtitle-stream-controller.ts":function(r,n,t){t.r(n),t.d(n,"SubtitleStreamController",function(){return f});var a=t("./src/events.ts"),s=t("./src/utils/buffer-helper.ts"),o=t("./src/controller/fragment-finders.ts"),p=t("./src/utils/discontinuities.ts"),x=t("./src/controller/level-helper.ts"),g=t("./src/controller/fragment-tracker.ts"),d=t("./src/controller/base-stream-controller.ts"),h=t("./src/types/loader.ts"),y=t("./src/types/level.ts");function b(v,l){for(var m=0;m<l.length;m++){var E=l[m];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(v,E.key,E)}}function T(v,l,m){return l&&b(v.prototype,l),m&&b(v,m),v}function _(v,l){v.prototype=Object.create(l.prototype),v.prototype.constructor=v,c(v,l)}function c(v,l){return c=Object.setPrototypeOf||function(E,S){return E.__proto__=S,E},c(v,l)}var u=500,f=function(v){_(l,v);function l(E,S){var O;return O=v.call(this,E,S,"[subtitle-stream-controller]")||this,O.levels=[],O.currentTrackId=-1,O.tracksBuffered=[],O.mainDetails=null,O._registerListeners(),O}var m=l.prototype;return m.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},m._registerListeners=function(){var S=this.hls;S.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),S.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),S.on(a.Events.ERROR,this.onError,this),S.on(a.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),S.on(a.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),S.on(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),S.on(a.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),S.on(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m._unregisterListeners=function(){var S=this.hls;S.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),S.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),S.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),S.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),S.off(a.Events.ERROR,this.onError,this),S.off(a.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),S.off(a.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),S.off(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),S.off(a.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),S.off(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m.startLoad=function(){this.stopLoad(),this.state=d.State.IDLE,this.setInterval(u),this.tick()},m.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},m.onLevelLoaded=function(S,O){this.mainDetails=O.details},m.onSubtitleFragProcessed=function(S,O){var D=O.frag,P=O.success;if(this.fragPrevious=D,this.state=d.State.IDLE,!!P){var A=this.tracksBuffered[this.currentTrackId];if(!!A){for(var w,L=D.start,R=0;R<A.length;R++)if(L>=A[R].start&&L<=A[R].end){w=A[R];break}var C=D.start+D.duration;w?w.end=C:(w={start:L,end:C},A.push(w)),this.fragmentTracker.fragBuffered(D)}}},m.onBufferFlushing=function(S,O){var D=O.startOffset,P=O.endOffset;if(D===0&&P!==Number.POSITIVE_INFINITY){var A=this.currentTrackId,w=this.levels;if(!w.length||!w[A]||!w[A].details)return;var L=w[A].details,R=L.targetduration,C=P-R;if(C<=0)return;O.endOffsetSubtitles=Math.max(0,C),this.tracksBuffered.forEach(function(M){for(var N=0;N<M.length;){if(M[N].end<=C){M.shift();continue}else if(M[N].start<C)M[N].start=C;else break;N++}}),this.fragmentTracker.removeFragmentsInRange(D,C,h.PlaylistLevelType.SUBTITLE)}},m.onError=function(S,O){var D,P=O.frag;!P||P.type!==h.PlaylistLevelType.SUBTITLE||((D=this.fragCurrent)!==null&&D!==void 0&&D.loader&&this.fragCurrent.loader.abort(),this.state=d.State.IDLE)},m.onSubtitleTracksUpdated=function(S,O){var D=this,P=O.subtitleTracks;this.tracksBuffered=[],this.levels=P.map(function(A){return new y.Level(A)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(A){D.tracksBuffered[A.id]=[]}),this.mediaBuffer=null},m.onSubtitleTrackSwitch=function(S,O){if(this.currentTrackId=O.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var D=this.levels[this.currentTrackId];D!=null&&D.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,D&&this.setInterval(u)},m.onSubtitleTrackLoaded=function(S,O){var D,P=O.details,A=O.id,w=this.currentTrackId,L=this.levels;if(!!L.length){var R=L[w];if(!(A>=L.length||A!==w||!R)){if(this.mediaBuffer=this.mediaBufferTimeRanges,P.live||(D=R.details)!==null&&D!==void 0&&D.live){var C=this.mainDetails;if(P.deltaUpdateFailed||!C)return;var M=C.fragments[0];if(!R.details)P.hasProgramDateTime&&C.hasProgramDateTime?Object(p.alignMediaPlaylistByPDT)(P,C):M&&Object(x.addSliding)(P,M.start);else{var N=this.alignPlaylists(P,R.details);N===0&&M&&Object(x.addSliding)(P,M.start)}}if(R.details=P,this.levelLastLoaded=A,this.tick(),P.live&&!this.fragCurrent&&this.media&&this.state===d.State.IDLE){var U=Object(o.findFragmentByPTS)(null,P.fragments,this.media.currentTime,0);U||(this.warn("Subtitle playlist not aligned with playback"),R.details=void 0)}}}},m._handleFragmentLoadComplete=function(S){var O=S.frag,D=S.payload,P=O.decryptdata,A=this.hls;if(!this.fragContextChanged(O)&&D&&D.byteLength>0&&P&&P.key&&P.iv&&P.method==="AES-128"){var w=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(D),P.key.buffer,P.iv.buffer).then(function(L){var R=performance.now();A.trigger(a.Events.FRAG_DECRYPTED,{frag:O,payload:L,stats:{tstart:w,tdecrypt:R}})})}},m.doTick=function(){if(!this.media){this.state=d.State.IDLE;return}if(this.state===d.State.IDLE){var S,O=this.currentTrackId,D=this.levels;if(!D.length||!D[O]||!D[O].details)return;var P=D[O].details,A=P.targetduration,w=this.config,L=this.media,R=s.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,L.currentTime-A,w.maxBufferHole),C=R.end,M=R.len,N=this.getMaxBufferLength()+A;if(M>N)return;console.assert(P,"Subtitle track details are defined on idle subtitle stream controller tick");var U=P.fragments,K=U.length,V=P.edge,W,G=this.fragPrevious;if(C<V){var Y=w.maxFragLookUpTolerance;W=Object(o.findFragmentByPTS)(G,U,C,Y),!W&&G&&G.start<U[0].start&&(W=U[0])}else W=U[K-1];(S=W)!==null&&S!==void 0&&S.encrypted?this.loadKey(W,P):W&&this.fragmentTracker.getState(W)===g.FragmentState.NOT_LOADED&&this.loadFragment(W,P,C)}},m.loadFragment=function(S,O,D){this.fragCurrent=S,v.prototype.loadFragment.call(this,S,O,D)},T(l,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),l}(d.default)},"./src/controller/subtitle-track-controller.ts":function(r,n,t){t.r(n);var a=t("./src/events.ts"),s=t("./src/utils/texttrack-utils.ts"),o=t("./src/controller/base-playlist-controller.ts"),p=t("./src/types/loader.ts");function x(T,_){for(var c=0;c<_.length;c++){var u=_[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(T,u.key,u)}}function g(T,_,c){return _&&x(T.prototype,_),c&&x(T,c),T}function d(T,_){T.prototype=Object.create(_.prototype),T.prototype.constructor=T,h(T,_)}function h(T,_){return h=Object.setPrototypeOf||function(u,f){return u.__proto__=f,u},h(T,_)}var y=function(T){d(_,T);function _(u){var f;return f=T.call(this,u,"[subtitle-track-controller]")||this,f.media=null,f.tracks=[],f.groupId=null,f.tracksInGroup=[],f.trackId=-1,f.selectDefaultTrack=!0,f.queuedDefaultTrack=-1,f.trackChangeListener=function(){return f.onTextTracksChanged()},f.asyncPollTrackChange=function(){return f.pollTrackChange(0)},f.useTextTrackPolling=!1,f.subtitlePollingInterval=-1,f.subtitleDisplay=!0,f.registerListeners(),f}var c=_.prototype;return c.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,T.prototype.destroy.call(this)},c.registerListeners=function(){var f=this.hls;f.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),f.on(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),f.on(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),f.on(a.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var f=this.hls;f.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(a.Events.LEVEL_LOADING,this.onLevelLoading,this),f.off(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),f.off(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),f.off(a.Events.ERROR,this.onError,this)},c.onMediaAttached=function(f,v){this.media=v.media,!!this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},c.pollTrackChange=function(f){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,f)},c.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var f=b(this.media.textTracks);f.forEach(function(v){Object(s.clearCurrentCues)(v)}),this.subtitleTrack=-1,this.media=null}},c.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},c.onManifestParsed=function(f,v){this.tracks=v.subtitleTracks},c.onSubtitleTrackLoaded=function(f,v){var l=v.id,m=v.details,E=this.trackId,S=this.tracksInGroup[E];if(!S){this.warn("Invalid subtitle track id "+l);return}var O=S.details;S.details=v.details,this.log("subtitle track "+l+" loaded ["+m.startSN+"-"+m.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,v,O))},c.onLevelLoading=function(f,v){this.switchLevel(v.level)},c.onLevelSwitching=function(f,v){this.switchLevel(v.level)},c.switchLevel=function(f){var v=this.hls.levels[f];if(!!(v!=null&&v.textGroupIds)){var l=v.textGroupIds[v.urlId];if(this.groupId!==l){var m=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,E=this.tracks.filter(function(D){return!l||D.groupId===l});this.tracksInGroup=E;var S=this.findTrackId(m==null?void 0:m.name)||this.findTrackId();this.groupId=l;var O={subtitleTracks:E};this.log("Updating subtitle tracks, "+E.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(a.Events.SUBTITLE_TRACKS_UPDATED,O),S!==-1&&this.setSubtitleTrack(S,m)}}},c.findTrackId=function(f){for(var v=this.tracksInGroup,l=0;l<v.length;l++){var m=v[l];if((!this.selectDefaultTrack||m.default)&&(!f||f===m.name))return m.id}return-1},c.onError=function(f,v){T.prototype.onError.call(this,f,v),!(v.fatal||!v.context)&&v.context.type===p.PlaylistContextType.SUBTITLE_TRACK&&v.context.id===this.trackId&&v.context.groupId===this.groupId&&this.retryLoadingOrFail(v)},c.loadPlaylist=function(f){var v=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(v)){var l=v.id,m=v.groupId,E=v.url;if(f)try{E=f.addDirectives(E)}catch(S){this.warn("Could not construct new URL with HLS Delivery Directives: "+S)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(a.Events.SUBTITLE_TRACK_LOADING,{url:E,id:l,groupId:m,deliveryDirectives:f||null})}},c.toggleTrackModes=function(f){var v=this,l=this.media,m=this.subtitleDisplay,E=this.trackId;if(!!l){var S=b(l.textTracks),O=S.filter(function(A){return A.groupId===v.groupId});if(f===-1)[].slice.call(S).forEach(function(A){A.mode="disabled"});else{var D=O[E];D&&(D.mode="disabled")}var P=O[f];P&&(P.mode=m?"showing":"hidden")}},c.setSubtitleTrack=function(f,v){var l,m=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=f;return}if(this.trackId!==f&&this.toggleTrackModes(f),!(this.trackId===f&&(f===-1||(l=m[f])!==null&&l!==void 0&&l.details)||f<-1||f>=m.length)){this.clearTimer();var E=m[f];if(this.log("Switching to subtitle track "+f),this.trackId=f,E){var S=E.id,O=E.groupId,D=O===void 0?"":O,P=E.name,A=E.type,w=E.url;this.hls.trigger(a.Events.SUBTITLE_TRACK_SWITCH,{id:S,groupId:D,name:P,type:A,url:w});var L=this.switchParams(E.url,v==null?void 0:v.details);this.loadPlaylist(L)}else this.hls.trigger(a.Events.SUBTITLE_TRACK_SWITCH,{id:f})}},c.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var f=-1,v=b(this.media.textTracks),l=0;l<v.length;l++)if(v[l].mode==="hidden")f=l;else if(v[l].mode==="showing"){f=l;break}this.subtitleTrack!==f&&(this.subtitleTrack=f)}},g(_,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(f){this.selectDefaultTrack=!1;var v=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(f,v)}}]),_}(o.default);function b(T){for(var _=[],c=0;c<T.length;c++){var u=T[c];u.kind==="subtitles"&&u.label&&_.push(T[c])}return _}n.default=y},"./src/controller/timeline-controller.ts":function(r,n,t){t.r(n),t.d(n,"TimelineController",function(){return b});var a=t("./src/polyfills/number.ts"),s=t("./src/events.ts"),o=t("./src/utils/cea-608-parser.ts"),p=t("./src/utils/output-filter.ts"),x=t("./src/utils/webvtt-parser.ts"),g=t("./src/utils/texttrack-utils.ts"),d=t("./src/utils/imsc1-ttml-parser.ts"),h=t("./src/types/loader.ts"),y=t("./src/utils/logger.ts"),b=function(){function u(v){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=c(),this.captionsProperties=void 0,this.hls=v,this.config=v.config,this.Cues=v.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var l=new p.default(this,"textTrack1"),m=new p.default(this,"textTrack2"),E=new p.default(this,"textTrack3"),S=new p.default(this,"textTrack4");this.cea608Parser1=new o.default(1,l,m),this.cea608Parser2=new o.default(3,E,S)}v.on(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),v.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(s.Events.MANIFEST_LOADED,this.onManifestLoaded,this),v.on(s.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.on(s.Events.FRAG_LOADING,this.onFragLoading,this),v.on(s.Events.FRAG_LOADED,this.onFragLoaded,this),v.on(s.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),v.on(s.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),v.on(s.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),v.on(s.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),v.on(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var f=u.prototype;return f.destroy=function(){var l=this.hls;l.off(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(s.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.off(s.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.off(s.Events.FRAG_LOADING,this.onFragLoading,this),l.off(s.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(s.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),l.off(s.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),l.off(s.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),l.off(s.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),l.off(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},f.addCues=function(l,m,E,S,O){for(var D=!1,P=O.length;P--;){var A=O[P],w=_(A[0],A[1],m,E);if(w>=0&&(A[0]=Math.min(A[0],m),A[1]=Math.max(A[1],E),D=!0,w/(E-m)>.5))return}if(D||O.push([m,E]),this.config.renderTextTracksNatively){var L=this.captionsTracks[l];this.Cues.newCue(L,m,E,S)}else{var R=this.Cues.newCue(null,m,E,S);this.hls.trigger(s.Events.CUES_PARSED,{type:"captions",cues:R,track:l})}},f.onInitPtsFound=function(l,m){var E=this,S=m.frag,O=m.id,D=m.initPTS,P=m.timescale,A=this.unparsedVttFrags;O==="main"&&(this.initPTS[S.cc]=D,this.timescale[S.cc]=P),A.length&&(this.unparsedVttFrags=[],A.forEach(function(w){E.onFragLoaded(s.Events.FRAG_LOADED,w)}))},f.getExistingTrack=function(l){var m=this.media;if(m)for(var E=0;E<m.textTracks.length;E++){var S=m.textTracks[E];if(S[l])return S}return null},f.createCaptionsTrack=function(l){this.config.renderTextTracksNatively?this.createNativeTrack(l):this.createNonNativeTrack(l)},f.createNativeTrack=function(l){if(!this.captionsTracks[l]){var m=this.captionsProperties,E=this.captionsTracks,S=this.media,O=m[l],D=O.label,P=O.languageCode,A=this.getExistingTrack(l);if(A)E[l]=A,Object(g.clearCurrentCues)(E[l]),Object(g.sendAddTrackEvent)(E[l],S);else{var w=this.createTextTrack("captions",D,P);w&&(w[l]=!0,E[l]=w)}}},f.createNonNativeTrack=function(l){if(!this.nonNativeCaptionsTracks[l]){var m=this.captionsProperties[l];if(!!m){var E=m.label,S={_id:l,label:E,kind:"captions",default:m.media?!!m.media.default:!1,closedCaptions:m.media};this.nonNativeCaptionsTracks[l]=S,this.hls.trigger(s.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[S]})}}},f.createTextTrack=function(l,m,E){var S=this.media;if(!!S)return S.addTextTrack(l,m,E)},f.onMediaAttaching=function(l,m){this.media=m.media,this._cleanTracks()},f.onMediaDetaching=function(){var l=this.captionsTracks;Object.keys(l).forEach(function(m){Object(g.clearCurrentCues)(l[m]),delete l[m]}),this.nonNativeCaptionsTracks={}},f.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=c(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},f._cleanTracks=function(){var l=this.media;if(!!l){var m=l.textTracks;if(m)for(var E=0;E<m.length;E++)Object(g.clearCurrentCues)(m[E])}},f.onSubtitleTracksUpdated=function(l,m){var E=this;this.textTracks=[];var S=m.subtitleTracks||[],O=S.some(function(w){return w.textCodec===d.IMSC1_CODEC});if(this.config.enableWebVTT||O&&this.config.enableIMSC1){var D=this.tracks&&S&&this.tracks.length===S.length;if(this.tracks=S||[],this.config.renderTextTracksNatively){var P=this.media?this.media.textTracks:[];this.tracks.forEach(function(w,L){var R;if(L<P.length){for(var C=null,M=0;M<P.length;M++)if(T(P[M],w)){C=P[M];break}C&&(R=C)}R?Object(g.clearCurrentCues)(R):(R=E.createTextTrack("subtitles",w.name,w.lang),R&&(R.mode="disabled")),R&&(R.groupId=w.groupId,E.textTracks.push(R))})}else if(!D&&this.tracks&&this.tracks.length){var A=this.tracks.map(function(w){return{label:w.name,kind:w.type.toLowerCase(),default:w.default,subtitleTrack:w}});this.hls.trigger(s.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:A})}}},f.onManifestLoaded=function(l,m){var E=this;this.config.enableCEA708Captions&&m.captions&&m.captions.forEach(function(S){var O=/(?:CC|SERVICE)([1-4])/.exec(S.instreamId);if(!!O){var D="textTrack"+O[1],P=E.captionsProperties[D];!P||(P.label=S.name,S.lang&&(P.languageCode=S.lang),P.media=S)}})},f.onFragLoading=function(l,m){var E=this.cea608Parser1,S=this.cea608Parser2,O=this.lastSn,D=this.lastPartIndex;if(!(!this.enabled||!(E&&S))&&m.frag.type===h.PlaylistLevelType.MAIN){var P,A,w=m.frag.sn,L=(P=m==null||(A=m.part)===null||A===void 0?void 0:A.index)!=null?P:-1;w===O+1||w===O&&L===D+1||(E.reset(),S.reset()),this.lastSn=w,this.lastPartIndex=L}},f.onFragLoaded=function(l,m){var E=m.frag,S=m.payload,O=this.initPTS,D=this.unparsedVttFrags;if(E.type===h.PlaylistLevelType.SUBTITLE)if(S.byteLength){if(!Object(a.isFiniteNumber)(O[E.cc])){D.push(m),O.length&&this.hls.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:E,error:new Error("Missing initial subtitle PTS")});return}var P=E.decryptdata,A="stats"in m;if(P==null||P.key==null||P.method!=="AES-128"||A){var w=this.tracks[E.level],L=this.vttCCs;L[E.cc]||(L[E.cc]={start:E.start,prevCC:this.prevCC,new:!0},this.prevCC=E.cc),w&&w.textCodec===d.IMSC1_CODEC?this._parseIMSC1(E,S):this._parseVTTs(E,S,L)}}else this.hls.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:E,error:new Error("Empty subtitle payload")})},f._parseIMSC1=function(l,m){var E=this,S=this.hls;Object(d.parseIMSC1)(m,this.initPTS[l.cc],this.timescale[l.cc],function(O){E._appendCues(O,l.level),S.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:l})},function(O){y.logger.log("Failed to parse IMSC1: "+O),S.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:O})})},f._parseVTTs=function(l,m,E){var S=this,O=this.hls;Object(x.parseWebVTT)(m,this.initPTS[l.cc],this.timescale[l.cc],E,l.cc,l.start,function(D){S._appendCues(D,l.level),O.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:l})},function(D){S._fallbackToIMSC1(l,m),y.logger.log("Failed to parse VTT cue: "+D),O.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:D})})},f._fallbackToIMSC1=function(l,m){var E=this,S=this.tracks[l.level];S.textCodec||Object(d.parseIMSC1)(m,this.initPTS[l.cc],this.timescale[l.cc],function(){S.textCodec=d.IMSC1_CODEC,E._parseIMSC1(l,m)},function(){S.textCodec="wvtt"})},f._appendCues=function(l,m){var E=this.hls;if(this.config.renderTextTracksNatively){var S=this.textTracks[m];if(S.mode==="disabled")return;l.forEach(function(P){return Object(g.addCueToTrack)(S,P)})}else{var O=this.tracks[m],D=O.default?"default":"subtitles"+m;E.trigger(s.Events.CUES_PARSED,{type:"subtitles",cues:l,track:D})}},f.onFragDecrypted=function(l,m){var E=m.frag;if(E.type===h.PlaylistLevelType.SUBTITLE){if(!Object(a.isFiniteNumber)(this.initPTS[E.cc])){this.unparsedVttFrags.push(m);return}this.onFragLoaded(s.Events.FRAG_LOADED,m)}},f.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},f.onFragParsingUserdata=function(l,m){var E=this.cea608Parser1,S=this.cea608Parser2;if(!(!this.enabled||!(E&&S)))for(var O=0;O<m.samples.length;O++){var D=m.samples[O].bytes;if(D){var P=this.extractCea608Data(D);E.addData(m.samples[O].pts,P[0]),S.addData(m.samples[O].pts,P[1])}}},f.onBufferFlushing=function(l,m){var E=m.startOffset,S=m.endOffset,O=m.endOffsetSubtitles,D=m.type,P=this.media;if(!(!P||P.currentTime<S)){if(!D||D==="video"){var A=this.captionsTracks;Object.keys(A).forEach(function(L){return Object(g.removeCuesInRange)(A[L],E,S)})}if(this.config.renderTextTracksNatively&&E===0&&O!==void 0){var w=this.textTracks;Object.keys(w).forEach(function(L){return Object(g.removeCuesInRange)(w[L],E,O)})}}},f.extractCea608Data=function(l){for(var m=l[0]&31,E=2,S=[[],[]],O=0;O<m;O++){var D=l[E++],P=127&l[E++],A=127&l[E++],w=(4&D)!=0,L=3&D;P===0&&A===0||w&&(L===0||L===1)&&(S[L].push(P),S[L].push(A))}return S},u}();function T(u,f){return u&&u.label===f.name&&!(u.textTrack1||u.textTrack2)}function _(u,f,v,l){return Math.min(f,l)-Math.max(u,v)}function c(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return a});var a=function(){function s(p,x){this.subtle=void 0,this.aesIV=void 0,this.subtle=p,this.aesIV=x}var o=s.prototype;return o.decrypt=function(x,g){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},g,x)},s}()},"./src/crypt/aes-decryptor.ts":function(r,n,t){t.r(n),t.d(n,"removePadding",function(){return s}),t.d(n,"default",function(){return o});var a=t("./src/utils/typed-array.ts");function s(p){var x=p.byteLength,g=x&&new DataView(p.buffer).getUint8(x-1);return g?Object(a.sliceUint8)(p,0,x-g):p}var o=function(){function p(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var x=p.prototype;return x.uint8ArrayToUint32Array_=function(d){for(var h=new DataView(d),y=new Uint32Array(4),b=0;b<4;b++)y[b]=h.getUint32(b*4);return y},x.initTable=function(){var d=this.sBox,h=this.invSBox,y=this.subMix,b=y[0],T=y[1],_=y[2],c=y[3],u=this.invSubMix,f=u[0],v=u[1],l=u[2],m=u[3],E=new Uint32Array(256),S=0,O=0,D=0;for(D=0;D<256;D++)D<128?E[D]=D<<1:E[D]=D<<1^283;for(D=0;D<256;D++){var P=O^O<<1^O<<2^O<<3^O<<4;P=P>>>8^P&255^99,d[S]=P,h[P]=S;var A=E[S],w=E[A],L=E[w],R=E[P]*257^P*16843008;b[S]=R<<24|R>>>8,T[S]=R<<16|R>>>16,_[S]=R<<8|R>>>24,c[S]=R,R=L*16843009^w*65537^A*257^S*16843008,f[P]=R<<24|R>>>8,v[P]=R<<16|R>>>16,l[P]=R<<8|R>>>24,m[P]=R,S?(S=A^E[E[E[L^A]]],O^=E[E[O]]):S=O=1}},x.expandKey=function(d){for(var h=this.uint8ArrayToUint32Array_(d),y=!0,b=0;b<h.length&&y;)y=h[b]===this.key[b],b++;if(!y){this.key=h;var T=this.keySize=h.length;if(T!==4&&T!==6&&T!==8)throw new Error("Invalid aes key size="+T);var _=this.ksRows=(T+6+1)*4,c,u,f=this.keySchedule=new Uint32Array(_),v=this.invKeySchedule=new Uint32Array(_),l=this.sBox,m=this.rcon,E=this.invSubMix,S=E[0],O=E[1],D=E[2],P=E[3],A,w;for(c=0;c<_;c++){if(c<T){A=f[c]=h[c];continue}w=A,c%T==0?(w=w<<8|w>>>24,w=l[w>>>24]<<24|l[w>>>16&255]<<16|l[w>>>8&255]<<8|l[w&255],w^=m[c/T|0]<<24):T>6&&c%T==4&&(w=l[w>>>24]<<24|l[w>>>16&255]<<16|l[w>>>8&255]<<8|l[w&255]),f[c]=A=(f[c-T]^w)>>>0}for(u=0;u<_;u++)c=_-u,u&3?w=f[c]:w=f[c-4],u<4||c<=4?v[u]=w:v[u]=S[l[w>>>24]]^O[l[w>>>16&255]]^D[l[w>>>8&255]]^P[l[w&255]],v[u]=v[u]>>>0}},x.networkToHostOrderSwap=function(d){return d<<24|(d&65280)<<8|(d&16711680)>>8|d>>>24},x.decrypt=function(d,h,y){for(var b=this.keySize+6,T=this.invKeySchedule,_=this.invSBox,c=this.invSubMix,u=c[0],f=c[1],v=c[2],l=c[3],m=this.uint8ArrayToUint32Array_(y),E=m[0],S=m[1],O=m[2],D=m[3],P=new Int32Array(d),A=new Int32Array(P.length),w,L,R,C,M,N,U,K,V,W,G,Y,q,ee,re=this.networkToHostOrderSwap;h<P.length;){for(V=re(P[h]),W=re(P[h+1]),G=re(P[h+2]),Y=re(P[h+3]),M=V^T[0],N=Y^T[1],U=G^T[2],K=W^T[3],q=4,ee=1;ee<b;ee++)w=u[M>>>24]^f[N>>16&255]^v[U>>8&255]^l[K&255]^T[q],L=u[N>>>24]^f[U>>16&255]^v[K>>8&255]^l[M&255]^T[q+1],R=u[U>>>24]^f[K>>16&255]^v[M>>8&255]^l[N&255]^T[q+2],C=u[K>>>24]^f[M>>16&255]^v[N>>8&255]^l[U&255]^T[q+3],M=w,N=L,U=R,K=C,q=q+4;w=_[M>>>24]<<24^_[N>>16&255]<<16^_[U>>8&255]<<8^_[K&255]^T[q],L=_[N>>>24]<<24^_[U>>16&255]<<16^_[K>>8&255]<<8^_[M&255]^T[q+1],R=_[U>>>24]<<24^_[K>>16&255]<<16^_[M>>8&255]<<8^_[N&255]^T[q+2],C=_[K>>>24]<<24^_[M>>16&255]<<16^_[N>>8&255]<<8^_[U&255]^T[q+3],A[h]=re(w^E),A[h+1]=re(C^S),A[h+2]=re(R^O),A[h+3]=re(L^D),E=V,S=W,O=G,D=Y,h=h+4}return A.buffer},p}()},"./src/crypt/decrypter.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return h});var a=t("./src/crypt/aes-crypto.ts"),s=t("./src/crypt/fast-aes-key.ts"),o=t("./src/crypt/aes-decryptor.ts"),p=t("./src/utils/logger.ts"),x=t("./src/utils/mp4-tools.ts"),g=t("./src/utils/typed-array.ts"),d=16,h=function(){function y(T,_,c){var u=c===void 0?{}:c,f=u.removePKCS7Padding,v=f===void 0?!0:f;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=T,this.config=_,this.removePKCS7Padding=v,v)try{var l=self.crypto;l&&(this.subtle=l.subtle||l.webkitSubtle)}catch(m){}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var b=y.prototype;return b.destroy=function(){this.observer=null},b.isSync=function(){return this.config.enableSoftwareAES},b.flush=function(){var _=this.currentResult;if(!_){this.reset();return}var c=new Uint8Array(_);return this.reset(),this.removePKCS7Padding?Object(o.removePadding)(c):c},b.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},b.decrypt=function(_,c,u,f){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(_),c,u);var v=this.flush();v&&f(v.buffer)}else this.webCryptoDecrypt(new Uint8Array(_),c,u).then(f)},b.softwareDecrypt=function(_,c,u){var f=this.currentIV,v=this.currentResult,l=this.remainderData;this.logOnce("JS AES decrypt"),l&&(_=Object(x.appendUint8Array)(l,_),this.remainderData=null);var m=this.getValidChunk(_);if(!m.length)return null;f&&(u=f);var E=this.softwareDecrypter;E||(E=this.softwareDecrypter=new o.default),E.expandKey(c);var S=v;return this.currentResult=E.decrypt(m.buffer,0,u),this.currentIV=Object(g.sliceUint8)(m,-16).buffer,S||null},b.webCryptoDecrypt=function(_,c,u){var f=this,v=this.subtle;return(this.key!==c||!this.fastAesKey)&&(this.key=c,this.fastAesKey=new s.default(v,c)),this.fastAesKey.expandKey().then(function(l){if(!v)return Promise.reject(new Error("web crypto not initialized"));var m=new a.default(v,u);return m.decrypt(_.buffer,l)}).catch(function(l){return f.onWebCryptoError(l,_,c,u)})},b.onWebCryptoError=function(_,c,u,f){return p.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",_),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(c,u,f)},b.getValidChunk=function(_){var c=_,u=_.length-_.length%d;return u!==_.length&&(c=Object(g.sliceUint8)(_,0,u),this.remainderData=Object(g.sliceUint8)(_,u)),c},b.logOnce=function(_){!this.logEnabled||(p.logger.log("[decrypter.ts]: "+_),this.logEnabled=!1)},y}()},"./src/crypt/fast-aes-key.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return a});var a=function(){function s(p,x){this.subtle=void 0,this.key=void 0,this.subtle=p,this.key=x}var o=s.prototype;return o.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},s}()},"./src/demux/aacdemuxer.ts":function(r,n,t){t.r(n);var a=t("./src/demux/base-audio-demuxer.ts"),s=t("./src/demux/adts.ts"),o=t("./src/utils/logger.ts"),p=t("./src/demux/id3.ts");function x(h,y){h.prototype=Object.create(y.prototype),h.prototype.constructor=h,g(h,y)}function g(h,y){return g=Object.setPrototypeOf||function(T,_){return T.__proto__=_,T},g(h,y)}var d=function(h){x(y,h);function y(T,_){var c;return c=h.call(this)||this,c.observer=void 0,c.config=void 0,c.observer=T,c.config=_,c}var b=y.prototype;return b.resetInitSegment=function(_,c,u){h.prototype.resetInitSegment.call(this,_,c,u),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:_,duration:u,inputTimeScale:9e4,dropped:0}},y.probe=function(_){if(!_)return!1;for(var c=p.getID3Data(_,0)||[],u=c.length,f=_.length;u<f;u++)if(s.probe(_,u))return o.logger.log("ADTS sync word found !"),!0;return!1},b.canParse=function(_,c){return s.canParse(_,c)},b.appendFrame=function(_,c,u){s.initTrackConfig(_,this.observer,c,u,_.manifestCodec);var f=s.appendFrame(_,c,u,this.initPTS,this.frameIndex);if(f&&f.missing===0)return f},y}(a.default);d.minProbeByteLength=9,n.default=d},"./src/demux/adts.ts":function(r,n,t){t.r(n),t.d(n,"getAudioConfig",function(){return p}),t.d(n,"isHeaderPattern",function(){return x}),t.d(n,"getHeaderLength",function(){return g}),t.d(n,"getFullFrameLength",function(){return d}),t.d(n,"canGetFrameLength",function(){return h}),t.d(n,"isHeader",function(){return y}),t.d(n,"canParse",function(){return b}),t.d(n,"probe",function(){return T}),t.d(n,"initTrackConfig",function(){return _}),t.d(n,"getFrameDuration",function(){return c}),t.d(n,"parseFrameHeader",function(){return u}),t.d(n,"appendFrame",function(){return f});var a=t("./src/utils/logger.ts"),s=t("./src/errors.ts"),o=t("./src/events.ts");function p(v,l,m,E){var S,O,D,P,A=navigator.userAgent.toLowerCase(),w=E,L=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];S=((l[m+2]&192)>>>6)+1;var R=(l[m+2]&60)>>>2;if(R>L.length-1){v.trigger(o.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+R});return}return D=(l[m+2]&1)<<2,D|=(l[m+3]&192)>>>6,a.logger.log("manifest codec:"+E+", ADTS type:"+S+", samplingIndex:"+R),/firefox/i.test(A)?R>=6?(S=5,P=new Array(4),O=R-3):(S=2,P=new Array(2),O=R):A.indexOf("android")!==-1?(S=2,P=new Array(2),O=R):(S=5,P=new Array(4),E&&(E.indexOf("mp4a.40.29")!==-1||E.indexOf("mp4a.40.5")!==-1)||!E&&R>=6?O=R-3:((E&&E.indexOf("mp4a.40.2")!==-1&&(R>=6&&D===1||/vivaldi/i.test(A))||!E&&D===1)&&(S=2,P=new Array(2)),O=R)),P[0]=S<<3,P[0]|=(R&14)>>1,P[1]|=(R&1)<<7,P[1]|=D<<3,S===5&&(P[1]|=(O&14)>>1,P[2]=(O&1)<<7,P[2]|=2<<2,P[3]=0),{config:P,samplerate:L[R],channelCount:D,codec:"mp4a.40."+S,manifestCodec:w}}function x(v,l){return v[l]===255&&(v[l+1]&246)==240}function g(v,l){return v[l+1]&1?7:9}function d(v,l){return(v[l+3]&3)<<11|v[l+4]<<3|(v[l+5]&224)>>>5}function h(v,l){return l+5<v.length}function y(v,l){return l+1<v.length&&x(v,l)}function b(v,l){return h(v,l)&&x(v,l)&&d(v,l)<=v.length-l}function T(v,l){if(y(v,l)){var m=g(v,l);if(l+m>=v.length)return!1;var E=d(v,l);if(E<=m)return!1;var S=l+E;return S===v.length||y(v,S)}return!1}function _(v,l,m,E,S){if(!v.samplerate){var O=p(l,m,E,S);if(!O)return;v.config=O.config,v.samplerate=O.samplerate,v.channelCount=O.channelCount,v.codec=O.codec,v.manifestCodec=O.manifestCodec,a.logger.log("parsed codec:"+v.codec+", rate:"+O.samplerate+", channels:"+O.channelCount)}}function c(v){return 1024*9e4/v}function u(v,l,m,E,S){var O=g(v,l),D=d(v,l);if(D-=O,D>0){var P=m+E*S;return{headerLength:O,frameLength:D,stamp:P}}}function f(v,l,m,E,S){var O=c(v.samplerate),D=u(l,m,E,S,O);if(D){var P=D.frameLength,A=D.headerLength,w=D.stamp,L=A+P,R=Math.max(0,m+L-l.length),C;R?(C=new Uint8Array(L-A),C.set(l.subarray(m+A,l.length),0)):C=l.subarray(m+A,m+L);var M={unit:C,pts:w};return R||v.samples.push(M),{sample:M,length:L,missing:R}}}},"./src/demux/base-audio-demuxer.ts":function(r,n,t){t.r(n),t.d(n,"initPTSFn",function(){return d});var a=t("./src/polyfills/number.ts"),s=t("./src/demux/id3.ts"),o=t("./src/demux/dummy-demuxed-track.ts"),p=t("./src/utils/mp4-tools.ts"),x=t("./src/utils/typed-array.ts"),g=function(){function h(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var y=h.prototype;return y.resetInitSegment=function(T,_,c){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},y.resetTimeStamp=function(){},y.resetContiguity=function(){},y.canParse=function(T,_){return!1},y.appendFrame=function(T,_,c){},y.demux=function(T,_){this.cachedData&&(T=Object(p.appendUint8Array)(this.cachedData,T),this.cachedData=null);var c=s.getID3Data(T,0),u=c?c.length:0,f,v,l=this._audioTrack,m=this._id3Track,E=c?s.getTimeStamp(c):void 0,S=T.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=d(E,_)),c&&c.length>0&&m.samples.push({pts:this.initPTS,dts:this.initPTS,data:c}),v=this.initPTS;u<S;){if(this.canParse(T,u)){var O=this.appendFrame(l,T,u);O?(this.frameIndex++,v=O.sample.pts,u+=O.length,f=u):u=S}else s.canParse(T,u)?(c=s.getID3Data(T,u),m.samples.push({pts:v,dts:v,data:c}),u+=c.length,f=u):u++;if(u===S&&f!==S){var D=Object(x.sliceUint8)(T,f);this.cachedData?this.cachedData=Object(p.appendUint8Array)(this.cachedData,D):this.cachedData=D}}return{audioTrack:l,avcTrack:Object(o.dummyTrack)(),id3Track:m,textTrack:Object(o.dummyTrack)()}},y.demuxSampleAes=function(T,_,c){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},y.flush=function(T){var _=this.cachedData;return _&&(this.cachedData=null,this.demux(_,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(o.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(o.dummyTrack)()}},y.destroy=function(){},h}(),d=function(y,b){return Object(a.isFiniteNumber)(y)?y*90:b*9e4};n.default=g},"./src/demux/chunk-cache.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return a});var a=function(){function o(){this.chunks=[],this.dataLength=0}var p=o.prototype;return p.push=function(g){this.chunks.push(g),this.dataLength+=g.length},p.flush=function(){var g=this.chunks,d=this.dataLength,h;if(g.length)g.length===1?h=g[0]:h=s(g,d);else return new Uint8Array(0);return this.reset(),h},p.reset=function(){this.chunks.length=0,this.dataLength=0},o}();function s(o,p){for(var x=new Uint8Array(p),g=0,d=0;d<o.length;d++){var h=o[d];x.set(h,g),g+=h.length}return x}},"./src/demux/dummy-demuxed-track.ts":function(r,n,t){t.r(n),t.d(n,"dummyTrack",function(){return a});function a(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(r,n,t){t.r(n);var a=t("./src/utils/logger.ts"),s=function(){function o(x){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=x,this.bytesAvailable=x.byteLength,this.word=0,this.bitsAvailable=0}var p=o.prototype;return p.loadWord=function(){var g=this.data,d=this.bytesAvailable,h=g.byteLength-d,y=new Uint8Array(4),b=Math.min(4,d);if(b===0)throw new Error("no bytes available");y.set(g.subarray(h,h+b)),this.word=new DataView(y.buffer).getUint32(0),this.bitsAvailable=b*8,this.bytesAvailable-=b},p.skipBits=function(g){var d;this.bitsAvailable>g?(this.word<<=g,this.bitsAvailable-=g):(g-=this.bitsAvailable,d=g>>3,g-=d>>3,this.bytesAvailable-=d,this.loadWord(),this.word<<=g,this.bitsAvailable-=g)},p.readBits=function(g){var d=Math.min(this.bitsAvailable,g),h=this.word>>>32-d;return g>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=d,this.bitsAvailable>0?this.word<<=d:this.bytesAvailable>0&&this.loadWord(),d=g-d,d>0&&this.bitsAvailable?h<<d|this.readBits(d):h},p.skipLZ=function(){var g;for(g=0;g<this.bitsAvailable;++g)if((this.word&2147483648>>>g)!=0)return this.word<<=g,this.bitsAvailable-=g,g;return this.loadWord(),g+this.skipLZ()},p.skipUEG=function(){this.skipBits(1+this.skipLZ())},p.skipEG=function(){this.skipBits(1+this.skipLZ())},p.readUEG=function(){var g=this.skipLZ();return this.readBits(g+1)-1},p.readEG=function(){var g=this.readUEG();return 1&g?1+g>>>1:-1*(g>>>1)},p.readBoolean=function(){return this.readBits(1)===1},p.readUByte=function(){return this.readBits(8)},p.readUShort=function(){return this.readBits(16)},p.readUInt=function(){return this.readBits(32)},p.skipScalingList=function(g){for(var d=8,h=8,y,b=0;b<g;b++)h!==0&&(y=this.readEG(),h=(d+y+256)%256),d=h===0?d:h},p.readSPS=function(){var g=0,d=0,h=0,y=0,b,T,_,c=this.readUByte.bind(this),u=this.readBits.bind(this),f=this.readUEG.bind(this),v=this.readBoolean.bind(this),l=this.skipBits.bind(this),m=this.skipEG.bind(this),E=this.skipUEG.bind(this),S=this.skipScalingList.bind(this);c();var O=c();if(u(5),l(3),c(),E(),O===100||O===110||O===122||O===244||O===44||O===83||O===86||O===118||O===128){var D=f();if(D===3&&l(1),E(),E(),l(1),v())for(T=D!==3?8:12,_=0;_<T;_++)v()&&(_<6?S(16):S(64))}E();var P=f();if(P===0)f();else if(P===1)for(l(1),m(),m(),b=f(),_=0;_<b;_++)m();E(),l(1);var A=f(),w=f(),L=u(1);L===0&&l(1),l(1),v()&&(g=f(),d=f(),h=f(),y=f());var R=[1,1];if(v()&&v()){var C=c();switch(C){case 1:R=[1,1];break;case 2:R=[12,11];break;case 3:R=[10,11];break;case 4:R=[16,11];break;case 5:R=[40,33];break;case 6:R=[24,11];break;case 7:R=[20,11];break;case 8:R=[32,11];break;case 9:R=[80,33];break;case 10:R=[18,11];break;case 11:R=[15,11];break;case 12:R=[64,33];break;case 13:R=[160,99];break;case 14:R=[4,3];break;case 15:R=[3,2];break;case 16:R=[2,1];break;case 255:{R=[c()<<8|c(),c()<<8|c()];break}}}return{width:Math.ceil((A+1)*16-g*2-d*2),height:(2-L)*(w+1)*16-(L?2:4)*(h+y),pixelRatio:R}},p.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},o}();n.default=s},"./src/demux/id3.ts":function(r,n,t){t.r(n),t.d(n,"isHeader",function(){return a}),t.d(n,"isFooter",function(){return s}),t.d(n,"getID3Data",function(){return o}),t.d(n,"canParse",function(){return x}),t.d(n,"getTimeStamp",function(){return g}),t.d(n,"isTimeStampFrame",function(){return d}),t.d(n,"getID3Frames",function(){return y}),t.d(n,"decodeFrame",function(){return b}),t.d(n,"utf8ArrayToStr",function(){return f}),t.d(n,"testables",function(){return v});var a=function(S,O){return O+10<=S.length&&S[O]===73&&S[O+1]===68&&S[O+2]===51&&S[O+3]<255&&S[O+4]<255&&S[O+6]<128&&S[O+7]<128&&S[O+8]<128&&S[O+9]<128},s=function(S,O){return O+10<=S.length&&S[O]===51&&S[O+1]===68&&S[O+2]===73&&S[O+3]<255&&S[O+4]<255&&S[O+6]<128&&S[O+7]<128&&S[O+8]<128&&S[O+9]<128},o=function(S,O){for(var D=O,P=0;a(S,O);){P+=10;var A=p(S,O+6);P+=A,s(S,O+10)&&(P+=10),O+=P}if(P>0)return S.subarray(D,D+P)},p=function(S,O){var D=0;return D=(S[O]&127)<<21,D|=(S[O+1]&127)<<14,D|=(S[O+2]&127)<<7,D|=S[O+3]&127,D},x=function(S,O){return a(S,O)&&p(S,O+6)+10<=S.length-O},g=function(S){for(var O=y(S),D=0;D<O.length;D++){var P=O[D];if(d(P))return u(P)}},d=function(S){return S&&S.key==="PRIV"&&S.info==="com.apple.streaming.transportStreamTimestamp"},h=function(S){var O=String.fromCharCode(S[0],S[1],S[2],S[3]),D=p(S,4),P=10;return{type:O,size:D,data:S.subarray(P,P+D)}},y=function(S){for(var O=0,D=[];a(S,O);){var P=p(S,O+6);O+=10;for(var A=O+P;O+8<A;){var w=h(S.subarray(O)),L=b(w);L&&D.push(L),O+=w.size+10}s(S,O)&&(O+=10)}return D},b=function(S){return S.type==="PRIV"?T(S):S.type[0]==="W"?c(S):_(S)},T=function(S){if(!(S.size<2)){var O=f(S.data,!0),D=new Uint8Array(S.data.subarray(O.length+1));return{key:S.type,info:O,data:D.buffer}}},_=function(S){if(!(S.size<2)){if(S.type==="TXXX"){var O=1,D=f(S.data.subarray(O),!0);O+=D.length+1;var P=f(S.data.subarray(O));return{key:S.type,info:D,data:P}}var A=f(S.data.subarray(1));return{key:S.type,data:A}}},c=function(S){if(S.type==="WXXX"){if(S.size<2)return;var O=1,D=f(S.data.subarray(O),!0);O+=D.length+1;var P=f(S.data.subarray(O));return{key:S.type,info:D,data:P}}var A=f(S.data);return{key:S.type,data:A}},u=function(S){if(S.data.byteLength===8){var O=new Uint8Array(S.data),D=O[3]&1,P=(O[4]<<23)+(O[5]<<15)+(O[6]<<7)+O[7];return P/=45,D&&(P+=4772185884e-2),Math.round(P)}},f=function(S,O){O===void 0&&(O=!1);var D=m();if(D){var P=D.decode(S);if(O){var A=P.indexOf("\0");return A!==-1?P.substring(0,A):P}return P.replace(/\0/g,"")}for(var w=S.length,L,R,C,M="",N=0;N<w;){if(L=S[N++],L===0&&O)return M;if(L===0||L===3)continue;switch(L>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:M+=String.fromCharCode(L);break;case 12:case 13:R=S[N++],M+=String.fromCharCode((L&31)<<6|R&63);break;case 14:R=S[N++],C=S[N++],M+=String.fromCharCode((L&15)<<12|(R&63)<<6|(C&63)<<0);break}}return M},v={decodeTextFrame:_},l;function m(){return!l&&typeof self.TextDecoder!="undefined"&&(l=new self.TextDecoder("utf-8")),l}},"./src/demux/mp3demuxer.ts":function(r,n,t){t.r(n);var a=t("./src/demux/base-audio-demuxer.ts"),s=t("./src/demux/id3.ts"),o=t("./src/utils/logger.ts"),p=t("./src/demux/mpegaudio.ts");function x(h,y){h.prototype=Object.create(y.prototype),h.prototype.constructor=h,g(h,y)}function g(h,y){return g=Object.setPrototypeOf||function(T,_){return T.__proto__=_,T},g(h,y)}var d=function(h){x(y,h);function y(){return h.apply(this,arguments)||this}var b=y.prototype;return b.resetInitSegment=function(_,c,u){h.prototype.resetInitSegment.call(this,_,c,u),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:_,duration:u,inputTimeScale:9e4,dropped:0}},y.probe=function(_){if(!_)return!1;for(var c=s.getID3Data(_,0)||[],u=c.length,f=_.length;u<f;u++)if(p.probe(_,u))return o.logger.log("MPEG Audio sync word found !"),!0;return!1},b.canParse=function(_,c){return p.canParse(_,c)},b.appendFrame=function(_,c,u){if(this.initPTS!==null)return p.appendFrame(_,c,u,this.initPTS,this.frameIndex)},y}(a.default);d.minProbeByteLength=4,n.default=d},"./src/demux/mp4demuxer.ts":function(r,n,t){t.r(n);var a=t("./src/utils/mp4-tools.ts"),s=t("./src/demux/dummy-demuxed-track.ts"),o=function(){function p(g,d){this.remainderData=null,this.config=void 0,this.config=d}var x=p.prototype;return x.resetTimeStamp=function(){},x.resetInitSegment=function(){},x.resetContiguity=function(){},p.probe=function(d){return Object(a.findBox)({data:d,start:0,end:Math.min(d.length,16384)},["moof"]).length>0},x.demux=function(d){var h=d,y=Object(s.dummyTrack)();if(this.config.progressive){this.remainderData&&(h=Object(a.appendUint8Array)(this.remainderData,d));var b=Object(a.segmentValidRange)(h);this.remainderData=b.remainder,y.samples=b.valid||new Uint8Array}else y.samples=h;return{audioTrack:Object(s.dummyTrack)(),avcTrack:y,id3Track:Object(s.dummyTrack)(),textTrack:Object(s.dummyTrack)()}},x.flush=function(){var d=Object(s.dummyTrack)();return d.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(s.dummyTrack)(),avcTrack:d,id3Track:Object(s.dummyTrack)(),textTrack:Object(s.dummyTrack)()}},x.demuxSampleAes=function(d,h,y){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},x.destroy=function(){},p}();o.minProbeByteLength=1024,n.default=o},"./src/demux/mpegaudio.ts":function(r,n,t){t.r(n),t.d(n,"appendFrame",function(){return g}),t.d(n,"parseHeader",function(){return d}),t.d(n,"isHeaderPattern",function(){return h}),t.d(n,"isHeader",function(){return y}),t.d(n,"canParse",function(){return b}),t.d(n,"probe",function(){return T});var a=null,s=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],p=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],x=[0,1,1,4];function g(_,c,u,f,v){if(!(u+24>c.length)){var l=d(c,u);if(l&&u+l.frameLength<=c.length){var m=l.samplesPerFrame*9e4/l.sampleRate,E=f+v*m,S={unit:c.subarray(u,u+l.frameLength),pts:E,dts:E};return _.config=[],_.channelCount=l.channelCount,_.samplerate=l.sampleRate,_.samples.push(S),{sample:S,length:l.frameLength,missing:0}}}}function d(_,c){var u=_[c+1]>>3&3,f=_[c+1]>>1&3,v=_[c+2]>>4&15,l=_[c+2]>>2&3;if(u!==1&&v!==0&&v!==15&&l!==3){var m=_[c+2]>>1&1,E=_[c+3]>>6,S=u===3?3-f:f===3?3:4,O=s[S*14+v-1]*1e3,D=u===3?0:u===2?1:2,P=o[D*3+l],A=E===3?1:2,w=p[u][f],L=x[f],R=w*8*L,C=Math.floor(w*O/P+m)*L;if(a===null){var M=navigator.userAgent||"",N=M.match(/Chrome\/(\d+)/i);a=N?parseInt(N[1]):0}var U=!!a&&a<=87;return U&&f===2&&O>=224e3&&E===0&&(_[c+3]=_[c+3]|128),{sampleRate:P,channelCount:A,frameLength:C,samplesPerFrame:R}}}function h(_,c){return _[c]===255&&(_[c+1]&224)==224&&(_[c+1]&6)!=0}function y(_,c){return c+1<_.length&&h(_,c)}function b(_,c){var u=4;return h(_,c)&&u<=_.length-c}function T(_,c){if(c+1<_.length&&h(_,c)){var u=4,f=d(_,c),v=u;f!=null&&f.frameLength&&(v=f.frameLength);var l=c+v;return l===_.length||y(_,l)}return!1}},"./src/demux/sample-aes.ts":function(r,n,t){t.r(n);var a=t("./src/crypt/decrypter.ts"),s=t("./src/demux/tsdemuxer.ts"),o=function(){function p(g,d,h){this.keyData=void 0,this.decrypter=void 0,this.keyData=h,this.decrypter=new a.default(g,d,{removePKCS7Padding:!1})}var x=p.prototype;return x.decryptBuffer=function(d,h){this.decrypter.decrypt(d,this.keyData.key.buffer,this.keyData.iv.buffer,h)},x.decryptAacSample=function(d,h,y,b){var T=d[h].unit,_=T.subarray(16,T.length-T.length%16),c=_.buffer.slice(_.byteOffset,_.byteOffset+_.length),u=this;this.decryptBuffer(c,function(f){var v=new Uint8Array(f);T.set(v,16),b||u.decryptAacSamples(d,h+1,y)})},x.decryptAacSamples=function(d,h,y){for(;;h++){if(h>=d.length){y();return}if(!(d[h].unit.length<32)){var b=this.decrypter.isSync();if(this.decryptAacSample(d,h,y,b),!b)return}}},x.getAvcEncryptedData=function(d){for(var h=Math.floor((d.length-48)/160)*16+16,y=new Int8Array(h),b=0,T=32;T<d.length-16;T+=160,b+=16)y.set(d.subarray(T,T+16),b);return y},x.getAvcDecryptedUnit=function(d,h){for(var y=new Uint8Array(h),b=0,T=32;T<d.length-16;T+=160,b+=16)d.set(y.subarray(b,b+16),T);return d},x.decryptAvcSample=function(d,h,y,b,T,_){var c=Object(s.discardEPB)(T.data),u=this.getAvcEncryptedData(c),f=this;this.decryptBuffer(u.buffer,function(v){T.data=f.getAvcDecryptedUnit(c,v),_||f.decryptAvcSamples(d,h,y+1,b)})},x.decryptAvcSamples=function(d,h,y,b){if(d instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;h++,y=0){if(h>=d.length){b();return}for(var T=d[h].units;!(y>=T.length);y++){var _=T[y];if(!(_.data.length<=48||_.type!==1&&_.type!==5)){var c=this.decrypter.isSync();if(this.decryptAvcSample(d,h,y,b,_,c),!c)return}}}},p}();n.default=o},"./src/demux/transmuxer-interface.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return y});var a=t("./node_modules/webworkify-webpack/index.js"),s=t("./src/events.ts"),o=t("./src/demux/transmuxer.ts"),p=t("./src/utils/logger.ts"),x=t("./src/errors.ts"),g=t("./src/utils/mediasource-helper.ts"),d=t("./node_modules/eventemitter3/index.js"),h=Object(g.getMediaSource)()||{isTypeSupported:function(){return!1}},y=function(){function b(_,c,u,f){var v=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=_,this.id=c,this.onTransmuxComplete=u,this.onFlush=f;var l=_.config,m=function(P,A){A=A||{},A.frag=v.frag,A.id=v.id,_.trigger(P,A)};this.observer=new d.EventEmitter,this.observer.on(s.Events.FRAG_DECRYPTED,m),this.observer.on(s.Events.ERROR,m);var E={mp4:h.isTypeSupported("video/mp4"),mpeg:h.isTypeSupported("audio/mpeg"),mp3:h.isTypeSupported('audio/mp4; codecs="mp3"')},S=navigator.vendor;if(l.enableWorker&&typeof Worker!="undefined"){p.logger.log("demuxing in webworker");var O;try{O=this.worker=a("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),O.addEventListener("message",this.onwmsg),O.onerror=function(D){_.trigger(s.Events.ERROR,{type:x.ErrorTypes.OTHER_ERROR,details:x.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(D.message+"  ("+D.filename+":"+D.lineno+")")})},O.postMessage({cmd:"init",typeSupported:E,vendor:S,id:c,config:JSON.stringify(l)})}catch(D){p.logger.warn("Error in worker:",D),p.logger.error("Error while initializing DemuxerWorker, fallback to inline"),O&&self.URL.revokeObjectURL(O.objectURL),this.transmuxer=new o.default(this.observer,E,l,S,c),this.worker=null}}else this.transmuxer=new o.default(this.observer,E,l,S,c)}var T=b.prototype;return T.destroy=function(){var c=this.worker;if(c)c.removeEventListener("message",this.onwmsg),c.terminate(),this.worker=null;else{var u=this.transmuxer;u&&(u.destroy(),this.transmuxer=null)}var f=this.observer;f&&f.removeAllListeners(),this.observer=null},T.push=function(c,u,f,v,l,m,E,S,O,D){var P,A,w=this;O.transmuxing.start=self.performance.now();var L=this.transmuxer,R=this.worker,C=m?m.start:l.start,M=l.decryptdata,N=this.frag,U=!(N&&l.cc===N.cc),K=!(N&&O.level===N.level),V=N?O.sn-N.sn:-1,W=this.part?O.part-this.part.index:1,G=!K&&(V===1||V===0&&W===1),Y=self.performance.now();(K||V||l.stats.parsing.start===0)&&(l.stats.parsing.start=Y),m&&(W||!G)&&(m.stats.parsing.start=Y);var q=!(N&&((P=l.initSegment)===null||P===void 0?void 0:P.url)===((A=N.initSegment)===null||A===void 0?void 0:A.url)),ee=new o.TransmuxState(U,G,S,K,C,q);if(!G||U||q){p.logger.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+O.sn+" p: "+O.part+" level: "+O.level+" id: "+O.id+`
        discontinuity: `+U+`
        trackSwitch: `+K+`
        contiguous: `+G+`
        accurateTimeOffset: `+S+`
        timeOffset: `+C+`
        initSegmentChange: `+q);var re=new o.TransmuxConfig(f,v,u,E,D);this.configureTransmuxer(re)}if(this.frag=l,this.part=m,R)R.postMessage({cmd:"demux",data:c,decryptdata:M,chunkMeta:O,state:ee},c instanceof ArrayBuffer?[c]:[]);else if(L){var pe=L.push(c,M,O,ee);Object(o.isPromise)(pe)?pe.then(function(Le){w.handleTransmuxComplete(Le)}):this.handleTransmuxComplete(pe)}},T.flush=function(c){var u=this;c.transmuxing.start=self.performance.now();var f=this.transmuxer,v=this.worker;if(v)v.postMessage({cmd:"flush",chunkMeta:c});else if(f){var l=f.flush(c);Object(o.isPromise)(l)?l.then(function(m){u.handleFlushResult(m,c)}):this.handleFlushResult(l,c)}},T.handleFlushResult=function(c,u){var f=this;c.forEach(function(v){f.handleTransmuxComplete(v)}),this.onFlush(u)},T.onWorkerMessage=function(c){var u=c.data,f=this.hls;switch(u.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.id=this.id,f.trigger(u.event,u.data);break}}},T.configureTransmuxer=function(c){var u=this.worker,f=this.transmuxer;u?u.postMessage({cmd:"configure",config:c}):f&&f.configure(c)},T.handleTransmuxComplete=function(c){c.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(c)},b}()},"./src/demux/transmuxer-worker.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return x});var a=t("./src/demux/transmuxer.ts"),s=t("./src/events.ts"),o=t("./src/utils/logger.ts"),p=t("./node_modules/eventemitter3/index.js");function x(b){var T=new p.EventEmitter,_=function(u,f){b.postMessage({event:u,data:f})};T.on(s.Events.FRAG_DECRYPTED,_),T.on(s.Events.ERROR,_),b.addEventListener("message",function(c){var u=c.data;switch(u.cmd){case"init":{var f=JSON.parse(u.config);b.transmuxer=new a.default(T,u.typeSupported,f,u.vendor,u.id),Object(o.enableLogs)(f.debug),_("init",null);break}case"configure":{b.transmuxer.configure(u.config);break}case"demux":{var v=b.transmuxer.push(u.data,u.decryptdata,u.chunkMeta,u.state);Object(a.isPromise)(v)?v.then(function(E){g(b,E)}):g(b,v);break}case"flush":{var l=u.chunkMeta,m=b.transmuxer.flush(l);Object(a.isPromise)(m)?m.then(function(E){h(b,E,l)}):h(b,m,l);break}}})}function g(b,T){if(!y(T.remuxResult)){var _=[],c=T.remuxResult,u=c.audio,f=c.video;u&&d(_,u),f&&d(_,f),b.postMessage({event:"transmuxComplete",data:T},_)}}function d(b,T){T.data1&&b.push(T.data1.buffer),T.data2&&b.push(T.data2.buffer)}function h(b,T,_){T.forEach(function(c){g(b,c)}),b.postMessage({event:"flush",data:_})}function y(b){return!b.audio&&!b.video&&!b.text&&!b.id3&&!b.initSegment}},"./src/demux/transmuxer.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return v}),t.d(n,"isPromise",function(){return E}),t.d(n,"TransmuxConfig",function(){return S}),t.d(n,"TransmuxState",function(){return O});var a=t("./src/events.ts"),s=t("./src/errors.ts"),o=t("./src/crypt/decrypter.ts"),p=t("./src/demux/aacdemuxer.ts"),x=t("./src/demux/mp4demuxer.ts"),g=t("./src/demux/tsdemuxer.ts"),d=t("./src/demux/mp3demuxer.ts"),h=t("./src/remux/mp4-remuxer.ts"),y=t("./src/remux/passthrough-remuxer.ts"),b=t("./src/demux/chunk-cache.ts"),T=t("./src/utils/mp4-tools.ts"),_=t("./src/utils/logger.ts"),c;try{c=self.performance.now.bind(self.performance)}catch(D){_.logger.debug("Unable to use Performance API on this environment"),c=self.Date.now}var u=[{demux:g.default,remux:h.default},{demux:x.default,remux:y.default},{demux:p.default,remux:h.default},{demux:d.default,remux:h.default}],f=1024;u.forEach(function(D){var P=D.demux;f=Math.max(f,P.minProbeByteLength)});var v=function(){function D(A,w,L,R,C){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new b.default,this.observer=A,this.typeSupported=w,this.config=L,this.vendor=R,this.id=C}var P=D.prototype;return P.configure=function(w){this.transmuxConfig=w,this.decrypter&&this.decrypter.reset()},P.push=function(w,L,R,C){var M=this,N=R.transmuxing;N.executeStart=c();var U=new Uint8Array(w),K=this.cache,V=this.config,W=this.currentTransmuxState,G=this.transmuxConfig;C&&(this.currentTransmuxState=C);var Y=l(U,L);if(Y&&Y.method==="AES-128"){var q=this.getDecrypter();if(V.enableSoftwareAES){var ee=q.softwareDecrypt(U,Y.key.buffer,Y.iv.buffer);if(!ee)return N.executeEnd=c(),m(R);U=new Uint8Array(ee)}else return this.decryptionPromise=q.webCryptoDecrypt(U,Y.key.buffer,Y.iv.buffer).then(function(He){var rt=M.push(He,null,R);return M.decryptionPromise=null,rt}),this.decryptionPromise}var re=C||W,pe=re.contiguous,Le=re.discontinuity,Te=re.trackSwitch,be=re.accurateTimeOffset,Re=re.timeOffset,Se=re.initSegmentChange,Ge=G.audioCodec,$e=G.videoCodec,st=G.defaultInitPts,Ze=G.duration,et=G.initSegmentData;if((Le||Te||Se)&&this.resetInitSegment(et,Ge,$e,Ze),(Le||Se)&&this.resetInitialTimestamp(st),pe||this.resetContiguity(),this.needsProbing(U,Le,Te)){if(K.dataLength){var ft=K.flush();U=Object(T.appendUint8Array)(ft,U)}this.configureTransmuxer(U,G)}var dt=this.transmux(U,Y,Re,be,R),ht=this.currentTransmuxState;return ht.contiguous=!0,ht.discontinuity=!1,ht.trackSwitch=!1,N.executeEnd=c(),dt},P.flush=function(w){var L=this,R=w.transmuxing;R.executeStart=c();var C=this.decrypter,M=this.cache,N=this.currentTransmuxState,U=this.decryptionPromise;if(U)return U.then(function(){return L.flush(w)});var K=[],V=N.timeOffset;if(C){var W=C.flush();W&&K.push(this.push(W,null,w))}var G=M.dataLength;M.reset();var Y=this.demuxer,q=this.remuxer;if(!Y||!q)return G>=f&&this.observer.emit(a.Events.ERROR,a.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),R.executeEnd=c(),[m(w)];var ee=Y.flush(V);return E(ee)?ee.then(function(re){return L.flushRemux(K,re,w),K}):(this.flushRemux(K,ee,w),K)},P.flushRemux=function(w,L,R){var C=L.audioTrack,M=L.avcTrack,N=L.id3Track,U=L.textTrack,K=this.currentTransmuxState,V=K.accurateTimeOffset,W=K.timeOffset;_.logger.log("[transmuxer.ts]: Flushed fragment "+R.sn+(R.part>-1?" p: "+R.part:"")+" of level "+R.level);var G=this.remuxer.remux(C,M,N,U,W,V,!0,this.id);w.push({remuxResult:G,chunkMeta:R}),R.transmuxing.executeEnd=c()},P.resetInitialTimestamp=function(w){var L=this.demuxer,R=this.remuxer;!L||!R||(L.resetTimeStamp(w),R.resetTimeStamp(w))},P.resetContiguity=function(){var w=this.demuxer,L=this.remuxer;!w||!L||(w.resetContiguity(),L.resetNextTimestamp())},P.resetInitSegment=function(w,L,R,C){var M=this.demuxer,N=this.remuxer;!M||!N||(M.resetInitSegment(L,R,C),N.resetInitSegment(w,L,R))},P.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},P.transmux=function(w,L,R,C,M){var N;return L&&L.method==="SAMPLE-AES"?N=this.transmuxSampleAes(w,L,R,C,M):N=this.transmuxUnencrypted(w,R,C,M),N},P.transmuxUnencrypted=function(w,L,R,C){var M=this.demuxer.demux(w,L,!1,!this.config.progressive),N=M.audioTrack,U=M.avcTrack,K=M.id3Track,V=M.textTrack,W=this.remuxer.remux(N,U,K,V,L,R,!1,this.id);return{remuxResult:W,chunkMeta:C}},P.transmuxSampleAes=function(w,L,R,C,M){var N=this;return this.demuxer.demuxSampleAes(w,L,R).then(function(U){var K=N.remuxer.remux(U.audioTrack,U.avcTrack,U.id3Track,U.textTrack,R,C,!1,N.id);return{remuxResult:K,chunkMeta:M}})},P.configureTransmuxer=function(w,L){for(var R=this.config,C=this.observer,M=this.typeSupported,N=this.vendor,U=L.audioCodec,K=L.defaultInitPts,V=L.duration,W=L.initSegmentData,G=L.videoCodec,Y,q=0,ee=u.length;q<ee;q++)if(u[q].demux.probe(w)){Y=u[q];break}Y||(_.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),Y={demux:x.default,remux:y.default});var re=this.demuxer,pe=this.remuxer,Le=Y.remux,Te=Y.demux;(!pe||!(pe instanceof Le))&&(this.remuxer=new Le(C,R,M,N)),(!re||!(re instanceof Te))&&(this.demuxer=new Te(C,R,M),this.probe=Te.probe),this.resetInitSegment(W,U,G,V),this.resetInitialTimestamp(K)},P.needsProbing=function(w,L,R){return!this.demuxer||!this.remuxer||L||R},P.getDecrypter=function(){var w=this.decrypter;return w||(w=this.decrypter=new o.default(this.observer,this.config)),w},D}();function l(D,P){var A=null;return D.byteLength>0&&P!=null&&P.key!=null&&P.iv!==null&&P.method!=null&&(A=P),A}var m=function(P){return{remuxResult:{},chunkMeta:P}};function E(D){return"then"in D&&D.then instanceof Function}var S=function(P,A,w,L,R){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=P,this.videoCodec=A,this.initSegmentData=w,this.duration=L,this.defaultInitPts=R},O=function(P,A,w,L,R,C){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=P,this.contiguous=A,this.accurateTimeOffset=w,this.trackSwitch=L,this.timeOffset=R,this.initSegmentChange=C}},"./src/demux/tsdemuxer.ts":function(r,n,t){t.r(n),t.d(n,"discardEPB",function(){return m});var a=t("./src/demux/adts.ts"),s=t("./src/demux/mpegaudio.ts"),o=t("./src/demux/exp-golomb.ts"),p=t("./src/demux/id3.ts"),x=t("./src/demux/sample-aes.ts"),g=t("./src/events.ts"),d=t("./src/utils/mp4-tools.ts"),h=t("./src/utils/logger.ts"),y=t("./src/errors.ts"),b={video:1,audio:2,id3:3,text:4},T=function(){function E(O,D,P){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=O,this.config=D,this.typeSupported=P}E.probe=function(D){var P=E.syncOffset(D);return P<0?!1:(P&&h.logger.warn("MPEG2-TS detected but first sync word found @ offset "+P+", junk ahead ?"),!0)},E.syncOffset=function(D){for(var P=Math.min(1e3,D.length-3*188),A=0;A<P;){if(D[A]===71&&D[A+188]===71&&D[A+2*188]===71)return A;A++}return-1},E.createTrack=function(D,P){return{container:D==="video"||D==="audio"?"video/mp2t":void 0,type:D,id:b[D],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:D==="audio"?P:void 0}};var S=E.prototype;return S.resetInitSegment=function(D,P,A){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=E.createTrack("video",A),this._audioTrack=E.createTrack("audio",A),this._id3Track=E.createTrack("id3",A),this._txtTrack=E.createTrack("text",A),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=D,this.videoCodec=P,this._duration=A},S.resetTimeStamp=function(){},S.resetContiguity=function(){var D=this._audioTrack,P=this._avcTrack,A=this._id3Track;D&&(D.pesData=null),P&&(P.pesData=null),A&&(A.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},S.demux=function(D,P,A,w){A===void 0&&(A=!1),w===void 0&&(w=!1),A||(this.sampleAes=null);var L,R=this._avcTrack,C=this._audioTrack,M=this._id3Track,N=R.pid,U=R.pesData,K=C.pid,V=M.pid,W=C.pesData,G=M.pesData,Y=!1,q=this.pmtParsed,ee=this._pmtId,re=D.length;if(this.remainderData&&(D=Object(d.appendUint8Array)(this.remainderData,D),re=D.length,this.remainderData=null),re<188&&!w)return this.remainderData=D,{audioTrack:C,avcTrack:R,id3Track:M,textTrack:this._txtTrack};var pe=Math.max(0,E.syncOffset(D));re-=(re+pe)%188,re<D.byteLength&&!w&&(this.remainderData=new Uint8Array(D.buffer,re,D.buffer.byteLength-re));for(var Le=0,Te=pe;Te<re;Te+=188)if(D[Te]===71){var be=!!(D[Te+1]&64),Re=((D[Te+1]&31)<<8)+D[Te+2],Se=(D[Te+3]&48)>>4,Ge=void 0;if(Se>1){if(Ge=Te+5+D[Te+4],Ge===Te+188)continue}else Ge=Te+4;switch(Re){case N:be&&(U&&(L=f(U))&&this.parseAVCPES(L,!1),U={data:[],size:0}),U&&(U.data.push(D.subarray(Ge,Te+188)),U.size+=Te+188-Ge);break;case K:be&&(W&&(L=f(W))&&(C.isAAC?this.parseAACPES(L):this.parseMPEGPES(L)),W={data:[],size:0}),W&&(W.data.push(D.subarray(Ge,Te+188)),W.size+=Te+188-Ge);break;case V:be&&(G&&(L=f(G))&&this.parseID3PES(L),G={data:[],size:0}),G&&(G.data.push(D.subarray(Ge,Te+188)),G.size+=Te+188-Ge);break;case 0:be&&(Ge+=D[Ge]+1),ee=this._pmtId=c(D,Ge);break;case ee:{be&&(Ge+=D[Ge]+1);var $e=u(D,Ge,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,A);N=$e.avc,N>0&&(R.pid=N),K=$e.audio,K>0&&(C.pid=K,C.isAAC=$e.isAAC),V=$e.id3,V>0&&(M.pid=V),Y&&!q&&(h.logger.log("reparse from beginning"),Y=!1,Te=pe-188),q=this.pmtParsed=!0;break}case 17:case 8191:break;default:Y=!0;break}}else Le++;Le>0&&this.observer.emit(g.Events.ERROR,g.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Le+" TS packet/s that do not start with 0x47"}),R.pesData=U,C.pesData=W,M.pesData=G;var st={audioTrack:C,avcTrack:R,id3Track:M,textTrack:this._txtTrack};return w&&this.extractRemainingSamples(st),st},S.flush=function(){var D=this.remainderData;this.remainderData=null;var P;return D?P=this.demux(D,-1,!1,!0):P={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(P),this.sampleAes?this.decrypt(P,this.sampleAes):P},S.extractRemainingSamples=function(D){var P=D.audioTrack,A=D.avcTrack,w=D.id3Track,L=A.pesData,R=P.pesData,C=w.pesData,M;L&&(M=f(L))?(this.parseAVCPES(M,!0),A.pesData=null):A.pesData=L,R&&(M=f(R))?(P.isAAC?this.parseAACPES(M):this.parseMPEGPES(M),P.pesData=null):(R!=null&&R.size&&h.logger.log("last AAC PES packet truncated,might overlap between fragments"),P.pesData=R),C&&(M=f(C))?(this.parseID3PES(M),w.pesData=null):w.pesData=C},S.demuxSampleAes=function(D,P,A){var w=this.demux(D,A,!0,!this.config.progressive),L=this.sampleAes=new x.default(this.observer,this.config,P);return this.decrypt(w,L)},S.decrypt=function(D,P){return new Promise(function(A){var w=D.audioTrack,L=D.avcTrack;w.samples&&w.isAAC?P.decryptAacSamples(w.samples,0,function(){L.samples?P.decryptAvcSamples(L.samples,0,0,function(){A(D)}):A(D)}):L.samples&&P.decryptAvcSamples(L.samples,0,0,function(){A(D)})})},S.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},S.parseAVCPES=function(D,P){var A=this,w=this._avcTrack,L=this.parseAVCNALu(D.data),R=this.avcSample,C,M=!1;D.data=null,R&&L.length&&!w.audFound&&(v(R,w),R=this.avcSample=_(!1,D.pts,D.dts,"")),L.forEach(function(N){switch(N.type){case 1:{C=!0,R||(R=A.avcSample=_(!0,D.pts,D.dts,"")),R.frame=!0;var U=N.data;if(M&&U.length>4){var K=new o.default(U).readSliceType();(K===2||K===4||K===7||K===9)&&(R.key=!0)}break}case 5:C=!0,R||(R=A.avcSample=_(!0,D.pts,D.dts,"")),R.key=!0,R.frame=!0;break;case 6:{C=!0;var V=new o.default(m(N.data));V.readUByte();for(var W=0,G=0,Y=!1,q=0;!Y&&V.bytesAvailable>1;){W=0;do q=V.readUByte(),W+=q;while(q===255);G=0;do q=V.readUByte(),G+=q;while(q===255);if(W===4&&V.bytesAvailable!==0){Y=!0;var ee=V.readUByte();if(ee===181){var re=V.readUShort();if(re===49){var pe=V.readUInt();if(pe===1195456820){var Le=V.readUByte();if(Le===3){for(var Te=V.readUByte(),be=V.readUByte(),Re=31&Te,Se=[Te,be],Ge=0;Ge<Re;Ge++)Se.push(V.readUByte()),Se.push(V.readUByte()),Se.push(V.readUByte());l(A._txtTrack.samples,{type:3,pts:D.pts,bytes:Se})}}}}}else if(W===5&&V.bytesAvailable!==0){if(Y=!0,G>16){for(var $e=[],st=0;st<16;st++)$e.push(V.readUByte().toString(16)),(st===3||st===5||st===7||st===9)&&$e.push("-");for(var Ze=G-16,et=new Uint8Array(Ze),ft=0;ft<Ze;ft++)et[ft]=V.readUByte();l(A._txtTrack.samples,{pts:D.pts,payloadType:W,uuid:$e.join(""),userData:Object(p.utf8ArrayToStr)(et),userDataBytes:et})}}else if(G<V.bytesAvailable)for(var dt=0;dt<G;dt++)V.readUByte()}break}case 7:if(C=!0,M=!0,!w.sps){var ht=new o.default(N.data),He=ht.readSPS();w.width=He.width,w.height=He.height,w.pixelRatio=He.pixelRatio,w.sps=[N.data],w.duration=A._duration;for(var rt=N.data.subarray(1,4),xt="avc1.",pt=0;pt<3;pt++){var ot=rt[pt].toString(16);ot.length<2&&(ot="0"+ot),xt+=ot}w.codec=xt}break;case 8:C=!0,w.pps||(w.pps=[N.data]);break;case 9:C=!1,w.audFound=!0,R&&v(R,w),R=A.avcSample=_(!1,D.pts,D.dts,"");break;case 12:C=!1;break;default:C=!1,R&&(R.debug+="unknown NAL "+N.type+" ");break}if(R&&C){var Lt=R.units;Lt.push(N)}}),P&&R&&(v(R,w),this.avcSample=null)},S.getLastNalUnit=function(){var D,P=this.avcSample,A;if(!P||P.units.length===0){var w=this._avcTrack.samples;P=w[w.length-1]}if((D=P)!==null&&D!==void 0&&D.units){var L=P.units;A=L[L.length-1]}return A},S.parseAVCNALu=function(D){var P=D.byteLength,A=this._avcTrack,w=A.naluState||0,L=w,R=[],C=0,M,N,U,K=-1,V=0;for(w===-1&&(K=0,V=D[0]&31,w=0,C=1);C<P;){if(M=D[C++],!w){w=M?0:1;continue}if(w===1){w=M?0:2;continue}if(!M)w=3;else if(M===1){if(K>=0){var W={data:D.subarray(K,C-w-1),type:V};R.push(W)}else{var G=this.getLastNalUnit();if(G&&(L&&C<=4-L&&G.state&&(G.data=G.data.subarray(0,G.data.byteLength-L)),N=C-w-1,N>0)){var Y=new Uint8Array(G.data.byteLength+N);Y.set(G.data,0),Y.set(D.subarray(0,N),G.data.byteLength),G.data=Y,G.state=0}}C<P?(U=D[C]&31,K=C,V=U,w=0):w=-1}else w=0}if(K>=0&&w>=0){var q={data:D.subarray(K,P),type:V,state:w};R.push(q)}if(R.length===0){var ee=this.getLastNalUnit();if(ee){var re=new Uint8Array(ee.data.byteLength+D.byteLength);re.set(ee.data,0),re.set(D,ee.data.byteLength),ee.data=re}}return A.naluState=w,R},S.parseAACPES=function(D){var P=0,A=this._audioTrack,w=this.aacOverFlow,L=D.data;if(w){this.aacOverFlow=null;var R=w.sample.unit.byteLength,C=Math.min(w.missing,R),M=R-C;w.sample.unit.set(L.subarray(0,C),M),A.samples.push(w.sample),P=w.missing}var N,U;for(N=P,U=L.length;N<U-1&&!a.isHeader(L,N);N++);if(N!==P){var K,V;if(N<U-1?(K="AAC PES did not start with ADTS header,offset:"+N,V=!1):(K="no ADTS header found in AAC PES",V=!0),h.logger.warn("parsing error:"+K),this.observer.emit(g.Events.ERROR,g.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:V,reason:K}),V)return}a.initTrackConfig(A,this.observer,L,N,this.audioCodec);var W;if(D.pts!==void 0)W=D.pts;else if(w){var G=a.getFrameDuration(A.samplerate);W=w.sample.pts+G}else{h.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var Y=0;N<U;)if(a.isHeader(L,N)){if(N+5<U){var q=a.appendFrame(A,L,N,W,Y);if(q)if(q.missing)this.aacOverFlow=q;else{N+=q.length,Y++;continue}}break}else N++},S.parseMPEGPES=function(D){var P=D.data,A=P.length,w=0,L=0,R=D.pts;if(R===void 0){h.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;L<A;)if(s.isHeader(P,L)){var C=s.appendFrame(this._audioTrack,P,L,R,w);if(C)L+=C.length,w++;else break}else L++},S.parseID3PES=function(D){if(D.pts===void 0){h.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(D)},E}();T.minProbeByteLength=188;function _(E,S,O,D){return{key:E,frame:!1,pts:S,dts:O,units:[],debug:D,length:0}}function c(E,S){return(E[S+10]&31)<<8|E[S+11]}function u(E,S,O,D){var P={audio:-1,avc:-1,id3:-1,isAAC:!0},A=(E[S+1]&15)<<8|E[S+2],w=S+3+A-4,L=(E[S+10]&15)<<8|E[S+11];for(S+=12+L;S<w;){var R=(E[S+1]&31)<<8|E[S+2];switch(E[S]){case 207:if(!D){h.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:P.audio===-1&&(P.audio=R);break;case 21:P.id3===-1&&(P.id3=R);break;case 219:if(!D){h.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:P.avc===-1&&(P.avc=R);break;case 3:case 4:O?P.audio===-1&&(P.audio=R,P.isAAC=!1):h.logger.log("MPEG audio found, not supported in this browser");break;case 36:h.logger.warn("Unsupported HEVC stream type found");break}S+=((E[S+3]&15)<<8|E[S+4])+5}return P}function f(E){var S=0,O,D,P,A,w,L=E.data;if(!E||E.size===0)return null;for(;L[0].length<19&&L.length>1;){var R=new Uint8Array(L[0].length+L[1].length);R.set(L[0]),R.set(L[1],L[0].length),L[0]=R,L.splice(1,1)}O=L[0];var C=(O[0]<<16)+(O[1]<<8)+O[2];if(C===1){if(D=(O[4]<<8)+O[5],D&&D>E.size-6)return null;var M=O[7];M&192&&(A=(O[9]&14)*536870912+(O[10]&255)*4194304+(O[11]&254)*16384+(O[12]&255)*128+(O[13]&254)/2,M&64?(w=(O[14]&14)*536870912+(O[15]&255)*4194304+(O[16]&254)*16384+(O[17]&255)*128+(O[18]&254)/2,A-w>60*9e4&&(h.logger.warn(Math.round((A-w)/9e4)+"s delta between PTS and DTS, align them"),A=w)):w=A),P=O[8];var N=P+9;if(E.size<=N)return null;E.size-=N;for(var U=new Uint8Array(E.size),K=0,V=L.length;K<V;K++){O=L[K];var W=O.byteLength;if(N)if(N>W){N-=W;continue}else O=O.subarray(N),W-=N,N=0;U.set(O,S),S+=W}return D&&(D-=P+3),{data:U,pts:A,dts:w,len:D}}return null}function v(E,S){if(E.units.length&&E.frame){if(E.pts===void 0){var O=S.samples,D=O.length;if(D){var P=O[D-1];E.pts=P.pts,E.dts=P.dts}else{S.dropped++;return}}S.samples.push(E)}E.debug.length&&h.logger.log(E.pts+"/"+E.dts+":"+E.debug)}function l(E,S){var O=E.length;if(O>0){if(S.pts>=E[O-1].pts)E.push(S);else for(var D=O-1;D>=0;D--)if(S.pts<E[D].pts){E.splice(D,0,S);break}}else E.push(S)}function m(E){for(var S=E.byteLength,O=[],D=1;D<S-2;)E[D]===0&&E[D+1]===0&&E[D+2]===3?(O.push(D+2),D+=2):D++;if(O.length===0)return E;var P=S-O.length,A=new Uint8Array(P),w=0;for(D=0;D<P;w++,D++)w===O[0]&&(w++,O.shift()),A[D]=E[w];return A}n.default=T},"./src/errors.ts":function(r,n,t){t.r(n),t.d(n,"ErrorTypes",function(){return a}),t.d(n,"ErrorDetails",function(){return s});var a;(function(o){o.NETWORK_ERROR="networkError",o.MEDIA_ERROR="mediaError",o.KEY_SYSTEM_ERROR="keySystemError",o.MUX_ERROR="muxError",o.OTHER_ERROR="otherError"})(a||(a={}));var s;(function(o){o.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",o.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",o.KEY_SYSTEM_NO_SESSION="keySystemNoSession",o.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",o.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",o.MANIFEST_LOAD_ERROR="manifestLoadError",o.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",o.MANIFEST_PARSING_ERROR="manifestParsingError",o.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",o.LEVEL_EMPTY_ERROR="levelEmptyError",o.LEVEL_LOAD_ERROR="levelLoadError",o.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",o.LEVEL_SWITCH_ERROR="levelSwitchError",o.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",o.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",o.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",o.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",o.FRAG_LOAD_ERROR="fragLoadError",o.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",o.FRAG_DECRYPT_ERROR="fragDecryptError",o.FRAG_PARSING_ERROR="fragParsingError",o.REMUX_ALLOC_ERROR="remuxAllocError",o.KEY_LOAD_ERROR="keyLoadError",o.KEY_LOAD_TIMEOUT="keyLoadTimeOut",o.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",o.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",o.BUFFER_APPEND_ERROR="bufferAppendError",o.BUFFER_APPENDING_ERROR="bufferAppendingError",o.BUFFER_STALLED_ERROR="bufferStalledError",o.BUFFER_FULL_ERROR="bufferFullError",o.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",o.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",o.INTERNAL_EXCEPTION="internalException",o.INTERNAL_ABORTED="aborted",o.UNKNOWN="unknown"})(s||(s={}))},"./src/events.ts":function(r,n,t){t.r(n),t.d(n,"Events",function(){return a});var a;(function(s){s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached"})(a||(a={}))},"./src/hls.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return l});var a=t("./node_modules/url-toolkit/src/url-toolkit.js"),s=t("./src/loader/playlist-loader.ts"),o=t("./src/loader/key-loader.ts"),p=t("./src/controller/id3-track-controller.ts"),x=t("./src/controller/latency-controller.ts"),g=t("./src/controller/level-controller.ts"),d=t("./src/controller/fragment-tracker.ts"),h=t("./src/controller/stream-controller.ts"),y=t("./src/is-supported.ts"),b=t("./src/utils/logger.ts"),T=t("./src/config.ts"),_=t("./node_modules/eventemitter3/index.js"),c=t("./src/events.ts"),u=t("./src/errors.ts");function f(m,E){for(var S=0;S<E.length;S++){var O=E[S];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(m,O.key,O)}}function v(m,E,S){return E&&f(m.prototype,E),S&&f(m,S),m}var l=function(){m.isSupported=function(){return Object(y.isSupported)()};function m(S){S===void 0&&(S={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new _.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var O=this.config=Object(T.mergeConfig)(m.DefaultConfig,S);this.userConfig=S,Object(b.enableLogs)(O.debug),this._autoLevelCapping=-1,O.progressive&&Object(T.enableStreamingMode)(O);var D=O.abrController,P=O.bufferController,A=O.capLevelController,w=O.fpsController,L=this.abrController=new D(this),R=this.bufferController=new P(this),C=this.capLevelController=new A(this),M=new w(this),N=new s.default(this),U=new o.default(this),K=new p.default(this),V=this.levelController=new g.default(this),W=new d.FragmentTracker(this),G=this.streamController=new h.default(this,W);C.setStreamController(G),M.setStreamController(G);var Y=[V,G];this.networkControllers=Y;var q=[N,U,L,R,C,M,K,W];this.audioTrackController=this.createController(O.audioTrackController,null,Y),this.createController(O.audioStreamController,W,Y),this.subtitleTrackController=this.createController(O.subtitleTrackController,null,Y),this.createController(O.subtitleStreamController,W,Y),this.createController(O.timelineController,null,q),this.emeController=this.createController(O.emeController,null,q),this.cmcdController=this.createController(O.cmcdController,null,q),this.latencyController=this.createController(x.default,null,q),this.coreComponents=q}var E=m.prototype;return E.createController=function(O,D,P){if(O){var A=D?new O(this,D):new O(this);return P&&P.push(A),A}return null},E.on=function(O,D,P){P===void 0&&(P=this),this._emitter.on(O,D,P)},E.once=function(O,D,P){P===void 0&&(P=this),this._emitter.once(O,D,P)},E.removeAllListeners=function(O){this._emitter.removeAllListeners(O)},E.off=function(O,D,P,A){P===void 0&&(P=this),this._emitter.off(O,D,P,A)},E.listeners=function(O){return this._emitter.listeners(O)},E.emit=function(O,D,P){return this._emitter.emit(O,D,P)},E.trigger=function(O,D){if(this.config.debug)return this.emit(O,O,D);try{return this.emit(O,O,D)}catch(P){b.logger.error("An internal error happened while handling event "+O+'. Error message: "'+P.message+'". Here is a stacktrace:',P),this.trigger(c.Events.ERROR,{type:u.ErrorTypes.OTHER_ERROR,details:u.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:O,error:P})}return!1},E.listenerCount=function(O){return this._emitter.listenerCount(O)},E.destroy=function(){b.logger.log("destroy"),this.trigger(c.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(O){return O.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(O){return O.destroy()}),this.coreComponents.length=0},E.attachMedia=function(O){b.logger.log("attachMedia"),this._media=O,this.trigger(c.Events.MEDIA_ATTACHING,{media:O})},E.detachMedia=function(){b.logger.log("detachMedia"),this.trigger(c.Events.MEDIA_DETACHING,void 0),this._media=null},E.loadSource=function(O){this.stopLoad();var D=this.media,P=this.url,A=this.url=a.buildAbsoluteURL(self.location.href,O,{alwaysNormalize:!0});b.logger.log("loadSource:"+A),D&&P&&P!==A&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(D)),this.trigger(c.Events.MANIFEST_LOADING,{url:O})},E.startLoad=function(O){O===void 0&&(O=-1),b.logger.log("startLoad("+O+")"),this.networkControllers.forEach(function(D){D.startLoad(O)})},E.stopLoad=function(){b.logger.log("stopLoad"),this.networkControllers.forEach(function(O){O.stopLoad()})},E.swapAudioCodec=function(){b.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},E.recoverMediaError=function(){b.logger.log("recoverMediaError");var O=this._media;this.detachMedia(),O&&this.attachMedia(O)},E.removeLevel=function(O,D){D===void 0&&(D=0),this.levelController.removeLevel(O,D)},v(m,[{key:"levels",get:function(){var O=this.levelController.levels;return O||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(O){b.logger.log("set currentLevel:"+O),this.loadLevel=O,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(O){b.logger.log("set nextLevel:"+O),this.levelController.manualLevel=O,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(O){b.logger.log("set loadLevel:"+O),this.levelController.manualLevel=O}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(O){this.levelController.nextLoadLevel=O}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(O){b.logger.log("set firstLevel:"+O),this.levelController.firstLevel=O}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(O){b.logger.log("set startLevel:"+O),O!==-1&&(O=Math.max(O,this.minAutoLevel)),this.levelController.startLevel=O}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(O){var D=!!O;D!==this.config.capLevelToPlayerSize&&(D?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=D)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(O){this._autoLevelCapping!==O&&(b.logger.log("set autoLevelCapping:"+O),this._autoLevelCapping=O)}},{key:"bandwidthEstimate",get:function(){var O=this.abrController.bwEstimator;return O?O.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var O=this.levels,D=this.config.minAutoBitrate;if(!O)return 0;for(var P=O.length,A=0;A<P;A++)if(O[A].maxBitrate>D)return A;return 0}},{key:"maxAutoLevel",get:function(){var O=this.levels,D=this.autoLevelCapping,P;return D===-1&&O&&O.length?P=O.length-1:P=D,P}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(O){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,O)}},{key:"audioTracks",get:function(){var O=this.audioTrackController;return O?O.audioTracks:[]}},{key:"audioTrack",get:function(){var O=this.audioTrackController;return O?O.audioTrack:-1},set:function(O){var D=this.audioTrackController;D&&(D.audioTrack=O)}},{key:"subtitleTracks",get:function(){var O=this.subtitleTrackController;return O?O.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var O=this.subtitleTrackController;return O?O.subtitleTrack:-1},set:function(O){var D=this.subtitleTrackController;D&&(D.subtitleTrack=O)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var O=this.subtitleTrackController;return O?O.subtitleDisplay:!1},set:function(O){var D=this.subtitleTrackController;D&&(D.subtitleDisplay=O)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(O){this.config.lowLatencyMode=O}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return c.Events}},{key:"ErrorTypes",get:function(){return u.ErrorTypes}},{key:"ErrorDetails",get:function(){return u.ErrorDetails}},{key:"DefaultConfig",get:function(){return m.defaultConfig?m.defaultConfig:T.hlsDefaultConfig},set:function(O){m.defaultConfig=O}}]),m}();l.defaultConfig=void 0},"./src/is-supported.ts":function(r,n,t){t.r(n),t.d(n,"isSupported",function(){return o}),t.d(n,"changeTypeSupported",function(){return p});var a=t("./src/utils/mediasource-helper.ts");function s(){return self.SourceBuffer||self.WebKitSourceBuffer}function o(){var x=Object(a.getMediaSource)();if(!x)return!1;var g=s(),d=x&&typeof x.isTypeSupported=="function"&&x.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),h=!g||g.prototype&&typeof g.prototype.appendBuffer=="function"&&typeof g.prototype.remove=="function";return!!d&&!!h}function p(){var x,g=s();return typeof(g==null||(x=g.prototype)===null||x===void 0?void 0:x.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return T}),t.d(n,"LoadError",function(){return c});var a=t("./src/polyfills/number.ts"),s=t("./src/errors.ts");function o(u,f){u.prototype=Object.create(f.prototype),u.prototype.constructor=u,h(u,f)}function p(u){var f=typeof Map=="function"?new Map:void 0;return p=function(l){if(l===null||!d(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof f!="undefined"){if(f.has(l))return f.get(l);f.set(l,m)}function m(){return x(l,arguments,y(this).constructor)}return m.prototype=Object.create(l.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),h(m,l)},p(u)}function x(u,f,v){return g()?x=Reflect.construct:x=function(m,E,S){var O=[null];O.push.apply(O,E);var D=Function.bind.apply(m,O),P=new D;return S&&h(P,S.prototype),P},x.apply(null,arguments)}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}function d(u){return Function.toString.call(u).indexOf("[native code]")!==-1}function h(u,f){return h=Object.setPrototypeOf||function(l,m){return l.__proto__=m,l},h(u,f)}function y(u){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(v){return v.__proto__||Object.getPrototypeOf(v)},y(u)}var b=Math.pow(2,17),T=function(){function u(v){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=v}var f=u.prototype;return f.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},f.abort=function(){this.loader&&this.loader.abort()},f.load=function(l,m){var E=this,S=l.url;if(!S)return Promise.reject(new c({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,networkDetails:null},"Fragment does not have a "+(S?"part list":"url")));this.abort();var O=this.config,D=O.fLoader,P=O.loader;return new Promise(function(A,w){E.loader&&E.loader.destroy();var L=E.loader=l.loader=D?new D(O):new P(O),R=_(l),C={timeout:O.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:O.fragLoadingMaxRetryTimeout,highWaterMark:b};l.stats=L.stats,L.load(R,C,{onSuccess:function(N,U,K,V){E.resetLoader(l,L),A({frag:l,part:null,payload:N.data,networkDetails:V})},onError:function(N,U,K){E.resetLoader(l,L),w(new c({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,response:N,networkDetails:K}))},onAbort:function(N,U,K){E.resetLoader(l,L),w(new c({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,networkDetails:K}))},onTimeout:function(N,U,K){E.resetLoader(l,L),w(new c({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,networkDetails:K}))},onProgress:function(N,U,K,V){m&&m({frag:l,part:null,payload:K,networkDetails:V})}})})},f.loadPart=function(l,m,E){var S=this;this.abort();var O=this.config,D=O.fLoader,P=O.loader;return new Promise(function(A,w){S.loader&&S.loader.destroy();var L=S.loader=l.loader=D?new D(O):new P(O),R=_(l,m),C={timeout:O.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:O.fragLoadingMaxRetryTimeout,highWaterMark:b};m.stats=L.stats,L.load(R,C,{onSuccess:function(N,U,K,V){S.resetLoader(l,L),S.updateStatsFromPart(l,m);var W={frag:l,part:m,payload:N.data,networkDetails:V};E(W),A(W)},onError:function(N,U,K){S.resetLoader(l,L),w(new c({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,part:m,response:N,networkDetails:K}))},onAbort:function(N,U,K){l.stats.aborted=m.stats.aborted,S.resetLoader(l,L),w(new c({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,part:m,networkDetails:K}))},onTimeout:function(N,U,K){S.resetLoader(l,L),w(new c({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,part:m,networkDetails:K}))}})})},f.updateStatsFromPart=function(l,m){var E=l.stats,S=m.stats,O=S.total;if(E.loaded+=S.loaded,O){var D=Math.round(l.duration/m.duration),P=Math.min(Math.round(E.loaded/O),D),A=D-P,w=A*Math.round(E.loaded/P);E.total=E.loaded+w}else E.total=Math.max(E.loaded,E.total);var L=E.loading,R=S.loading;L.start?L.first+=R.first-R.start:(L.start=R.start,L.first=R.first),L.end=R.end},f.resetLoader=function(l,m){l.loader=null,this.loader===m&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),m.destroy()},u}();function _(u,f){f===void 0&&(f=null);var v=f||u,l={frag:u,part:f,responseType:"arraybuffer",url:v.url,headers:{},rangeStart:0,rangeEnd:0},m=v.byteRangeStartOffset,E=v.byteRangeEndOffset;return Object(a.isFiniteNumber)(m)&&Object(a.isFiniteNumber)(E)&&(l.rangeStart=m,l.rangeEnd=E),l}var c=function(u){o(f,u);function f(v){for(var l,m=arguments.length,E=new Array(m>1?m-1:0),S=1;S<m;S++)E[S-1]=arguments[S];return l=u.call.apply(u,[this].concat(E))||this,l.data=void 0,l.data=v,l}return f}(p(Error))},"./src/loader/fragment.ts":function(r,n,t){t.r(n),t.d(n,"ElementaryStreamTypes",function(){return b}),t.d(n,"BaseSegment",function(){return T}),t.d(n,"Fragment",function(){return _}),t.d(n,"Part",function(){return c});var a=t("./src/polyfills/number.ts"),s=t("./node_modules/url-toolkit/src/url-toolkit.js"),o=t("./src/utils/logger.ts"),p=t("./src/loader/level-key.ts"),x=t("./src/loader/load-stats.ts");function g(u,f){u.prototype=Object.create(f.prototype),u.prototype.constructor=u,d(u,f)}function d(u,f){return d=Object.setPrototypeOf||function(l,m){return l.__proto__=m,l},d(u,f)}function h(u,f){for(var v=0;v<f.length;v++){var l=f[v];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(u,l.key,l)}}function y(u,f,v){return f&&h(u.prototype,f),v&&h(u,v),u}var b;(function(u){u.AUDIO="audio",u.VIDEO="video",u.AUDIOVIDEO="audiovideo"})(b||(b={}));var T=function(){function u(v){var l;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(l={},l[b.AUDIO]=null,l[b.VIDEO]=null,l[b.AUDIOVIDEO]=null,l),this.baseurl=v}var f=u.prototype;return f.setByteRange=function(l,m){var E=l.split("@",2),S=[];E.length===1?S[0]=m?m.byteRangeEndOffset:0:S[0]=parseInt(E[1]),S[1]=parseInt(E[0])+S[0],this._byteRange=S},y(u,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(l){this._url=l}}]),u}(),_=function(u){g(f,u);function f(l,m){var E;return E=u.call(this,m)||this,E._decryptdata=null,E.rawProgramDateTime=null,E.programDateTime=null,E.tagList=[],E.duration=0,E.sn=0,E.levelkey=void 0,E.type=void 0,E.loader=null,E.level=-1,E.cc=0,E.startPTS=void 0,E.endPTS=void 0,E.appendedPTS=void 0,E.startDTS=void 0,E.endDTS=void 0,E.start=0,E.deltaPTS=void 0,E.maxStartPTS=void 0,E.minEndPTS=void 0,E.stats=new x.LoadStats,E.urlId=0,E.data=void 0,E.bitrateTest=!1,E.title=null,E.initSegment=null,E.type=l,E}var v=f.prototype;return v.createInitializationVector=function(m){for(var E=new Uint8Array(16),S=12;S<16;S++)E[S]=m>>8*(15-S)&255;return E},v.setDecryptDataFromLevelKey=function(m,E){var S=m;return(m==null?void 0:m.method)==="AES-128"&&m.uri&&!m.iv&&(S=p.LevelKey.fromURI(m.uri),S.method=m.method,S.iv=this.createInitializationVector(E),S.keyFormat="identity"),S},v.setElementaryStreamInfo=function(m,E,S,O,D,P){P===void 0&&(P=!1);var A=this.elementaryStreams,w=A[m];if(!w){A[m]={startPTS:E,endPTS:S,startDTS:O,endDTS:D,partial:P};return}w.startPTS=Math.min(w.startPTS,E),w.endPTS=Math.max(w.endPTS,S),w.startDTS=Math.min(w.startDTS,O),w.endDTS=Math.max(w.endDTS,D)},v.clearElementaryStreamInfo=function(){var m=this.elementaryStreams;m[b.AUDIO]=null,m[b.VIDEO]=null,m[b.AUDIOVIDEO]=null},y(f,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var m=this.sn;typeof m!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&o.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),m=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,m)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(a.isFiniteNumber)(this.programDateTime))return null;var m=Object(a.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+m*1e3}},{key:"encrypted",get:function(){var m;return!!((m=this.decryptdata)!==null&&m!==void 0&&m.keyFormat&&this.decryptdata.uri)}}]),f}(T),c=function(u){g(f,u);function f(v,l,m,E,S){var O;O=u.call(this,m)||this,O.fragOffset=0,O.duration=0,O.gap=!1,O.independent=!1,O.relurl=void 0,O.fragment=void 0,O.index=void 0,O.stats=new x.LoadStats,O.duration=v.decimalFloatingPoint("DURATION"),O.gap=v.bool("GAP"),O.independent=v.bool("INDEPENDENT"),O.relurl=v.enumeratedString("URI"),O.fragment=l,O.index=E;var D=v.enumeratedString("BYTERANGE");return D&&O.setByteRange(D,S),S&&(O.fragOffset=S.fragOffset+S.duration),O}return y(f,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var l=this.elementaryStreams;return!!(l.audio||l.video||l.audiovideo)}}]),f}(T)},"./src/loader/key-loader.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return p});var a=t("./src/events.ts"),s=t("./src/errors.ts"),o=t("./src/utils/logger.ts"),p=function(){function x(d){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=d,this._registerListeners()}var g=x.prototype;return g._registerListeners=function(){this.hls.on(a.Events.KEY_LOADING,this.onKeyLoading,this)},g._unregisterListeners=function(){this.hls.off(a.Events.KEY_LOADING,this.onKeyLoading)},g.destroy=function(){this._unregisterListeners();for(var h in this.loaders){var y=this.loaders[h];y&&y.destroy()}this.loaders={}},g.onKeyLoading=function(h,y){var b=y.frag,T=b.type,_=this.loaders[T];if(!b.decryptdata){o.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var c=b.decryptdata.uri;if(c!==this.decrypturl||this.decryptkey===null){var u=this.hls.config;if(_&&(o.logger.warn("abort previous key loader for type:"+T),_.abort()),!c){o.logger.warn("key uri is falsy");return}var f=u.loader,v=b.loader=this.loaders[T]=new f(u);this.decrypturl=c,this.decryptkey=null;var l={url:c,frag:b,responseType:"arraybuffer"},m={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},E={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};v.load(l,m,E)}else this.decryptkey&&(b.decryptdata.key=this.decryptkey,this.hls.trigger(a.Events.KEY_LOADED,{frag:b}))},g.loadsuccess=function(h,y,b){var T=b.frag;if(!T.decryptdata){o.logger.error("after key load, decryptdata unset");return}this.decryptkey=T.decryptdata.key=new Uint8Array(h.data),T.loader=null,delete this.loaders[T.type],this.hls.trigger(a.Events.KEY_LOADED,{frag:T})},g.loaderror=function(h,y){var b=y.frag,T=b.loader;T&&T.abort(),delete this.loaders[b.type],this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:b,response:h})},g.loadtimeout=function(h,y){var b=y.frag,T=b.loader;T&&T.abort(),delete this.loaders[b.type],this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:b})},x}()},"./src/loader/level-details.ts":function(r,n,t){t.r(n),t.d(n,"LevelDetails",function(){return x});var a=t("./src/polyfills/number.ts");function s(g,d){for(var h=0;h<d.length;h++){var y=d[h];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(g,y.key,y)}}function o(g,d,h){return d&&s(g.prototype,d),h&&s(g,h),g}var p=10,x=function(){function g(h){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=h}var d=g.prototype;return d.reloaded=function(y){if(!y){this.advanced=!0,this.updated=!0;return}var b=this.lastPartSn-y.lastPartSn,T=this.lastPartIndex-y.lastPartIndex;this.updated=this.endSN!==y.endSN||!!T||!!b,this.advanced=this.endSN>y.endSN||b>0||b===0&&T>0,this.updated||this.advanced?this.misses=Math.floor(y.misses*.6):this.misses=y.misses+1,this.availabilityDelay=y.availabilityDelay},o(g,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(a.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||p}},{key:"drift",get:function(){var y=this.driftEndTime-this.driftStartTime;if(y>0){var b=this.driftEnd-this.driftStart;return b*1e3/y}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var y;return(y=this.partList)!==null&&y!==void 0&&y.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var y;return(y=this.fragments)!==null&&y!==void 0&&y.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var y;return(y=this.partList)!==null&&y!==void 0&&y.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var y;return(y=this.partList)!==null&&y!==void 0&&y.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),g}()},"./src/loader/level-key.ts":function(r,n,t){t.r(n),t.d(n,"LevelKey",function(){return p});var a=t("./node_modules/url-toolkit/src/url-toolkit.js");function s(x,g){for(var d=0;d<g.length;d++){var h=g[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(x,h.key,h)}}function o(x,g,d){return g&&s(x.prototype,g),d&&s(x,d),x}var p=function(){x.fromURL=function(d,h){return new x(d,h)},x.fromURI=function(d){return new x(d)};function x(g,d){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,d?this._uri=Object(a.buildAbsoluteURL)(g,d,{alwaysNormalize:!0}):this._uri=g}return o(x,[{key:"uri",get:function(){return this._uri}}]),x}()},"./src/loader/load-stats.ts":function(r,n,t){t.r(n),t.d(n,"LoadStats",function(){return a});var a=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return f});var a=t("./src/polyfills/number.ts"),s=t("./node_modules/url-toolkit/src/url-toolkit.js"),o=t("./src/loader/fragment.ts"),p=t("./src/loader/level-details.ts"),x=t("./src/loader/level-key.ts"),g=t("./src/utils/attr-list.ts"),d=t("./src/utils/logger.ts"),h=t("./src/utils/codecs.ts"),y=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,b=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),_=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),c=/\.(mp4|m4s|m4v|m4a)$/i;function u(S){var O,D;return c.test((O=(D=s.parseURL(S))===null||D===void 0?void 0:D.path)!=null?O:"")}var f=function(){function S(){}return S.findGroup=function(D,P){for(var A=0;A<D.length;A++){var w=D[A];if(w.id===P)return w}},S.convertAVC1ToAVCOTI=function(D){var P=D.split(".");if(P.length>2){var A=P.shift()+".";return A+=parseInt(P.shift()).toString(16),A+=("000"+parseInt(P.shift()).toString(16)).substr(-4),A}return D},S.resolve=function(D,P){return s.buildAbsoluteURL(P,D,{alwaysNormalize:!0})},S.parseMasterPlaylist=function(D,P){var A=[],w={},L=!1;y.lastIndex=0;for(var R;(R=y.exec(D))!=null;)if(R[1]){var C=new g.AttrList(R[1]),M={attrs:C,bitrate:C.decimalInteger("AVERAGE-BANDWIDTH")||C.decimalInteger("BANDWIDTH"),name:C.NAME,url:S.resolve(R[2],P)},N=C.decimalResolution("RESOLUTION");N&&(M.width=N.width,M.height=N.height),v((C.CODECS||"").split(/[ ,]+/).filter(function(K){return K}),M),M.videoCodec&&M.videoCodec.indexOf("avc1")!==-1&&(M.videoCodec=S.convertAVC1ToAVCOTI(M.videoCodec)),A.push(M)}else if(R[3]){var U=new g.AttrList(R[3]);U["DATA-ID"]&&(L=!0,w[U["DATA-ID"]]=U)}return{levels:A,sessionData:L?w:null}},S.parseMasterPlaylistMedia=function(D,P,A,w){w===void 0&&(w=[]);var L,R=[],C=0;for(b.lastIndex=0;(L=b.exec(D))!==null;){var M=new g.AttrList(L[1]);if(M.TYPE===A){var N={attrs:M,bitrate:0,id:C++,groupId:M["GROUP-ID"],instreamId:M["INSTREAM-ID"],name:M.NAME||M.LANGUAGE||"",type:A,default:M.bool("DEFAULT"),autoselect:M.bool("AUTOSELECT"),forced:M.bool("FORCED"),lang:M.LANGUAGE,url:M.URI?S.resolve(M.URI,P):""};if(w.length){var U=S.findGroup(w,N.groupId)||w[0];l(N,U,"audioCodec"),l(N,U,"textCodec")}R.push(N)}}return R},S.parseLevelPlaylist=function(D,P,A,w,L){var R=new p.LevelDetails(P),C=R.fragments,M=null,N=0,U=0,K=0,V=0,W=null,G=new o.Fragment(w,P),Y,q,ee,re=-1,pe=!1;for(T.lastIndex=0,R.m3u8=D;(Y=T.exec(D))!==null;){pe&&(pe=!1,G=new o.Fragment(w,P),G.start=K,G.sn=N,G.cc=V,G.level=A,M&&(G.initSegment=M,G.rawProgramDateTime=M.rawProgramDateTime));var Le=Y[1];if(Le){G.duration=parseFloat(Le);var Te=(" "+Y[2]).slice(1);G.title=Te||null,G.tagList.push(Te?["INF",Le,Te]:["INF",Le])}else if(Y[3])Object(a.isFiniteNumber)(G.duration)&&(G.start=K,ee&&(G.levelkey=ee),G.sn=N,G.level=A,G.cc=V,G.urlId=L,C.push(G),G.relurl=(" "+Y[3]).slice(1),E(G,W),W=G,K+=G.duration,N++,U=0,pe=!0);else if(Y[4]){var be=(" "+Y[4]).slice(1);W?G.setByteRange(be,W):G.setByteRange(be)}else if(Y[5])G.rawProgramDateTime=(" "+Y[5]).slice(1),G.tagList.push(["PROGRAM-DATE-TIME",G.rawProgramDateTime]),re===-1&&(re=C.length);else{if(Y=Y[0].match(_),!Y){d.logger.warn("No matches on slow regex match for level playlist!");continue}for(q=1;q<Y.length&&typeof Y[q]=="undefined";q++);var Re=(" "+Y[q]).slice(1),Se=(" "+Y[q+1]).slice(1),Ge=Y[q+2]?(" "+Y[q+2]).slice(1):"";switch(Re){case"PLAYLIST-TYPE":R.type=Se.toUpperCase();break;case"MEDIA-SEQUENCE":N=R.startSN=parseInt(Se);break;case"SKIP":{var $e=new g.AttrList(Se),st=$e.decimalInteger("SKIPPED-SEGMENTS");if(Object(a.isFiniteNumber)(st)){R.skippedSegments=st;for(var Ze=st;Ze--;)C.unshift(null);N+=st}var et=$e.enumeratedString("RECENTLY-REMOVED-DATERANGES");et&&(R.recentlyRemovedDateranges=et.split("	"));break}case"TARGETDURATION":R.targetduration=parseFloat(Se);break;case"VERSION":R.version=parseInt(Se);break;case"EXTM3U":break;case"ENDLIST":R.live=!1;break;case"#":(Se||Ge)&&G.tagList.push(Ge?[Se,Ge]:[Se]);break;case"DIS":V++;case"GAP":G.tagList.push([Re]);break;case"BITRATE":G.tagList.push([Re,Se]);break;case"DISCONTINUITY-SEQ":V=parseInt(Se);break;case"KEY":{var ft,dt=new g.AttrList(Se),ht=dt.enumeratedString("METHOD"),He=dt.URI,rt=dt.hexadecimalInteger("IV"),xt=dt.enumeratedString("KEYFORMATVERSIONS"),pt=dt.enumeratedString("KEYID"),ot=(ft=dt.enumeratedString("KEYFORMAT"))!=null?ft:"identity",Lt=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Lt.indexOf(ot)>-1){d.logger.warn("Keyformat "+ot+" is not supported from the manifest");continue}else if(ot!=="identity")continue;ht&&(ee=x.LevelKey.fromURL(P,He),He&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ht)>=0&&(ee.method=ht,ee.keyFormat=ot,pt&&(ee.keyID=pt),xt&&(ee.keyFormatVersions=xt),ee.iv=rt));break}case"START":{var wt=new g.AttrList(Se),Pt=wt.decimalFloatingPoint("TIME-OFFSET");Object(a.isFiniteNumber)(Pt)&&(R.startTimeOffset=Pt);break}case"MAP":{var ve=new g.AttrList(Se);G.relurl=ve.URI,ve.BYTERANGE&&G.setByteRange(ve.BYTERANGE),G.level=A,G.sn="initSegment",ee&&(G.levelkey=ee),G.initSegment=null,M=G,pe=!0;break}case"SERVER-CONTROL":{var Ce=new g.AttrList(Se);R.canBlockReload=Ce.bool("CAN-BLOCK-RELOAD"),R.canSkipUntil=Ce.optionalFloat("CAN-SKIP-UNTIL",0),R.canSkipDateRanges=R.canSkipUntil>0&&Ce.bool("CAN-SKIP-DATERANGES"),R.partHoldBack=Ce.optionalFloat("PART-HOLD-BACK",0),R.holdBack=Ce.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var ke=new g.AttrList(Se);R.partTarget=ke.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Ue=R.partList;Ue||(Ue=R.partList=[]);var Je=U>0?Ue[Ue.length-1]:void 0,it=U++,X=new o.Part(new g.AttrList(Se),G,P,it,Je);Ue.push(X),G.duration+=X.duration;break}case"PRELOAD-HINT":{var Ae=new g.AttrList(Se);R.preloadHint=Ae;break}case"RENDITION-REPORT":{var Me=new g.AttrList(Se);R.renditionReports=R.renditionReports||[],R.renditionReports.push(Me);break}default:d.logger.warn("line parsed but not handled: "+Y);break}}}W&&!W.relurl?(C.pop(),K-=W.duration,R.partList&&(R.fragmentHint=W)):R.partList&&(E(G,W),G.cc=V,R.fragmentHint=G);var Ke=C.length,ne=C[0],_e=C[Ke-1];if(K+=R.skippedSegments*R.targetduration,K>0&&Ke&&_e){R.averagetargetduration=K/Ke;var H=_e.sn;R.endSN=H!=="initSegment"?H:0,ne&&(R.startCC=ne.cc,ne.initSegment||R.fragments.every(function(De){return De.relurl&&u(De.relurl)})&&(d.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),G=new o.Fragment(w,P),G.relurl=_e.relurl,G.level=A,G.sn="initSegment",ne.initSegment=G,R.needSidxRanges=!0))}else R.endSN=0,R.startCC=0;return R.fragmentHint&&(K+=R.fragmentHint.duration),R.totalduration=K,R.endCC=V,re>0&&m(C,re),R},S}();function v(S,O){["video","audio","text"].forEach(function(D){var P=S.filter(function(w){return Object(h.isCodecType)(w,D)});if(P.length){var A=P.filter(function(w){return w.lastIndexOf("avc1",0)===0||w.lastIndexOf("mp4a",0)===0});O[D+"Codec"]=A.length>0?A[0]:P[0],S=S.filter(function(w){return P.indexOf(w)===-1})}}),O.unknownCodecs=S}function l(S,O,D){var P=O[D];P&&(S[D]=P)}function m(S,O){for(var D=S[O],P=O;P--;){var A=S[P];if(!A)return;A.programDateTime=D.programDateTime-A.duration*1e3,D=A}}function E(S,O){S.rawProgramDateTime?S.programDateTime=Date.parse(S.rawProgramDateTime):O!=null&&O.programDateTime&&(S.programDateTime=O.endProgramDateTime),Object(a.isFiniteNumber)(S.programDateTime)||(S.programDateTime=null,S.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(r,n,t){t.r(n);var a=t("./src/polyfills/number.ts"),s=t("./src/events.ts"),o=t("./src/errors.ts"),p=t("./src/utils/logger.ts"),x=t("./src/utils/mp4-tools.ts"),g=t("./src/loader/m3u8-parser.ts"),d=t("./src/types/loader.ts"),h=t("./src/utils/attr-list.ts");function y(_){var c=_.type;switch(c){case d.PlaylistContextType.AUDIO_TRACK:return d.PlaylistLevelType.AUDIO;case d.PlaylistContextType.SUBTITLE_TRACK:return d.PlaylistLevelType.SUBTITLE;default:return d.PlaylistLevelType.MAIN}}function b(_,c){var u=_.url;return(u===void 0||u.indexOf("data:")===0)&&(u=c.url),u}var T=function(){function _(u){this.hls=void 0,this.loaders=Object.create(null),this.hls=u,this.registerListeners()}var c=_.prototype;return c.registerListeners=function(){var f=this.hls;f.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(s.Events.LEVEL_LOADING,this.onLevelLoading,this),f.on(s.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),f.on(s.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},c.unregisterListeners=function(){var f=this.hls;f.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(s.Events.LEVEL_LOADING,this.onLevelLoading,this),f.off(s.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),f.off(s.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},c.createInternalLoader=function(f){var v=this.hls.config,l=v.pLoader,m=v.loader,E=l||m,S=new E(v);return f.loader=S,this.loaders[f.type]=S,S},c.getInternalLoader=function(f){return this.loaders[f.type]},c.resetInternalLoader=function(f){this.loaders[f]&&delete this.loaders[f]},c.destroyInternalLoaders=function(){for(var f in this.loaders){var v=this.loaders[f];v&&v.destroy(),this.resetInternalLoader(f)}},c.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},c.onManifestLoading=function(f,v){var l=v.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:d.PlaylistContextType.MANIFEST,url:l,deliveryDirectives:null})},c.onLevelLoading=function(f,v){var l=v.id,m=v.level,E=v.url,S=v.deliveryDirectives;this.load({id:l,groupId:null,level:m,responseType:"text",type:d.PlaylistContextType.LEVEL,url:E,deliveryDirectives:S})},c.onAudioTrackLoading=function(f,v){var l=v.id,m=v.groupId,E=v.url,S=v.deliveryDirectives;this.load({id:l,groupId:m,level:null,responseType:"text",type:d.PlaylistContextType.AUDIO_TRACK,url:E,deliveryDirectives:S})},c.onSubtitleTrackLoading=function(f,v){var l=v.id,m=v.groupId,E=v.url,S=v.deliveryDirectives;this.load({id:l,groupId:m,level:null,responseType:"text",type:d.PlaylistContextType.SUBTITLE_TRACK,url:E,deliveryDirectives:S})},c.load=function(f){var v,l=this.hls.config,m=this.getInternalLoader(f);if(m){var E=m.context;if(E&&E.url===f.url){p.logger.trace("[playlist-loader]: playlist request ongoing");return}p.logger.log("[playlist-loader]: aborting previous loader for type: "+f.type),m.abort()}var S,O,D,P;switch(f.type){case d.PlaylistContextType.MANIFEST:S=l.manifestLoadingMaxRetry,O=l.manifestLoadingTimeOut,D=l.manifestLoadingRetryDelay,P=l.manifestLoadingMaxRetryTimeout;break;case d.PlaylistContextType.LEVEL:case d.PlaylistContextType.AUDIO_TRACK:case d.PlaylistContextType.SUBTITLE_TRACK:S=0,O=l.levelLoadingTimeOut;break;default:S=l.levelLoadingMaxRetry,O=l.levelLoadingTimeOut,D=l.levelLoadingRetryDelay,P=l.levelLoadingMaxRetryTimeout;break}if(m=this.createInternalLoader(f),(v=f.deliveryDirectives)!==null&&v!==void 0&&v.part){var A;if(f.type===d.PlaylistContextType.LEVEL&&f.level!==null?A=this.hls.levels[f.level].details:f.type===d.PlaylistContextType.AUDIO_TRACK&&f.id!==null?A=this.hls.audioTracks[f.id].details:f.type===d.PlaylistContextType.SUBTITLE_TRACK&&f.id!==null&&(A=this.hls.subtitleTracks[f.id].details),A){var w=A.partTarget,L=A.targetduration;w&&L&&(O=Math.min(Math.max(w*3,L*.8)*1e3,O))}}var R={timeout:O,maxRetry:S,retryDelay:D,maxRetryDelay:P,highWaterMark:0},C={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};m.load(f,R,C)},c.loadsuccess=function(f,v,l,m){if(m===void 0&&(m=null),l.isSidxRequest){this.handleSidxRequest(f,l),this.handlePlaylistLoaded(f,v,l,m);return}this.resetInternalLoader(l.type);var E=f.data;if(E.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(f,l,"no EXTM3U delimiter",m);return}v.parsing.start=performance.now(),E.indexOf("#EXTINF:")>0||E.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(f,v,l,m):this.handleMasterPlaylist(f,v,l,m)},c.loaderror=function(f,v,l){l===void 0&&(l=null),this.handleNetworkError(v,l,!1,f)},c.loadtimeout=function(f,v,l){l===void 0&&(l=null),this.handleNetworkError(v,l,!0)},c.handleMasterPlaylist=function(f,v,l,m){var E=this.hls,S=f.data,O=b(f,l),D=g.default.parseMasterPlaylist(S,O),P=D.levels,A=D.sessionData;if(!P.length){this.handleManifestParsingError(f,l,"no level found in manifest",m);return}var w=P.map(function(U){return{id:U.attrs.AUDIO,audioCodec:U.audioCodec}}),L=P.map(function(U){return{id:U.attrs.SUBTITLES,textCodec:U.textCodec}}),R=g.default.parseMasterPlaylistMedia(S,O,"AUDIO",w),C=g.default.parseMasterPlaylistMedia(S,O,"SUBTITLES",L),M=g.default.parseMasterPlaylistMedia(S,O,"CLOSED-CAPTIONS");if(R.length){var N=R.some(function(U){return!U.url});!N&&P[0].audioCodec&&!P[0].attrs.AUDIO&&(p.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),R.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new h.AttrList({}),bitrate:0,url:""}))}E.trigger(s.Events.MANIFEST_LOADED,{levels:P,audioTracks:R,subtitles:C,captions:M,url:O,stats:v,networkDetails:m,sessionData:A})},c.handleTrackOrLevelPlaylist=function(f,v,l,m){var E=this.hls,S=l.id,O=l.level,D=l.type,P=b(f,l),A=Object(a.isFiniteNumber)(S)?S:0,w=Object(a.isFiniteNumber)(O)?O:A,L=y(l),R=g.default.parseLevelPlaylist(f.data,P,w,L,A);if(!R.fragments.length){E.trigger(s.Events.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:P,reason:"no fragments found in level",level:typeof l.level=="number"?l.level:void 0});return}if(D===d.PlaylistContextType.MANIFEST){var C={attrs:new h.AttrList({}),bitrate:0,details:R,name:"",url:P};E.trigger(s.Events.MANIFEST_LOADED,{levels:[C],audioTracks:[],url:P,stats:v,networkDetails:m,sessionData:null})}if(v.parsing.end=performance.now(),R.needSidxRanges){var M,N=(M=R.fragments[0].initSegment)===null||M===void 0?void 0:M.url;this.load({url:N,isSidxRequest:!0,type:D,level:O,levelDetails:R,id:S,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}l.levelDetails=R,this.handlePlaylistLoaded(f,v,l,m)},c.handleSidxRequest=function(f,v){var l=Object(x.parseSegmentIndex)(new Uint8Array(f.data));if(!!l){var m=l.references,E=v.levelDetails;m.forEach(function(S,O){var D=S.info,P=E.fragments[O];P.byteRange.length===0&&P.setByteRange(String(1+D.end-D.start)+"@"+String(D.start)),P.initSegment&&P.initSegment.setByteRange(String(l.moovEndOffset)+"@0")})}},c.handleManifestParsingError=function(f,v,l,m){this.hls.trigger(s.Events.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:v.type===d.PlaylistContextType.MANIFEST,url:f.url,reason:l,response:f,context:v,networkDetails:m})},c.handleNetworkError=function(f,v,l,m){l===void 0&&(l=!1),p.logger.warn("[playlist-loader]: A network "+(l?"timeout":"error")+" occurred while loading "+f.type+" level: "+f.level+" id: "+f.id+' group-id: "'+f.groupId+'"');var E=o.ErrorDetails.UNKNOWN,S=!1,O=this.getInternalLoader(f);switch(f.type){case d.PlaylistContextType.MANIFEST:E=l?o.ErrorDetails.MANIFEST_LOAD_TIMEOUT:o.ErrorDetails.MANIFEST_LOAD_ERROR,S=!0;break;case d.PlaylistContextType.LEVEL:E=l?o.ErrorDetails.LEVEL_LOAD_TIMEOUT:o.ErrorDetails.LEVEL_LOAD_ERROR,S=!1;break;case d.PlaylistContextType.AUDIO_TRACK:E=l?o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,S=!1;break;case d.PlaylistContextType.SUBTITLE_TRACK:E=l?o.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:o.ErrorDetails.SUBTITLE_LOAD_ERROR,S=!1;break}O&&this.resetInternalLoader(f.type);var D={type:o.ErrorTypes.NETWORK_ERROR,details:E,fatal:S,url:f.url,loader:O,context:f,networkDetails:v};m&&(D.response=m),this.hls.trigger(s.Events.ERROR,D)},c.handlePlaylistLoaded=function(f,v,l,m){var E=l.type,S=l.level,O=l.id,D=l.groupId,P=l.loader,A=l.levelDetails,w=l.deliveryDirectives;if(!(A!=null&&A.targetduration)){this.handleManifestParsingError(f,l,"invalid target duration",m);return}if(!!P)switch(A.live&&(P.getCacheAge&&(A.ageHeader=P.getCacheAge()||0),(!P.getCacheAge||isNaN(A.ageHeader))&&(A.ageHeader=0)),E){case d.PlaylistContextType.MANIFEST:case d.PlaylistContextType.LEVEL:this.hls.trigger(s.Events.LEVEL_LOADED,{details:A,level:S||0,id:O||0,stats:v,networkDetails:m,deliveryDirectives:w});break;case d.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(s.Events.AUDIO_TRACK_LOADED,{details:A,id:O||0,groupId:D||"",stats:v,networkDetails:m,deliveryDirectives:w});break;case d.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(s.Events.SUBTITLE_TRACK_LOADED,{details:A,id:O||0,groupId:D||"",stats:v,networkDetails:m,deliveryDirectives:w});break}},_}();n.default=T},"./src/polyfills/number.ts":function(r,n,t){t.r(n),t.d(n,"isFiniteNumber",function(){return a}),t.d(n,"MAX_SAFE_INTEGER",function(){return s});var a=Number.isFinite||function(o){return typeof o=="number"&&isFinite(o)},s=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(r,n,t){t.r(n);var a=function(){function s(){}return s.getSilentFrame=function(p,x){switch(p){case"mp4a.40.2":if(x===1)return new Uint8Array([0,200,0,128,35,128]);if(x===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(x===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(x===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(x===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(x===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(x===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(x===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(x===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},s}();n.default=a},"./src/remux/mp4-generator.ts":function(r,n,t){t.r(n);var a=Math.pow(2,32)-1,s=function(){function o(){}return o.init=function(){o.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var x;for(x in o.types)o.types.hasOwnProperty(x)&&(o.types[x]=[x.charCodeAt(0),x.charCodeAt(1),x.charCodeAt(2),x.charCodeAt(3)]);var g=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);o.HDLR_TYPES={video:g,audio:d};var h=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),y=new Uint8Array([0,0,0,0,0,0,0,0]);o.STTS=o.STSC=o.STCO=y,o.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),o.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),o.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),o.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var b=new Uint8Array([105,115,111,109]),T=new Uint8Array([97,118,99,49]),_=new Uint8Array([0,0,0,1]);o.FTYP=o.box(o.types.ftyp,b,_,b,T),o.DINF=o.box(o.types.dinf,o.box(o.types.dref,h))},o.box=function(x){for(var g=8,d=arguments.length,h=new Array(d>1?d-1:0),y=1;y<d;y++)h[y-1]=arguments[y];for(var b=h.length,T=b;b--;)g+=h[b].byteLength;var _=new Uint8Array(g);for(_[0]=g>>24&255,_[1]=g>>16&255,_[2]=g>>8&255,_[3]=g&255,_.set(x,4),b=0,g=8;b<T;b++)_.set(h[b],g),g+=h[b].byteLength;return _},o.hdlr=function(x){return o.box(o.types.hdlr,o.HDLR_TYPES[x])},o.mdat=function(x){return o.box(o.types.mdat,x)},o.mdhd=function(x,g){g*=x;var d=Math.floor(g/(a+1)),h=Math.floor(g%(a+1));return o.box(o.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,d>>24,d>>16&255,d>>8&255,d&255,h>>24,h>>16&255,h>>8&255,h&255,85,196,0,0]))},o.mdia=function(x){return o.box(o.types.mdia,o.mdhd(x.timescale,x.duration),o.hdlr(x.type),o.minf(x))},o.mfhd=function(x){return o.box(o.types.mfhd,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,x&255]))},o.minf=function(x){return x.type==="audio"?o.box(o.types.minf,o.box(o.types.smhd,o.SMHD),o.DINF,o.stbl(x)):o.box(o.types.minf,o.box(o.types.vmhd,o.VMHD),o.DINF,o.stbl(x))},o.moof=function(x,g,d){return o.box(o.types.moof,o.mfhd(x),o.traf(d,g))},o.moov=function(x){for(var g=x.length,d=[];g--;)d[g]=o.trak(x[g]);return o.box.apply(null,[o.types.moov,o.mvhd(x[0].timescale,x[0].duration)].concat(d).concat(o.mvex(x)))},o.mvex=function(x){for(var g=x.length,d=[];g--;)d[g]=o.trex(x[g]);return o.box.apply(null,[o.types.mvex].concat(d))},o.mvhd=function(x,g){g*=x;var d=Math.floor(g/(a+1)),h=Math.floor(g%(a+1)),y=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,x>>24&255,x>>16&255,x>>8&255,x&255,d>>24,d>>16&255,d>>8&255,d&255,h>>24,h>>16&255,h>>8&255,h&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return o.box(o.types.mvhd,y)},o.sdtp=function(x){var g=x.samples||[],d=new Uint8Array(4+g.length),h,y;for(h=0;h<g.length;h++)y=g[h].flags,d[h+4]=y.dependsOn<<4|y.isDependedOn<<2|y.hasRedundancy;return o.box(o.types.sdtp,d)},o.stbl=function(x){return o.box(o.types.stbl,o.stsd(x),o.box(o.types.stts,o.STTS),o.box(o.types.stsc,o.STSC),o.box(o.types.stsz,o.STSZ),o.box(o.types.stco,o.STCO))},o.avc1=function(x){var g=[],d=[],h,y,b;for(h=0;h<x.sps.length;h++)y=x.sps[h],b=y.byteLength,g.push(b>>>8&255),g.push(b&255),g=g.concat(Array.prototype.slice.call(y));for(h=0;h<x.pps.length;h++)y=x.pps[h],b=y.byteLength,d.push(b>>>8&255),d.push(b&255),d=d.concat(Array.prototype.slice.call(y));var T=o.box(o.types.avcC,new Uint8Array([1,g[3],g[4],g[5],252|3,224|x.sps.length].concat(g).concat([x.pps.length]).concat(d))),_=x.width,c=x.height,u=x.pixelRatio[0],f=x.pixelRatio[1];return o.box(o.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,_>>8&255,_&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),T,o.box(o.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),o.box(o.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,f>>24,f>>16&255,f>>8&255,f&255])))},o.esds=function(x){var g=x.config.length;return new Uint8Array([0,0,0,0,3,23+g,0,1,0,4,15+g,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([g]).concat(x.config).concat([6,1,2]))},o.mp4a=function(x){var g=x.samplerate;return o.box(o.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,g>>8&255,g&255,0,0]),o.box(o.types.esds,o.esds(x)))},o.mp3=function(x){var g=x.samplerate;return o.box(o.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,x.channelCount,0,16,0,0,0,0,g>>8&255,g&255,0,0]))},o.stsd=function(x){return x.type==="audio"?!x.isAAC&&x.codec==="mp3"?o.box(o.types.stsd,o.STSD,o.mp3(x)):o.box(o.types.stsd,o.STSD,o.mp4a(x)):o.box(o.types.stsd,o.STSD,o.avc1(x))},o.tkhd=function(x){var g=x.id,d=x.duration*x.timescale,h=x.width,y=x.height,b=Math.floor(d/(a+1)),T=Math.floor(d%(a+1));return o.box(o.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,g>>24&255,g>>16&255,g>>8&255,g&255,0,0,0,0,b>>24,b>>16&255,b>>8&255,b&255,T>>24,T>>16&255,T>>8&255,T&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,h>>8&255,h&255,0,0,y>>8&255,y&255,0,0]))},o.traf=function(x,g){var d=o.sdtp(x),h=x.id,y=Math.floor(g/(a+1)),b=Math.floor(g%(a+1));return o.box(o.types.traf,o.box(o.types.tfhd,new Uint8Array([0,0,0,0,h>>24,h>>16&255,h>>8&255,h&255])),o.box(o.types.tfdt,new Uint8Array([1,0,0,0,y>>24,y>>16&255,y>>8&255,y&255,b>>24,b>>16&255,b>>8&255,b&255])),o.trun(x,d.length+16+20+8+16+8+8),d)},o.trak=function(x){return x.duration=x.duration||4294967295,o.box(o.types.trak,o.tkhd(x),o.mdia(x))},o.trex=function(x){var g=x.id;return o.box(o.types.trex,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},o.trun=function(x,g){var d=x.samples||[],h=d.length,y=12+16*h,b=new Uint8Array(y),T,_,c,u,f,v;for(g+=8+y,b.set([0,0,15,1,h>>>24&255,h>>>16&255,h>>>8&255,h&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255],0),T=0;T<h;T++)_=d[T],c=_.duration,u=_.size,f=_.flags,v=_.cts,b.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,f.degradPrio&240<<8,f.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*T);return o.box(o.types.trun,b)},o.initSegment=function(x){o.types||o.init();var g=o.moov(x),d=new Uint8Array(o.FTYP.byteLength+g.byteLength);return d.set(o.FTYP),d.set(g,o.FTYP.byteLength),d},o}();s.types=void 0,s.HDLR_TYPES=void 0,s.STTS=void 0,s.STSC=void 0,s.STCO=void 0,s.STSZ=void 0,s.VMHD=void 0,s.SMHD=void 0,s.STSD=void 0,s.FTYP=void 0,s.DINF=void 0,n.default=s},"./src/remux/mp4-remuxer.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return v}),t.d(n,"normalizePts",function(){return l});var a=t("./src/polyfills/number.ts"),s=t("./src/remux/aac-helper.ts"),o=t("./src/remux/mp4-generator.ts"),p=t("./src/events.ts"),x=t("./src/errors.ts"),g=t("./src/utils/logger.ts"),d=t("./src/types/loader.ts"),h=t("./src/utils/timescale-conversion.ts");function y(){return y=Object.assign||function(O){for(var D=1;D<arguments.length;D++){var P=arguments[D];for(var A in P)Object.prototype.hasOwnProperty.call(P,A)&&(O[A]=P[A])}return O},y.apply(this,arguments)}var b=10*1e3,T=1024,_=1152,c=null,u=null,f=!1,v=function(){function O(P,A,w,L){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=P,this.config=A,this.typeSupported=w,this.ISGenerated=!1,c===null){var R=navigator.userAgent||"",C=R.match(/Chrome\/(\d+)/i);c=C?parseInt(C[1]):0}if(u===null){var M=navigator.userAgent.match(/Safari\/(\d+)/i);u=M?parseInt(M[1]):0}f=!!c&&c<75||!!u&&u<600}var D=O.prototype;return D.destroy=function(){},D.resetTimeStamp=function(A){g.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=A},D.resetNextTimestamp=function(){g.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},D.resetInitSegment=function(){g.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},D.getVideoStartPts=function(A){var w=!1,L=A.reduce(function(R,C){var M=C.pts-R;return M<-4294967296?(w=!0,l(R,C.pts)):M>0?R:C.pts},A[0].pts);return w&&g.logger.debug("PTS rollover detected"),L},D.remux=function(A,w,L,R,C,M,N,U){var K,V,W,G,Y,q,ee=C,re=C,pe=A.pid>-1,Le=w.pid>-1,Te=w.samples.length,be=A.samples.length>0,Re=Te>1,Se=(!pe||be)&&(!Le||Re)||this.ISGenerated||N;if(Se){this.ISGenerated||(W=this.generateIS(A,w,C));var Ge=this.isVideoContiguous,$e=-1;if(Re&&($e=m(w.samples),!Ge&&this.config.forceKeyFrameOnDiscontinuity))if(q=!0,$e>0){g.logger.warn("[mp4-remuxer]: Dropped "+$e+" out of "+Te+" video samples due to a missing keyframe");var st=this.getVideoStartPts(w.samples);w.samples=w.samples.slice($e),w.dropped+=$e,re+=(w.samples[0].pts-st)/(w.timescale||9e4)}else $e===-1&&(g.logger.warn("[mp4-remuxer]: No keyframe found out of "+Te+" video samples"),q=!1);if(this.ISGenerated){if(be&&Re){var Ze=this.getVideoStartPts(w.samples),et=l(A.samples[0].pts,Ze)-Ze,ft=et/w.inputTimeScale;ee+=Math.max(0,ft),re+=Math.max(0,-ft)}if(be){if(A.samplerate||(g.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),W=this.generateIS(A,w,C)),V=this.remuxAudio(A,ee,this.isAudioContiguous,M,Le||Re||U===d.PlaylistLevelType.AUDIO?re:void 0),Re){var dt=V?V.endPTS-V.startPTS:0;w.inputTimeScale||(g.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),W=this.generateIS(A,w,C)),K=this.remuxVideo(w,re,Ge,dt)}}else Re&&(K=this.remuxVideo(w,re,Ge,0));K&&(K.firstKeyFrame=$e,K.independent=$e!==-1)}}return this.ISGenerated&&(L.samples.length&&(Y=this.remuxID3(L,C)),R.samples.length&&(G=this.remuxText(R,C))),{audio:V,video:K,initSegment:W,independent:q,text:G,id3:Y}},D.generateIS=function(A,w,L){var R=A.samples,C=w.samples,M=this.typeSupported,N={},U=!Object(a.isFiniteNumber)(this._initPTS),K="audio/mp4",V,W,G;if(U&&(V=W=1/0),A.config&&R.length&&(A.timescale=A.samplerate,A.isAAC||(M.mpeg?(K="audio/mpeg",A.codec=""):M.mp3&&(A.codec="mp3")),N.audio={id:"audio",container:K,codec:A.codec,initSegment:!A.isAAC&&M.mpeg?new Uint8Array(0):o.default.initSegment([A]),metadata:{channelCount:A.channelCount}},U&&(G=A.inputTimeScale,V=W=R[0].pts-Math.round(G*L))),w.sps&&w.pps&&C.length&&(w.timescale=w.inputTimeScale,N.video={id:"main",container:"video/mp4",codec:w.codec,initSegment:o.default.initSegment([w]),metadata:{width:w.width,height:w.height}},U)){G=w.inputTimeScale;var Y=this.getVideoStartPts(C),q=Math.round(G*L);W=Math.min(W,l(C[0].dts,Y)-q),V=Math.min(V,Y-q)}if(Object.keys(N).length)return this.ISGenerated=!0,U&&(this._initPTS=V,this._initDTS=W),{tracks:N,initPTS:V,timescale:G}},D.remuxVideo=function(A,w,L,R){var C=A.inputTimeScale,M=A.samples,N=[],U=M.length,K=this._initPTS,V=this.nextAvcDts,W=8,G,Y,q,ee=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,pe=0,Le=!1;if(!L||V===null){var Te=w*C,be=M[0].pts-l(M[0].dts,M[0].pts);V=Te-be}for(var Re=0;Re<U;Re++){var Se=M[Re];if(Se.pts=l(Se.pts-K,V),Se.dts=l(Se.dts-K,V),Se.dts>Se.pts){var Ge=9e4*.2;pe=Math.max(Math.min(pe,Se.pts-Se.dts),-1*Ge)}Se.dts<M[Re>0?Re-1:Re].dts&&(Le=!0)}Le&&M.sort(function(Xe,Qe){var bt=Xe.dts-Qe.dts,lr=Xe.pts-Qe.pts;return bt||lr}),Y=M[0].dts,q=M[M.length-1].dts;var $e=Math.round((q-Y)/(U-1));if(pe<0){if(pe<$e*-2){g.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(h.toMsFromMpegTsClock)(-$e,!0)+" ms");for(var st=pe,Ze=0;Ze<U;Ze++)M[Ze].dts=st=Math.max(st,M[Ze].pts-$e),M[Ze].pts=Math.max(st,M[Ze].pts)}else{g.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(h.toMsFromMpegTsClock)(pe,!0)+" ms to overcome this issue");for(var et=0;et<U;et++)M[et].dts=M[et].dts+pe}Y=M[0].dts}if(L){var ft=Y-V,dt=ft>$e,ht=ft<-1;if(dt||ht){dt?g.logger.warn("AVC: "+Object(h.toMsFromMpegTsClock)(ft,!0)+" ms ("+ft+"dts) hole between fragments detected, filling it"):g.logger.warn("AVC: "+Object(h.toMsFromMpegTsClock)(-ft,!0)+" ms ("+ft+"dts) overlapping between fragments detected"),Y=V;var He=M[0].pts-ft;M[0].dts=Y,M[0].pts=He,g.logger.log("Video: First PTS/DTS adjusted: "+Object(h.toMsFromMpegTsClock)(He,!0)+"/"+Object(h.toMsFromMpegTsClock)(Y,!0)+", delta: "+Object(h.toMsFromMpegTsClock)(ft,!0)+" ms")}}f&&(Y=Math.max(0,Y));for(var rt=0,xt=0,pt=0;pt<U;pt++){for(var ot=M[pt],Lt=ot.units,wt=Lt.length,Pt=0,ve=0;ve<wt;ve++)Pt+=Lt[ve].data.length;xt+=Pt,rt+=wt,ot.length=Pt,ot.dts=Math.max(ot.dts,Y),ot.pts=Math.max(ot.pts,ot.dts,0),ee=Math.min(ot.pts,ee),re=Math.max(ot.pts,re)}q=M[U-1].dts;var Ce=xt+4*rt+8,ke;try{ke=new Uint8Array(Ce)}catch(Xe){this.observer.emit(p.Events.ERROR,p.Events.ERROR,{type:x.ErrorTypes.MUX_ERROR,details:x.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ce,reason:"fail allocating video mdat "+Ce});return}var Ue=new DataView(ke.buffer);Ue.setUint32(0,Ce),ke.set(o.default.types.mdat,4);for(var Je=0;Je<U;Je++){for(var it=M[Je],X=it.units,Ae=0,Me=0,Ke=X.length;Me<Ke;Me++){var ne=X[Me],_e=ne.data,H=ne.data.byteLength;Ue.setUint32(W,H),W+=4,ke.set(_e,W),W+=H,Ae+=4+H}if(Je<U-1)G=M[Je+1].dts-it.dts;else{var De=this.config,ut=it.dts-M[Je>0?Je-1:Je].dts;if(De.stretchShortVideoTrack&&this.nextAudioPts!==null){var B=Math.floor(De.maxBufferHole*C),ge=(R?ee+R*C:this.nextAudioPts)-it.pts;ge>B?(G=ge-ut,G<0&&(G=ut),g.logger.log("[mp4-remuxer]: It is approximately "+ge/90+" ms to the next segment; using duration "+G/90+" ms for the last video frame.")):G=ut}else G=ut}var xe=Math.round(it.pts-it.dts);N.push(new E(it.key,G,Ae,xe))}if(N.length&&c&&c<70){var $=N[0].flags;$.dependsOn=2,$.isNonSync=0}console.assert(G!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=V=q+G,this.isVideoContiguous=!0;var ae=o.default.moof(A.sequenceNumber++,Y,y({},A,{samples:N})),me="video",at={data1:ae,data2:ke,startPTS:ee/C,endPTS:(re+G)/C,startDTS:Y/C,endDTS:V/C,type:me,hasAudio:!1,hasVideo:!0,nb:N.length,dropped:A.dropped};return A.samples=[],A.dropped=0,console.assert(ke.length,"MDAT length must not be zero"),at},D.remuxAudio=function(A,w,L,R,C){var M=A.inputTimeScale,N=A.samplerate?A.samplerate:M,U=M/N,K=A.isAAC?T:_,V=K*U,W=this._initPTS,G=!A.isAAC&&this.typeSupported.mpeg,Y=[],q=A.samples,ee=G?0:8,re=this.nextAudioPts||-1,pe=w*M;if(this.isAudioContiguous=L=L||q.length&&re>0&&(R&&Math.abs(pe-re)<9e3||Math.abs(l(q[0].pts-W,pe)-re)<20*V),q.forEach(function(_e){_e.pts=l(_e.pts-W,pe)}),!L||re<0){if(q=q.filter(function(_e){return _e.pts>=0}),!q.length)return;C===0?re=0:R?re=Math.max(0,pe):re=q[0].pts}if(A.isAAC)for(var Le=C!==void 0,Te=this.config.maxAudioFramesDrift,be=0,Re=re;be<q.length;be++){var Se=q[be],Ge=Se.pts,$e=Ge-Re,st=Math.abs(1e3*$e/M);if($e<=-Te*V&&Le)be===0&&(g.logger.warn("Audio frame @ "+(Ge/M).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*$e/M)+" ms."),this.nextAudioPts=re=Re=Ge);else if($e>=Te*V&&st<b&&Le){var Ze=Math.round($e/V);Re=Ge-Ze*V,Re<0&&(Ze--,Re+=V),be===0&&(this.nextAudioPts=re=Re),g.logger.warn("[mp4-remuxer]: Injecting "+Ze+" audio frame @ "+(Re/M).toFixed(3)+"s due to "+Math.round(1e3*$e/M)+" ms gap.");for(var et=0;et<Ze;et++){var ft=Math.max(Re,0),dt=s.default.getSilentFrame(A.manifestCodec||A.codec,A.channelCount);dt||(g.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),dt=Se.unit.subarray()),q.splice(be,0,{unit:dt,pts:ft}),Re+=V,be++}}Se.pts=Re,Re+=V}for(var ht=null,He=null,rt,xt=0,pt=q.length;pt--;)xt+=q[pt].unit.byteLength;for(var ot=0,Lt=q.length;ot<Lt;ot++){var wt=q[ot],Pt=wt.unit,ve=wt.pts;if(He!==null){var Ce=Y[ot-1];Ce.duration=Math.round((ve-He)/U)}else if(L&&A.isAAC&&(ve=re),ht=ve,xt>0){xt+=ee;try{rt=new Uint8Array(xt)}catch(_e){this.observer.emit(p.Events.ERROR,p.Events.ERROR,{type:x.ErrorTypes.MUX_ERROR,details:x.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:xt,reason:"fail allocating audio mdat "+xt});return}if(!G){var ke=new DataView(rt.buffer);ke.setUint32(0,xt),rt.set(o.default.types.mdat,4)}}else return;rt.set(Pt,ee);var Ue=Pt.byteLength;ee+=Ue,Y.push(new E(!0,K,Ue,0)),He=ve}var Je=Y.length;if(!!Je){var it=Y[Y.length-1];this.nextAudioPts=re=He+U*it.duration;var X=G?new Uint8Array(0):o.default.moof(A.sequenceNumber++,ht/U,y({},A,{samples:Y}));A.samples=[];var Ae=ht/M,Me=re/M,Ke="audio",ne={data1:X,data2:rt,startPTS:Ae,endPTS:Me,startDTS:Ae,endDTS:Me,type:Ke,hasAudio:!0,hasVideo:!1,nb:Je};return this.isAudioContiguous=!0,console.assert(rt.length,"MDAT length must not be zero"),ne}},D.remuxEmptyAudio=function(A,w,L,R){var C=A.inputTimeScale,M=A.samplerate?A.samplerate:C,N=C/M,U=this.nextAudioPts,K=(U!==null?U:R.startDTS*C)+this._initDTS,V=R.endDTS*C+this._initDTS,W=N*T,G=Math.ceil((V-K)/W),Y=s.default.getSilentFrame(A.manifestCodec||A.codec,A.channelCount);if(g.logger.warn("[mp4-remuxer]: remux empty Audio"),!Y){g.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var q=[],ee=0;ee<G;ee++){var re=K+ee*W;q.push({unit:Y,pts:re,dts:re})}return A.samples=q,this.remuxAudio(A,w,L,!1)},D.remuxID3=function(A,w){var L=A.samples.length;if(!!L){for(var R=A.inputTimeScale,C=this._initPTS,M=this._initDTS,N=0;N<L;N++){var U=A.samples[N];U.pts=l(U.pts-C,w*R)/R,U.dts=l(U.dts-M,w*R)/R}var K=A.samples;return A.samples=[],{samples:K}}},D.remuxText=function(A,w){var L=A.samples.length;if(!!L){for(var R=A.inputTimeScale,C=this._initPTS,M=0;M<L;M++){var N=A.samples[M];N.pts=l(N.pts-C,w*R)/R}A.samples.sort(function(K,V){return K.pts-V.pts});var U=A.samples;return A.samples=[],{samples:U}}},O}();function l(O,D){var P;if(D===null)return O;for(D<O?P=-8589934592:P=8589934592;Math.abs(O-D)>4294967296;)O+=P;return O}function m(O){for(var D=0;D<O.length;D++)if(O[D].key)return D;return-1}var E=function(D,P,A,w){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=P,this.size=A,this.cts=w,this.flags=new S(D)},S=function(D){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=D?2:1,this.isNonSync=D?0:1}},"./src/remux/passthrough-remuxer.ts":function(r,n,t){t.r(n);var a=t("./src/polyfills/number.ts"),s=t("./src/utils/mp4-tools.ts"),o=t("./src/loader/fragment.ts"),p=t("./src/utils/logger.ts"),x=function(){function h(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var y=h.prototype;return y.destroy=function(){},y.resetTimeStamp=function(T){this.initPTS=T,this.lastEndDTS=null},y.resetNextTimestamp=function(){this.lastEndDTS=null},y.resetInitSegment=function(T,_,c){this.audioCodec=_,this.videoCodec=c,this.generateInitSegment(T),this.emitInitSegment=!0},y.generateInitSegment=function(T){var _=this.audioCodec,c=this.videoCodec;if(!T||!T.byteLength){this.initTracks=void 0,this.initData=void 0;return}var u=this.initData=Object(s.parseInitSegment)(T);_||(_=d(u.audio,o.ElementaryStreamTypes.AUDIO)),c||(c=d(u.video,o.ElementaryStreamTypes.VIDEO));var f={};u.audio&&u.video?f.audiovideo={container:"video/mp4",codec:_+","+c,initSegment:T,id:"main"}:u.audio?f.audio={container:"audio/mp4",codec:_,initSegment:T,id:"audio"}:u.video?f.video={container:"video/mp4",codec:c,initSegment:T,id:"main"}:p.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=f},y.remux=function(T,_,c,u,f){var v=this.initPTS,l=this.lastEndDTS,m={audio:void 0,video:void 0,text:u,id3:c,initSegment:void 0};Object(a.isFiniteNumber)(l)||(l=this.lastEndDTS=f||0);var E=_.samples;if(!E||!E.length)return m;var S={initPTS:void 0,timescale:1},O=this.initData;if((!O||!O.length)&&(this.generateInitSegment(E),O=this.initData),!O||!O.length)return p.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),m;this.emitInitSegment&&(S.tracks=this.initTracks,this.emitInitSegment=!1),Object(a.isFiniteNumber)(v)||(this.initPTS=S.initPTS=v=g(O,E,l));var D=Object(s.getDuration)(E,O),P=l,A=D+P;Object(s.offsetStartDTS)(O,E,v),D>0?this.lastEndDTS=A:(p.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var w=!!O.audio,L=!!O.video,R="";w&&(R+="audio"),L&&(R+="video");var C={data1:E,startPTS:P,startDTS:P,endPTS:A,endDTS:A,type:R,hasAudio:w,hasVideo:L,nb:1,dropped:0};return m.audio=C.type==="audio"?C:void 0,m.video=C.type!=="audio"?C:void 0,m.text=u,m.id3=c,m.initSegment=S,m},h}(),g=function(y,b,T){return Object(s.getStartDTS)(y,b)-T};function d(h,y){var b=h==null?void 0:h.codec;return b&&b.length>4?b:b==="hvc1"?"hvc1.1.c.L120.90":b==="av01"?"av01.0.04M.08":b==="avc1"||y===o.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}n.default=x},"./src/task-loop.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return a});var a=function(){function s(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var o=s.prototype;return o.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},o.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},o.onHandlerDestroyed=function(){},o.hasInterval=function(){return!!this._tickInterval},o.hasNextTick=function(){return!!this._tickTimer},o.setInterval=function(x){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,x),!0)},o.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},o.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},o.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},o.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},o.doTick=function(){},s}()},"./src/types/cmcd.ts":function(r,n,t){t.r(n),t.d(n,"CMCDVersion",function(){return a}),t.d(n,"CMCDObjectType",function(){return s}),t.d(n,"CMCDStreamingFormat",function(){return o}),t.d(n,"CMCDStreamType",function(){return p});var a=1,s;(function(x){x.MANIFEST="m",x.AUDIO="a",x.VIDEO="v",x.MUXED="av",x.INIT="i",x.CAPTION="c",x.TIMED_TEXT="tt",x.KEY="k",x.OTHER="o"})(s||(s={}));var o;(function(x){x.DASH="d",x.HLS="h",x.SMOOTH="s",x.OTHER="o"})(o||(o={}));var p;(function(x){x.VOD="v",x.LIVE="l"})(p||(p={}))},"./src/types/level.ts":function(r,n,t){t.r(n),t.d(n,"HlsSkip",function(){return o}),t.d(n,"getSkipValue",function(){return p}),t.d(n,"HlsUrlParameters",function(){return x}),t.d(n,"Level",function(){return g});function a(d,h){for(var y=0;y<h.length;y++){var b=h[y];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(d,b.key,b)}}function s(d,h,y){return h&&a(d.prototype,h),y&&a(d,y),d}var o;(function(d){d.No="",d.Yes="YES",d.v2="v2"})(o||(o={}));function p(d,h){var y=d.canSkipUntil,b=d.canSkipDateRanges,T=d.endSN,_=h!==void 0?h-T:0;return y&&_<y?b?o.v2:o.Yes:o.No}var x=function(){function d(y,b,T){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=y,this.part=b,this.skip=T}var h=d.prototype;return h.addDirectives=function(b){var T=new self.URL(b);return this.msn!==void 0&&T.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&T.searchParams.set("_HLS_part",this.part.toString()),this.skip&&T.searchParams.set("_HLS_skip",this.skip),T.toString()},d}(),g=function(){function d(h){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[h.url],this.attrs=h.attrs,this.bitrate=h.bitrate,h.details&&(this.details=h.details),this.id=h.id||0,this.name=h.name,this.width=h.width||0,this.height=h.height||0,this.audioCodec=h.audioCodec,this.videoCodec=h.videoCodec,this.unknownCodecs=h.unknownCodecs,this.codecSet=[h.videoCodec,h.audioCodec].filter(function(y){return y}).join(",").replace(/\.[^.,]+/g,"")}return s(d,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(y){var b=y%this.url.length;this._urlId!==b&&(this.details=void 0,this._urlId=b)}}]),d}()},"./src/types/loader.ts":function(r,n,t){t.r(n),t.d(n,"PlaylistContextType",function(){return a}),t.d(n,"PlaylistLevelType",function(){return s});var a;(function(o){o.MANIFEST="manifest",o.LEVEL="level",o.AUDIO_TRACK="audioTrack",o.SUBTITLE_TRACK="subtitleTrack"})(a||(a={}));var s;(function(o){o.MAIN="main",o.AUDIO="audio",o.SUBTITLE="subtitle"})(s||(s={}))},"./src/types/transmuxer.ts":function(r,n,t){t.r(n),t.d(n,"ChunkMetadata",function(){return a});var a=function(p,x,g,d,h,y){d===void 0&&(d=0),h===void 0&&(h=-1),y===void 0&&(y=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=s(),this.buffering={audio:s(),video:s(),audiovideo:s()},this.level=p,this.sn=x,this.id=g,this.size=d,this.part=h,this.partial=y};function s(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(r,n,t){t.r(n),t.d(n,"AttrList",function(){return o});var a=/^(\d+)x(\d+)$/,s=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,o=function(){function p(g){typeof g=="string"&&(g=p.parseAttrList(g));for(var d in g)g.hasOwnProperty(d)&&(this[d]=g[d])}var x=p.prototype;return x.decimalInteger=function(d){var h=parseInt(this[d],10);return h>Number.MAX_SAFE_INTEGER?1/0:h},x.hexadecimalInteger=function(d){if(this[d]){var h=(this[d]||"0x").slice(2);h=(h.length&1?"0":"")+h;for(var y=new Uint8Array(h.length/2),b=0;b<h.length/2;b++)y[b]=parseInt(h.slice(b*2,b*2+2),16);return y}else return null},x.hexadecimalIntegerAsNumber=function(d){var h=parseInt(this[d],16);return h>Number.MAX_SAFE_INTEGER?1/0:h},x.decimalFloatingPoint=function(d){return parseFloat(this[d])},x.optionalFloat=function(d,h){var y=this[d];return y?parseFloat(y):h},x.enumeratedString=function(d){return this[d]},x.bool=function(d){return this[d]==="YES"},x.decimalResolution=function(d){var h=a.exec(this[d]);if(h!==null)return{width:parseInt(h[1],10),height:parseInt(h[2],10)}},p.parseAttrList=function(d){var h,y={},b='"';for(s.lastIndex=0;(h=s.exec(d))!==null;){var T=h[2];T.indexOf(b)===0&&T.lastIndexOf(b)===T.length-1&&(T=T.slice(1,-1)),y[h[1]]=T}return y},p}()},"./src/utils/binary-search.ts":function(r,n,t){t.r(n);var a={search:function(o,p){for(var x=0,g=o.length-1,d=null,h=null;x<=g;){d=(x+g)/2|0,h=o[d];var y=p(h);if(y>0)x=d+1;else if(y<0)g=d-1;else return h}return null}};n.default=a},"./src/utils/buffer-helper.ts":function(r,n,t){t.r(n),t.d(n,"BufferHelper",function(){return o});var a=t("./src/utils/logger.ts"),s={length:0,start:function(){return 0},end:function(){return 0}},o=function(){function p(){}return p.isBuffered=function(g,d){try{if(g){for(var h=p.getBuffered(g),y=0;y<h.length;y++)if(d>=h.start(y)&&d<=h.end(y))return!0}}catch(b){}return!1},p.bufferInfo=function(g,d,h){try{if(g){var y=p.getBuffered(g),b=[],T;for(T=0;T<y.length;T++)b.push({start:y.start(T),end:y.end(T)});return this.bufferedInfo(b,d,h)}}catch(_){}return{len:0,start:d,end:d,nextStart:void 0}},p.bufferedInfo=function(g,d,h){d=Math.max(0,d),g.sort(function(S,O){var D=S.start-O.start;return D||O.end-S.end});var y=[];if(h)for(var b=0;b<g.length;b++){var T=y.length;if(T){var _=y[T-1].end;g[b].start-_<h?g[b].end>_&&(y[T-1].end=g[b].end):y.push(g[b])}else y.push(g[b])}else y=g;for(var c=0,u,f=d,v=d,l=0;l<y.length;l++){var m=y[l].start,E=y[l].end;if(d+h>=m&&d<E)f=m,v=E,c=v-d;else if(d+h<m){u=m;break}}return{len:c,start:f||0,end:v||0,nextStart:u}},p.getBuffered=function(g){try{return g.buffered}catch(d){return a.logger.log("failed to get media.buffered",d),s}},p}()},"./src/utils/cea-608-parser.ts":function(r,n,t){t.r(n),t.d(n,"Row",function(){return v}),t.d(n,"CaptionScreen",function(){return l});var a=t("./src/utils/logger.ts"),s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(A){var w=A;return s.hasOwnProperty(A)&&(w=s[A]),String.fromCharCode(w)},p=15,x=100,g={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},d={17:2,18:4,21:6,22:8,23:10,19:13,20:15},h={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},y={25:2,26:4,29:6,30:8,31:10,27:13,28:15},b=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],T;(function(P){P[P.ERROR=0]="ERROR",P[P.TEXT=1]="TEXT",P[P.WARNING=2]="WARNING",P[P.INFO=2]="INFO",P[P.DEBUG=3]="DEBUG",P[P.DATA=3]="DATA"})(T||(T={}));var _=function(){function P(){this.time=null,this.verboseLevel=T.ERROR}var A=P.prototype;return A.log=function(L,R){this.verboseLevel>=L&&a.logger.log(this.time+" ["+L+"] "+R)},P}(),c=function(A){for(var w=[],L=0;L<A.length;L++)w.push(A[L].toString(16));return w},u=function(){function P(w,L,R,C,M){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=w||"white",this.underline=L||!1,this.italics=R||!1,this.background=C||"black",this.flash=M||!1}var A=P.prototype;return A.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},A.setStyles=function(L){for(var R=["foreground","underline","italics","background","flash"],C=0;C<R.length;C++){var M=R[C];L.hasOwnProperty(M)&&(this[M]=L[M])}},A.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},A.equals=function(L){return this.foreground===L.foreground&&this.underline===L.underline&&this.italics===L.italics&&this.background===L.background&&this.flash===L.flash},A.copy=function(L){this.foreground=L.foreground,this.underline=L.underline,this.italics=L.italics,this.background=L.background,this.flash=L.flash},A.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},P}(),f=function(){function P(w,L,R,C,M,N){this.uchar=void 0,this.penState=void 0,this.uchar=w||" ",this.penState=new u(L,R,C,M,N)}var A=P.prototype;return A.reset=function(){this.uchar=" ",this.penState.reset()},A.setChar=function(L,R){this.uchar=L,this.penState.copy(R)},A.setPenState=function(L){this.penState.copy(L)},A.equals=function(L){return this.uchar===L.uchar&&this.penState.equals(L.penState)},A.copy=function(L){this.uchar=L.uchar,this.penState.copy(L.penState)},A.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},P}(),v=function(){function P(w){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var L=0;L<x;L++)this.chars.push(new f);this.logger=w,this.pos=0,this.currPenState=new u}var A=P.prototype;return A.equals=function(L){for(var R=!0,C=0;C<x;C++)if(!this.chars[C].equals(L.chars[C])){R=!1;break}return R},A.copy=function(L){for(var R=0;R<x;R++)this.chars[R].copy(L.chars[R])},A.isEmpty=function(){for(var L=!0,R=0;R<x;R++)if(!this.chars[R].isEmpty()){L=!1;break}return L},A.setCursor=function(L){this.pos!==L&&(this.pos=L),this.pos<0?(this.logger.log(T.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>x&&(this.logger.log(T.DEBUG,"Too large cursor position "+this.pos),this.pos=x)},A.moveCursor=function(L){var R=this.pos+L;if(L>1)for(var C=this.pos+1;C<R+1;C++)this.chars[C].setPenState(this.currPenState);this.setCursor(R)},A.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},A.insertChar=function(L){L>=144&&this.backSpace();var R=o(L);if(this.pos>=x){this.logger.log(T.ERROR,"Cannot insert "+L.toString(16)+" ("+R+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(R,this.currPenState),this.moveCursor(1)},A.clearFromPos=function(L){var R;for(R=L;R<x;R++)this.chars[R].reset()},A.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},A.clearToEndOfRow=function(){this.clearFromPos(this.pos)},A.getTextString=function(){for(var L=[],R=!0,C=0;C<x;C++){var M=this.chars[C].uchar;M!==" "&&(R=!1),L.push(M)}return R?"":L.join("")},A.setPenStyles=function(L){this.currPenState.setStyles(L);var R=this.chars[this.pos];R.setPenState(this.currPenState)},P}(),l=function(){function P(w){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var L=0;L<p;L++)this.rows.push(new v(w));this.logger=w,this.currRow=p-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var A=P.prototype;return A.reset=function(){for(var L=0;L<p;L++)this.rows[L].clear();this.currRow=p-1},A.equals=function(L){for(var R=!0,C=0;C<p;C++)if(!this.rows[C].equals(L.rows[C])){R=!1;break}return R},A.copy=function(L){for(var R=0;R<p;R++)this.rows[R].copy(L.rows[R])},A.isEmpty=function(){for(var L=!0,R=0;R<p;R++)if(!this.rows[R].isEmpty()){L=!1;break}return L},A.backSpace=function(){var L=this.rows[this.currRow];L.backSpace()},A.clearToEndOfRow=function(){var L=this.rows[this.currRow];L.clearToEndOfRow()},A.insertChar=function(L){var R=this.rows[this.currRow];R.insertChar(L)},A.setPen=function(L){var R=this.rows[this.currRow];R.setPenStyles(L)},A.moveCursor=function(L){var R=this.rows[this.currRow];R.moveCursor(L)},A.setCursor=function(L){this.logger.log(T.INFO,"setCursor: "+L);var R=this.rows[this.currRow];R.setCursor(L)},A.setPAC=function(L){this.logger.log(T.INFO,"pacData = "+JSON.stringify(L));var R=L.row-1;if(this.nrRollUpRows&&R<this.nrRollUpRows-1&&(R=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==R){for(var C=0;C<p;C++)this.rows[C].clear();var M=this.currRow+1-this.nrRollUpRows,N=this.lastOutputScreen;if(N){var U=N.rows[M].cueStartTime,K=this.logger.time;if(U&&K!==null&&U<K)for(var V=0;V<this.nrRollUpRows;V++)this.rows[R-this.nrRollUpRows+V+1].copy(N.rows[M+V])}}this.currRow=R;var W=this.rows[this.currRow];if(L.indent!==null){var G=L.indent,Y=Math.max(G-1,0);W.setCursor(L.indent),L.color=W.chars[Y].penState.foreground}var q={foreground:L.color,underline:L.underline,italics:L.italics,background:"black",flash:!1};this.setPen(q)},A.setBkgData=function(L){this.logger.log(T.INFO,"bkgData = "+JSON.stringify(L)),this.backSpace(),this.setPen(L),this.insertChar(32)},A.setRollUpRows=function(L){this.nrRollUpRows=L},A.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(T.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(T.TEXT,this.getDisplayText());var L=this.currRow+1-this.nrRollUpRows,R=this.rows.splice(L,1)[0];R.clear(),this.rows.splice(this.currRow,0,R),this.logger.log(T.INFO,"Rolling up")},A.getDisplayText=function(L){L=L||!1;for(var R=[],C="",M=-1,N=0;N<p;N++){var U=this.rows[N].getTextString();U&&(M=N+1,L?R.push("Row "+M+": '"+U+"'"):R.push(U.trim()))}return R.length>0&&(L?C="["+R.join(" | ")+"]":C=R.join(`
`)),C},A.getTextAndFormat=function(){return this.rows},P}(),m=function(){function P(w,L,R){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=w,this.outputFilter=L,this.mode=null,this.verbose=0,this.displayedMemory=new l(R),this.nonDisplayedMemory=new l(R),this.lastOutputScreen=new l(R),this.currRollUpRow=this.displayedMemory.rows[p-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=R}var A=P.prototype;return A.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[p-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},A.getHandler=function(){return this.outputFilter},A.setHandler=function(L){this.outputFilter=L},A.setPAC=function(L){this.writeScreen.setPAC(L)},A.setBkgData=function(L){this.writeScreen.setBkgData(L)},A.setMode=function(L){L!==this.mode&&(this.mode=L,this.logger.log(T.INFO,"MODE="+L),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=L)},A.insertChars=function(L){for(var R=0;R<L.length;R++)this.writeScreen.insertChar(L[R]);var C=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(T.INFO,C+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(T.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},A.ccRCL=function(){this.logger.log(T.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},A.ccBS=function(){this.logger.log(T.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},A.ccAOF=function(){},A.ccAON=function(){},A.ccDER=function(){this.logger.log(T.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},A.ccRU=function(L){this.logger.log(T.INFO,"RU("+L+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(L)},A.ccFON=function(){this.logger.log(T.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},A.ccRDC=function(){this.logger.log(T.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},A.ccTR=function(){this.logger.log(T.INFO,"TR"),this.setMode("MODE_TEXT")},A.ccRTD=function(){this.logger.log(T.INFO,"RTD"),this.setMode("MODE_TEXT")},A.ccEDM=function(){this.logger.log(T.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},A.ccCR=function(){this.logger.log(T.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},A.ccENM=function(){this.logger.log(T.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},A.ccEOC=function(){if(this.logger.log(T.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var L=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=L,this.writeScreen=this.nonDisplayedMemory,this.logger.log(T.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},A.ccTO=function(L){this.logger.log(T.INFO,"TO("+L+") - Tab Offset"),this.writeScreen.moveCursor(L)},A.ccMIDROW=function(L){var R={flash:!1};if(R.underline=L%2==1,R.italics=L>=46,R.italics)R.foreground="white";else{var C=Math.floor(L/2)-16,M=["white","green","blue","cyan","red","yellow","magenta"];R.foreground=M[C]}this.logger.log(T.INFO,"MIDROW: "+JSON.stringify(R)),this.writeScreen.setPen(R)},A.outputDataUpdate=function(L){L===void 0&&(L=!1);var R=this.logger.time;R!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=R:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,R,this.lastOutputScreen),L&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:R),this.lastOutputScreen.copy(this.displayedMemory))},A.cueSplitAtTime=function(L){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,L,this.displayedMemory),this.cueStartTime=L))},P}(),E=function(){function P(w,L,R){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var C=new _;this.channels=[null,new m(w,L,C),new m(w+1,R,C)],this.cmdHistory=D(),this.logger=C}var A=P.prototype;return A.getHandler=function(L){return this.channels[L].getHandler()},A.setHandler=function(L,R){this.channels[L].setHandler(R)},A.addData=function(L,R){var C,M,N,U=!1;this.logger.time=L;for(var K=0;K<R.length;K+=2)if(M=R[K]&127,N=R[K+1]&127,!(M===0&&N===0)){if(this.logger.log(T.DATA,"["+c([R[K],R[K+1]])+"] -> ("+c([M,N])+")"),C=this.parseCmd(M,N),C||(C=this.parseMidrow(M,N)),C||(C=this.parsePAC(M,N)),C||(C=this.parseBackgroundAttributes(M,N)),!C&&(U=this.parseChars(M,N),U)){var V=this.currentChannel;if(V&&V>0){var W=this.channels[V];W.insertChars(U)}else this.logger.log(T.WARNING,"No channel found yet. TEXT-MODE?")}!C&&!U&&this.logger.log(T.WARNING,"Couldn't parse cleaned data "+c([M,N])+" orig: "+c([R[K],R[K+1]]))}},A.parseCmd=function(L,R){var C=this.cmdHistory,M=(L===20||L===28||L===21||L===29)&&R>=32&&R<=47,N=(L===23||L===31)&&R>=33&&R<=35;if(!(M||N))return!1;if(O(L,R,C))return S(null,null,C),this.logger.log(T.DEBUG,"Repeated command ("+c([L,R])+") is dropped"),!0;var U=L===20||L===21||L===23?1:2,K=this.channels[U];return L===20||L===21||L===28||L===29?R===32?K.ccRCL():R===33?K.ccBS():R===34?K.ccAOF():R===35?K.ccAON():R===36?K.ccDER():R===37?K.ccRU(2):R===38?K.ccRU(3):R===39?K.ccRU(4):R===40?K.ccFON():R===41?K.ccRDC():R===42?K.ccTR():R===43?K.ccRTD():R===44?K.ccEDM():R===45?K.ccCR():R===46?K.ccENM():R===47&&K.ccEOC():K.ccTO(R-32),S(L,R,C),this.currentChannel=U,!0},A.parseMidrow=function(L,R){var C=0;if((L===17||L===25)&&R>=32&&R<=47){if(L===17?C=1:C=2,C!==this.currentChannel)return this.logger.log(T.ERROR,"Mismatch channel in midrow parsing"),!1;var M=this.channels[C];return M?(M.ccMIDROW(R),this.logger.log(T.DEBUG,"MIDROW ("+c([L,R])+")"),!0):!1}return!1},A.parsePAC=function(L,R){var C,M=this.cmdHistory,N=(L>=17&&L<=23||L>=25&&L<=31)&&R>=64&&R<=127,U=(L===16||L===24)&&R>=64&&R<=95;if(!(N||U))return!1;if(O(L,R,M))return S(null,null,M),!0;var K=L<=23?1:2;R>=64&&R<=95?C=K===1?g[L]:h[L]:C=K===1?d[L]:y[L];var V=this.channels[K];return V?(V.setPAC(this.interpretPAC(C,R)),S(L,R,M),this.currentChannel=K,!0):!1},A.interpretPAC=function(L,R){var C,M={color:null,italics:!1,indent:null,underline:!1,row:L};return R>95?C=R-96:C=R-64,M.underline=(C&1)==1,C<=13?M.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(C/2)]:C<=15?(M.italics=!0,M.color="white"):M.indent=Math.floor((C-16)/2)*4,M},A.parseChars=function(L,R){var C,M=null,N=null;if(L>=25?(C=2,N=L-8):(C=1,N=L),N>=17&&N<=19){var U;N===17?U=R+80:N===18?U=R+112:U=R+144,this.logger.log(T.INFO,"Special char '"+o(U)+"' in channel "+C),M=[U]}else L>=32&&L<=127&&(M=R===0?[L]:[L,R]);if(M){var K=c(M);this.logger.log(T.DEBUG,"Char codes =  "+K.join(",")),S(L,R,this.cmdHistory)}return M},A.parseBackgroundAttributes=function(L,R){var C=(L===16||L===24)&&R>=32&&R<=47,M=(L===23||L===31)&&R>=45&&R<=47;if(!(C||M))return!1;var N,U={};L===16||L===24?(N=Math.floor((R-32)/2),U.background=b[N],R%2==1&&(U.background=U.background+"_semi")):R===45?U.background="transparent":(U.foreground="black",R===47&&(U.underline=!0));var K=L<=23?1:2,V=this.channels[K];return V.setBkgData(U),S(L,R,this.cmdHistory),!0},A.reset=function(){for(var L=0;L<Object.keys(this.channels).length;L++){var R=this.channels[L];R&&R.reset()}this.cmdHistory=D()},A.cueSplitAtTime=function(L){for(var R=0;R<this.channels.length;R++){var C=this.channels[R];C&&C.cueSplitAtTime(L)}},P}();function S(P,A,w){w.a=P,w.b=A}function O(P,A,w){return w.a===P&&w.b===A}function D(){return{a:null,b:null}}n.default=E},"./src/utils/codecs.ts":function(r,n,t){t.r(n),t.d(n,"isCodecType",function(){return s}),t.d(n,"isCodecSupportedInMp4",function(){return o});var a={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function s(p,x){var g=a[x];return!!g&&g[p.slice(0,4)]===!0}function o(p,x){return MediaSource.isTypeSupported((x||"video")+'/mp4;codecs="'+p+'"')}},"./src/utils/cues.ts":function(r,n,t){t.r(n);var a=t("./src/utils/vttparser.ts"),s=t("./src/utils/webvtt-parser.ts"),o=t("./src/utils/texttrack-utils.ts"),p=/\s/,x={newCue:function(d,h,y,b){for(var T=[],_,c,u,f,v,l=self.VTTCue||self.TextTrackCue,m=0;m<b.rows.length;m++)if(_=b.rows[m],u=!0,f=0,v="",!_.isEmpty()){for(var E=0;E<_.chars.length;E++)p.test(_.chars[E].uchar)&&u?f++:(v+=_.chars[E].uchar,u=!1);_.cueStartTime=h,h===y&&(y+=1e-4),f>=16?f--:f++;var S=Object(a.fixLineBreaks)(v.trim()),O=Object(s.generateCueId)(h,y,S);(!d||!d.cues||!d.cues.getCueById(O))&&(c=new l(h,y,S),c.id=O,c.line=m+1,c.align="left",c.position=10+Math.min(80,Math.floor(f*8/32)*10),T.push(c))}return d&&T.length&&(T.sort(function(D,P){return D.line==="auto"||P.line==="auto"?0:D.line>8&&P.line>8?P.line-D.line:D.line-P.line}),T.forEach(function(D){return Object(o.addCueToTrack)(d,D)})),T}};n.default=x},"./src/utils/discontinuities.ts":function(r,n,t){t.r(n),t.d(n,"findFirstFragWithCC",function(){return p}),t.d(n,"shouldAlignOnDiscontinuities",function(){return x}),t.d(n,"findDiscontinuousReferenceFrag",function(){return g}),t.d(n,"adjustSlidingStart",function(){return h}),t.d(n,"alignStream",function(){return y}),t.d(n,"alignPDT",function(){return T}),t.d(n,"alignFragmentByPDTDelta",function(){return _}),t.d(n,"alignMediaPlaylistByPDT",function(){return c});var a=t("./src/polyfills/number.ts"),s=t("./src/utils/logger.ts"),o=t("./src/controller/level-helper.ts");function p(u,f){for(var v=null,l=0,m=u.length;l<m;l++){var E=u[l];if(E&&E.cc===f){v=E;break}}return v}function x(u,f,v){return!!(f.details&&(v.endCC>v.startCC||u&&u.cc<v.startCC))}function g(u,f){var v=u.fragments,l=f.fragments;if(!l.length||!v.length){s.logger.log("No fragments to align");return}var m=p(v,l[0].cc);if(!m||m&&!m.startPTS){s.logger.log("No frag in previous level to align on");return}return m}function d(u,f){if(u){var v=u.start+f;u.start=u.startPTS=v,u.endPTS=v+u.duration}}function h(u,f){for(var v=f.fragments,l=0,m=v.length;l<m;l++)d(v[l],u);f.fragmentHint&&d(f.fragmentHint,u),f.alignedSliding=!0}function y(u,f,v){!f||(b(u,v,f),!v.alignedSliding&&f.details&&T(v,f.details),!v.alignedSliding&&f.details&&!v.skippedSegments&&Object(o.adjustSliding)(f.details,v))}function b(u,f,v){if(x(u,v,f)){var l=g(v.details,f);l&&Object(a.isFiniteNumber)(l.start)&&(s.logger.log("Adjusting PTS using last level due to CC increase within current level "+f.url),h(l.start,f))}}function T(u,f){if(!(!f.fragments.length||!u.hasProgramDateTime||!f.hasProgramDateTime)){var v=f.fragments[0].programDateTime,l=u.fragments[0].programDateTime,m=(l-v)/1e3+f.fragments[0].start;m&&Object(a.isFiniteNumber)(m)&&(s.logger.log("Adjusting PTS using programDateTime delta "+(l-v)+"ms, sliding:"+m.toFixed(3)+" "+u.url+" "),h(m,u))}}function _(u,f){var v=u.programDateTime;if(!!v){var l=(v-f)/1e3;u.start=u.startPTS=l,u.endPTS=l+u.duration}}function c(u,f){if(!(!f.fragments.length||!u.hasProgramDateTime||!f.hasProgramDateTime)){var v=f.fragments[0].programDateTime,l=f.fragments[0].start,m=v-l*1e3;u.fragments.forEach(function(E){_(E,m)}),u.fragmentHint&&_(u.fragmentHint,m),u.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(r,n,t){t.r(n);var a=t("./src/utils/ewma.ts"),s=function(){function o(x,g,d){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=d,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new a.default(x),this.fast_=new a.default(g)}var p=o.prototype;return p.update=function(g,d){var h=this.slow_,y=this.fast_;this.slow_.halfLife!==g&&(this.slow_=new a.default(g,h.getEstimate(),h.getTotalWeight())),this.fast_.halfLife!==d&&(this.fast_=new a.default(d,y.getEstimate(),y.getTotalWeight()))},p.sample=function(g,d){g=Math.max(g,this.minDelayMs_);var h=8*d,y=g/1e3,b=h/y;this.fast_.sample(y,b),this.slow_.sample(y,b)},p.canEstimate=function(){var g=this.fast_;return g&&g.getTotalWeight()>=this.minWeight_},p.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},p.destroy=function(){},o}();n.default=s},"./src/utils/ewma.ts":function(r,n,t){t.r(n);var a=function(){function s(p,x,g){x===void 0&&(x=0),g===void 0&&(g=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=p,this.alpha_=p?Math.exp(Math.log(.5)/p):0,this.estimate_=x,this.totalWeight_=g}var o=s.prototype;return o.sample=function(x,g){var d=Math.pow(this.alpha_,x);this.estimate_=g*(1-d)+d*this.estimate_,this.totalWeight_+=x},o.getTotalWeight=function(){return this.totalWeight_},o.getEstimate=function(){if(this.alpha_){var x=1-Math.pow(this.alpha_,this.totalWeight_);if(x)return this.estimate_/x}return this.estimate_},s}();n.default=a},"./src/utils/fetch-loader.ts":function(r,n,t){t.r(n),t.d(n,"fetchSupported",function(){return _});var a=t("./src/polyfills/number.ts"),s=t("./src/loader/load-stats.ts"),o=t("./src/demux/chunk-cache.ts");function p(l,m){l.prototype=Object.create(m.prototype),l.prototype.constructor=l,y(l,m)}function x(l){var m=typeof Map=="function"?new Map:void 0;return x=function(S){if(S===null||!h(S))return S;if(typeof S!="function")throw new TypeError("Super expression must either be null or a function");if(typeof m!="undefined"){if(m.has(S))return m.get(S);m.set(S,O)}function O(){return g(S,arguments,b(this).constructor)}return O.prototype=Object.create(S.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),y(O,S)},x(l)}function g(l,m,E){return d()?g=Reflect.construct:g=function(O,D,P){var A=[null];A.push.apply(A,D);var w=Function.bind.apply(O,A),L=new w;return P&&y(L,P.prototype),L},g.apply(null,arguments)}function d(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(l){return!1}}function h(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function y(l,m){return y=Object.setPrototypeOf||function(S,O){return S.__proto__=O,S},y(l,m)}function b(l){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(E){return E.__proto__||Object.getPrototypeOf(E)},b(l)}function T(){return T=Object.assign||function(l){for(var m=1;m<arguments.length;m++){var E=arguments[m];for(var S in E)Object.prototype.hasOwnProperty.call(E,S)&&(l[S]=E[S])}return l},T.apply(this,arguments)}function _(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(l){}return!1}var c=function(){function l(E){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=E.fetchSetup||f,this.controller=new self.AbortController,this.stats=new s.LoadStats}var m=l.prototype;return m.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},m.abortInternal=function(){var S=this.response;(!S||!S.ok)&&(this.stats.aborted=!0,this.controller.abort())},m.abort=function(){var S;this.abortInternal(),(S=this.callbacks)!==null&&S!==void 0&&S.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},m.load=function(S,O,D){var P=this,A=this.stats;if(A.loading.start)throw new Error("Loader can only be used once.");A.loading.start=self.performance.now();var w=u(S,this.controller.signal),L=D.onProgress,R=S.responseType==="arraybuffer",C=R?"byteLength":"length";this.context=S,this.config=O,this.callbacks=D,this.request=this.fetchSetup(S,w),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){P.abortInternal(),D.onTimeout(A,S,P.response)},O.timeout),self.fetch(this.request).then(function(M){if(P.response=P.loader=M,!M.ok){var N=M.status,U=M.statusText;throw new v(U||"fetch, bad network response",N,M)}return A.loading.first=Math.max(self.performance.now(),A.loading.start),A.total=parseInt(M.headers.get("Content-Length")||"0"),L&&Object(a.isFiniteNumber)(O.highWaterMark)?P.loadProgressively(M,A,S,O.highWaterMark,L):R?M.arrayBuffer():M.text()}).then(function(M){var N=P.response;self.clearTimeout(P.requestTimeout),A.loading.end=Math.max(self.performance.now(),A.loading.first),A.loaded=A.total=M[C];var U={url:N.url,data:M};L&&!Object(a.isFiniteNumber)(O.highWaterMark)&&L(A,S,M,N),D.onSuccess(U,A,S,N)}).catch(function(M){if(self.clearTimeout(P.requestTimeout),!A.aborted){var N=M.code||0;D.onError({code:N,text:M.message},S,M.details)}})},m.getCacheAge=function(){var S=null;if(this.response){var O=this.response.headers.get("age");S=O?parseFloat(O):null}return S},m.loadProgressively=function(S,O,D,P,A){P===void 0&&(P=0);var w=new o.default,L=S.body.getReader(),R=function C(){return L.read().then(function(M){if(M.done)return w.dataLength&&A(O,D,w.flush(),S),Promise.resolve(new ArrayBuffer(0));var N=M.value,U=N.length;return O.loaded+=U,U<P||w.dataLength?(w.push(N),w.dataLength>=P&&A(O,D,w.flush(),S)):A(O,D,N,S),C()}).catch(function(){return Promise.reject()})};return R()},l}();function u(l,m){var E={method:"GET",mode:"cors",credentials:"same-origin",signal:m,headers:new self.Headers(T({},l.headers))};return l.rangeEnd&&E.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),E}function f(l,m){return new self.Request(l.url,m)}var v=function(l){p(m,l);function m(E,S,O){var D;return D=l.call(this,E)||this,D.code=void 0,D.details=void 0,D.code=S,D.details=O,D}return m}(x(Error));n.default=c},"./src/utils/imsc1-ttml-parser.ts":function(r,n,t){t.r(n),t.d(n,"IMSC1_CODEC",function(){return h}),t.d(n,"parseIMSC1",function(){return _});var a=t("./src/utils/mp4-tools.ts"),s=t("./src/utils/vttparser.ts"),o=t("./src/utils/vttcue.ts"),p=t("./src/demux/id3.ts"),x=t("./src/utils/timescale-conversion.ts"),g=t("./src/utils/webvtt-parser.ts");function d(){return d=Object.assign||function(P){for(var A=1;A<arguments.length;A++){var w=arguments[A];for(var L in w)Object.prototype.hasOwnProperty.call(w,L)&&(P[L]=w[L])}return P},d.apply(this,arguments)}var h="stpp.ttml.im1t",y=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,b=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,T={left:"start",center:"center",right:"end",start:"start",end:"end"};function _(P,A,w,L,R){var C=Object(a.findBox)(new Uint8Array(P),["mdat"]);if(C.length===0){R(new Error("Could not parse IMSC1 mdat"));return}var M=C[0],N=Object(p.utf8ArrayToStr)(new Uint8Array(P,M.start,M.end-M.start)),U=Object(x.toTimescaleFromScale)(A,1,w);try{L(c(N,U))}catch(K){R(K)}}function c(P,A){var w=new DOMParser,L=w.parseFromString(P,"text/xml"),R=L.getElementsByTagName("tt")[0];if(!R)throw new Error("Invalid ttml");var C={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},M=Object.keys(C).reduce(function(W,G){return W[G]=R.getAttribute("ttp:"+G)||C[G],W},{}),N=R.getAttribute("xml:space")!=="preserve",U=f(u(R,"styling","style")),K=f(u(R,"layout","region")),V=u(R,"body","[begin]");return[].map.call(V,function(W){var G=v(W,N);if(!G||!W.hasAttribute("begin"))return null;var Y=S(W.getAttribute("begin"),M),q=S(W.getAttribute("dur"),M),ee=S(W.getAttribute("end"),M);if(Y===null)throw E(W);if(ee===null){if(q===null)throw E(W);ee=Y+q}var re=new o.default(Y-A,ee-A,G);re.id=Object(g.generateCueId)(re.startTime,re.endTime,re.text);var pe=K[W.getAttribute("region")],Le=U[W.getAttribute("style")];re.position=10,re.size=80;var Te=l(pe,Le),be=Te.textAlign;if(be){var Re=T[be];Re&&(re.lineAlign=Re),re.align=be}return d(re,Te),re}).filter(function(W){return W!==null})}function u(P,A,w){var L=P.getElementsByTagName(A)[0];return L?[].slice.call(L.querySelectorAll(w)):[]}function f(P){return P.reduce(function(A,w){var L=w.getAttribute("xml:id");return L&&(A[L]=w),A},{})}function v(P,A){return[].slice.call(P.childNodes).reduce(function(w,L,R){var C;return L.nodeName==="br"&&R?w+`
`:(C=L.childNodes)!==null&&C!==void 0&&C.length?v(L,A):A?w+L.textContent.trim().replace(/\s+/g," "):w+L.textContent},"")}function l(P,A){var w="http://www.w3.org/ns/ttml#styling",L=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return L.reduce(function(R,C){var M=m(A,w,C)||m(P,w,C);return M&&(R[C]=M),R},{})}function m(P,A,w){return P.hasAttributeNS(A,w)?P.getAttributeNS(A,w):null}function E(P){return new Error("Could not parse ttml timestamp "+P)}function S(P,A){if(!P)return null;var w=Object(s.parseTimeStamp)(P);return w===null&&(y.test(P)?w=O(P,A):b.test(P)&&(w=D(P,A))),w}function O(P,A){var w=y.exec(P),L=(w[4]|0)+(w[5]|0)/A.subFrameRate;return(w[1]|0)*3600+(w[2]|0)*60+(w[3]|0)+L/A.frameRate}function D(P,A){var w=b.exec(P),L=Number(w[1]),R=w[2];switch(R){case"h":return L*3600;case"m":return L*60;case"ms":return L*1e3;case"f":return L/A.frameRate;case"t":return L/A.tickRate}return L}},"./src/utils/logger.ts":function(r,n,t){t.r(n),t.d(n,"enableLogs",function(){return g}),t.d(n,"logger",function(){return d});var a=function(){},s={trace:a,debug:a,log:a,warn:a,info:a,error:a},o=s;function p(h){var y=self.console[h];return y?y.bind(self.console,"["+h+"] >"):a}function x(h){for(var y=arguments.length,b=new Array(y>1?y-1:0),T=1;T<y;T++)b[T-1]=arguments[T];b.forEach(function(_){o[_]=h[_]?h[_].bind(h):p(_)})}function g(h){if(self.console&&h===!0||typeof h=="object"){x(h,"debug","log","info","warn","error");try{o.log()}catch(y){o=s}}else o=s}var d=o},"./src/utils/mediakeys-helper.ts":function(r,n,t){t.r(n),t.d(n,"KeySystems",function(){return a}),t.d(n,"requestMediaKeySystemAccess",function(){return s});var a;(function(o){o.WIDEVINE="com.widevine.alpha",o.PLAYREADY="com.microsoft.playready"})(a||(a={}));var s=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(r,n,t){t.r(n),t.d(n,"getMediaSource",function(){return a});function a(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(r,n,t){t.r(n),t.d(n,"bin2str",function(){return x}),t.d(n,"readUint16",function(){return g}),t.d(n,"readUint32",function(){return d}),t.d(n,"writeUint32",function(){return h}),t.d(n,"findBox",function(){return y}),t.d(n,"parseSegmentIndex",function(){return b}),t.d(n,"parseInitSegment",function(){return T}),t.d(n,"getStartDTS",function(){return _}),t.d(n,"getDuration",function(){return c}),t.d(n,"computeRawDurationFromSamples",function(){return u}),t.d(n,"offsetStartDTS",function(){return f}),t.d(n,"segmentValidRange",function(){return v}),t.d(n,"appendUint8Array",function(){return l});var a=t("./src/utils/typed-array.ts"),s=t("./src/loader/fragment.ts"),o=Math.pow(2,32)-1,p=[].push;function x(m){return String.fromCharCode.apply(null,m)}function g(m,E){"data"in m&&(E+=m.start,m=m.data);var S=m[E]<<8|m[E+1];return S<0?65536+S:S}function d(m,E){"data"in m&&(E+=m.start,m=m.data);var S=m[E]<<24|m[E+1]<<16|m[E+2]<<8|m[E+3];return S<0?4294967296+S:S}function h(m,E,S){"data"in m&&(E+=m.start,m=m.data),m[E]=S>>24,m[E+1]=S>>16&255,m[E+2]=S>>8&255,m[E+3]=S&255}function y(m,E){var S=[];if(!E.length)return S;var O,D,P;"data"in m?(O=m.data,D=m.start,P=m.end):(O=m,D=0,P=O.byteLength);for(var A=D;A<P;){var w=d(O,A),L=x(O.subarray(A+4,A+8)),R=w>1?A+w:P;if(L===E[0])if(E.length===1)S.push({data:O,start:A+8,end:R});else{var C=y({data:O,start:A+8,end:R},E.slice(1));C.length&&p.apply(S,C)}A=R}return S}function b(m){var E=y(m,["moov"]),S=E[0],O=S?S.end:null,D=y(m,["sidx"]);if(!D||!D[0])return null;var P=[],A=D[0],w=A.data[0],L=w===0?8:16,R=d(A,L);L+=4;var C=0,M=0;w===0?L+=8:L+=16,L+=2;var N=A.end+M,U=g(A,L);L+=2;for(var K=0;K<U;K++){var V=L,W=d(A,V);V+=4;var G=W&2147483647,Y=(W&2147483648)>>>31;if(Y===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var q=d(A,V);V+=4,P.push({referenceSize:G,subsegmentDuration:q,info:{duration:q/R,start:N,end:N+G-1}}),N+=G,V+=4,L=V}return{earliestPresentationTime:C,timescale:R,version:w,referencesCount:U,references:P,moovEndOffset:O}}function T(m){for(var E=[],S=y(m,["moov","trak"]),O=0;O<S.length;O++){var D=S[O],P=y(D,["tkhd"])[0];if(P){var A=P.data[P.start],w=A===0?12:20,L=d(P,w),R=y(D,["mdia","mdhd"])[0];if(R){A=R.data[R.start],w=A===0?12:20;var C=d(R,w),M=y(D,["mdia","hdlr"])[0];if(M){var N=x(M.data.subarray(M.start+8,M.start+12)),U={soun:s.ElementaryStreamTypes.AUDIO,vide:s.ElementaryStreamTypes.VIDEO}[N];if(U){var K=y(D,["mdia","minf","stbl","stsd"])[0],V=void 0;K&&(V=x(K.data.subarray(K.start+12,K.start+16))),E[L]={timescale:C,type:U},E[U]={timescale:C,id:L,codec:V}}}}}}var W=y(m,["moov","mvex","trex"]);return W.forEach(function(G){var Y=d(G,4),q=E[Y];q&&(q.default={duration:d(G,12),flags:d(G,20)})}),E}function _(m,E){return y(E,["moof","traf"]).reduce(function(S,O){var D=y(O,["tfdt"])[0],P=D.data[D.start],A=y(O,["tfhd"]).reduce(function(w,L){var R=d(L,4),C=m[R];if(C){var M=d(D,4);P===1&&(M*=Math.pow(2,32),M+=d(D,8));var N=C.timescale||9e4,U=M/N;if(isFinite(U)&&(w===null||U<w))return U}return w},null);return A!==null&&isFinite(A)&&(S===null||A<S)?A:S},null)||0}function c(m,E){for(var S=0,O=0,D=0,P=y(m,["moof","traf"]),A=0;A<P.length;A++){var w=P[A],L=y(w,["tfhd"])[0],R=d(L,4),C=E[R];if(!!C){var M=C.default,N=d(L,0)|(M==null?void 0:M.flags),U=M==null?void 0:M.duration;N&8&&(N&2?U=d(L,12):U=d(L,8));for(var K=C.timescale||9e4,V=y(w,["trun"]),W=0;W<V.length;W++){if(S=u(V[W]),!S&&U){var G=d(V[W],4);S=U*G}C.type===s.ElementaryStreamTypes.VIDEO?O+=S/K:C.type===s.ElementaryStreamTypes.AUDIO&&(D+=S/K)}}}if(O===0&&D===0){var Y=b(m);if(Y!=null&&Y.references)return Y.references.reduce(function(q,ee){return q+ee.info.duration||0},0)}return O||D}function u(m){var E=d(m,0),S=8;E&1&&(S+=4),E&4&&(S+=4);for(var O=0,D=d(m,4),P=0;P<D;P++){if(E&256){var A=d(m,S);O+=A,S+=4}E&512&&(S+=4),E&1024&&(S+=4),E&2048&&(S+=4)}return O}function f(m,E,S){y(E,["moof","traf"]).forEach(function(O){y(O,["tfhd"]).forEach(function(D){var P=d(D,4),A=m[P];if(!!A){var w=A.timescale||9e4;y(O,["tfdt"]).forEach(function(L){var R=L.data[L.start],C=d(L,4);if(R===0)h(L,4,C-S*w);else{C*=Math.pow(2,32),C+=d(L,8),C-=S*w,C=Math.max(C,0);var M=Math.floor(C/(o+1)),N=Math.floor(C%(o+1));h(L,4,M),h(L,8,N)}})}})})}function v(m){var E={valid:null,remainder:null},S=y(m,["moof"]);if(S){if(S.length<2)return E.remainder=m,E}else return E;var O=S[S.length-1];return E.valid=Object(a.sliceUint8)(m,0,O.start-8),E.remainder=Object(a.sliceUint8)(m,O.start-8),E}function l(m,E){var S=new Uint8Array(m.length+E.length);return S.set(m),S.set(E,m.length),S}},"./src/utils/output-filter.ts":function(r,n,t){t.r(n),t.d(n,"default",function(){return a});var a=function(){function s(p,x){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=p,this.trackName=x}var o=s.prototype;return o.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},o.newCue=function(x,g,d){(this.startTime===null||this.startTime>x)&&(this.startTime=x),this.endTime=g,this.screen=d,this.timelineController.createCaptionsTrack(this.trackName)},o.reset=function(){this.cueRanges=[],this.startTime=null},s}()},"./src/utils/texttrack-utils.ts":function(r,n,t){t.r(n),t.d(n,"sendAddTrackEvent",function(){return s}),t.d(n,"addCueToTrack",function(){return o}),t.d(n,"clearCurrentCues",function(){return p}),t.d(n,"removeCuesInRange",function(){return x}),t.d(n,"getCuesInRange",function(){return d});var a=t("./src/utils/logger.ts");function s(h,y){var b;try{b=new Event("addtrack")}catch(T){b=document.createEvent("Event"),b.initEvent("addtrack",!1,!1)}b.track=h,y.dispatchEvent(b)}function o(h,y){var b=h.mode;if(b==="disabled"&&(h.mode="hidden"),h.cues&&!h.cues.getCueById(y.id))try{if(h.addCue(y),!h.cues.getCueById(y.id))throw new Error("addCue is failed for: "+y)}catch(_){a.logger.debug("[texttrack-utils]: "+_);var T=new self.TextTrackCue(y.startTime,y.endTime,y.text);T.id=y.id,h.addCue(T)}b==="disabled"&&(h.mode=b)}function p(h){var y=h.mode;if(y==="disabled"&&(h.mode="hidden"),h.cues)for(var b=h.cues.length;b--;)h.removeCue(h.cues[b]);y==="disabled"&&(h.mode=y)}function x(h,y,b){var T=h.mode;if(T==="disabled"&&(h.mode="hidden"),h.cues&&h.cues.length>0)for(var _=d(h.cues,y,b),c=0;c<_.length;c++)h.removeCue(_[c]);T==="disabled"&&(h.mode=T)}function g(h,y){if(y<h[0].startTime)return 0;var b=h.length-1;if(y>h[b].endTime)return-1;for(var T=0,_=b;T<=_;){var c=Math.floor((_+T)/2);if(y<h[c].startTime)_=c-1;else if(y>h[c].startTime&&T<b)T=c+1;else return c}return h[T].startTime-y<y-h[_].startTime?T:_}function d(h,y,b){var T=[],_=g(h,y);if(_>-1)for(var c=_,u=h.length;c<u;c++){var f=h[c];if(f.startTime>=y&&f.endTime<=b)T.push(f);else if(f.startTime>b)return T}return T}},"./src/utils/time-ranges.ts":function(r,n,t){t.r(n);var a={toString:function(o){for(var p="",x=o.length,g=0;g<x;g++)p+="["+o.start(g).toFixed(3)+","+o.end(g).toFixed(3)+"]";return p}};n.default=a},"./src/utils/timescale-conversion.ts":function(r,n,t){t.r(n),t.d(n,"toTimescaleFromBase",function(){return s}),t.d(n,"toTimescaleFromScale",function(){return o}),t.d(n,"toMsFromMpegTsClock",function(){return p}),t.d(n,"toMpegTsClockFromTimescale",function(){return x});var a=9e4;function s(g,d,h,y){h===void 0&&(h=1),y===void 0&&(y=!1);var b=g*d*h;return y?Math.round(b):b}function o(g,d,h,y){return h===void 0&&(h=1),y===void 0&&(y=!1),s(g,d,1/h,y)}function p(g,d){return d===void 0&&(d=!1),s(g,1e3,1/a,d)}function x(g,d){return d===void 0&&(d=1),s(g,a,1/d)}},"./src/utils/typed-array.ts":function(r,n,t){t.r(n),t.d(n,"sliceUint8",function(){return a});function a(s,o,p){return Uint8Array.prototype.slice?s.slice(o,p):new Uint8Array(Array.prototype.slice.call(s,o,p))}},"./src/utils/vttcue.ts":function(r,n,t){t.r(n),n.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var a=["","lr","rl"],s=["start","middle","end","left","right"];function o(h,y){if(typeof y!="string"||!Array.isArray(h))return!1;var b=y.toLowerCase();return~h.indexOf(b)?b:!1}function p(h){return o(a,h)}function x(h){return o(s,h)}function g(h){for(var y=arguments.length,b=new Array(y>1?y-1:0),T=1;T<y;T++)b[T-1]=arguments[T];for(var _=1;_<arguments.length;_++){var c=arguments[_];for(var u in c)h[u]=c[u]}return h}function d(h,y,b){var T=this,_={enumerable:!0};T.hasBeenReset=!1;var c="",u=!1,f=h,v=y,l=b,m=null,E="",S=!0,O="auto",D="start",P=50,A="middle",w=50,L="middle";Object.defineProperty(T,"id",g({},_,{get:function(){return c},set:function(C){c=""+C}})),Object.defineProperty(T,"pauseOnExit",g({},_,{get:function(){return u},set:function(C){u=!!C}})),Object.defineProperty(T,"startTime",g({},_,{get:function(){return f},set:function(C){if(typeof C!="number")throw new TypeError("Start time must be set to a number.");f=C,this.hasBeenReset=!0}})),Object.defineProperty(T,"endTime",g({},_,{get:function(){return v},set:function(C){if(typeof C!="number")throw new TypeError("End time must be set to a number.");v=C,this.hasBeenReset=!0}})),Object.defineProperty(T,"text",g({},_,{get:function(){return l},set:function(C){l=""+C,this.hasBeenReset=!0}})),Object.defineProperty(T,"region",g({},_,{get:function(){return m},set:function(C){m=C,this.hasBeenReset=!0}})),Object.defineProperty(T,"vertical",g({},_,{get:function(){return E},set:function(C){var M=p(C);if(M===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=M,this.hasBeenReset=!0}})),Object.defineProperty(T,"snapToLines",g({},_,{get:function(){return S},set:function(C){S=!!C,this.hasBeenReset=!0}})),Object.defineProperty(T,"line",g({},_,{get:function(){return O},set:function(C){if(typeof C!="number"&&C!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");O=C,this.hasBeenReset=!0}})),Object.defineProperty(T,"lineAlign",g({},_,{get:function(){return D},set:function(C){var M=x(C);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");D=M,this.hasBeenReset=!0}})),Object.defineProperty(T,"position",g({},_,{get:function(){return P},set:function(C){if(C<0||C>100)throw new Error("Position must be between 0 and 100.");P=C,this.hasBeenReset=!0}})),Object.defineProperty(T,"positionAlign",g({},_,{get:function(){return A},set:function(C){var M=x(C);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");A=M,this.hasBeenReset=!0}})),Object.defineProperty(T,"size",g({},_,{get:function(){return w},set:function(C){if(C<0||C>100)throw new Error("Size must be between 0 and 100.");w=C,this.hasBeenReset=!0}})),Object.defineProperty(T,"align",g({},_,{get:function(){return L},set:function(C){var M=x(C);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");L=M,this.hasBeenReset=!0}})),T.displayState=void 0}return d.prototype.getCueAsHTML=function(){var h=self.WebVTT;return h.convertCueToDOMTree(self,this.text)},d}()},"./src/utils/vttparser.ts":function(r,n,t){t.r(n),t.d(n,"parseTimeStamp",function(){return o}),t.d(n,"fixLineBreaks",function(){return y}),t.d(n,"VTTParser",function(){return b});var a=t("./src/utils/vttcue.ts"),s=function(){function T(){}var _=T.prototype;return _.decode=function(u,f){if(!u)return"";if(typeof u!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(u))},T}();function o(T){function _(u,f,v,l){return(u|0)*3600+(f|0)*60+(v|0)+parseFloat(l||0)}var c=T.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return c?parseFloat(c[2])>59?_(c[2],c[3],0,c[4]):_(c[1],c[2],c[3],c[4]):null}var p=function(){function T(){this.values=Object.create(null)}var _=T.prototype;return _.set=function(u,f){!this.get(u)&&f!==""&&(this.values[u]=f)},_.get=function(u,f,v){return v?this.has(u)?this.values[u]:f[v]:this.has(u)?this.values[u]:f},_.has=function(u){return u in this.values},_.alt=function(u,f,v){for(var l=0;l<v.length;++l)if(f===v[l]){this.set(u,f);break}},_.integer=function(u,f){/^-?\d+$/.test(f)&&this.set(u,parseInt(f,10))},_.percent=function(u,f){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(f)){var v=parseFloat(f);if(v>=0&&v<=100)return this.set(u,v),!0}return!1},T}();function x(T,_,c,u){var f=u?T.split(u):[T];for(var v in f)if(typeof f[v]=="string"){var l=f[v].split(c);if(l.length===2){var m=l[0],E=l[1];_(m,E)}}}var g=new a.default(0,0,""),d=g.align==="middle"?"middle":"center";function h(T,_,c){var u=T;function f(){var m=o(T);if(m===null)throw new Error("Malformed timestamp: "+u);return T=T.replace(/^[^\sa-zA-Z-]+/,""),m}function v(m,E){var S=new p;x(m,function(P,A){var w;switch(P){case"region":for(var L=c.length-1;L>=0;L--)if(c[L].id===A){S.set(P,c[L].region);break}break;case"vertical":S.alt(P,A,["rl","lr"]);break;case"line":w=A.split(","),S.integer(P,w[0]),S.percent(P,w[0])&&S.set("snapToLines",!1),S.alt(P,w[0],["auto"]),w.length===2&&S.alt("lineAlign",w[1],["start",d,"end"]);break;case"position":w=A.split(","),S.percent(P,w[0]),w.length===2&&S.alt("positionAlign",w[1],["start",d,"end","line-left","line-right","auto"]);break;case"size":S.percent(P,A);break;case"align":S.alt(P,A,["start",d,"end","left","right"]);break}},/:/,/\s/),E.region=S.get("region",null),E.vertical=S.get("vertical","");var O=S.get("line","auto");O==="auto"&&g.line===-1&&(O=-1),E.line=O,E.lineAlign=S.get("lineAlign","start"),E.snapToLines=S.get("snapToLines",!0),E.size=S.get("size",100),E.align=S.get("align",d);var D=S.get("position","auto");D==="auto"&&g.position===50&&(D=E.align==="start"||E.align==="left"?0:E.align==="end"||E.align==="right"?100:50),E.position=D}function l(){T=T.replace(/^\s+/,"")}if(l(),_.startTime=f(),l(),T.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+u);T=T.substr(3),l(),_.endTime=f(),l(),v(T,_)}function y(T){return T.replace(/<br(?: \/)?>/gi,`
`)}var b=function(){function T(){this.state="INITIAL",this.buffer="",this.decoder=new s,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var _=T.prototype;return _.parse=function(u){var f=this;u&&(f.buffer+=f.decoder.decode(u,{stream:!0}));function v(){var D=f.buffer,P=0;for(D=y(D);P<D.length&&D[P]!=="\r"&&D[P]!==`
`;)++P;var A=D.substr(0,P);return D[P]==="\r"&&++P,D[P]===`
`&&++P,f.buffer=D.substr(P),A}function l(D){x(D,function(P,A){},/:/)}try{var m="";if(f.state==="INITIAL"){if(!/\r\n|\n/.test(f.buffer))return this;m=v();var E=m.match(/^()?WEBVTT([ \t].*)?$/);if(!E||!E[0])throw new Error("Malformed WebVTT signature.");f.state="HEADER"}for(var S=!1;f.buffer;){if(!/\r\n|\n/.test(f.buffer))return this;switch(S?S=!1:m=v(),f.state){case"HEADER":/:/.test(m)?l(m):m||(f.state="ID");continue;case"NOTE":m||(f.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(m)){f.state="NOTE";break}if(!m)continue;if(f.cue=new a.default(0,0,""),f.state="CUE",m.indexOf("-->")===-1){f.cue.id=m;continue}case"CUE":if(!f.cue){f.state="BADCUE";continue}try{h(m,f.cue,f.regionList)}catch(D){f.cue=null,f.state="BADCUE";continue}f.state="CUETEXT";continue;case"CUETEXT":{var O=m.indexOf("-->")!==-1;if(!m||O&&(S=!0)){f.oncue&&f.cue&&f.oncue(f.cue),f.cue=null,f.state="ID";continue}if(f.cue===null)continue;f.cue.text&&(f.cue.text+=`
`),f.cue.text+=m}continue;case"BADCUE":m||(f.state="ID")}}}catch(D){f.state==="CUETEXT"&&f.cue&&f.oncue&&f.oncue(f.cue),f.cue=null,f.state=f.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},_.flush=function(){var u=this;try{if((u.cue||u.state==="HEADER")&&(u.buffer+=`

`,u.parse()),u.state==="INITIAL"||u.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(f){u.onparsingerror&&u.onparsingerror(f)}return u.onflush&&u.onflush(),this},T}()},"./src/utils/webvtt-parser.ts":function(r,n,t){t.r(n),t.d(n,"generateCueId",function(){return b}),t.d(n,"parseWebVTT",function(){return _});var a=t("./src/polyfills/number.ts"),s=t("./src/utils/vttparser.ts"),o=t("./src/demux/id3.ts"),p=t("./src/utils/timescale-conversion.ts"),x=t("./src/remux/mp4-remuxer.ts"),g=/\r\n|\n\r|\n|\r/g,d=function(u,f,v){return v===void 0&&(v=0),u.substr(v,f.length)===f},h=function(u){var f=parseInt(u.substr(-3)),v=parseInt(u.substr(-6,2)),l=parseInt(u.substr(-9,2)),m=u.length>9?parseInt(u.substr(0,u.indexOf(":"))):0;if(!Object(a.isFiniteNumber)(f)||!Object(a.isFiniteNumber)(v)||!Object(a.isFiniteNumber)(l)||!Object(a.isFiniteNumber)(m))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+u);return f+=1e3*v,f+=60*1e3*l,f+=60*60*1e3*m,f},y=function(u){for(var f=5381,v=u.length;v;)f=f*33^u.charCodeAt(--v);return(f>>>0).toString()};function b(c,u,f){return y(c.toString())+y(u.toString())+y(f)}var T=function(u,f,v){var l=u[f],m=u[l.prevCC];if(!m||!m.new&&l.new){u.ccOffset=u.presentationOffset=l.start,l.new=!1;return}for(;(E=m)!==null&&E!==void 0&&E.new;){var E;u.ccOffset+=l.start-m.start,l.new=!1,l=m,m=u[l.prevCC]}u.presentationOffset=v};function _(c,u,f,v,l,m,E,S){var O=new s.VTTParser,D=Object(o.utf8ArrayToStr)(new Uint8Array(c)).trim().replace(g,`
`).split(`
`),P=[],A=Object(p.toMpegTsClockFromTimescale)(u,f),w="00:00.000",L=0,R=0,C,M=!0,N=!1;O.oncue=function(U){var K=v[l],V=v.ccOffset,W=(L-A)/9e4;if(K!=null&&K.new&&(R!==void 0?V=v.ccOffset=K.start:T(v,l,W)),W&&(V=W-v.presentationOffset),N){var G=U.endTime-U.startTime,Y=Object(x.normalizePts)((U.startTime+V-R)*9e4,m*9e4)/9e4;U.startTime=Y,U.endTime=Y+G}var q=U.text.trim();U.text=decodeURIComponent(encodeURIComponent(q)),U.id||(U.id=b(U.startTime,U.endTime,q)),U.endTime>0&&P.push(U)},O.onparsingerror=function(U){C=U},O.onflush=function(){if(C){S(C);return}E(P)},D.forEach(function(U){if(M)if(d(U,"X-TIMESTAMP-MAP=")){M=!1,N=!0,U.substr(16).split(",").forEach(function(K){d(K,"LOCAL:")?w=K.substr(6):d(K,"MPEGTS:")&&(L=parseInt(K.substr(7)))});try{R=h(w)/1e3}catch(K){N=!1,C=K}return}else U===""&&(M=!1);O.parse(U+`
`)}),O.flush()}},"./src/utils/xhr-loader.ts":function(r,n,t){t.r(n);var a=t("./src/utils/logger.ts"),s=t("./src/loader/load-stats.ts"),o=/^age:\s*[\d.]+\s*$/m,p=function(){function x(d){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=d?d.xhrSetup:null,this.stats=new s.LoadStats,this.retryDelay=0}var g=x.prototype;return g.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},g.abortInternal=function(){var h=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),h&&(h.onreadystatechange=null,h.onprogress=null,h.readyState!==4&&(this.stats.aborted=!0,h.abort()))},g.abort=function(){var h;this.abortInternal(),(h=this.callbacks)!==null&&h!==void 0&&h.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},g.load=function(h,y,b){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=h,this.config=y,this.callbacks=b,this.retryDelay=y.retryDelay,this.loadInternal()},g.loadInternal=function(){var h=this.config,y=this.context;if(!!h){var b=this.loader=new self.XMLHttpRequest,T=this.stats;T.loading.first=0,T.loaded=0;var _=this.xhrSetup;try{if(_)try{_(b,y.url)}catch(f){b.open("GET",y.url,!0),_(b,y.url)}b.readyState||b.open("GET",y.url,!0);var c=this.context.headers;if(c)for(var u in c)b.setRequestHeader(u,c[u])}catch(f){this.callbacks.onError({code:b.status,text:f.message},y,b);return}y.rangeEnd&&b.setRequestHeader("Range","bytes="+y.rangeStart+"-"+(y.rangeEnd-1)),b.onreadystatechange=this.readystatechange.bind(this),b.onprogress=this.loadprogress.bind(this),b.responseType=y.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),h.timeout),b.send()}},g.readystatechange=function(){var h=this.context,y=this.loader,b=this.stats;if(!(!h||!y)){var T=y.readyState,_=this.config;if(!b.aborted&&T>=2)if(self.clearTimeout(this.requestTimeout),b.loading.first===0&&(b.loading.first=Math.max(self.performance.now(),b.loading.start)),T===4){y.onreadystatechange=null,y.onprogress=null;var c=y.status;if(c>=200&&c<300){b.loading.end=Math.max(self.performance.now(),b.loading.first);var u,f;if(h.responseType==="arraybuffer"?(u=y.response,f=u.byteLength):(u=y.responseText,f=u.length),b.loaded=b.total=f,!this.callbacks)return;var v=this.callbacks.onProgress;if(v&&v(b,h,u,y),!this.callbacks)return;var l={url:y.responseURL,data:u};this.callbacks.onSuccess(l,b,h,y)}else b.retry>=_.maxRetry||c>=400&&c<499?(a.logger.error(c+" while loading "+h.url),this.callbacks.onError({code:c,text:y.statusText},h,y)):(a.logger.warn(c+" while loading "+h.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,_.maxRetryDelay),b.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.timeout)}},g.loadtimeout=function(){a.logger.warn("timeout while loading "+this.context.url);var h=this.callbacks;h&&(this.abortInternal(),h.onTimeout(this.stats,this.context,this.loader))},g.loadprogress=function(h){var y=this.stats;y.loaded=h.loaded,h.lengthComputable&&(y.total=h.total)},g.getCacheAge=function(){var h=null;if(this.loader&&o.test(this.loader.getAllResponseHeaders())){var y=this.loader.getResponseHeader("age");h=y?parseFloat(y):null}return h},x}();n.default=p}}).default})})(lp);var d1=Gu(lp.exports);const up=3,h1=["m3u8"],p1=({file:i})=>{const{getSetting:e,lastFiles:r}=vt.exports.useContext(Sn),n=r.filter(h=>h.type===up),{i18n:t}=ca();let a=kn(),s=a();const o=Kp(!0),p=i.name.endsWith(".m3u8")?s:i.url,x=Rp();let g;const d=Ku({base:"30px",md:"50px"});return vt.exports.useEffect(()=>{let h={container:"#video-player",title:i.name,url:p,autoplay:e("autoplay video")==="true",autoMini:!0,autoSize:!1,playbackRate:!0,flip:!0,rotate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,mutex:!0,light:!0,backdrop:!0,subtitleOffset:!0,miniProgressBar:!0,localVideo:!0,localSubtitle:!0,lang:t.language==="zh"?"zh-cn":"en",setting:!0,pip:!0,customType:{flv:function(c,u){const f=f1.createPlayer({type:"flv",url:u},{referrerPolicy:"no-referrer"});f.attachMediaElement(c),f.load()},m3u8:function(c,u){var f=new d1;f.loadSource(u),f.attachMedia(c)}},moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0}};i.name.toLowerCase().endsWith(".flv")&&(h.type="flv"),e("artplayer whitelist")?h.whitelist=e("artplayer whitelist").split(","):h.whitelist=[],!c1||h.whitelist.some(c=>c==="*"||is.indexOf(c)>-1)||(h.moreVideoAttr.controls=!0),e("artplayer autoSize")==="true"&&(h.autoSize=!0);const b=i.name.substring(0,i.name.lastIndexOf("."));let T="";const _=r.find(c=>{const u=c.name;if(!u.startsWith(b))return!1;for(const f of[".srt",".ass",".vtt"])if(u.endsWith(f))return!0;return!1});return _&&(o+""+_.name,h.subtitle={type:T,url:a(_),bilingual:!0,style:{color:"#03A9F4","font-size":d}}),g=new u1(h),g.on("video:ended",()=>{const c=n.findIndex(u=>u.name===i.name);c<n.length-1&&x.push(encodeURI(n[c+1].name))}),()=>{g&&g.destroy&&g.destroy()}},[]),oe.createElement(bi,{w:"full",className:"video-preview-box"},oe.createElement(Cp,null,oe.createElement(Ip,{rightIcon:oe.createElement(da,{boxSize:6,as:zp}),w:"full",colorScheme:"gray",as:jr,mb:2},oe.createElement(Mp,{w:"full",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},i.name)),oe.createElement(kp,{w:"full",maxH:"65vh",overflowY:"auto",zIndex:999},n.map(h=>oe.createElement(Np,{key:h.name,w:"full"},oe.createElement(tl,{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxW:"85vw",w:"full",as:Bp,_hover:{textDecoration:"none"},to:encodeURI(h.name)},h.name))))),oe.createElement(bi,{w:"full",h:"60vh",id:"video-player"}),oe.createElement(Fp,{mt:"2",spacing:"2",justify:"center"},oe.createElement(jr,{colorScheme:"purple",as:Ti.a,href:`iina://weblink?url=${s}`},"IINA"),oe.createElement(jr,{colorScheme:"yellow",as:Ti.a,href:`potplayer://${s}`},"PotPlayer"),oe.createElement(jr,{colorScheme:"orange",as:Ti.a,href:`vlc://${s}`},"VLC"),oe.createElement(jr,{colorScheme:"teal",as:Ti.a,href:`nplayer-${s}`},"nPlayer"),oe.createElement(jr,{colorScheme:"blue",as:Ti.a,href:`intent:${s}#Intent;package=com.mxtech.videoplayer.ad;S.title=${i.name};end`},"MXPlayer"),oe.createElement(jr,{colorScheme:"blue",as:Ti.a,href:`intent:${s}#Intent;package=com.mxtech.videoplayer.pro;S.title=${i.name};end`},"MXPlayer Pro")))};var v1=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",type:up,exts:h1,default:p1});const fp={"../preview/audio.tsx":_y,"../preview/epub.tsx":zT,"../preview/image.tsx":HT,"../preview/ipa.tsx":QT,"../preview/markdown.tsx":Vp,"../preview/office.tsx":i1,"../preview/pdf.tsx":e1,"../preview/plist.tsx":l1,"../preview/video.tsx":v1},g1=({file:i})=>{const{getSetting:e}=vt.exports.useContext(Sn),r=i.name.split(".").pop()||"",n=kn(),{t}=ca();return oe.createElement(Si,{className:"no-preview",p:"4"},oe.createElement(el,{spacing:"8"},oe.createElement(da,{color:e("icon color")||"#1890ff",boxSize:20,as:cs(i.type,r)}),oe.createElement(fs,{size:"md"},i.name),oe.createElement(jr,{onClick:()=>{window.open(n(),"_blank")}},t("Download"))))},O1=()=>{const{files:i}=vt.exports.useContext(Sn);Gp(i[0].name);for(const e in fp){const r=fp[e],n=r.default;if(r.type===i[0].type||r.exts.includes(i[0].name.split(".").pop()))return oe.createElement(n,{file:i[0]})}return oe.createElement(g1,{file:i[0]})};export{O1 as default};
